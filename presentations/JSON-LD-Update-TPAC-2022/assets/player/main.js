"use strict";var SC=SC||{},CoreDocs=CoreDocs||{},NO=!1,YES=!0;for(var key in CoreDocs.loc=function(e,t){return void 0===t&&CoreDocs.error('"'+e+'" needs a comment to be picked up for loc.'),e=(e=e.loc()).replace(/@@/g,"%@")},SC.String={fmt:function(){for(var e=this.replace(/%@([0-9]+)/,(function(e){return(arguments[parseInt(e[1],0)-1]||"").toString()})),t=[],i=-1,r=0,a=0;(i=e.indexOf("%@",r))>=0;){t.push(e.slice(r,i)),r=i+2;var n=arguments[a++];n&&n.toString&&(n=n.toString()),t.push(n)}return r<e.length&&t.push(e.slice(r,e.length)),t.length>1?t.join(""):t[0]},loc:function(){var e=String[String.currentLanguage()],t=e[this];return t||(t=String.English[this]||this),t.fmt.apply(t,arguments)}},SC.String)String.prototype[key]=SC.String[key];function getUrlParameter(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?"":t[1]}function setElementProperty(e,t,i){"ms"===browserPrefix?e.style[t]=i:e.style.setProperty(t,i,null)}function setElementPosition(e,t,i,r,a){null!=e?(e.style.top=t+"px",e.style.left=i+"px",e.style.width=r+"px",e.style.height=a+"px"):window.console.log("null element passed to setElementPosition "+t+", "+i+", "+r+", "+a)}function showElement(e){null!=e&&(e.style.visibility="visible")}function hideElement(e){null!=e&&(e.style.visibility="hidden")}function runInNextEventLoop(e){setTimeout(e,100)}function ensureScaleFactorNotZero(e){return 0===e?1e-6:e}function scaleSizeWithinSize(e,t,i,r){var a={},n=e/t,o=i/r;return n>o?(a.width=i,a.height=t*(i/e)):n<o?(a.width=e*(r/t),a.height=r):(a.width=i,a.height=r),a}function parseTransformMatrix(e){var t=[1,0,0,1,0,0];0===e.indexOf("matrix(")&&(t=e.substring(7,e.length-1).split(","));return t}function escapeTextureId(e){return e.replace(/\./g,"-")}function unEscapeTextureId(e){return e.replace(/\-/g,".")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.assign(String,{browserLanguage:(navigator.language||navigator.browserLanguage).split("-",1)[0],useAutodetectedLanguage:NO,preferredLanguage:null,currentLanguage:function(){var e=this.useAutodetectedLanguage?this.browserLanguage||this.preferredLanguage||"en":this.preferredLanguage||this.browserLanguage||"en";return this[e]||(e=this.normalizedLanguage(e)),e},normalizedLanguage:function(e){switch(e){case"fr":e="French";break;case"de":e="German";break;case"ja":case"jp":e="Japanese";break;default:e="English";break;case"es":e="Spanish"}return e},addStringsFor:function(e,t){return e=String.normalizedLanguage(e),String[e]||(String[e]={}),Object.assign(String[e],t||{}),this}}),String.English=String.English||{},String.French=String.French||{},String.German=String.German||{},String.Japanese=String.Japanese||{},String.Spanish=String.Spanish||{};var browserPrefix,browserVersion,kOrientationUnknown="orientationUnknown",kOrientationLandscape="orientationLandscape",kOrientationPortrait="orientationPortrait",kShowModeNormal=0,kShowModeAutoplay=1,kShowModeHyperlinksOnly=2,kSoundTrackModePlayOnce=0,kSoundTrackModeLooping=1,kSoundTrackModeOff=2,kOpacityPropertyName="opacity",kVisibilityPropertyName="visibility",kZIndexPropertyName="z-index",kDisplayPropertyName="display",kDisplayBlockPropertyValue="block",kDisplayNonePropertyValue="none",kTransformOriginTopLeftPropertyValue="top left",kTransformOriginCenterPropertyValue="center",kTransformStylePreserve3DPropertyValue="preserve-3d",kTransformStyleFlatPropertyValue="flat",kPositionAbsolutePropertyValue="absolute",kPositionRelativePropertyValue="relative",kBackfaceVisibilityHiddenPropertyValue="hidden",kMaxSceneDownloadWaitTime=12e4,kMaxScriptDownloadWaitTime=12e4,kWaitingIndicatorFadeOutDuration=2e3,kHideAddressBarDelay=3e3,kSceneLoadPollInterval=100,kSceneLoadDisplaySpinnerTime=3e3,kSceneLoadDisplaySpinnerPollCount=kSceneLoadDisplaySpinnerTime/kSceneLoadPollInterval,kSceneLoadGiveUpTime=6e4,kSceneLoadGiveUpPollCount=kSceneLoadGiveUpTime/kSceneLoadPollInterval,kPropertyName_currentSlide="currentSlide",kKeyCode_Plus=107,kKeyCode_Minus=109,kKeyCode_Dot=110,kKeyCode_F11=122,kKeyCode_F12=123,kKeyCode_Hyphen=189,kKeyCode_Equal=187,kKeyCode_Period=190,kKeyCode_Slash=191,kKeyCode_Space=32,kKeyCode_Escape=27,kKeyCode_LeftArrow=37,kKeyCode_UpArrow=38,kKeyCode_RightArrow=39,kKeyCode_DownArrow=40,kKeyCode_OpenBracket=219,kKeyCode_CloseBracket=221,kKeyCode_Home=36,kKeyCode_End=35,kKeyCode_PageUp=33,kKeyCode_PageDown=34,kKeyCode_Return=13,kKeyCode_N=78,kKeyCode_P=80,kKeyCode_Q=81,kKeyCode_S=83,kKeyCode_Delete=8,kKeyCode_0=48,kKeyCode_9=57,kKeyCode_Numeric_0=96,kKeyCode_Numeric_9=105,kKeyModifier_Shift=1e3,kKeyModifier_Ctrl=2e3,kKeyModifier_Alt=3e3,kKeyModifier_Meta=4e3,kHelpPlacardMainTitle=CoreDocs.loc("Keyboard Shortcuts","Keyboard Shortcuts"),kHelpPlacardNavigationTitle=CoreDocs.loc("Navigation","Navigation"),kHelpPlacardOtherTitle=CoreDocs.loc("Other","Other"),kHelpPlacardAdvanceToNextBuild=CoreDocs.loc("Advance to next build","Advance to next build"),kHelpPlacardGoBackToPreviousBuild=CoreDocs.loc("Go back to previous build","Go back to previous build"),kHelpPlacardAdvanceAndSkipBuild=CoreDocs.loc("Advance and skip build","Advance and skip build"),kHelpPlacardAdvanceToNextSlide=CoreDocs.loc("Advance to next slide","Advance to next slide"),kHelpPlacardGoBackToPreviousSlide=CoreDocs.loc("Go back to previous slide","Go back to previous slide"),kHelpPlacardGoToFirstSlide=CoreDocs.loc("Go to first slide","Go to first slide"),kHelpPlacardGoToLastSlide=CoreDocs.loc("Go to last slide","Go to last slide"),kHelpPlacardQuitPresentationMode=CoreDocs.loc("Quit presentation mode","Quit presentation mode"),kHelpPlacardGoToSpecificSlide=CoreDocs.loc("Go to specific slide","Go to specific slide"),kHelpPlacardShowOrHideKeyboardShortcuts=CoreDocs.loc("Show or hide Keyboard Shortcuts","Show or hide Keyboard Shortcuts"),kHelpPlacardShowOrHideTheCurrentSlideNumber=CoreDocs.loc("Show or hide the current slide number","Show or hide the current slide number"),kUnableToReachiWorkTryAgain=CoreDocs.loc("Slide couldn't be displayed.\nDo you want to try again?","alert text to display when we timeout trying to download resources from iWork.com"),kSlideLabel=CoreDocs.loc("Slide","Prefix label for 'Slide I/N' display"),kTapOrSwipeToAdvance=CoreDocs.loc("Tap or Swipe to advance","Help string for bottom of portrait mode on mobile device"),gShowController=null,userAgentString=window.navigator.userAgent,isMacOS=-1!==window.navigator.platform.indexOf("Mac"),isIOS="iPad"===navigator.platform||"iPhone"===navigator.platform||"iPod"===navigator.platform,isSafari=!1,isChrome=!1,isEdge=!1,isFirefox=!1;userAgentString.lastIndexOf("Edge/")>0?(isEdge=!0,browserPrefix="webkit",browserVersion=12):userAgentString.indexOf("AppleWebKit/")>-1?(browserPrefix="webkit",userAgentString.lastIndexOf("Chrome/")>0&&(isChrome=!0),!isChrome&&userAgentString.lastIndexOf("Safari/")>0&&(isSafari=!0)):userAgentString.indexOf("Gecko")>-1&&-1===userAgentString.indexOf("KHTML")&&(browserPrefix="moz",isFirefox=!0);var kKeyframesPropertyName="@-"+browserPrefix+"-keyframes",kAnimationNamePropertyName="-"+browserPrefix+"-animation-name",kAnimationDurationPropertyName="-"+browserPrefix+"-animation-duration",kAnimationDelayPropertyName="-"+browserPrefix+"-animation-delay",kAnimationFillModePropertyName="-"+browserPrefix+"-animation-fill-mode",kAnimationTimingFunctionPropertyName="-"+browserPrefix+"-animation-timing-function",kAnimationIterationCountPropertyName="-"+browserPrefix+"-animation-iteration-count",kTransformPropertyName="-"+browserPrefix+"-transform",kTransformOriginPropertyName="-"+browserPrefix+"-transform-origin",kTransformOriginZPropertyName="-"+browserPrefix+"-transform-origin-z",kTransitionPropertyName="-"+browserPrefix+"-transition",kTransitionDurationName="-"+browserPrefix+"-transition-duration",kTransformStylePropertyName="-"+browserPrefix+"-transform-style",kTransitionEndEventName=browserPrefix+"TransitionEnd",kAnimationEndEventName=browserPrefix+"AnimationEnd",kPerspectivePropertyName="-"+browserPrefix+"-perspective",kPerspectiveOriginPropertyName="-"+browserPrefix+"-perspective-origin",kBackfaceVisibilityPropertyName="-"+browserPrefix+"-backface-visibility",kBoxShadowPropertyName="-"+browserPrefix+"-box-shadow",kBorderPropertyName="border",kBackgroundImagePropertyName="background-image",kEmphasisEffects=["apple:action-pop","apple:action-pulse","apple:action-blink","apple:action-flip","apple:action-bounce","apple:action-jiggle"],kActionBuildKeyAnimations={"apple:action-opacity":["opacity"],"apple:action-motion-path":["position"],"apple:action-rotation":["transform.rotation.z"],"apple:action-scale":["transform.scale.x","transform.scale.y","anchorPoint","contents","bounds"],"apple:action-blink":["opacity"],"apple:action-bounce":["anchorPoint","transform.scale.y","transform.translation.y","transform.scale.x"],"apple:action-flip":["transform.rotation.y","transform.scale.xy"],"apple:action-jiggle":["transform.rotation.z"],"apple:action-pop":["transform.scale.xy"],"apple:action-pulse":["transform.scale.xy"]},kSupportedWebGLEffects=["apple:wipe-iris","com.apple.iWork.Keynote.BUKAnvil","com.apple.iWork.Keynote.BUKTwist","com.apple.iWork.Keynote.BUKFlop","com.apple.iWork.Keynote.KLNColorPlanes","com.apple.iWork.Keynote.KLNFlame","com.apple.iWork.Keynote.KLNConfetti","com.apple.iWork.Keynote.KLNDiffuse","com.apple.iWork.Keynote.KNFireworks","com.apple.iWork.Keynote.KLNShimmer","com.apple.iWork.Keynote.KLNSparkle","apple:magic-move-implied-motion-path","apple:ca-text-shimmer","apple:ca-text-sparkle"],useWebGL=!0,usePDF=!0,pdfScaleFactor=1,kFullscreenChangeEventName=browserPrefix+"fullscreenchange";function static_url(e){return e}function extractDelegateFromUrlParameter(){var e,t=getUrlParameter("delegate");if(""==t||null==t||void 0===t)e=new NullDelegate;else{var i=t.indexOf(".");for(e=window;-1!=i;){e=e[t.substring(0,i)],i=(t=t.substring(i+1)).indexOf(".")}e=e[t]}return e}function urlParamsGet(e,t){var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==i?"":i.length>1?decodeURIComponent(i[1]):""}window.addEventListener("load",setupShowController,!1);var NullDelegate=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"showDidLoad",value:function(){}},{key:"showExited",value:function(){history.go(-1)}},{key:"propertyChanged",value:function(e,t){}},{key:"setPlaybackReadyHandler",value:function(e){e()}}]),e}();function setupShowController(){(gShowController=new ShowController).displayManager.showWaitingIndicator(),gShowController.delegate.setPlaybackReadyHandler((function(){if(usePDF){"file:"===window.location.protocol&&(PDFJS.disableWorker=!0),PDFJS.workerSrc="./assets/player/pdfjs/pdf_worker.js",PDFJS.cMapUrl="./assets/player/pdfjs/web/cmaps/",PDFJS.cMapPacked=!0;var e=document.createElement("canvas");e.getContext("webgl")||e.getContext("experimental-webgl")||(useWebGL=!1)}gShowController.startShow()}))}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(){if("function"==typeof window.CustomEvent)return!1;window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}}();var kShowControllerState_Stopped="Stopped",kShowControllerState_Starting="Starting",kShowControllerState_DownloadingScript="DownloadingScipt",kShowControllerState_SettingUpScene="SettingUpScene",kShowControllerState_IdleAtFinalState="IdleAtFinalState",kShowControllerState_IdleAtInitialState="IdleAtInitialState",kShowControllerState_WaitingToJump="WaitingToJump",kShowControllerState_ReadyToJump="ReadyToJump",kShowControllerState_WaitingToDisplay="WaitingToDisplay",kShowControllerState_ReadyToDisplay="ReadyToDisplay",kShowControllerState_WaitingToPlay="WaitingToPlay",kShowControllerState_ReadyToPlay="ReadyToPlay",kShowControllerState_Playing="Playing",kKeyDownEvent="keydown",kSlideIndexDidChangeEvent="ShowController:SlideIndexDidChangeEvent",ShowController=function(){function e(){_classCallCheck(this,e),this.delegate=extractDelegateFromUrlParameter(),this.delegate.showDidLoad(),this.showUrl="./assets/",this.displayManager=new DisplayManager,this.scriptManager=new ScriptManager(this.showUrl),this.textureManager=new TextureManager(this.showUrl),this.stageManager=new StageManager(this.textureManager,this.scriptManager),this.touchController=new TouchController,this.animationManager=new AnimationManager,this.orientationController=new OrientationController,this.activeHyperlinks=[],this.movieHyperlinks=[],this.script=null,this.currentSceneIndex=-1,this.nextSceneIndex=-1,this.currentSlideIndex=-1,this.previousSlideIndex=-1,this.currentSoundTrackIndex=0,this.transformOriginValue="",this.accumulatingDigits=!1,this.digitAccumulator=0,this.firstSlide=!0,this.lastSlideViewedIndex=-1,this.accountID="",this.guid="",this.locale="EN",this.isNavigationBarVisible=!1,this.isFullscreen=!1,this.volume=3,this.muted=!1,this.soundTrackPlayer=null,this.sceneIndexOfPrebuiltAnimations=-1,this.queuedUserAction=null,this.handleScriptDidDownloadEvent=this.handleScriptDidDownloadEvent.bind(this),this.handleScriptDidNotDownloadEvent=this.handleScriptDidNotDownloadEvent.bind(this),this.handleStageIsReadyEvent=this.handleStageIsReadyEvent.bind(this),this.handleStageSizeDidChangeEvent=this.handleStageSizeDidChangeEvent.bind(this),this.handleKeyDownEvent=this.handleKeyDownEvent.bind(this),this.handleSwipeEvent=this.handleSwipeEvent.bind(this),this.handleClickEvent=this.handleClickEvent.bind(this),this.handleContextMenuEvent=this.handleContextMenuEvent.bind(this),this.handleFullscreenChangeEvent=this.handleFullscreenChangeEvent.bind(this),this.handleWindowResizeEvent=this.handleWindowResizeEvent.bind(this),this.addGlobalEventListeners(),this.touchController.registerTapEventCallback(this.handleTapEvent.bind(this)),this.changeState(kShowControllerState_Stopped),this.movieCache=null,this.iframeCache=null,this.audioCache=null,this.playbackController=new KPFPlaybackController({},this.stageManager.stage),this.navigatorController=new NavigatorController(document.getElementById("slideshowNavigator")),this.slideNumberController=new SlideNumberController(document.getElementById("slideNumberControl")),this.slideNumberDisplay=new SlideNumberDisplay(document.getElementById("slideNumberDisplay")),this.helpPlacard=new HelpPlacardController(document.getElementById("helpPlacard")),this.isRecording=!1,this.isRecordingStarted=!1}return _createClass(e,[{key:"startShow",value:function(){this.changeState(kShowControllerState_DownloadingScript),this.scriptManager.downloadScript(this.delegate)}},{key:"exitShow",value:function(e){clearTimeout(this.exitTimeout),e?this.delegate.showExited():this.exitTimeout=setTimeout(function(){this.delegate.showExited()}.bind(this),750)}},{key:"promptUserToTryAgain",value:function(e){return confirm(e)}},{key:"handleScriptDidDownloadEvent",value:function(e){switch(this.state){case kShowControllerState_DownloadingScript:var t,i=this.script=e.detail.script,r=i.showMode;r==kShowModeHyperlinksOnly&&this.displayManager.setHyperlinksOnlyMode(),this.changeState(kShowControllerState_Starting);var a=parseInt(getUrlParameter("restartingSceneIndex")),n=document.URL.split("?")[0].split("#");if(n[1]&&(a=parseInt(n[1])),a)t=a;else{var o,s=getUrlParameter("currentSlide");o=s?parseInt(s):1,t=this.scriptManager.sceneIndexFromSlideIndex(o-1)}if(i.recording&&"navigation"===i.recording.eventTracks[0].type){this.narrationManager=new NarrationManager(i.recording),t=this.narrationManager.sceneIndexFromNavigationEvent(this.narrationManager.navigationEvents[0]),this.isRecording=!0,this.jumpToScene(t,!1);break}if(t>i.lastSceneIndex)break;if(r===kShowModeAutoplay)this.jumpToScene(t,!0);else{var l=1==(e=i.events[t]).automaticPlay||1==e.automaticPlay;this.jumpToScene(t,l)}}}},{key:"handleScriptDidNotDownloadEvent",value:function(e){this.promptUserToTryAgain(kUnableToReachiWorkTryAgain)?this.scriptManager.downloadScript():(this.displayManager.clearLaunchMode(),this.displayManager.hideWaitingIndicator())}},{key:"handleStageIsReadyEvent",value:function(e){this.isFullscreen?setTimeout(function(){this.displayManager.stageArea.style.opacity=1}.bind(this),50):setTimeout(function(){this.displayManager.stageArea.style.opacity=1}.bind(this),500),this.positionSlideNumberControl(),this.positionSlideNumberDisplay(),this.positionHelpPlacard()}},{key:"positionSlideNumberControl",value:function(){var e=(this.displayManager.usableDisplayWidth-this.slideNumberController.width)/2,t=this.displayManager.stageAreaTop+this.displayManager.stageAreaHeight-(this.slideNumberController.height+16);this.slideNumberController.setPosition(e,t)}},{key:"positionSlideNumberDisplay",value:function(){var e=(this.displayManager.usableDisplayWidth-this.slideNumberDisplay.width)/2,t=this.displayManager.stageAreaTop+this.displayManager.stageAreaHeight-(this.slideNumberDisplay.height+16);this.slideNumberDisplay.setPosition(e,t)}},{key:"positionHelpPlacard",value:function(){var e=(this.displayManager.usableDisplayWidth-this.helpPlacard.width)/2,t=(this.displayManager.usableDisplayHeight-this.helpPlacard.height)/2;this.helpPlacard.setPosition(e,t)}},{key:"handleFullscreenChangeEvent",value:function(){document.webkitIsFullScreen||document.mozFullScreen?this.isFullscreen=!0:this.isFullscreen=!1,setTimeout(function(){this.displayManager.layoutDisplay()}.bind(this),0)}},{key:"handleWindowResizeEvent",value:function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.changeWindowSize.bind(this),1e3)}},{key:"changeWindowSize",value:function(){if(this.delegate.setViewScale){this.scriptManager.reapplyScaleFactor(),this.textureManager.slideCache=null,this.textureManager.slideCache={};var e=this.currentSceneIndex;this.state===kShowControllerState_IdleAtFinalState&&(this.currentSceneIndex<this.script.numScenes-1?e=this.currentSceneIndex+1:this.script.loopSlideshow&&(e=0)),this.jumpToScene(e,!1)}document.dispatchEvent(new CustomEvent(kShowSizeDidChangeEvent,{detail:{width:this.script.slideWidth,height:this.script.slideHeight}}))}},{key:"handleStageSizeDidChangeEvent",value:function(e){var t=e.detail;this.touchController.setTrackArea(t.left,t.top,t.width,t.height)}},{key:"handleKeyDownEvent",value:function(e){var t=e.charCode||e.keyCode;if(t!==kKeyCode_F11&&t!==kKeyCode_F12){var i={altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,shiftKey:!!e.shiftKey,metaKey:!!e.metaKey};if(i.metaKey){if(t===kKeyCode_Period||t===kKeyCode_Dot)this.exitShow(!0);else if(t!=kKeyCode_Return)return}else if(i.ctrlKey)return;e.stopPropagation(),this.onKeyPress(t,i)}}},{key:"handleContextMenuEvent",value:function(e){e.stopPropagation()}},{key:"handleClickEvent",value:function(e){if(!this.isRecording){var t,i;e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(t=e.clientX,i=e.clientY);var r={pointX:t,pointY:i};"video"!==e.target.nodeName.toLowerCase()&&this.processClickOrTapAtDisplayCoOrds(r)}}},{key:"handleTapEvent",value:function(e){var t,i=e.detail,r={pointX:i.pointX,pointY:i.pointY},a=i.target;a&&(t=this.slideNumberFromTarget(a)),t?this.navigatorController.select(t):this.processClickOrTapAtDisplayCoOrds(r)}},{key:"slideNumberFromTarget",value:function(e){if(!e)return null;for(;(null===e.slideNumber||void 0===e.slideNumber)&&"body"!==e.nodeName.toLowerCase();)e=e.parentNode;return e.slideNumber}},{key:"processClickOrTapAtDisplayCoOrds",value:function(e){var t;if(this.slideNumberController.isShowing)return this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),void(this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),0));if(this.helpPlacard.isShowing)this.helpPlacard.hide();else{var i=this.displayManager.convertDisplayCoOrdsToShowCoOrds(e);-1!==i.pointX&&(t=this.findHyperlinkAtCoOrds(i)),t?this.processHyperlink(t):this.advanceToNextBuild("processClickOrTapAtDisplayCoOrds")}}},{key:"handleSwipeEvent",value:function(e){var t=e.detail,i=t.direction;if(!this.displayManager.navigatorIsShowing||"left"!==i&&"right"!==i){if(t.swipeStartX&&t.swipeStartX<150)"right"===i?this.navigatorController.thumbnailSidebar.show(this.navigatorController.leftSidebar):"left"===i&&this.navigatorController.thumbnailSidebar.hide(this.navigatorController.leftSidebar);else if("left"===i)switch(t.fingers){case 1:this.advanceToNextBuild("handleSwipeEvent");break;case 2:this.advanceToNextSlide("handleSwipeEvent")}else if("right"===i)switch(t.fingers){case 1:this.goBackToPreviousSlide("handleSwipeEvent");break;case 2:this.goBackToPreviousBuild("handleSwipeEvent")}}else this.navigatorController.thumbnailSidebar.hide(this.navigatorController.leftSidebar)}},{key:"onMouseDown",value:function(e){e.leftClick?this.advanceToNextBuild("onMouseDown"):e.rightClick&&this.goBackToPreviousBuild("onMouseDown")}},{key:"onKeyPress",value:function(e,t){e>=kKeyCode_Numeric_0&&e<=kKeyCode_Numeric_9&&(e=kKeyCode_0+(e-kKeyCode_Numeric_0)),e+=t.shiftKey?kKeyModifier_Shift:0,e+=t.altKey?kKeyModifier_Alt:0,e+=t.ctrlKey?kKeyModifier_Ctrl:0,e+=t.metaKey?kKeyModifier_Meta:0;var i=this.script||e===kKeyCode_Escape||e===kKeyCode_Q;if(!this.isRecording&&i){switch(e){case kKeyCode_Escape:this.exitShow(!0);break;case kKeyCode_Slash:case kKeyCode_Slash+kKeyModifier_Shift:this.helpPlacard.isShowing?this.helpPlacard.hide():this.helpPlacard.show();break;case kKeyCode_Q:this.exitShow(!0);break;case kKeyCode_S:this.slideNumberController.isShowing&&(this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),0)),this.slideNumberDisplay.isShowing?this.slideNumberDisplay.hide():(this.slideNumberDisplay.setSlideNumber(this.currentSlideIndex+1),this.slideNumberDisplay.show());break;case kKeyCode_Return:if(this.accumulatingDigits){this.accumulatingDigits=!1,this.script.showMode!==kShowModeHyperlinksOnly&&(this.digitAccumulator>this.script.slideCount?this.digitAccumulator=this.script.slideCount:this.digitAccumulator<1&&(this.digitAccumulator=1),this.slideNumberController.setSlideNumber(this.digitAccumulator),this.jumpToSlide(this.digitAccumulator));break}case kKeyCode_N:case kKeyCode_Space:case kKeyCode_DownArrow:case kKeyCode_RightArrow:case kKeyCode_PageDown:this.advanceToNextBuild("onKeyPress");break;case kKeyCode_RightArrow+kKeyModifier_Shift:case kKeyCode_CloseBracket:this.advanceAndSkipBuild("onKeyPress");break;case kKeyCode_DownArrow+kKeyModifier_Shift:case kKeyCode_PageDown+kKeyModifier_Shift:case kKeyCode_CloseBracket:case kKeyCode_Equal+kKeyModifier_Shift:case kKeyCode_Equal:case kKeyCode_Plus:this.advanceToNextSlide("onKeyPress");break;case kKeyCode_LeftArrow+kKeyModifier_Shift:case kKeyCode_PageUp+kKeyModifier_Shift:case kKeyCode_OpenBracket:this.goBackToPreviousBuild("onKeyPress");break;case kKeyCode_P:case kKeyCode_PageUp:case kKeyCode_LeftArrow:case kKeyCode_UpArrow:case kKeyCode_UpArrow+kKeyModifier_Shift:case kKeyCode_Hyphen:case kKeyCode_Minus:this.goBackToPreviousSlide("onKeyPress");break;case kKeyCode_Delete:if(!0,this.accumulatingDigits)if(this.digitAccumulator<10)this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),0);else{this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),7e3);var r=this.digitAccumulator.toString();this.digitAccumulator=parseInt(r.substring(0,r.length-1)),this.slideNumberController.setSlideNumber(this.digitAccumulator)}break;case kKeyCode_Home:this.script.showMode!==kShowModeHyperlinksOnly&&this.jumpToSlide(1);break;case kKeyCode_End:this.script.showMode!==kShowModeHyperlinksOnly&&this.jumpToSlide(this.script.slideCount);break;default:this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),7e3),e>=kKeyCode_0&&e<=kKeyCode_9?(this.slideNumberDisplay.isShowing&&this.slideNumberDisplay.hide(),!0,!1===this.accumulatingDigits&&(this.accumulatingDigits=!0,this.digitAccumulator=0),this.digitAccumulator.toString().length<4&&(this.digitAccumulator*=10,this.digitAccumulator+=e-kKeyCode_0,this.slideNumberController.setSlideNumber(this.digitAccumulator),this.slideNumberController.isShowing||this.slideNumberController.show())):!0}this.accumulatingDigits}}},{key:"hideAndResetSlideNumberController",value:function(){this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.accumulatingDigits=!1,this.digitAccumulator=0,this.slideNumberController.hide()}},{key:"hideSlideNumberDisplay",value:function(){this.slideNumberDisplay.hide()}},{key:"toggleFullscreen",value:function(){setTimeout(function(){this.displayManager.stageArea.style.opacity=0}.bind(this),0),this.displayManager.hideHUD(!0),document.webkitIsFullScreen||document.mozFullScreen?(this.isFullscreen=!1,document.webkitCancelFullScreen&&document.webkitCancelFullScreen()||document.mozCancelFullScreen&&document.mozCancelFullScreen()):(this.isFullscreen=!0,document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen()||document.body.mozRequestFullScreen&&document.body.mozRequestFullScreen())}},{key:"changeState",value:function(e){e!==this.state&&(this.leavingState(),this.state=e,this.enteringState())}},{key:"leavingState",value:function(){switch(this.state){case kShowControllerState_Stopped:case kShowControllerState_Starting:case kShowControllerState_SettingUpScene:case kShowControllerState_IdleAtFinalState:case kShowControllerState_IdleAtInitialState:case kShowControllerState_WaitingToJump:case kShowControllerState_ReadyToJump:case kShowControllerState_ReadyToPlay:case kShowControllerState_Playing:break;case kShowControllerState_WaitingToPlay:this.displayManager.hideWaitingIndicator()}}},{key:"enteringState",value:function(){switch(this.state){case kShowControllerState_Stopped:break;case kShowControllerState_Starting:this.displayManager.showWaitingIndicator();break;case kShowControllerState_SettingUpScene:break;case kShowControllerState_IdleAtFinalState:this.unloadTextures();case kShowControllerState_IdleAtInitialState:this.updateSlideNumber(),runInNextEventLoop(this.doIdleProcessing.bind(this));break;case kShowControllerState_WaitingToJump:case kShowControllerState_ReadyToJump:break;case kShowControllerState_WaitingToPlay:this.displayManager.showWaitingIndicator()}}},{key:"preloadTextures",value:function(){var e=this.script,t=this.currentSceneIndex;this.state===kShowControllerState_IdleAtFinalState&&(t<e.numScenes-1?t+=1:e.loopSlideshow&&(t=0)),this.textureManager.loadScene(t)}},{key:"unloadTextures",value:function(){var e=this.script,t=this.currentSceneIndex;this.state===kShowControllerState_IdleAtFinalState&&(t<e.numScenes-1?t+=1:e.loopSlideshow&&(t=0));var i=e.slideIndexFromSceneIndexLookup[t],r=this.textureManager.slideCache;for(var a in r)if(a<i-1||a>i+1){var n=r[a];for(var o in n.textureAssets){var s=n.textureAssets[o];if(s){var l=s.getContext("2d");l&&l.clearRect(0,0,s.width,s.height),delete n.textureAssets[o]}}delete this.textureManager.slideCache[a].textureAssets,delete this.textureManager.slideCache[a].textureRequests,delete this.textureManager.slideCache[a].requested,n.pdf&&(n.pdf.destroy(),delete this.textureManager.slideCache[a].pdf),delete this.textureManager.slideCache[a]}}},{key:"doIdleProcessing",value:function(){(this.preloadTextures(),null!==this.queuedUserAction&&void 0!==this.queuedUserAction)?(this.queuedUserAction(),this.queuedUserAction=null):0!==this.stageManager.stage.childNodes.length&&this.updateNavigationButtons();clearTimeout(this.createHyperlinksForCurrentStateTimeout),this.createHyperlinksForCurrentStateTimeout=setTimeout(function(){this.createHyperlinksForCurrentState("idle")}.bind(this),100)}},{key:"truncatedSlideIndex",value:function(e){return this.truncatedIndex(e,this.script.lastSlideIndex,this.script.loopSlideshow)}},{key:"truncatedSceneIndex",value:function(e){return this.truncatedIndex(e,this.script.lastSceneIndex,this.script.loopSlideshow)}},{key:"truncatedIndex",value:function(e,t,i){return e<0?e=i?e+t+1:-1:e>t&&(e=i?e-t-1:-1),e}},{key:"advanceToNextBuild",value:function(e){if(!this.script)return!1;if(this.script.showMode===kShowModeHyperlinksOnly&&"currentSceneDidComplete"!==e)return!1;if(this.displayManager.infoPanelIsShowing)return!1;var t=!1;switch(this.state){case kShowControllerState_IdleAtFinalState:if(-1===this.nextSceneIndex){if(!this.delegate.getKPFJsonStringForShow){this.stopSoundTrack();break}this.stopSoundTrack(),this.exitShow()}t=!0,this.jumpToScene(this.nextSceneIndex,!0);break;case kShowControllerState_IdleAtInitialState:if(this.currentSceneIndex>=this.script.numScenes)if(this.script.loopSlideshow)t=!0,this.jumpToScene(0,!1);else{if(!this.delegate.getKPFJsonStringForShow){this.stopSoundTrack();break}this.stopSoundTrack(),this.exitShow()}else t=!0,this.playCurrentScene();break;default:null!==this.queuedUserAction&&void 0!==this.queuedUserAction||(t=!0,this.queuedUserAction=this.advanceToNextBuild.bind(this,e))}return t}},{key:"advanceToNextSlide",value:function(e){if(!this.script)return!1;if(this.script.showMode!=kShowModeHyperlinksOnly&&!this.displayManager.infoPanelIsShowing){var t=this.currentSceneIndex;switch(this.state){case kShowControllerState_IdleAtFinalState:t+=1;case kShowControllerState_IdleAtInitialState:var i;if(this.scriptManager.slideIndexFromSceneIndex(t)===this.script.slideCount-1){if(!this.script.loopSlideshow)return;i=0}else i=this.currentSlideIndex+1;var r=this.scriptManager.sceneIndexFromSlideIndex(i),a=this.script.events[r],n=1==a.automaticPlay||1==a.automaticPlay;this.jumpToSlide(i+1,n);break;default:null!==this.queuedUserAction&&void 0!==this.queuedUserAction||(this.queuedUserAction=this.advanceToNextSlide.bind(this,e))}}}},{key:"goBackToPreviousBuild",value:function(e){if(!this.script)return!1;if(this.resetMediaCache(),this.script.showMode!==kShowModeHyperlinksOnly&&!this.displayManager.infoPanelIsShowing){var t=this.currentSceneIndex;switch(this.state){case kShowControllerState_IdleAtFinalState:t+=1;case kShowControllerState_Playing:case kShowControllerState_IdleAtInitialState:var i;if(0===t){if(!this.script.loopSlideshow)return;i=this.script.events.length-1}else i=t-1;this.jumpToScene(i,!1);break;default:null!==this.queuedUserAction&&void 0!==this.queuedUserAction||(this.queuedUserAction=this.goBackToPreviousBuild.bind(this,e))}}}},{key:"advanceAndSkipBuild",value:function(e){if(!this.script)return!1;if(this.script.showMode!==kShowModeHyperlinksOnly){var t=this.currentSceneIndex;switch(this.state){case kShowControllerState_IdleAtFinalState:t+=1;case kShowControllerState_IdleAtInitialState:var i;if(t>=this.script.numScenes-1){if(!this.script.loopSlideshow)return;i=0}else i=t+1;this.jumpToScene(i,!1);break;default:null==this.queuedUserAction&&(this.queuedUserAction=this.advanceAndSkipBuild.bind(this,e))}}}},{key:"goBackToPreviousSlide",value:function(e){if(!this.script)return!1;if(this.script.showMode!==kShowModeHyperlinksOnly&&!this.displayManager.infoPanelIsShowing){var t=this.currentSceneIndex;switch(this.state){case kShowControllerState_IdleAtFinalState:t+=1;case kShowControllerState_Playing:case kShowControllerState_IdleAtInitialState:var i,r=this.scriptManager.slideIndexFromSceneIndex(t),a=this.scriptManager.sceneIndexFromSlideIndex(r);i=0===r?t>0?0:this.script.loopSlideshow?this.script.slideCount-1:0:-1===r&&t>0?this.script.slideCount-1:t>a?this.currentSlideIndex:this.currentSlideIndex-1,this.jumpToSlide(i+1);break;default:null!==this.queuedUserAction&&void 0!==this.queuedUserAction||(this.queuedUserAction=this.goBackToPreviousSlide.bind(this,e))}}}},{key:"calculatePreviousSceneIndex",value:function(e){return previousSceneIndex=-1===e?-1:e-1,previousSceneIndex}},{key:"jumpToSlide",value:function(e,t){var i=e-1,r=this.scriptManager.sceneIndexFromSlideIndex(i);this.resetMediaCache(),null==t&&(t=!1),this.jumpToScene(r,t)}},{key:"jumpToScene",value:function(e,t){if(this.lastSlideViewedIndex=this.scriptManager.slideIndexFromSceneIndex(this.currentSceneIndex),-1!==e){switch(this.state){case kShowControllerState_Starting:var i="position:absolute;background-color:transparent; left:0px; top:0px; width:"+this.displayManager.usableDisplayWidth+"px; height:"+this.displayManager.usableDisplayHeight+"px;";this.starting=!0,this.maskElement=document.createElement("div"),this.maskElement.setAttribute("style",i),document.body.appendChild(this.maskElement);case kShowControllerState_IdleAtInitialState:case kShowControllerState_IdleAtFinalState:case kShowControllerState_ReadyToJump:break;default:return}if(!1===this.textureManager.isScenePreloaded(e)){this.changeState(kShowControllerState_WaitingToJump);var r={sceneIndex:e,automaticPlay:t};return this.waitForSceneToLoadTimeout=setTimeout(this.handleSceneDidNotLoad.bind(this,r),kMaxSceneDownloadWaitTime),void this.textureManager.loadScene(e,this.handleSceneDidLoad.bind(this,r))}this.changeState(kShowControllerState_SettingUpScene),runInNextEventLoop(this.jumpToScene_partThree.bind(this,e,t))}}},{key:"handleSceneDidLoad",value:function(e){if(clearTimeout(this.waitForSceneToLoadTimeout),this.state===kShowControllerState_WaitingToJump)this.changeState(kShowControllerState_ReadyToJump),this.jumpToScene_partTwo(e.sceneIndex,e.automaticPlay)}},{key:"handleSceneDidNotLoad",value:function(e){if(clearTimeout(this.waitForSceneToLoadTimeout),this.queuedUserAction=null,this.promptUserToTryAgain(kUnableToReachiWorkTryAgain)){var t=window.location.href,i=t.indexOf("&restartingSceneIndex"),r=(-1===i?t:t.substring(0,i))+"&restartingSceneIndex="+e.sceneIndex;window.location.replace(r)}else this.changeState(kShowControllerState_IdleAtFinalState)}},{key:"jumpToScene_partTwo",value:function(e,t){this.changeState(kShowControllerState_SettingUpScene),runInNextEventLoop(this.jumpToScene_partThree.bind(this,e,t))}},{key:"jumpToScene_partThree",value:function(e,t){this.jumpToScene_partFour(e,t)}},{key:"jumpToScene_partFour",value:function(e,t){if(this.displayScene(e),this.starting&&(null!=this.maskElement&&(document.body.removeChild(this.maskElement),this.maskElement=null,this.starting=!1),window.focus()),this.helpPlacard.isShowing&&this.helpPlacard.hide(),this.slideNumberDisplay.isShowing&&this.slideNumberDisplay.hide(),this.slideNumberController.isShowing&&(this.slideNumberTimeout&&clearTimeout(this.slideNumberTimeout),this.slideNumberTimeout=setTimeout(this.hideAndResetSlideNumberController.bind(this),500)),t){var i=this.script;if(i.showMode===kShowModeAutoplay){var r=i.events[e].effects;if(r&&r.length>0){var a="transition"===r[0].type?i.autoplayTransitionDelay:i.autoplayBuildDelay;setTimeout(function(){this.playCurrentScene()}.bind(this),1e3*a)}else this.playCurrentScene()}else this.playCurrentScene()}else this.changeState(kShowControllerState_IdleAtInitialState),this.isRecording&&!this.isRecordingStarted&&(this.narrationManager.start(),this.isRecordingStarted=!0)}},{key:"displayScene",value:function(e,t){if(-1!==e){if(this.animationManager.deleteAllAnimations(),this.scriptManager.slideIndexFromSceneIndex(this.currentSceneIndex)!==(t?t.slideIndex:this.scriptManager.slideIndexFromSceneIndex(e))&&this.resetMediaCache(),this.setCurrentSceneIndexTo(e),t)this.playbackController.renderEvent(t);else{var i=this.script.slideIndexFromSceneIndexLookup[e],r=this.script.slideList[i],a=new KPFEvent({slideId:r,slideIndex:i,sceneIndex:e,event:this.script.events[e]});this.playbackController.renderEvent(a)}this.updateNavigationButtons()}}},{key:"setCurrentSceneIndexTo",value:function(e){this.currentSceneIndex=e,this.assignNextSceneIndex(),this.updateSlideNumber(),this.updateNavigationButtons()}},{key:"assignNextSceneIndex",value:function(){this.nextSceneIndex=this.calculateNextSceneIndex(this.currentSceneIndex)}},{key:"calculateNextSceneIndex",value:function(e){return this.calculateNextSceneIndex_internal(e)}},{key:"calculateNextSceneIndex_internal",value:function(e){return e<this.script.lastSceneIndex?e+1:this.script.loopSlideshow?0:-1}},{key:"updateSlideNumber",value:function(){var e=this.currentSceneIndex;this.state!==kShowControllerState_IdleAtFinalState&&this.state!==kShowControllerState_Playing||(e=this.nextSceneIndex);var t=this.scriptManager.slideIndexFromSceneIndex(e);this.firstSlide&&(this.displayManager.hideWaitingIndicator(),runInNextEventLoop(function(){this.startSoundTrack(),this.displayManager.clearLaunchMode()}.bind(this)),this.firstSlide=!1),this.currentSlideIndex!=t&&(this.previousSlideIndex=this.currentSlideIndex,this.currentSlideIndex=t,this.delegate.propertyChanged(kPropertyName_currentSlide,this.currentSlideIndex+1),document.dispatchEvent(new CustomEvent(kSlideIndexDidChangeEvent,{detail:{slideIndex:this.currentSlideIndex}})))}},{key:"updateNavigationButtons",value:function(){var e=this.currentSceneIndex;this.state===kShowControllerState_IdleAtFinalState&&e++,this.updateWindowHistory(e);-1===this.script.lastSceneIndex?!1:this.script.loopSlideshow?!0:(e>0&&!0,0===e&&0===this.script.lastSceneIndex||(this.currentSceneIndex<this.script.lastSceneIndex||this.currentSceneIndex===this.script.lastSceneIndex&&this.state))}},{key:"playCurrentScene",value:function(e){var t,i=this,r=(this.state,0),a=this.playbackController.eventOverallEndTime();(this.changeState(kShowControllerState_Playing),this.clearAllHyperlinks(),this.helpPlacard.isShowing&&this.helpPlacard.hide(),this.slideNumberDisplay.isShowing&&this.slideNumberDisplay.hide(),e)?(t=e.sceneIndexToJump,this.resetMediaCache()):(t=this.nextSceneIndex,this.scriptManager.slideIndexFromSceneIndex(this.currentSceneIndex)!==this.scriptManager.slideIndexFromSceneIndex(t)&&this.resetMediaCache(),!0===this.playbackController.kpfEvent.event.automaticPlay&&"transition"===this.playbackController.kpfEvent.event.effects[0].type&&(r=this.playbackController.kpfEvent.event.effects[0].beginTime,a=this.playbackController.kpfEvent.event.effects[0].duration));clearTimeout(this.animateTimeout);var n,o=this.playbackController.kpfEvent.event.effects,s=o.length>0;s&&"transition"===o[0].type&&(isEdge||"com.apple.iWork.Keynote.BLTBlinds"!==o[0].name)&&(n=this.playbackController.renderEffects()),this.animateTimeout=setTimeout((function(){s&&(null==n&&(n=i.playbackController.renderEffects()),i.playbackController.animateEffects(n)),i.updateSlideNumber(),setTimeout(i.currentSceneDidComplete.bind(i,t),1e3*a+100)}),1e3*r)}},{key:"currentSceneDidComplete",value:function(e){var t=this.script,i=t.showMode;if(this.slideNumberDisplay.isShowing&&this.slideNumberDisplay.hide(),this.changeState(kShowControllerState_IdleAtFinalState),i==kShowModeHyperlinksOnly||-1!=e&&e!=this.nextSceneIndex){var r=t.events[e],a=1===r.automaticPlay||!0===r.automaticPlay;this.jumpToScene(e,a)}else-1===this.nextSceneIndex?(this.updateNavigationButtons(),this.delegate.getKPFJsonStringForShow?(this.stopSoundTrack(),this.exitShow()):this.stopSoundTrack()):(t.events[this.nextSceneIndex].automaticPlay||i===kShowModeAutoplay)&&runInNextEventLoop(this.advanceToNextBuild.bind(this,"currentSceneDidComplete"))}},{key:"resetMediaCache",value:function(){this.resetMovieCache(),this.resetAudioCache()}},{key:"resetMovieCache",value:function(){for(var e in this.movieCache)delete this.movieCache[e].videoElement,delete this.movieCache[e];this.movieCache=null}},{key:"resetAudioCache",value:function(){for(var e in this.audioCache)this.audioCache[e].audioElement.pause(),this.audioCache[e].audioElement.src="",this.audioCache[e].audioElement=null,delete this.audioCache[e];this.audioCache=null}},{key:"updateWindowHistory",value:function(e){if(void 0!==window.history.replaceState){var t=document.URL.split("?"),i=t[0].split("#");"file:"!==window.location.protocol&&window.history.replaceState(null,"Keynote",i[0]+"#"+e+(t[1]?"?"+t[1]:""))}}},{key:"startSoundTrack",value:function(){null!=this.script.soundtrack&&null!=this.script.soundtrack.tracks&&this.script.soundtrack.mode!==kSoundTrackModeOff&&(this.currentSoundTrackIndex=0,this.playNextItemInSoundTrack())}},{key:"stopSoundTrack",value:function(){this.soundTrackPlayer&&(this.soundTrackPlayer.pause(),this.soundTrackPlayer=null)}},{key:"playNextItemInSoundTrack",value:function(){var e=this.script.soundtrack.tracks[this.currentSoundTrackIndex];this.soundTrackPlayer=new Audio,this.soundTrackPlayer.src="assets/"+e,this.soundTrackPlayer.volume=this.script.soundtrack.volume,this.soundTrackPlayer.addEventListener("ended",this.soundTrackItemDidComplete.bind(this),!1),this.soundTrackPlayer.load(),this.soundTrackPlayer.play()}},{key:"soundTrackItemDidComplete",value:function(){this.currentSoundTrackIndex++,this.currentSoundTrackIndex<this.script.soundtrack.tracks.length?this.playNextItemInSoundTrack():this.script.soundtrack.mode===kSoundTrackModePlayOnce?this.soundTrackPlayer=null:this.script.soundtrack.mode===kSoundTrackModeLooping&&this.startSoundTrack()}},{key:"processHyperlink",value:function(e){var t=e.url;if(0===t.indexOf("?slide=")){var i=t.substring(7),r=-1;if("first"===i)r=0;else if("last"===i)r=this.script.slideCount-1;else{var a=this.currentSceneIndex,n=-1;switch(this.state){case kShowControllerState_IdleAtFinalState:a+=1;case kShowControllerState_IdleAtInitialState:var o=this.scriptManager.slideIndexFromSceneIndex(a);"next"===i?o===this.script.slideCount-1?this.script.loopSlideshow?n=0:this.delegate.getKPFJsonStringForShow&&this.exitShow():n=o+1:"previous"===i&&(n=0===o?this.script.loopSlideshow?this.script.slideCount-1:0:o-1)}r=n}-1!=r&&this.jumpToHyperlinkSlide(r,e)}else if(0===t.indexOf("?slideid=")){for(var s=t.substring(9),l=this.script.slideList,h=(r=-1,0),c=l.length;h<c;h++)if(l[h]===s){r=h;break}-1!==r&&this.jumpToHyperlinkSlide(r,e)}else 0===t.indexOf("?action=retreat")?-1!==this.lastSlideViewedIndex&&this.jumpToHyperlinkSlide(this.lastSlideViewedIndex,e):0===t.indexOf("?action=exitpresentation")?this.exitShow():0===t.indexOf("http:")||0===t.indexOf("https:")?window.open(t,"_blank",null):0!==t.indexOf("mailto:")&&0!==t.indexOf("tel:")||(window.location=t)}},{key:"jumpToHyperlinkSlide",value:function(e,t){var i=t.events,r=this.script.sceneIndexFromSlideIndexLookup[e];if(i){var a=i[this.script.slideList[e]];if(a){var n=this.currentSceneIndex;switch(this.state){case kShowControllerState_IdleAtFinalState:n<this.script.numScenes-1?n+=1:this.script.loopSlideshow&&(n=0);case kShowControllerState_IdleAtInitialState:var o=this.script.slideIndexFromSceneIndexLookup[n],s=this.script.slideList[o],l=new KPFEvent({slideId:s,slideIndex:o,sceneIndex:n,event:a});this.displayScene(n,l),this.playCurrentScene({sceneIndexToJump:r});break;default:return}}else{var h=1==(c=this.script.events[r]).automaticPlay||1==c.automaticPlay;this.jumpToSlide(e+1,h)}}else{var c;h=1==(c=this.script.events[r]).automaticPlay||1==c.automaticPlay;this.jumpToSlide(e+1,h)}}},{key:"addMovieHyperlink",value:function(e,t){var i={targetRectangle:e,url:t};this.movieHyperlinks.push(i)}},{key:"clearMovieHyperlinks",value:function(){delete this.movieHyperlinks,this.movieHyperlinks=[]}},{key:"clearAllHyperlinks",value:function(){this.stageManager.clearAllHyperlinks(),delete this.activeHyperlinks,this.activeHyperlinks=[]}},{key:"findHyperlinkAtCoOrds",value:function(e){for(var t=null!==this.activeHyperlinks&&void 0!==this.activeHyperlinks?this.activeHyperlinks.length:0;t>0;t--){var i=this.activeHyperlinks[t-1],r=i.targetRectangle,a=Math.floor(r.x),n=Math.floor(r.y),o=a+Math.floor(r.width),s=n+Math.floor(r.height);if(e.pointX>=a&&e.pointX<=o&&e.pointY>=n&&e.pointY<=s)return i}return null}},{key:"createHyperlinksForCurrentState",value:function(e){var t=-1;switch(this.state){case kShowControllerState_IdleAtInitialState:t=this.currentSceneIndex;break;case kShowControllerState_IdleAtFinalState:this.currentSceneIndex<this.script.lastSceneIndex?t=this.currentSceneIndex+1:this.script.showMode==kShowModeHyperlinksOnly?t=this.currentSceneIndex:this.script.loopSlideshow&&(t=0)}-1!=t&&(this.clearAllHyperlinks(),this.createHyperlinks(t))}},{key:"createHyperlinks",value:function(e){if(-1!==e){var t=this.script.events[e];if(null!=t){var i=t.hyperlinks;if(null!=i){var r,a=i.length,n=this.displayManager.showWidth,o=this.displayManager.showHeight;for(r=0;r<a;r++){var s=i[r],l=s.targetRectangle,h={targetRectangle:l,events:s.events,url:s.url};l.x,l.y,l.x,l.width,l.y,l.top;this.stageManager.addHyperlink(h.targetRectangle),this.activeHyperlinks[r]=h}if(this.movieHyperlinks.length>0)for(var c=0;c<this.movieHyperlinks.length;c++){var u=this.movieHyperlinks[c];this.stageManager.addHyperlink(u.targetRectangle),this.activeHyperlinks[r++]=u}}}}}},{key:"addGlobalEventListeners",value:function(){document.addEventListener(kScriptDidDownloadEvent,this.handleScriptDidDownloadEvent),document.addEventListener(kScriptDidNotDownloadEvent,this.handleScriptDidNotDownloadEvent),document.addEventListener(kStageIsReadyEvent,this.handleStageIsReadyEvent),document.addEventListener(kStageSizeDidChangeEvent,this.handleStageSizeDidChangeEvent),document.addEventListener(kKeyDownEvent,this.handleKeyDownEvent),document.addEventListener(kSwipeEvent,this.handleSwipeEvent),this.displayManager.body.addEventListener("click",this.handleClickEvent),document.addEventListener(kFullscreenChangeEventName,this.handleFullscreenChangeEvent),window.addEventListener("resize",this.handleWindowResizeEvent),document.addEventListener("contextmenu",this.handleContextMenuEvent)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kTouchStartEventName="touchstart",kTouchMoveEventName="touchmove",kTouchEndEventName="touchend",kTouchCancelEventName="touchcancel",kGestureStartEventName="gesturestart",kGestureEndEventName="gestureend",kSwipeEvent="TouchController:SwipeEvent",kTapEvent="TouchController:TapeEvent",TouchController=function(){function e(){_classCallCheck(this,e),document.addEventListener(kTouchStartEventName,this.handleTouchStartEvent.bind(this)),document.addEventListener(kTouchMoveEventName,this.handleTouchMoveEvent.bind(this)),document.addEventListener(kTouchEndEventName,this.handleTouchEndEvent.bind(this)),document.addEventListener(kTouchCancelEventName,this.handleTouchCancelEvent.bind(this)),document.addEventListener(kGestureStartEventName,this.handleGestureStartEvent.bind(this)),document.addEventListener(kGestureEndEventName,this.handleGestureEndEvent.bind(this)),this.swipeInProgress=!1,this.swipeFingerCount=0,this.swipeStartTime=0,this.swipeStartX=0,this.swipeStartY=0,this.preventDefault=!0,this.tapEventCallback=null,this.setTrackArea(0,0,0,0),this.enableTouchTracking=!0}return _createClass(e,[{key:"setTouchTrackingEnabled",value:function(e){this.enableTouchTracking=e}},{key:"setTrackArea",value:function(e,t,i,r){this.trackAreaLeft=e,this.trackAreaTop=t,this.trackAreaRight=e+i,this.trackAreaBottom=t+r}},{key:"registerTapEventCallback",value:function(e){this.tapEventCallback=e}},{key:"isTouchWithinTrackArea",value:function(e){return!1!==this.enableTouchTracking&&(!(e.clientX<this.trackAreaLeft)&&(!(e.clientX>this.trackAreaRight)&&(!(e.clientY<this.trackAreaTop)&&!(e.clientY>this.trackAreaBottom))))}},{key:"handleTouchStartEvent",value:function(e){if(!1===this.swipeInProgress){var t=e.touches[0];this.isTouchWithinTrackArea(t)&&(this.preventDefault&&e.preventDefault(),this.swipeInProgress=!0,this.swipeFingerCount=e.touches.length,this.swipeStartTime=new Date,this.swipeStartX=t.clientX,this.swipeStartY=t.clientY)}else e.touches.length>this.swipeFingerCount&&(this.swipeFingerCount=e.touches.length)}},{key:"handleTouchMoveEvent",value:function(e){this.preventDefault&&e.preventDefault()}},{key:"handleTouchEndEvent",value:function(e){if(this.swipeInProgress&&(this.preventDefault&&e.preventDefault(),0===e.touches.length)){var t=e.changedTouches[0],i=window.innerHeight/3,r=window.innerWidth/3,a=t.clientX-this.swipeStartX,n=t.clientY-this.swipeStartY,o=Math.abs(a),s=Math.abs(n),l=new Date-this.swipeStartTime,h=!1,c=!1;if(l<400&&o<20&&s<20&&(h=!0),l<=800&&(o>s?s<=i&&(c=!0):o<=r&&(c=!0)),h)if(this.tapEventCallback){var u={detail:{fingers:this.swipeFingerCount,pointX:t.clientX,pointY:t.clientY,target:e.target}};this.tapEventCallback(u)}else document.dispatchEvent(new CustomEvent(kTapEvent,{detail:{fingers:this.swipeFingerCount,pointX:t.clientX,pointY:t.clientY}}));else if(c){var d;d=o>s?a<0?"left":"right":n<0?"up":"down",document.dispatchEvent(new CustomEvent(kSwipeEvent,{detail:{direction:d,fingers:this.swipeFingerCount,swipeStartX:this.swipeStartX}}))}this.swipeInProgress=!1,this.swipeFingerCount=0}}},{key:"handleTouchCancelEvent",value:function(e){this.swipeInProgress=!1}},{key:"handleGestureStartEvent",value:function(e){this.preventDefault&&e.preventDefault()}},{key:"handleGestureEndEvent",value:function(e){this.preventDefault&&e.preventDefault()}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kStageSizeDidChangeEvent="DisplayManager:StageSizeDidChangeEvent",kTimeoutValueForCursor=1e3,DisplayManager=function(){function e(){_classCallCheck(this,e),document.addEventListener(kShowSizeDidChangeEvent,this.handleShowSizeDidChangeEvent.bind(this)),document.addEventListener(kOrientationChangedEvent,this.handleOrientationDidChangeEvent.bind(this)),this.body=document.getElementById("body"),this.stageArea=document.getElementById("stageArea"),this.stage=document.getElementById("stage"),this.hyperlinkPlane=document.getElementById("hyperlinkPlane"),this.waitingIndicator=document.getElementById("waitingIndicator"),this.waitingIndicatorTimeout=null,this.orientation=kOrientationUnknown,this.showWidth=0,this.showHeight=0,this.stageAreaWidth=0,this.stageAreaHeight=0,this.stageAreaTop=0,this.stageAreaLeft=0,this.usableDisplayWidth=0,this.usableDisplayHeight=0,this.inLaunchMode=!0,this.initialAddressBarScrollPerformed=!1,this.updateUsableDisplayArea(),this.positionWaitingIndicator(),this.showWaitingIndicator(),this.hyperlinksOnly=!1,this.hasCacheEverGoneOverPixelLimit=!1,this.hhasStageEverGoneOverPixelLimit=!1,this.cacheHighWaterMark=0,this.stageHighWaterMark=0,this.body.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.lastMouseX=-1,this.lastMouseY=-1,this.cursorTimeout=null,this.setTimeoutForCursor()}return _createClass(e,[{key:"setHyperlinksOnlyMode",value:function(){this.hyperlinksOnly=!0}},{key:"handleMouseMove",value:function(e){e=e||window.event,Math.abs(this.lastMouseX-e.clientX)+Math.abs(this.lastMouseY-e.clientY)>10&&!1===this.cursorIsShowing?this.showCursor():this.navigatorIsShowing||this.setTimeoutForCursor(),this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}},{key:"handleShowSizeDidChangeEvent",value:function(e){var t=e.detail;this.showWidth=t.width,this.showHeight=t.height,this.layoutDisplay()}},{key:"handleOrientationDidChangeEvent",value:function(e){this.orientation=e.detail.orientation,clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.handleOrientationDidChangeEvent_partTwo.bind(this),300)}},{key:"handleOrientationDidChangeEvent_partTwo",value:function(){this.layoutDisplay(),!1===this.inLaunchMode&&this.showApplicableControls()}},{key:"showCursor",value:function(){this.inLaunchMode||(this.body.style.cursor="default",this.cursorIsShowing=!0,this.setTimeoutForCursor())}},{key:"hideCursor",value:function(){this.body.style.cursor="none",this.cursorIsShowing=!1}},{key:"setTimeoutForCursor",value:function(){this.cursorTimeout&&clearTimeout(this.cursorTimeout),this.cursorTimeout=setTimeout(this.handleTimeoutForCursor.bind(this),kTimeoutValueForCursor)}},{key:"clearTimeoutForCursor",value:function(){this.cursorTimeout&&clearTimeout(this.cursorTimeout)}},{key:"handleTimeoutForCursor",value:function(){this.hideCursor()}},{key:"updateUsableDisplayArea",value:function(){this.usableDisplayWidth=window.innerWidth,this.usableDisplayHeight=window.innerHeight}},{key:"clearLaunchMode",value:function(){this.inLaunchMode=!1,runInNextEventLoop(this.showAll.bind(this))}},{key:"positionWaitingIndicator",value:function(){var e=110,t=(this.usableDisplayWidth-e)/2,i=(this.usableDisplayHeight-e)/2;setElementPosition(this.waitingIndicator,i,t,e,e)}},{key:"hideWaitingIndicator",value:function(){this.waitingIndicator.style.display="none"}},{key:"showWaitingIndicator",value:function(){this.waitingIndicator.style.display="block"}},{key:"convertDisplayCoOrdsToShowCoOrds",value:function(e){var t={},i=this.stageAreaLeft+this.stageAreaWidth,r=this.stageAreaTop+this.stageAreaHeight;return e.pointX<this.stageAreaLeft||e.pointX>i||e.pointY<this.stageAreaTop||e.pointY>r?(t.pointX=-1,t.pointY=-1):(t.pointX=(e.pointX-this.stageAreaLeft)/this.stageAreaWidth*this.showWidth,t.pointY=(e.pointY-this.stageAreaTop)/this.stageAreaHeight*this.showHeight),t}},{key:"layoutDisplay",value:function(){this.updateUsableDisplayArea();var e=this.usableDisplayWidth,t=this.usableDisplayHeight;gShowController.isFullscreen||e>this.showWidth&&(e=this.showWidth);var i=scaleSizeWithinSize(this.showWidth,this.showHeight,e,t);this.stageAreaWidth=i.width,this.stageAreaHeight=i.height,this.stageAreaLeft=(this.usableDisplayWidth-this.stageAreaWidth)/2,this.stageAreaTop=(t-this.stageAreaHeight)/2,setElementPosition(this.stageArea,this.stageAreaTop,this.stageAreaLeft,this.stageAreaWidth,this.stageAreaHeight);this.usableDisplayWidth,this.stageAreaTop,this.stageAreaTop,this.stageAreaHeight,this.usableDisplayWidth,this.usableDisplayHeight,this.stageAreaTop,this.stageAreaHeight,this.stageAreaTop;var r=this.stageAreaLeft;this.stageAreaHeight,this.stageAreaLeft,this.stageAreaWidth,this.stageAreaTop,this.usableDisplayWidth,this.stageAreaWidth,this.stageAreaHeight;this.positionWaitingIndicator(),this.hideAddressBar(),document.dispatchEvent(new CustomEvent(kStageSizeDidChangeEvent,{detail:{left:this.stageAreaLeft,top:this.stageAreaTop,width:this.stageAreaWidth,height:this.stageAreaHeight}}))}},{key:"showApplicableControls",value:function(){this.hideAddressBar()}},{key:"showAll",value:function(){this.hideWaitingIndicator(),!1===this.inLaunchMode&&this.showApplicableControls(),showElement(this.stageArea),showElement(this.hyperlinkPlane)}},{key:"hideAddressBar",value:function(){this.inLaunchMode}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kStageIsReadyEvent="StageManager:StageIsReadyEvent",StageManager=function(){function e(t,i){_classCallCheck(this,e),this.textureManager=t,this.scriptManager=i,this.stage=document.getElementById("stage"),this.hyperlinkPlane=document.getElementById("hyperlinkPlane"),this.stageWidth=0,this.stageHeight=0,this.showWidth=0,this.showHeight=0,this.audioTrackOffset=0,this.audioTrackIconSize=0,document.addEventListener(kShowSizeDidChangeEvent,this.handleShowSizeDidChangeEvent.bind(this)),document.addEventListener(kStageSizeDidChangeEvent,this.handleStageSizeDidChangeEvent.bind(this))}return _createClass(e,[{key:"removeTexture",value:function(e){e.parentNode.removeChild(e)}},{key:"addHyperlink",value:function(e){var t=document.createElement("div");setElementProperty(t,"pointer-events","all"),t.setAttribute("class","hyperlink"),t.style.left=e.x+"px",t.style.top=e.y+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",this.hyperlinkPlane.appendChild(t)}},{key:"clearAllHyperlinks",value:function(){for(;this.hyperlinkPlane.childNodes.length>0;)this.hyperlinkPlane.removeChild(this.hyperlinkPlane.firstChild);this.audioTrackOffset=this.audioTrackSpacer}},{key:"handleStageSizeDidChangeEvent",value:function(e){var t=e.detail;this.stageWidth=t.width,this.stageHeight=t.height,this.adjustStageToFit(this.stage),this.adjustStageToFit(this.hyperlinkPlane)}},{key:"handleShowSizeDidChangeEvent",value:function(e){var t=e.detail;this.showWidth=t.width,this.showHeight=t.height,this.adjustStageToFit(this.stage),this.adjustStageToFit(this.hyperlinkPlane),this.audioTrackIconSize=this.showHeight/4,this.audioTrackSpacer=this.audioTrackIconSize/4,this.audioTrackOffset=this.audioTrackSpacer}},{key:"adjustStageToFit",value:function(e){if(0!==this.showWidth&&0!==this.stageWidth){var t=this.stageHeight/this.showHeight,i=this.stageWidth/this.showWidth,r="scaleX("+i+") scaleY("+t+")",a=15*Math.tan(Math.PI/180*20/2)*(this.showWidth>this.showHeight?this.showHeight:this.showWidth);this.perspective=a,setElementProperty(e,kTransformOriginPropertyName,kTransformOriginCenterPropertyValue),setElementProperty(e,kTransformPropertyName,r),setElementProperty(e,kPerspectiveOriginPropertyName,kTransformOriginCenterPropertyValue),setElementProperty(e,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue),setElementPosition(e,(t-1)*this.showHeight/2,(i-1)*this.showWidth/2,this.showWidth,this.showHeight),document.dispatchEvent(new CustomEvent(kStageIsReadyEvent,{detail:{}}))}}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kKeyframeRule=window.CSSRule.WEBKIT_KEYFRAMES_RULE,AnimationManager=function(){function e(){_classCallCheck(this,e);var t=document.createElement("style");t.type="text/css",t.media="screen",document.getElementsByTagName("head")[0].appendChild(t),this.styleSheet=document.styleSheets[document.styleSheets.length-1],this.createdAnimations=new Object}return _createClass(e,[{key:"createAnimation",value:function(e){return this.styleSheet.insertRule(kKeyframesPropertyName+" "+e+" {}",0),this.styleSheet.cssRules[0]}},{key:"deleteAllAnimations",value:function(){for(;this.styleSheet.cssRules.length>0;)this.styleSheet.deleteRule(0);this.createdAnimations=new Object}},{key:"markAnimationsCreated",value:function(e){this.createdAnimations[e]=!0}},{key:"animationsCreated",value:function(e){return this.createdAnimations[e]}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var TextureManager=function(){function e(t){_classCallCheck(this,e),this.script=null,this.showUrl=t,this.slideCache={},this.sceneDidLoadCallbackHandler=null,this.viewScale=1,document.addEventListener(kScriptDidDownloadEvent,function(e){this.handleScriptDidDownloadEvent(e)}.bind(this),!1)}return _createClass(e,[{key:"setSceneDidLoadCallbackHandler",value:function(e,t){this.sceneDidLoadCallbackHandler={handler:e,sceneIndex:t}}},{key:"processTextureDidLoadCallback",value:function(e,t){if(null!==this.sceneDidLoadCallbackHandler&&void 0!==this.sceneDidLoadCallbackHandler){var i=this.sceneDidLoadCallbackHandler.sceneIndex;this.script.slideIndexFromSceneIndexLookup[i]==t&&this.isSlidePreloaded(t)&&(this.callSceneDidLoadCallback(),setTimeout(function(){this.destroyPDFDocument(t)}.bind(this),5e3))}}},{key:"destroyPDFDocument",value:function(e){var t=this.slideCache[e];if(t){var i=t.pdf;i&&(i.destroy(),delete this.slideCache[e].pdf)}}},{key:"processSlideDidLoadCallback",value:function(e){if(null!==this.sceneDidLoadCallbackHandler&&void 0!==this.sceneDidLoadCallbackHandler){var t=this.sceneDidLoadCallbackHandler.sceneIndex;this.script.slideIndexFromSceneIndexLookup[t]==e&&this.callSceneDidLoadCallback()}}},{key:"processSceneDidLoadCallback",value:function(e){this.sceneDidLoadCallbackHandler&&e===this.sceneDidLoadCallbackHandler.sceneIndex&&this.isScenePreloaded(e)&&this.callSceneDidLoadCallback()}},{key:"callSceneDidLoadCallback",value:function(){this.sceneDidLoadCallbackHandler.handler(),this.sceneDidLoadCallbackHandler=null}},{key:"loadScene",value:function(e,t){if(!(e<0||e>this.script.numScenes)){t&&this.setSceneDidLoadCallbackHandler(t,e);var i=this.script.slideIndexFromSceneIndexLookup[e];usePDF?this.requestPdfDocument(i):this.requestSlideSvgmap(i)}}},{key:"preloadScenes",value:function(e){for(var t in e){var i=this.script.slideIndexFromSceneIndexLookup[t];null!=i&&(!1===this.slideCache.hasOwnProperty(i)&&this.loadScene(t))}}},{key:"isSlidePreloaded",value:function(e){var t=!1;if(this.slideCache[e])for(var i in t=!0,this.slideCache[e].textureRequests)if(!1===this.slideCache[e].textureRequests[i]){t=!1;break}return t}},{key:"isScenePreloaded",value:function(e){var t=this.script.slideIndexFromSceneIndexLookup[e];return this.isSlidePreloaded(t)}},{key:"handleScriptDidDownloadEvent",value:function(e){var t=e.detail;this.script=t.script,this.delegate=t.delegate}},{key:"requestPdfDocument",value:function(e){this.slideCache[e]||(this.slideCache[e]={textureAssets:{},textureRequests:{},pdf:null,requested:!1});var t=this.script.slideList[e];if(this.slideCache[e].requested)this.isSlidePreloaded(e)&&this.processSlideDidLoadCallback(e);else{var i=this.script.slides[t].assets;for(var r in i){"texture"===i[r].type&&(this.slideCache[e].textureRequests[r]=!1)}var a=this.showUrl+t+"/assets/"+t+".pdf",n={slideId:t,slideIndex:e};if(this.slideCache[e].requested=!0,"file:"===window.location.protocol){a+="p",null!==window.local_pdf&&void 0!==window.local_pdf||(window.local_pdf=function(e){this.handleRequestLocalPdfCallback(e)}.bind(this));var o=document.createElement("script");o.setAttribute("src",a),document.head.appendChild(o)}else PDFJS.getDocument(a).then(this.handleRequestPdfDocumentCompleted.bind(this,n))}}},{key:"handleRequestLocalPdfCallback",value:function(e){var t=e.slide,i=this.script.slideList.indexOf(t),r=atob(e.pdf),a={slideId:t,slideIndex:i};PDFJS.getDocument({data:r}).then(this.handleRequestPdfDocumentCompleted.bind(this,a))}},{key:"handleRequestPdfDocumentCompleted",value:function(e,t){var i=e.slideId,r=e.slideIndex,a=this.script.slides[i].assets;if(this.slideCache[r])for(var n in this.slideCache[r].pdf=t,a){var o=a[n];if("texture"===o.type){var s=this.urlForTexture(n,i);if("pdf"===/(?:\.([^.]+))?$/.exec(s)[1].toLowerCase()){var l=o.index+1;t.getPage(l).then(this.handleRequestPdfPageCompleted.bind(this,n,r))}else{var h=new Image;h.addEventListener("load",this.handleImageOnloadEvent.bind(this,n,r)),h.src=s}}}}},{key:"handleRequestPdfPageCompleted",value:function(e,t,i){var r=this,a=i.getViewport(pdfScaleFactor),n=document.createElement("canvas"),o=n.getContext("2d");n.height=a.height,n.width=a.width;var s={canvasContext:o,background:"rgba(0, 0, 0, 0)",viewport:a},l=this.slideCache,h=i.render(s),c=h._internalRenderTask.callback;h._internalRenderTask.callback=function(i){c.call(r,i),l[t].textureAssets[e]=n,l[t].textureRequests[e]=!0,r.processTextureDidLoadCallback(e,t)}}},{key:"requestSlideSvgmap",value:function(e){this.slideCache[e]||(this.slideCache[e]={},this.slideCache[e].textureAssets={},this.slideCache[e].textureRequests={});var t=this.script.slideList[e];if(this.slideCache[e].svgmap)this.isSlidePreloaded(e)&&this.processSlideDidLoadCallback(e);else{var i=this.script.slides[t].assets;for(var r in i){"texture"===i[r].type&&(this.slideCache[e].textureRequests[r]=!1)}var a=this.showUrl+t+"/assets/"+t+".svgmap";if("file:"===window.location.protocol){a+="p",null!==window.svgmap&&void 0!==window.svgmap||(window.svgmap=this.handleRequestSlideSvgmapCompleted.bind(this,null,!0));var n=document.createElement("script");n.setAttribute("src",a),document.head.appendChild(n)}else{var o={slideId:t,slideIndex:e};new Ajax.Request(a,{method:"get",onSuccess:this.handleRequestSlideSvgmapCompleted.bind(this,o,!1)})}}}},{key:"handleRequestSlideSvgmapCompleted",value:function(e,t,i){var r,a;t?(r=i.slide,a=i.svg):(r=e.slideId,a=JSON.parse(i.responseText));var n=this.script.slideList.indexOf(r),o=this.script.slides[r].assets;for(var s in this.slideCache[n].svgmap=a,o){var l=o[s];if("texture"===l.type){var h=this.urlForTexture(s,r),c=h.split("/"),u=c[c.length-1].split(".");if("svgmap"===u[u.length-1]){var d=a[l.index];e={textureId:s,slideId:r,slideIndex:n};this.handleFetchCompleted(e,d)}else{var f=new Image;f.addEventListener("load",this.handleImageOnloadEvent.bind(this,s,n)),f.src=h}}}}},{key:"handleFetchCompleted",value:function(e,t){this.viewScale;for(var i=e.textureId,r=e.slideId,a=e.slideIndex,n=new DOMParser,o=this.showUrl+r+"/assets/",s=n.parseFromString(t,"text/xml"),l=s.documentElement.getAttribute("viewBox").split(" "),h=l[2],c=l[3],u=s.getElementsByTagName("image"),d=0,f=u.length;d<f;d++){var m=u[d],p=m.getAttributeNS("http://www.w3.org/1999/xlink","href");m.setAttributeNS("http://www.w3.org/1999/xlink","href",o+p)}var A=document.importNode(s.documentElement,!0);A.setAttributeNS("http://www.w3.org/2000/svg","width",h),A.setAttributeNS("http://www.w3.org/2000/svg","height",c),this.slideCache[a].textureAssets[i]=A,this.slideCache[a].textureRequests[i]=!0,this.processTextureDidLoadCallback(i,a)}},{key:"handleImageOnloadEvent",value:function(e,t,i){var r=(i=i||window.event).target||i.srcElement;this.slideCache[t].textureAssets[e]=r,this.slideCache[t].textureRequests[e]=!0,this.processTextureDidLoadCallback(e,t)}},{key:"getTextureObject",value:function(e,t){var i,r=this.script.slideIndexFromSceneIndexLookup[e];return this.slideCache[r]&&(i=this.slideCache[r].textureAssets[t]),i}},{key:"getTextureInfo",value:function(e,t){var i=this.script.slideIndexFromSceneIndexLookup[e];if(null==i)return null;var r=this.script.slideList[i];return this.script.slides[r].assets[t]}},{key:"getTextureUrl",value:function(e,t){var i=this.script.slideIndexFromSceneIndexLookup[e];if(null==i)return null;var r=this.script.slideList[i];return this.urlForTexture(t,r)}},{key:"getMovieUrl",value:function(e,t){var i=this.script.slideIndexFromSceneIndexLookup[e];if(null==i)return null;var r=this.script.slideList[i];return this.urlForAsset(t,r)}},{key:"urlForAsset",value:function(e,t){var i,r="",a=this.script.slides[t].assets[e];return null==a||null!=(i=usePDF?a.url.native:a.url.web)&&""!==i&&(r="http"===i.toLowerCase().substring(0,4)?i:this.showUrl+(t?t+"/":"")+i),r}},{key:"urlForTexture",value:function(e,t){return this.generateUrl(e,t,!1)}},{key:"generateUrl",value:function(e,t){var i="",r="",a=this.script.slides[t].assets[e];return a?(null!=(r=usePDF?a.url.native:a.url.web)&&""!=r&&(i="http"===r.toLowerCase().substring(0,4)?r:this.showUrl+(t?t+"/":"")+r),i):i}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kShowSizeDidChangeEvent="ScriptManager:ShowSizeDidChangeEvent",kScriptDidDownloadEvent="ScriptManager:ScriptDidDownloadEvent",kScriptDidNotDownloadEvent="ScriptManager:ScriptDidNotDownloadEvent",kSlideDidDownloadEvent="SlideManager:SlideDidDownloadEvent",kSlideDidNotDownloadEvent="SlideManager:SlideDidNotDownloadEvent",ScriptManager=function(){function e(t){_classCallCheck(this,e),this.script=null,this.showUrl=t,this.slideManager=null,document.addEventListener(kSlideDidDownloadEvent,this.handleSlideDidDownloadEvent.bind(this)),document.addEventListener(kSlideDidNotDownloadEvent,this.handleSlideDidDownloadEvent.bind(this))}return _createClass(e,[{key:"handleSlideDidDownloadEvent",value:function(e){var t=!0;for(var i in this.slideManager.slides)if(this.slideManager.slides.hasOwnProperty(i)&&!this.slideManager.slides[i].downloaded){t=!1;break}if(t){this.script.events=[],this.script.originalEvents=[],this.script.slideIndexFromSceneIndexLookup={},this.script.sceneIndexFromSlideIndexLookup={},this.script.slides={},this.script.originalSlides={};var r,a,n,o,s=0,l=0,h=0;for(var i in this.slideManager.slides)if(this.slideManager.slides.hasOwnProperty(i)){n=this.slideManager.slides[i].script,o=this.slideManager.slides[i].originalScript,r=n.events,a=o.events,this.script.slides[i]=n,this.script.originalSlides[i]=o,this.script.sceneIndexFromSlideIndexLookup[s]=l;for(var c=0,u=r.length;c<u;c++)this.script.events.push(r[c]),this.script.originalEvents.push(a[c]),this.script.slideIndexFromSceneIndexLookup[h]=s,h+=1;s+=1,l=h}this.script.numScenes=this.script.events.length,this.script.lastSceneIndex=this.script.numScenes-1,this.script.lastSlideIndex=this.script.slideList.length-1,this.script.originalSlideWidth=this.script.slideWidth,this.script.originalSlideHeight=this.script.slideHeight,isEdge?this.adjustScriptForEdge():this.adjustScript(),this.delegate.setViewScale&&(this.applyScaleFactor(),this.delegate.setViewScale(this.scaleFactor)),document.dispatchEvent(new CustomEvent(kScriptDidDownloadEvent,{detail:{script:this.script,delegate:this.delegate}})),document.dispatchEvent(new CustomEvent(kShowSizeDidChangeEvent,{detail:{width:this.script.slideWidth,height:this.script.slideHeight}}))}}},{key:"adjustScript",value:function(){for(var e=0,t=this.script.events.length;e<t;e++){for(var i=this.script.events[e],r=this.script.originalEvents[e],a=0,n=i.effects.length;a<n;a++){var o=i.effects[a],s=r.effects[a];this.adjustEffects(o,s),this.adjustEmphasisBuilds(o,s),isSafari&&this.adjustEffectsForSafari(o,s),isChrome&&this.adjustEffectsForChrome(o,s),"moz"===browserPrefix&&this.adjustEffectsForFirefox(o,s)}a=0;for(var l=i.hyperlinks.length;a<l;a++){var h=i.hyperlinks[a],c=r.hyperlinks[a];for(var u in h.events){var d=h.events[u],f=c.events[u],m=0;for(n=d.effects.length;m<n;m++){var p=d.effects[m],A=f.effects[m];this.adjustEffects(p,A),this.adjustEmphasisBuilds(p,A),isSafari&&this.adjustEffectsForSafari(o,s),isChrome&&this.adjustEffectsForChrome(o,s),"moz"===browserPrefix&&this.adjustEffectsForFirefox(o,s)}}}}}},{key:"adjustEffects",value:function(e,t){switch(e.name){case"com.apple.iWork.Keynote.BLTBlinds":if("transition"===e.type){var i=t.baseLayer.layers[0];(r=e.baseLayer.layers[0]).layers.splice(0,2),i.layers.splice(0,2)}break;case"apple:apple-grid":i=t.baseLayer.layers[0];(r=e.baseLayer.layers[0]).layers.splice(0,2),i.layers.splice(0,2);break;case"com.apple.iWork.Keynote.BLTSwoosh":i=t.baseLayer.layers[0];var r=e.baseLayer.layers[0];if("transition"===e.type){r.layers[1].layers[0].layers.splice(0,1),i.layers[1].layers[0].layers.splice(0,1);var a=i.layers[1];i.layers[1]=i.layers[2],i.layers[2]=a;var n=r.layers[1];r.layers[1]=r.layers[2],r.layers[2]=n}}}},{key:"adjustEmphasisBuilds",value:function(e,t){switch(e.name){case"apple:action-blink":case"apple:action-pulse":var i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];i.animations[0]||(i=t.baseLayer.layers[0].layers[0],r=e.baseLayer.layers[0].layers[0]);for(var a=(y=i.animations[0]).repeatCount?Math.floor(y.repeatCount):1,n=y.duration,o=y.keyTimes,s=y.values,l=y.timingFunctions,h=n*a,c=[],u=[],d=[],f=0,m=1/a,p=0;p<a;p++){f=m*p;for(var A=0,v=o.length;A<v;A++)c.push(f+o[A]/a),u.push(s[A]);var g=0;for(v=l.length;g<v;g++)d.push(l[g]);p<a-1&&d.push({timingFunction:"linear"})}i.animations[0].duration=h,i.animations[0].keyTimes=c,i.animations[0].values=u,i.animations[0].timingFunctions=d,r.animations[0].duration=h,r.animations[0].keyTimes=c,r.animations[0].values=u,r.animations[0].timingFunctions=d;break;case"apple:action-jiggle":i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];i.animations[0]||(i=t.baseLayer.layers[0].layers[0],r=e.baseLayer.layers[0].layers[0]);var y,b=i.animations[0];for(v=(y=r.animations[0]).animations.length,p=0;p<v;p++)for(a=Math.ceil(y.duration/y.animations[p].duration),A=0;A<a-1;A++){var S=JSON.parse(JSON.stringify(b.animations[p])),x=JSON.parse(JSON.stringify(y.animations[p]));S.beginTime=b.animations[p].duration*(A+1),x.beginTime=y.animations[p].duration*(A+1),i.animations[0].animations.push(S),r.animations[0].animations.push(x),A===a-2&&(S.duration=y.duration-S.beginTime,x.duration=y.duration-x.beginTime,"transform.rotation.z"===y.animations[p].property?(S.to.scalar=0,x.to.scalar=0):"position"===y.animations[p].property&&(S.to.pointX=(S.from.pointX+S.to.pointX)/2,x.to.pointX=(x.from.pointX+x.to.pointX)/2))}}g=0;for(var C=e.effects.length;g<C;g++)this.adjustEmphasisBuilds(e.effects[g],t.effects[g])}},{key:"adjustEffectsForSafari",value:function(e,t){switch(e.name){case"apple:scale":var i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[0].animations.length>0){var a=i.layers[0];i.layers[0]=i.layers[1],i.layers[1]=a,i.layers[1].initialState.hidden=!0;var n=r.layers[0];r.layers[0]=r.layers[1],r.layers[1]=n,r.layers[1].initialState.hidden=!0;var o,s=i.layers[1].animations[0].beginTime,l=i.layers[1].animations[0].duration,h=i.layers[1].animations[0].animations[0].beginTime,c=i.layers[1].animations[0].animations[0].duration;if(s===h){for(var u=0,d=i.layers[1].animations[0].animations.length;u<d;u++)"transform.translation.z"===i.layers[1].animations[0].animations[u].property&&(i.layers[1].animations[0].animations.splice(u,1),r.layers[1].animations[0].animations.splice(u,1));o={animations:[],beginTime:s,duration:l,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations.push(o),r.layers[1].animations[0].animations.push(o)}else{for(u=0,d=i.layers[1].animations[0].animations[0].animations.length;u<d;u++)"transform.translation.z"===i.layers[1].animations[0].animations[0].animations[u].property&&(i.layers[1].animations[0].animations[0].animations.splice(u,1),r.layers[1].animations[0].animations[0].animations.splice(u,1));o={animations:[],beginTime:i.layers[1].animations[0].animations[0].animations[0].beginTime+.03,duration:i.layers[1].animations[0].animations[0].animations[0].duration,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations[0].animations.push(o),r.layers[1].animations[0].animations[0].animations.push(o)}}break;case"com.apple.iWork.Keynote.KLNSwap":var f,m,p,A;i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[1].animations[0].animations.length>1){for(u=0,d=i.layers[1].animations[0].animations.length;u<d&&(p=i.layers[1].animations[0].animations[u],A=r.layers[1].animations[0].animations[u],"opacity"!==p.property);u++);c=i.layers[1].animations[0].duration}else{for(u=0,d=i.layers[1].animations[0].animations[0].animations.length;u<d&&(p=i.layers[1].animations[0].animations[0].animations[u],A=r.layers[1].animations[0].animations[0].animations[u],"opacity"!==p.property);u++);c=i.layers[1].animations[0].animations[0].duration}f=.4*c,m=.4*c,p.to.scalar=0,p.beginTime=f,p.duration=m,A.to.scalar=0,A.beginTime=f,A.duration=m}}},{key:"adjustEffectsForChrome",value:function(e,t){switch(e.name){case"apple:fall":var i=t.baseLayer.layers[0],r=e.baseLayer.layers[0],a=i.layers[1].animations[0].beginTime,n=i.layers[1].animations[0].duration;if(!i.layers[1].animations[0].animations)break;var o={animations:[],beginTime:a,duration:n-.01,fillMode:"forwards",from:{scalar:1},property:"transform.translation.z",timingFunction:"linear",to:{scalar:1}},s={animations:[],beginTime:n-.01,duration:.01,fillMode:"forwards",from:{scalar:-1},property:"transform.translation.z",timingFunction:"linear",to:{scalar:-1}};i.layers[1].animations[0].animations.push(o),r.layers[1].animations[0].animations.push(o),i.layers[1].animations[0].animations.push(s),r.layers[1].animations[0].animations.push(s);break;case"apple:scale":i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[0].animations.length>0){var l=i.layers[0];i.layers[0]=i.layers[1],i.layers[1]=l,i.layers[1].initialState.hidden=!0;var h=r.layers[0];r.layers[0]=r.layers[1],r.layers[1]=h,r.layers[1].initialState.hidden=!0;a=i.layers[1].animations[0].beginTime,n=i.layers[1].animations[0].duration;var c,u=i.layers[1].animations[0].animations[0].beginTime,d=i.layers[1].animations[0].animations[0].duration;if(a===u){for(var f=0,m=i.layers[1].animations[0].animations.length;f<m;f++)"transform.translation.z"===i.layers[1].animations[0].animations[f].property&&(i.layers[1].animations[0].animations.splice(f,1),r.layers[1].animations[0].animations.splice(f,1));c={animations:[],beginTime:a,duration:n,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations.push(c),r.layers[1].animations[0].animations.push(c)}else{for(f=0,m=i.layers[1].animations[0].animations[0].animations.length;f<m;f++)"transform.translation.z"===i.layers[1].animations[0].animations[0].animations[f].property&&(i.layers[1].animations[0].animations[0].animations.splice(f,1),r.layers[1].animations[0].animations[0].animations.splice(f,1));c={animations:[],beginTime:i.layers[1].animations[0].animations[0].animations[0].beginTime+.03,duration:i.layers[1].animations[0].animations[0].animations[0].duration,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations[0].animations.push(c),r.layers[1].animations[0].animations[0].animations.push(c)}}break;case"com.apple.iWork.Keynote.KLNSwap":var p,A,v,g;i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[1].animations[0].animations.length>1){for(f=0,m=i.layers[1].animations[0].animations.length;f<m&&(v=i.layers[1].animations[0].animations[f],g=r.layers[1].animations[0].animations[f],"opacity"!==v.property);f++);d=i.layers[1].animations[0].duration}else{for(f=0,m=i.layers[1].animations[0].animations[0].animations.length;f<m&&(v=i.layers[1].animations[0].animations[0].animations[f],g=r.layers[1].animations[0].animations[0].animations[f],"opacity"!==v.property);f++);d=i.layers[1].animations[0].animations[0].duration}p=.4*d,A=.4*d,v.to.scalar=0,v.beginTime=p,v.duration=A,g.to.scalar=0,g.beginTime=p,g.duration=A}}},{key:"adjustEffectsForFirefox",value:function(e,t){switch(e.name){case"apple:scale":var i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[0].animations.length>0){var a=i.layers[0];i.layers[0]=i.layers[1],i.layers[1]=a,i.layers[1].initialState.hidden=!0;var n=r.layers[0];r.layers[0]=r.layers[1],r.layers[1]=n,r.layers[1].initialState.hidden=!0;var o,s=i.layers[1].animations[0].beginTime,l=i.layers[1].animations[0].duration,h=i.layers[1].animations[0].animations[0].beginTime,c=i.layers[1].animations[0].animations[0].duration;if(s===h){for(var u=0,d=i.layers[1].animations[0].animations.length;u<d;u++)"transform.translation.z"===i.layers[1].animations[0].animations[u].property&&(i.layers[1].animations[0].animations.splice(u,1),r.layers[1].animations[0].animations.splice(u,1));o={animations:[],beginTime:s,duration:l,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations.push(o),r.layers[1].animations[0].animations.push(o)}else{for(u=0,d=i.layers[1].animations[0].animations[0].animations.length;u<d;u++)"transform.translation.z"===i.layers[1].animations[0].animations[0].animations[u].property&&(i.layers[1].animations[0].animations[0].animations.splice(u,1),r.layers[1].animations[0].animations[0].animations.splice(u,1));o={animations:[],beginTime:i.layers[1].animations[0].animations[0].animations[0].beginTime+.03,duration:i.layers[1].animations[0].animations[0].animations[0].duration,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations[0].animations.push(o),r.layers[1].animations[0].animations[0].animations.push(o)}}break;case"com.apple.iWork.Keynote.KLNSwap":var f,m,p,A;i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[1].animations[0].animations.length>1){for(u=0,d=i.layers[1].animations[0].animations.length;u<d&&(p=i.layers[1].animations[0].animations[u],A=r.layers[1].animations[0].animations[u],"opacity"!==p.property);u++);c=i.layers[1].animations[0].duration}else{for(u=0,d=i.layers[1].animations[0].animations[0].animations.length;u<d&&(p=i.layers[1].animations[0].animations[0].animations[u],A=r.layers[1].animations[0].animations[0].animations[u],"opacity"!==p.property);u++);c=i.layers[1].animations[0].animations[0].duration}f=.4*c,m=.4*c,p.to.scalar=0,p.beginTime=f,p.duration=m,A.to.scalar=0,A.beginTime=f,A.duration=m}}},{key:"adjustScriptForEdge",value:function(){for(var e=0,t=this.script.events.length;e<t;e++){for(var i=this.script.events[e],r=this.script.originalEvents[e],a=0,n=i.effects.length;a<n;a++){var o=i.effects[a],s=r.effects[a];this.adjustEffectsForEdge(o,s),this.adjustEmphasisBuilds(o,s)}a=0;for(var l=i.hyperlinks.length;a<l;a++){var h=i.hyperlinks[a],c=r.hyperlinks[a];for(var u in h.events){var d=h.events[u],f=c.events[u],m=0;for(n=d.effects.length;m<n;m++){var p=d.effects[m],A=f.effects[m];this.adjustEffectsForEdge(p,A),this.adjustEmphasisBuilds(p,A)}}}}}},{key:"adjustEffectsForEdge",value:function(e,t){switch(e.name){case"apple:bounce":case"apple:slide":case"apple:pivot":case"apple:scale":var i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[0].animations.length>0){var a=i.layers[0];i.layers[0]=i.layers[1],i.layers[1]=a,i.layers[1].initialState.hidden=!0;var n=r.layers[0];r.layers[0]=r.layers[1],r.layers[1]=n,r.layers[1].initialState.hidden=!0;var o=i.layers[1].animations[0].beginTime,s=i.layers[1].animations[0].duration,l=i.layers[1].animations[0].animations[0].beginTime,h=i.layers[1].animations[0].animations[0].duration;if(o===l){for(var c=0,u=i.layers[1].animations[0].animations.length;c<u;c++)"transform.translation.z"===i.layers[1].animations[0].animations[c].property&&(i.layers[1].animations[0].animations.splice(c,1),r.layers[1].animations[0].animations.splice(c,1));A={animations:[],beginTime:o,duration:s,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations.push(A),r.layers[1].animations[0].animations.push(A)}else{for(c=0,u=i.layers[1].animations[0].animations[0].animations.length;c<u;c++)"transform.translation.z"===i.layers[1].animations[0].animations[0].animations[c].property&&(i.layers[1].animations[0].animations[0].animations.splice(c,1),r.layers[1].animations[0].animations[0].animations.splice(c,1));A={animations:[],beginTime:i.layers[1].animations[0].animations[0].animations[0].beginTime+.03,duration:i.layers[1].animations[0].animations[0].animations[0].duration,fillMode:"forwards",from:{scalar:!1},property:"hidden",timingFunction:"linear",to:{scalar:!1}},i.layers[1].animations[0].animations[0].animations.push(A),r.layers[1].animations[0].animations[0].animations.push(A)}}break;case"apple:doorway":i=t.baseLayer.layers[0],r=e.baseLayer.layers[0],o=i.layers[0].animations[0].beginTime,s=i.layers[0].animations[0].duration,l=i.layers[0].animations[0].animations[0].beginTime,h=i.layers[0].animations[0].animations[0].duration;i.layers[0].layers=[],i.layers[0].animations=[],r.layers[0].layers=[],r.layers[0].animations=[],o===l?(i.layers[1].animations[0].animations[0].beginTime=l,i.layers[1].animations[0].animations[0].duration=h,r.layers[1].animations[0].animations[0].beginTime=l,r.layers[1].animations[0].animations[0].duration=h):(i.layers[1].animations[0].animations[0].animations[0].duration=h,r.layers[1].animations[0].animations[0].animations[0].duration=h),i.layers.splice(2,1),r.layers.splice(2,1);break;case"com.apple.iWork.Keynote.BLTBlinds":case"apple:3D-cube":case"com.apple.iWork.Keynote.BLTReflection":case"apple:revolve":case"com.apple.iWork.Keynote.BLTRevolvingDoor":i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];p={animations:[],beginTime:0,duration:t.duration,fillMode:"both",from:{scalar:1},property:"opacity",timingFunction:"easeInEaseOut",to:{scalar:0}},i.layers[0].layers=[],i.layers[0].animations=[],i.layers[1].layers=[],i.layers[1].animations=[],i.layers[1].animations.push(p),r.layers[0].layers=[],r.layers[0].animations=[],r.layers[1].layers=[],r.layers[1].animations=[],r.layers[1].animations.push(p),"com.apple.iWork.Keynote.BLTBlinds"===e.name&&(i.layers[0].initialState.hidden=!1,i.layers[1].initialState.hidden=!1,r.layers[0].initialState.hidden=!1,r.layers[1].initialState.hidden=!1,i.layers.splice(2,i.layers.length-2),r.layers.splice(2,r.layers.length-2));break;case"com.apple.iWork.Keynote.KLNSwap":var d,f,m,p;i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[1].animations[0].animations.length>1){for(c=0,u=i.layers[1].animations[0].animations.length;c<u&&(m=i.layers[1].animations[0].animations[c],p=r.layers[1].animations[0].animations[c],"opacity"!==m.property);c++);h=i.layers[1].animations[0].duration}else{for(c=0,u=i.layers[1].animations[0].animations[0].animations.length;c<u&&(m=i.layers[1].animations[0].animations[0].animations[c],p=r.layers[1].animations[0].animations[0].animations[c],"opacity"!==m.property);c++);h=i.layers[1].animations[0].animations[0].duration}d=.4*h,f=.4*h,m.to.scalar=0,m.beginTime=d,m.duration=f,p.to.scalar=0,p.beginTime=d,p.duration=f;break;case"apple:FlipThrough":i=t.baseLayer.layers[0],r=e.baseLayer.layers[0];if(i.layers[0].animations.length>0){a=JSON.parse(JSON.stringify(i.layers[1]));i.layers.splice(0,0,a);n=JSON.parse(JSON.stringify(r.layers[1]));r.layers.splice(0,0,n);var A;o=i.layers[1].animations[0].beginTime,s=i.layers[1].animations[0].duration,l=i.layers[1].animations[0].animations[0].beginTime,h=i.layers[1].animations[0].animations[0].duration;if(o===l){for(c=0,u=i.layers[1].animations[0].animations.length;c<u;c++)"transform.translation.z"===i.layers[1].animations[0].animations[c].property&&(i.layers[1].animations[0].animations.splice(c,1),r.layers[1].animations[0].animations.splice(c,1));A={animations:[],beginTime:o+s/2,duration:s/2,fillMode:"forwards",from:{scalar:!0},property:"hidden",timingFunction:"linear",to:{scalar:!0}},i.layers[2].animations[0].animations.push(A),r.layers[2].animations[0].animations.push(A)}else{for(c=0,u=i.layers[1].animations[0].animations[0].animations.length;c<u;c++)"transform.translation.z"===i.layers[1].animations[0].animations[0].animations[c].property&&(i.layers[1].animations[0].animations[0].animations.splice(c,1),r.layers[1].animations[0].animations[0].animations.splice(c,1));A={animations:[],beginTime:i.layers[2].animations[0].animations[0].animations[0].beginTime+i.layers[2].animations[0].animations[0].animations[0].duration/2,duration:i.layers[2].animations[0].animations[0].animations[0].duration/2,fillMode:"forwards",from:{scalar:!0},property:"hidden",timingFunction:"linear",to:{scalar:!0}},i.layers[2].animations[0].animations[0].animations.push(A),r.layers[2].animations[0].animations[0].animations.push(A)}}}}},{key:"handleSlideDidNotDownloadEvent",value:function(e){this.scriptDidNotDownload.bind(this)}},{key:"reapplyScaleFactor",value:function(){this.delegate.setViewScale&&(this.applyScaleFactor(),this.delegate.setViewScale(this.scaleFactor))}},{key:"applyScaleFactorForAnimation",value:function(e,t,i){var r=e.property;if(e.path)for(var a=0,n=e.path.length;a<n;a++){var o=e.path[a].points,s=t.path[a].points;o[0][0]=s[0][0]*i,o[0][1]=s[0][1]*i}switch(r){case"anchorPointZ":case"zPosition":case"transform.translation.x":case"transform.translation.y":if(e.from&&(e.from.scalar=t.from.scalar*i),e.to&&(e.to.scalar=t.to.scalar*i),e.values){a=0;for(var l=e.values.length;a<l;a++)e.values[a].scalar=t.values[a].scalar*i}break;case"transform.translation.z":if(e.from&&1!==e.from.scalar&&.01!==e.from.scalar&&(e.from.scalar=t.from.scalar*i),e.to&&1!==e.to.scalar&&.01!==e.to.scalar&&(e.to.scalar=t.to.scalar*i),e.values)for(a=0,l=e.values.length;a<l;a++)e.values[a].scalar=t.values[a].scalar*i;break;case"position":case"transform.translation":if(e.from&&(e.from.pointX=t.from.pointX*i,e.from.pointY=t.from.pointY*i),e.to&&(e.to.pointX=t.to.pointX*i,e.to.pointY=t.to.pointY*i),e.values)for(a=0,l=e.values.length;a<l;a++)e.values[a].pointX=t.values[a].pointX*i,e.values[a].pointY=t.values[a].pointY*i;break;case"transform":if(e.from&&(e.from.transform[12]=t.from.transform[12]*i,e.from.transform[13]=t.from.transform[13]*i,e.from.transform[14]=t.from.transform[14]*i),e.to&&(e.to.transform[12]=t.to.transform[12]*i,e.to.transform[13]=t.to.transform[13]*i,e.to.transform[14]=t.to.transform[14]*i),e.values)for(a=0,l=e.values.length;a<l;a++)e.values[a].transform[12]=t.values[a].transform[12]*i,e.values[a].transform[13]=t.values[a].transform[13]*i,e.values[a].transform[14]=t.values[a].transform[14]*i;break;case"bounds":e.from&&(e.from.width=t.from.width*i,e.from.height=t.from.height*i),e.to&&(e.to.width=t.to.width*i,e.to.height=t.to.height*i)}if(e.animations){a=0;for(var h=e.animations.length;a<h;a++)this.applyScaleFactorForAnimation(e.animations[a],t.animations[a],i)}}},{key:"applyScaleFactorForLayer",value:function(e,t,i,r,a,n){var o=e.initialState,s=t.initialState,l=s.contentsRect;switch(o.affineTransform[4]=s.affineTransform[4]*i,o.affineTransform[5]=s.affineTransform[5]*i,o.width=s.width*i,o.height=s.height*i,o.position.pointX=s.position.pointX*i,o.position.pointY=s.position.pointY*i,r){case"com.apple.iWork.Keynote.BLTBlinds":case"com.apple.iWork.Keynote.BLTMosaicFlip":this.adjustForCropAnimation(o,l,n.particleCount.x,n.particleCount.y)}if(e.animations)for(var h=0,c=e.animations.length;h<c;h++)this.applyScaleFactorForAnimation(e.animations[h],t.animations[h],i);for(h=0,c=e.layers.length;h<c;h++)this.applyScaleFactorForLayer(e.layers[h],t.layers[h],i,r,a,n)}},{key:"applyScaleFactorForBaseLayer",value:function(e,t,i){var r=e.initialState,a=t.initialState;r.affineTransform[4]=a.affineTransform[4]*i,r.affineTransform[5]=a.affineTransform[5]*i,r.width=a.width*i,r.height=a.height*i,r.position.pointX=a.position.pointX*i,r.position.pointY=a.position.pointY*i;for(var n=0,o=e.layers.length;n<o;n++)this.applyScaleFactorForBaseLayer(e.layers[n],t.layers[n],i)}},{key:"applyScaleFactor",value:function(){var e=this.script.originalSlideWidth,t=this.script.originalSlideHeight,i=scaleSizeWithinSize(e,t,window.innerWidth,window.innerHeight),r=(i.width,i.height/t);this.scaleFactor=r,this.script.slideWidth=this.script.originalSlideWidth*r,this.script.slideHeight=this.script.originalSlideHeight*r;for(var a=0,n=this.script.events.length;a<n;a++){var o=this.script.events[a],s=this.script.originalEvents[a],l=this.script.slideIndexFromSceneIndexLookup[a],h=this.script.slideList[l];this.applyScaleFactorForBaseLayer(o.baseLayer,s.baseLayer,r);for(var c=0,u=o.effects.length;c<u;c++){var d=o.effects[c],f=s.effects[c],m={};if("com.apple.iWork.Keynote.BLTMosaicFlip"===d.name||"com.apple.iWork.Keynote.BLTBlinds"===d.name){for(var p=0,A=0,v=0,g=d.baseLayer.layers[0].layers.length;v<g;v++){var y=f.baseLayer.layers[0].layers[v].initialState.contentsRect;(M=Math.round(y.x/y.width))>p&&(p=M),(I=Math.round(y.y/y.height))>A&&(A=I)}m.particleCount={x:p+1,y:A+1}}this.applyScaleFactorForLayer(d.baseLayer,f.baseLayer,r,d.name,h,m)}c=0;for(var b=o.hyperlinks.length;c<b;c++){var S=o.hyperlinks[c],x=s.hyperlinks[c],C=S.targetRectangle,w=x.targetRectangle;for(var P in C.y=w.y*r,C.x=w.x*r,C.width=w.width*r,C.height=w.height*r,S.events){var T=S.events[P],k=x.events[P],D=0;for(u=T.effects.length;D<u;D++){var E=T.effects[D],B=k.effects[D];m={};if("com.apple.iWork.Keynote.BLTMosaicFlip"===E.name||"com.apple.iWork.Keynote.BLTBlinds"===E.name){for(p=0,A=0,v=0,g=E.baseLayer.layers[0].layers.length;v<g;v++){var M,I;y=E.baseLayer.layers[0].layers[v].initialState.contentsRect;(M=Math.round(y.x/y.width))>p&&(p=M),(I=Math.round(y.y/y.height))>A&&(A=I)}m.particleCount={x:p+1,y:A+1}}this.applyScaleFactorForLayer(E.baseLayer,B.baseLayer,r,E.name,h,m)}}}}for(var F in this.script.slides)if(this.script.slides.hasOwnProperty(F)){var L=this.script.slides[F],N=this.script.originalSlides[F];for(var G in L.assets)if(L.assets.hasOwnProperty(G)){var R=L.assets[G],O=N.assets[G];R.width=O.width*r,R.height=O.height*r}}}},{key:"adjustForCropAnimation",value:function(e,t,i,r){var a=this.script.slideWidth,n=this.script.slideHeight,o=Math.floor(a/i),s=Math.floor(n/r),l=Math.round(t.x/t.width),h=Math.round(t.y/t.height);1===t.width&&1===t.height||(e.width=l!==i-1?o:a-o*(i-1),e.height=h!==r-1?s:n-s*(r-1),e.position.pointX=o*l+e.width/2,e.position.pointY=s*h+e.height/2,e.contentsRect.x=o*l/a,e.contentsRect.y=s*h/n,e.contentsRect.width=e.width/a,e.contentsRect.height=e.height/n)}},{key:"downloadScript",value:function(e){if(this.delegate=e,this.delegate.getKPFJsonStringForShow){if(this.script=JSON.parse(this.delegate.getKPFJsonStringForShow()),null==this.script)return;return this.slideManager=new SlideManager({header:this.script}),void this.slideManager.getSlides(this.script.slideList,this.delegate)}this.downloadTimeout=setTimeout(this.scriptDidNotDownload.bind(this),kMaxScriptDownloadWaitTime),this.downloadAlreadyFailed=!1;var t=this.showUrl+"header.json";if("file:"===window.location.protocol){t+="p",window.local_header=function(e){this.scriptDidDownload(e,!0)}.bind(this);var i=document.createElement("script");i.setAttribute("src",t),document.head.appendChild(i)}else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.send(),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?this.scriptDidDownload(r):this.scriptDidNotDownload())}.bind(this)}}},{key:"scriptDidDownload",value:function(e,t){clearTimeout(this.downloadTimeout),this.script=t?e:JSON.parse(e.responseText),this.slideManager=new SlideManager({header:this.script}),this.slideManager.downloadSlides(this.script.slideList)}},{key:"scriptDidNotDownload",value:function(e){this.downloadAlreadyFailed=!0,e&&clearTimeout(this.downloadTimeout),document.dispatchEvent(new CustomEvent(kScriptDidNotDownloadEvent,{detail:{}}))}},{key:"sceneIndexFromSlideIndex",value:function(e){return null===this.script||void 0===this.script||e<0||e>=this.script.slideList.length?-1:this.script.sceneIndexFromSlideIndexLookup[e]}},{key:"slideIndexFromSceneIndex",value:function(e){return null===this.script||void 0===this.script||e<0||e>=this.script.events.length?-1:this.script.slideIndexFromSceneIndexLookup[e]}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kOrientationChangedEvent="OrientationController:OrientationChangedEvent",OrientationController=function(){function e(){_classCallCheck(this,e);var t=navigator.platform;"iPad"!==t&&"iPhone"!==t&&"iPod"!==t||(window.addEventListener("orientationchange",this.handleDeviceOrientationChangeEvent.bind(this)),this.handleDeviceOrientationChangeEvent()),this.orientation=kOrientationUnknown}return _createClass(e,[{key:"handleDeviceOrientationChangeEvent",value:function(e){var t=window.orientation,i=kOrientationUnknown;i=90===t||-90===t?kOrientationLandscape:kOrientationPortrait,this.changeOrientation(i)}},{key:"changeOrientation",value:function(e){this.orientation=e,document.dispatchEvent(new CustomEvent(kOrientationChangedEvent,{detail:{orientation:this.orientation}}))}}]),e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kpfLayerCounter=0,eventOverallDuration=0,KPFEffect=function(){function e(t){_classCallCheck(this,e),this.attributes=t.attributes,this.type=t.type,this.name=t.name,this.beginTime=t.beginTime,this.duration=t.duration,this.objectID=t.objectID,this.baseLayer=t.baseLayer,this.webVideo=t.webVideo,kEmphasisEffects.indexOf(this.name)>-1&&(this.isEmphasisBuild=!0),t.movie&&(this.movie=t.movie),this.effects=[],this.addSubEffect(t.effects)}return _createClass(e,[{key:"destroy",value:function(){for(var e=0,t=this.effects.length;e<t;e++)this.destroyEffect(this.effects[e]);this.type=null,this.name=null,this.beginTime=null,this.duration=null,this.objectID=null,delete this.kpfLayer,delete this.effects,delete this.baseLayer,this.movie&&delete this.movie,this.currentKPFLayer&&delete this.currentKPFLayer}},{key:"destroyEffect",value:function(e){for(var t=0,i=e.effects.length;t<i;t++)this.destroyEffect(e.effects[t]);e.type=null,e.name=null,e.beginTime=null,e.duration=null,e.objectID=null,delete e.kpfLayer,delete e.effects,delete e.baseLayer,e.movie&&delete e.movie,e.currentKPFLayer&&delete e.currentKPFLayer}},{key:"addSubEffect",value:function(t){for(var i=0,r=t.length;i<r;i++){var a=new e(t[i]);this.effects.push(a)}}}]),e}(),KPFCssAnimation=function(){function e(t,i){_classCallCheck(this,e),this.kDelta=1e-4,this.kRoundingFactor=1e4,this.animations=[],this.keyAnimations={};for(var r=i.initialState.rotation,a=0,n=t.length;a<n;a++){var o,s,l,h,c,u=t[a],d=u.beginTime,f=u.duration,m=u.timingFunction?u.timingFunction:"linear",p=d+f;if(this.overallEndTime=0,p>this.overallEndTime&&(this.overallEndTime=p),"custom"===m&&(o=u.timingControlPoint1x,s=u.timingControlPoint1y,l=u.timingControlPoint2x,h=u.timingControlPoint2y),null!==u.animations&&void 0!==u.animations&&u.animations.length>0){var A=u.animations,v=d;null!==A[0].property&&void 0!==A[0].property||(v=A[0].beginTime,A=A[0].animations);for(var g=0,y=A.length;g<y;g++){var b=A[g],S=b.property;null==(L=this.keyAnimations[S])&&(L={groupBeginTime:v,earliestBeginTime:v+b.beginTime,latestEndTime:-1,repeatCount:b.repeatCount,keyActions:[]},this.keyAnimations[S]=L),v+b.beginTime+b.duration>L.latestEndTime&&(L.latestEndTime=v+b.beginTime+b.duration);var x=b.additive&&("transform.rotation"===b.property||"transform.rotation.z"===b.property);if(b.path)for(var C=u.path.length,w=0;a<C-1;w++){var P=u.path[w],T=u.path[w+1],k=P.points[0],D=T.points[0],E={pointX:k[0],pointY:k[1]},B={pointX:D[0],pointY:D[1]};switch(P.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":c={property:"position",from:E,to:B,fillMode:"forwards",beginTime:v+b.beginTime+w/(C-1)*b.duration,duration:1/(C-1)*b.duration,timingFunction:"linear",groupTimingFunction:m,groupBeginTime:d,groupDuration:f,groupTimingControlPoint1x:o,groupTimingControlPoint1y:s,groupTimingControlPoint2x:l,groupTimingControlPoint2y:h}}this.addAction(c,b)}else if(b.keyTimes){var M=b.keyTimes.length;for(w=0;w<M-1;w++){var I=b.keyTimes[w],F=b.keyTimes[w+1];c={property:b.property,from:x?{scalar:b.values[w].scalar+r}:b.values[w],to:x?{scalar:b.values[w+1].scalar+r}:b.values[w+1],fillMode:b.fillMode,beginTime:v+b.beginTime+I/1*b.duration,duration:(F-I)*b.duration,timingFunction:b.timingFunctions?b.timingFunctions[w]:"linear",groupTimingFunction:m,groupBeginTime:d,groupDuration:f,groupTimingControlPoint1x:o,groupTimingControlPoint1y:s,groupTimingControlPoint2x:l,groupTimingControlPoint2y:h},this.addAction(c,b)}}else c={property:b.property,from:x?{scalar:b.from.scalar+r}:b.from,to:x?{scalar:b.to.scalar+r}:b.to,fillMode:b.fillMode,beginTime:v+b.beginTime,duration:b.duration,timingFunction:b.timingFunction?b.timingFunction:"linear",groupTimingFunction:m,groupBeginTime:d,groupDuration:f,groupTimingControlPoint1x:o,groupTimingControlPoint1y:s,groupTimingControlPoint2x:l,groupTimingControlPoint2y:h},this.addAction(c,b)}}else{var L;S=u.property;null==(L=this.keyAnimations[S])&&(L={groupBeginTime:0,earliestBeginTime:u.beginTime,latestEndTime:-1,repeatCount:u.repeatCount,keyActions:[]},this.keyAnimations[S]=L),u.beginTime+u.duration>L.latestEndTime&&(L.latestEndTime=u.beginTime+u.duration);x=u.additive&&("transform.rotation"===u.property||"transform.rotation.z"===u.property);if(u.path)for(C=u.path.length,w=0;w<C-1;w++){P=u.path[w],T=u.path[w+1],k=P.points[0],D=T.points[0],E={pointX:k[0],pointY:k[1]},B={pointX:D[0],pointY:D[1]};switch(P.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":c={property:"position",from:E,to:B,fillMode:"forwards",beginTime:d+w/(C-1)*f,duration:1/(C-1)*f,timingFunction:"linear"}}this.addAction(c,u)}else if(u.keyTimes)for(M=u.keyTimes.length,w=0;w<M-1;w++){I=u.keyTimes[w],F=u.keyTimes[w+1];c={property:u.property,from:x?{scalar:u.values[w].scalar+r}:u.values[w],to:x?{scalar:u.values[w+1].scalar+r}:u.values[w+1],fillMode:u.fillMode,beginTime:d+I*f,duration:(F-I)*f,timingFunction:u.timingFunctions?u.timingFunctions[w]:"linear"},this.addAction(c,u)}else c={property:u.property,from:x?{scalar:u.from.scalar+r}:u.from,to:x?{scalar:u.to.scalar+r}:u.to,fillMode:u.fillMode,beginTime:d,duration:f,timingFunction:m||"linear"},this.addAction(c,u)}}this.createKeyActions(),this.createAnimationRules(i),this.createAnimationRuleForKeyframes(i)}return _createClass(e,[{key:"addAction",value:function(e,t){"custom"===t.timingFunction?(e.timingControlPoint1x=t.timingControlPoint1x,e.timingControlPoint1y=t.timingControlPoint1y,e.timingControlPoint2x=t.timingControlPoint2x,e.timingControlPoint2y=t.timingControlPoint2y):null!==e.timingFunction.timingFunction&&void 0!==e.timingFunction.timingFunction&&("custom"===e.timingFunction.timingFunction&&(e.timingControlPoint1x=e.timingFunction.timingControlPoint1x,e.timingControlPoint1y=e.timingFunction.timingControlPoint1y,e.timingControlPoint2x=e.timingFunction.timingControlPoint2x,e.timingControlPoint2y=e.timingFunction.timingControlPoint2y),e.timingFunction=e.timingFunction.timingFunction),this.animations.push(e)}},{key:"createKeyActions",value:function(){for(var e=0,t=this.animations.length;e<t;e++){var i=this.animations[e],r=i.beginTime,a=r+i.duration,n=i.property,o=this.keyAnimations[n],s=o.keyActions,l=0,h=100;o.latestEndTime-o.earliestBeginTime>0&&(l=100*r/this.overallEndTime,h=100*a/this.overallEndTime),h>99.9999&&(h=100);var c={startKeyframe:l,endKeyframe:h,from:i.from,to:i.to,timingFunction:i.timingFunction};i.fillMode&&(c.fillMode=i.fillMode),"custom"===i.timingFunction&&(c.timingControlPoint1x=i.timingControlPoint1x,c.timingControlPoint1y=i.timingControlPoint1y,c.timingControlPoint2x=i.timingControlPoint2x,c.timingControlPoint2y=i.timingControlPoint2y),s.push(c),s.sort(this.sortAction)}}},{key:"sortAction",value:function(e,t){return e.startKeyframe-t.startKeyframe}},{key:"roundNum",value:function(e){return Math.round(e*this.kRoundingFactor)/this.kRoundingFactor}},{key:"createAnimationRules",value:function(e){var t=this.kDelta;for(var i in this.keyAnimations)if("playing"!==i){var r=this.keyAnimations[i],a=r.keyActions,n=!1;r.keyframes=[];var o=a[0],s=this.roundNum(o.startKeyframe),l=this.roundNum(100*r.groupBeginTime/this.overallEndTime);if("anchorPoint"!==i)if("anchorPointZ"!==i){if(null!=o){var h=0,c=null,u=null;0!==s&&("hidden"===i?(u={scalar:e.hidden},this.insertInitialKeyframes(r,s-t,i,u)):"opacity"===i?(u="both"===o.fillMode||"backwards"===o.fillMode?o.from:{scalar:e.opacity},this.insertInitialKeyframes(r,s-t,i,u)):"position"===i?(u=e.isBuildIn||e.isBuildOut?l>0&&"both"!==o.fillMode&&"backwards"!==o.fillMode?{pointX:0,pointY:0}:{pointX:this.roundNum(o.from.pointX-e.initialState.position.pointX),pointY:this.roundNum(o.from.pointY-e.initialState.position.pointY)}:{pointX:0,pointY:0},this.insertInitialKeyframes(r,s-t,i,u)):(u=this.createInitialKeyframeValue(e,i,o.from,n),l>0&&this.insertInitialKeyframes(r,l-t,i,u),s-l>t&&("both"!==o.fillMode&&"backwards"!==o.fillMode||(u=o.from),"transform.translation"===i&&(u.pointX=this.roundNum(u.pointX),u.pointY=this.roundNum(u.pointY)),r.keyframes.push({keyframe:l,keyName:i,value:u,timingFunction:"linear"}),r.keyframes.push({keyframe:s-t,keyName:i,value:u,timingFunction:"linear"}))),h=o.startKeyframe,c=u);for(var d=0,f=a.length;d<f;d++){o=a[d],"position"===i&&(u=e.initialState.position,o.from={pointX:this.roundNum(o.from.pointX-u.pointX),pointY:this.roundNum(o.from.pointY-u.pointY)},o.to={pointX:this.roundNum(o.to.pointX-u.pointX),pointY:this.roundNum(o.to.pointY-u.pointY)}),Math.abs(o.startKeyframe-h)>t&&r.keyframes.push({keyframe:this.roundNum(o.startKeyframe)-t,keyName:i,value:c,timingFunction:"linear"}),"transform.translation"===i&&(o.from.pointX=this.roundNum(o.from.pointX),o.from.pointY=this.roundNum(o.from.pointY),o.to.pointX=this.roundNum(o.to.pointX),o.to.pointY=this.roundNum(o.to.pointY));var m=this.createTimingFunctionForAction(o);r.keyframes.push({keyframe:this.roundNum(o.startKeyframe),keyName:i,value:o.from,timingFunction:m}),r.keyframes.push({keyframe:this.roundNum(o.endKeyframe)-(100===o.endKeyframe?0:t),keyName:i,value:o.to,timingFunction:m}),c=o.to,h=o.endKeyframe}100!==h&&"hidden"!==i&&(r.keyframes.push({keyframe:this.roundNum(h),keyName:i,value:c,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:i,value:c,timingFunction:"linear"}))}}else{if(n=!0,0!==s){S=this.createInitialKeyframeValue(e,i,o.from,!0);r.keyframes.push({keyframe:0,keyName:"zPosition",value:S,timingFunction:"linear"}),r.keyframes.push({keyframe:s-t,keyName:"zPosition",value:S,timingFunction:"linear"})}r.keyframes.push({keyframe:s,keyName:"zPosition",value:o.from,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:"zPosition",value:o.to,timingFunction:"linear"}),e.transformOriginZValue=o.to.scalar}else{var p={};p.x=o.to.pointX,p.y=o.to.pointY;var A={pointX:-(o.from.pointX-e.anchorPoint.pointX)*e.bounds.width,pointY:-(o.from.pointY-e.anchorPoint.pointY)*e.bounds.height};if(e.isMagicMove){var v=this.anchorPointOffset(e,{x:o.from.pointX,y:o.from.pointY}),g={pointX:v.x,pointY:v.y},y=this.anchorPointOffset(e,{x:o.to.pointX,y:o.to.pointY}),b={pointX:y.x,pointY:y.y};g.pointX===b.pointX&&g.pointY===b.pointY||(A={pointX:b.pointX-g.pointX,pointY:b.pointY-g.pointY},e.magicMoveOffsetValue=A)}if(0!==s){var S={pointX:0,pointY:0};l>0&&this.insertInitialKeyframes(r,l-t,"position",S),s-l>t&&("both"!==o.fillMode&&"backwards"!==o.fillMode||(S=A),r.keyframes.push({keyframe:l,keyName:"position",value:S,timingFunction:"linear"}),r.keyframes.push({keyframe:s-t,keyName:"position",value:S,timingFunction:"linear"}))}r.keyframes.push({keyframe:s,keyName:"position",value:A,timingFunction:"linear"}),r.keyframes.push({keyframe:100,keyName:"position",value:A,timingFunction:"linear"}),e.transformOriginValue=100*p.x+"% "+100*p.y+"%"}}}},{key:"insertInitialKeyframes",value:function(e,t,i,r){e.keyframes.push({keyframe:0,keyName:i,value:r,timingFunction:"linear"}),e.keyframes.push({keyframe:t,keyName:i,value:r,timingFunction:"linear"})}},{key:"anchorPointOffset",value:function(e,t){var i={},r={},a={},n=e.bounds;return i.x=n.width/2,i.y=n.height/2,r.x=t.x*n.width,r.y=t.y*n.height,a.x=i.x-r.x,a.y=i.y-r.y,a}},{key:"createInitialKeyframeValue",value:function(e,t,i,r){var a={};switch(t){case"anchorPoint":a.pointX=(e.anchorPoint.pointX-.5)*e.bounds.width,a.pointY=(e.anchorPoint.pointY-.5)*e.bounds.height;break;case"anchorPointZ":a.scalar=isFirefox||isChrome||isEdge?0:i.scalar+i.scalar;break;case"opacity":case"opacityMultiplier":a.scalar=e.opacity;break;case"hidden":a.scalar=e.hidden;break;case"position":a.pointX=e.affineTransform[4],a.pointY=e.affineTransform[5];break;case"zPosition":a.scalar=0;break;case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":a.scalar=e.initialState.scale;break;case"transform.rotation.z":a.scalar=e.initialState.rotation;break;case"transform":a.transform=i.transform;break;case"bounds":a.pointX=0,a.pointY=0,a.width=e.initialState.width,a.height=e.initialState.height;break;default:a.scalar=0,a.pointX=0,a.pointY=0}return a}},{key:"createTimingFunctionForAction",value:function(e){var t="",i=e.timingFunction,r=e;switch("object"===_typeof(i)&&(i=i.timingFunction,r=e.timingFunction),i.toLowerCase()){case"easein":t="ease-in";break;case"easeout":t="ease-out";break;case"easeinout":case"easeineaseout":t="ease-in-out";break;case"custom":t="cubic-bezier("+r.timingControlPoint1x+","+r.timingControlPoint1y+","+r.timingControlPoint2x+","+r.timingControlPoint2y+")";break;default:t="linear"}return t}},{key:"createAnimationRuleForKeyframes",value:function(e){for(var t in this.keyAnimations){var i,r,a=this.keyAnimations[t],n="layer"+e.layerId+"-"+escapeTextureId(t),o="";if("contents"!==t){i=gShowController.animationManager.createAnimation(n);for(var s=0,l=a.keyframes.length;s<l;s++)r=a.keyframes[s],o=this.createAnimationRuleForKeyframe(t,r,e)+" ",i.appendRule(o);e.cssAnimationRules.push(n)}else{var h=this.roundNum(a.keyActions[0].startKeyframe);i=gShowController.animationManager.createAnimation(n+"-from");var c="0% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",u="49.999% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",d="50% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",f="100% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";0!==h&&(u=(100-h)/2+h-this.kDelta-this.kDelta+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",d=(100-h)/2+h+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}"),i.appendRule(c),i.appendRule(u),i.appendRule(d),i.appendRule(f),i=gShowController.animationManager.createAnimation(n+"-to"),c="0% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",u="49.999% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",d="50% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",f="100% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}",0!==h&&(u=(100-h)/2+h-this.kDelta-this.kDelta+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}",d=(100-h)/2+h+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}"),i.appendRule(c),i.appendRule(u),i.appendRule(d),i.appendRule(f),e.cssAnimationRules.push(n)}}}},{key:"createAnimationRuleForKeyframe",value:function(e,t,i){var r,a=t.keyframe,n=t.keyName,o=t.value,s=t.timingFunction,l=i.transformOriginValue,h=(i.transformOriginZValue,"");if(l&&(h=kTransformOriginPropertyName+": "+l+";"),"hidden"===n){var c={scalar:-1};!1===o.scalar||0===o.scalar?c.scalar=1:c.scalar=0,n="opacity",r=this.cssPropertyValueForActionValue(e,n,c)}else r=this.cssPropertyValueForActionValue(e,n,o);return a+"% {"+h+(this.cssPropertyNameForAction(n)+": "+r+"; "+(a<100?kAnimationTimingFunctionPropertyName+": "+s+";":""))+"}"}},{key:"cssPropertyValueForActionValue",value:function(e,t,i){switch(t){case"hidden":return!0===i.scalar?"hidden":"visible";case"anchorPoint":return i.pointX+"% "+i.pointY+"%";case"anchorPointZ":return i.scalar;case"position":return"translate("+i.pointX+"px,"+i.pointY+"px)";case"zPosition":return"anchorPointZ"===e&&(isFirefox||isChrome)?"translateZ("+-i.scalar+"px)":"translateZ("+i.scalar+"px)";case"translationEmphasis":return"translateX("+i.translationEmphasis[0]+"px) translateY("+i.translationEmphasis[1]+"px) translateZ("+i.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+i.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(i.scaleEmphasis[3])+","+ensureScaleFactorNotZero(i.scaleEmphasis[4])+","+ensureScaleFactorNotZero(i.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(i.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(i.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(i.scalar)+")";case"transform.rotation.x":return"rotateX("+i.scalar+"rad)";case"transform.rotation.y":return"rotateY("+i.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+i.scalar+"rad)";case"transform.translation":return"translateX("+i.pointX+"px) translateY("+i.pointY+"px)";case"transform.translation.x":return"translateX("+i.scalar+"px)";case"transform.translation.y":return"translateY("+i.scalar+"px)";case"transform.translation.z":return"translateZ("+i.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return i.scalar+"";case"transform":return"matrix3d("+i.transform+")";case"doubleSided":return!1===i.scalar?"hidden":"visible";case"contents":return i.texture;default:return"some value"}}},{key:"cssPropertyNameForAction",value:function(e){switch(e){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return e}}}]),e}(),KPFLayer=function(){function e(t,i,r){_classCallCheck(this,e),this.animationInfo=i,this.layerId=kpfLayerCounter,kpfLayerCounter+=1,this.objectID=null!==t.objectID?t.objectID:null,this.textureId=t.texture?t.texture:null,this.animations=t.animations,this.initialState=t.initialState,this.isVideoLayer=t.isVideoLayer,this.isWebVideoPosterLayer=t.isWebVideoPosterLayer,this.hasHighlightedBulletAnimation=t.hasHighlightedBulletAnimation,this.texturedRectangle=t.texturedRectangle,this.cssAnimationRules=[],this.layers=[],this.affineTransform=this.initialState.affineTransform,this.position=this.initialState.position,this.textureTransform="",null!=this.initialState.transform&&null!=this.initialState.transform?this.textureTransform="matrix3D("+this.initialState.transform+")":this.textureTransform="matrix("+this.affineTransform+")",this.anchorPoint=this.initialState.anchorPoint,null==r&&(r={pointX:0,pointY:0});var a=this.position.pointX-this.initialState.width/2-(this.anchorPoint.pointX-.5)*this.initialState.width,n=this.position.pointY-this.initialState.height/2-(this.anchorPoint.pointY-.5)*this.initialState.height;a=Math.round(1e6*a)/1e6,n=Math.round(1e6*n)/1e6,this.bounds={width:this.initialState.width,height:this.initialState.height,origin:{pointX:this.affineTransform[4],pointY:this.affineTransform[5]},offset:{pointX:a,pointY:n},canvasOffset:{pointX:a+r.pointX,pointY:n+r.pointY}},this.sublayerTransform=this.initialState.sublayerTransform,this.contentsRect=this.initialState.contentsRect,this.hidden=this.initialState.hidden,this.opacity=this.initialState.opacity,this.visibility=!0===this.hidden?"hidden":"visible",this.addSublayer(t.layers,i,this.bounds.offset),this.initLayerAnimations()}return _createClass(e,[{key:"destroy",value:function(){this.initialState=null,this.cssAnimationRules=null,this.affineTransform=null,this.textureTransform=null,this.anchorPoint=null,this.anchorPointZ=null,this.bounds=null,this.contentsRect=null,this.hidden=null,this.opacity=null}},{key:"addSublayer",value:function(t,i,r){for(var a=0,n=t.length;a<n;a++){var o=new e(t[a],i,r);this.layers.push(o)}}},{key:"initLayerAnimations",value:function(){var e=!1,t=!1,i=!1,r=!1,a=!1,n=!1,o=!1,s=!1,l=!1,h=!1,c=!1,u=!1,d=!1,f=!1,m=!1,p=!1,A=!1,v=[],g=!1,y=this.animationInfo,b=y.type,S=y.name,x=["isPlaying","opacityMultiplier","hidden"];if("actionBuild"===b?this.isActionBuild=!0:"buildIn"===b?this.isBuildIn=!0:"buildOut"===b?this.isBuildOut=!0:"transition"===b&&(this.isTransition=!0),"apple:magic-move-implied-motion-path"===S?this.isMagicMove=!0:"apple:ca-isometric"===S?g=!0:"renderMovie"===S?this.isRenderMovie=!0:"renderWebVideo"===S?this.isRenderWebVideo=!0:kEmphasisEffects.indexOf(S)>-1&&(this.isEmphasisBuild=!0),this.animations.length>0&&(this.cssAnimation=new KPFCssAnimation(this.animations,this)),this.divNames=[],this.objectID&&(this.isRenderMovie||this.isRenderWebVideo))this.divNames=["opacity","position","transform.rotation.z","transform.scale.x","transform.scale.y","bounds","contents"];else if(this.cssAnimation){for(var C in this.cssAnimation.keyAnimations)x.indexOf(C)>0||("opacity"===C?t=!0:"anchorPoint"===C?i=!0:"anchorPointZ"===C?r=!0:g||"transform.translation.x"!==C?g||"transform.translation.y"!==C?g||"transform.translation.z"!==C?g||"transform.translation"!==C?g||"transform.rotation.x"!==C?g||"transform.rotation.y"!==C?g||"transform.rotation.z"!==C?g||"transform.rotation"!==C?"transform.scale.x"===C?d=!0:"transform.scale.y"===C?f=!0:"transform.scale.xy"===C?m=!0:"transform.scale"===C?p=!0:"transform"===C?A=!0:"doubleSided"===C?e=!0:"contents"===C?this.hasContentsAnimation=!0:"bounds"===C?this.hasBoundsAnimation=!0:"position"===C?this.hasPosition=!0:v.push(C):u=!0:c=!0:h=!0:l=!0:s=!0:o=!0:n=!0:a=!0);if(t&&this.isActionBuild&&!this.isEmphasisBuild){this.divNames.push("opacity");for(var w=0,P=this.layers.length;w<P;w++)0===this.layers[w].animations.length&&(this.layers[w].divNames=["opacity","position","transform.rotation.z","transform.scale.x","transform.scale.y","bounds","contents"])}else{(t||this.isActionBuild)&&-1===this.divNames.indexOf("opacity")&&this.divNames.push("opacity"),A&&this.divNames.push("transform"),(this.hasPosition||this.isActionBuild)&&this.divNames.push("position"),i&&this.divNames.push("anchorPoint"),r&&this.divNames.push("anchorPointZ");for(w=0,P=v.length;w<P;w++)this.divNames.push(v[w]);a&&this.divNames.push("transform.translation.x"),n&&this.divNames.push("transform.translation.y"),s&&this.divNames.push("transform.translation"),o&&this.divNames.push("transform.translation.z"),l&&this.divNames.push("transform.rotation.x"),h&&this.divNames.push("transform.rotation.y"),c&&this.divNames.push("transform.rotation.z"),0===this.initialState.rotation&&!this.isActionBuild||-1!==this.divNames.indexOf("transform.rotation.z")||this.divNames.push("transform.rotation.z"),u&&this.divNames.push("transform.rotation"),d&&this.divNames.push("transform.scale.x"),f&&this.divNames.push("transform.scale.y"),(1!==this.initialState.scale||this.isActionBuild)&&(-1===this.divNames.indexOf("transform.scale.x")&&this.divNames.push("transform.scale.x"),-1===this.divNames.indexOf("transform.scale.y")&&this.divNames.push("transform.scale.y")),m&&this.divNames.push("transform.scale.xy"),p&&this.divNames.push("transform.scale"),this.textureId&&(this.hasBoundsAnimation||this.isActionBuild)&&this.divNames.push("bounds"),this.textureId&&(this.hasContentsAnimation||this.isActionBuild)&&this.divNames.push("contents"),e&&this.divNames.push("doubleSided")}}}}]),e}(),KPFAudio=function(){function e(t){_classCallCheck(this,e),this.objectID=t.objectID,this.audioId=t.audioId,this.isSoundTrack=t.isSoundTrack,this.isPlaying=!1,(this.audioElement=new Audio).setAttribute("id",this.audioId)}return _createClass(e,[{key:"setSrc",value:function(e){this.audioElement.setAttribute("src",e)}},{key:"setLoop",value:function(e){this.audioElement.loop=e}},{key:"setVolume",value:function(e){this.audioElement.volume=e}},{key:"startAudio",value:function(){var e=this,t=this.audioElement;if(t){var i=t.play();void 0!==i?i.then((function(){e.isPlaying=!0})).catch((function(){e.isPlaying=!1})):this.isPlaying=!0}}},{key:"stopAudio",value:function(){this.audioElement&&(this.audioElement.pause(),this.isPlaying=!1)}}]),e}(),KPFMovie=function(){function e(t){_classCallCheck(this,e),this.objectID=t.objectID,this.movieId=t.movieId,this.width=t.width,this.height=t.height,this.sceneIndex=t.sceneIndex,this.textureId=t.textureId,this.src=t.src,this.showControls=t.showControls,this.movieDiv=t.movieDiv,this.parentLayer=t.parentLayer,this.webVideo=t.webVideo,this.webVideo?this.initWebVideo():this.initVideo(),this.setInsertBeforeOrAfterTextureId(),this.isFirstRendered=!0,this.isEnded=!1,this.isPlaying=!1}return _createClass(e,[{key:"destroy",value:function(){this.videoElement&&(this.videoElement.pause(),this.videoElement.src="")}},{key:"setStyle",value:function(e){var t=e.node,i=e.top,r=e.left,a=e.width,n=e.height,o=e.position,s=e.opacity,l=e.visibility,h=t.style;h.top=i,h.left=r,h.width=a,h.height=n,h.position=o,null!=s&&(h.opacity=s),null!=l&&(h.visibility=l)}},{key:"initVideo",value:function(){var e=this.videoElement=document.createElement("video");this.setStyle({node:e,top:"0px",left:"0px",width:this.width+"px",height:this.height+"px",position:kPositionAbsolutePropertyValue,visibility:"hidden"}),setElementProperty(e,"pointer-events","all"),e.setAttribute("id",this.movieId),e.setAttribute("src",this.src),this.showControls&&(e.addEventListener("mouseover",this.handleMouseOver.bind(e)),e.addEventListener("mouseleave",this.handleMouseLeave.bind(e)))}},{key:"initWebVideo",value:function(){var e=this.iframe=document.createElement("iframe");this.setStyle({node:e,top:"0px",left:"0px",width:this.width+"px",height:this.height+"px",position:kPositionAbsolutePropertyValue,visibility:"hidden"}),setElementProperty(e,"pointer-events","all"),e.setAttribute("id",this.objectID+"-webVideo"),e.setAttribute("frameborder",0);var t,i,r,a=this.webVideo.url;if(a.indexOf("youtu")>-1?i="youtube":a.indexOf("vimeo")>-1&&(i="vimeo"),"youtube"===i)r="https://www.youtube.com/embed/"+(t=urlParamsGet("v",a));else if("vimeo"===i){var n=a.match(/https:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/);n&&(t=n[2]),r="https://player.vimeo.com/video/"+t}e.style.border="none",e.setAttribute("src",r+"?autoplay=1")}},{key:"handleMouseOver",value:function(){this.setAttribute("controls","controls")}},{key:"handleMouseLeave",value:function(){this.removeAttribute("controls")}},{key:"setInsertBeforeOrAfterTextureId",value:function(){for(var e=this.parentLayer.layers,t=0,i=e.length;t<i;t++){var r=e[t];(r.isVideoLayer||r.isWebVideoPosterLayer)&&(t+1<i&&(this.insertBeforeTextureId=e[t+1].textureId),t-1>=0&&(this.insertAfterTextureId=e[t-1].textureId))}}},{key:"observeEvents",value:function(e){var t=this.videoElement;t&&(t.removeEventListener("canplay",this.handleMovieDidStart),t.removeEventListener("ended",this.handleMovieDidEnd),t.addEventListener("canplay",this.handleMovieDidStart.bind(this,e)),t.addEventListener("ended",this.handleMovieDidEnd.bind(this,e)));var i=this.iframe;i&&(i.textureElement=e,i.addEventListener("load",(function(){i.style.visibility="visible",i.textureElement.style.visibility="hidden"})))}},{key:"setLoop",value:function(e){this.videoElement&&(this.videoElement.loop=e)}},{key:"setVolume",value:function(e){this.videoElement&&(this.videoElement.volume=e)}},{key:"removeControls",value:function(){this.videoElement&&this.videoElement.hasAttribute("controls")&&this.videoElement.removeAttribute("controls")}},{key:"handleMovieDidStart",value:function(e){this.videoElement&&(this.videoElement.style.visibility="visible",e&&setTimeout(this.hideMoviePoster.bind(this,e),120))}},{key:"handleMovieDidEnd",value:function(e){this.videoElement&&(this.videoElement.loop||(this.isEnded=!0))}},{key:"startMovie",value:function(){var e=this,t=this.videoElement;if(t){var i=t.play();void 0!==i?i.then((function(){e.isPlaying=!0})).catch((function(){e.isPlaying=!1})):this.isPlaying=!0}}},{key:"stopMovie",value:function(){this.videoElement&&this.videoElement.pause()}},{key:"hideMoviePoster",value:function(e){var t=e.style;t.visibility="hidden",t.display="none",e.parentNode&&e.parentNode.removeChild(e)}}]),e}(),KPFPlaybackController=function(){function e(t,i){_classCallCheck(this,e),this.domNode=i,this.kpfEvent=null}return _createClass(e,[{key:"destroy",value:function(){this.removeEvent(),this.domNode=null}},{key:"removeEvent",value:function(){if(this.kpfEvent)for(this.kpfEvent.destroy(),delete this.kpfEvent,this.kpfEvent=null;this.domNode.childNodes.length>0;)this.domNode.removeChild(this.domNode.childNodes[0])}},{key:"renderEvent",value:function(e){this.removeEvent(),this.kpfEvent=e,this.kpfEvent.renderEvent(this.domNode)}},{key:"renderEffects",value:function(){return this.kpfEvent.renderEffects(this.kpfEvent.event.effects)}},{key:"animateEffects",value:function(e){this.kpfEvent.animateEffects(e)}},{key:"eventOverallEndTime",value:function(){return this.kpfEvent.eventOverallEndTime}}]),e}(),KPFCssRenderer=function(){function e(t,i,r){_classCallCheck(this,e),this.textureId=t.textureId,this.nativeWidth=t.bounds.width,this.nativeHeight=t.bounds.height,this.opacity=t.opacity,this.visibility=!0===t.hidden?"hidden":"visible",this.textureTransform=t.textureTransform,this.affineTransform=t.affineTransform,this.anchorPoint=t.anchorPoint,this.contentsRect=t.contentsRect,this.layer=t,this.sceneIndex=i,this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1,r.length>0&&this.initRendererFlags(r[0]),this.glContentsRenderer={},this.domNode=document.createElement("div"),this.domNode.setAttribute("id","layer"+t.layerId)}return _createClass(e,[{key:"initRendererFlags",value:function(e){"transition"===e.type&&"apple:ca-swing"!==e.name&&"com.apple.iWork.Keynote.BLTSwoosh"!==e.name?(this.enableCompositingUsingBackface=!0,this.enablePreserve3DFromParent=!0,!isChrome||"apple:ca-push"!==e.name&&"com.apple.iWork.Keynote.BLTFadeThruColor"!==e.name||(this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1)):(this.enableCompositingUsingBackface=!1,this.enablePreserve3DFromParent=!1),"apple:apple-grid"===e.name?this.isGridTransition=!0:"com.apple.iWork.Keynote.BLTMosaicFlip"===e.name?this.isMosaicTransition=!0:"com.apple.iWork.Keynote.BLTSwoosh"===e.name&&"transition"===e.type&&(this.isSwooshTransition=!0)}},{key:"destroy",value:function(){this.textureId=null,this.nativeWidth=null,this.nativeHeight=null,this.opacity=null,this.visibility=null,this.textureTransform=null,this.affineTransform=null,this.anchorPoint=null,this.textureAnimation=null,this.contentsRect=null,this.requiresPerspectiveTransform=null,this.sceneIndex=null;for(var e=this.domNode.getElementsByTagName("canvas"),t=e.length;t--;){var i=e[t];if(i){var r=i.getContext("2d");r&&(r.clearRect(0,0,i.width,i.height),e[t].remove())}}if(this.domNode.hasChildNodes())for(;this.domNode.childNodes.length>0;)this.domNode.removeChild(this.domNode.firstChild);this.domNode=null}},{key:"addAnimationNode",value:function(e,t,i,r){if(null==t)return e;var a=t.shift();if(null==a)return e;var n=document.createElement("div"),o=i+"-"+escapeTextureId(a);n.setAttribute("id",o),r.initialState.masksToBounds&&setElementProperty(n,"overflow","hidden"),this.enableCompositingUsingBackface?setElementProperty(n,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(n,kTransformPropertyName,"translateZ(0px)"),this.setStyle(n,"0px","0px",e.style.width,e.style.height,kPositionAbsolutePropertyValue,null,null),setElementProperty(n,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue),.5===r.anchorPoint.pointX&&.5===r.anchorPoint.pointY||setElementProperty(n,kTransformOriginPropertyName,100*r.anchorPoint.pointX+"% "+100*r.anchorPoint.pointY+"%");var s=["opacity","doubleSided","anchorPointZ"];return r.transformOriginValue&&r.transformOriginZValue&&("apple:ca-revolve"===r.animationInfo.name?s.push("anchorPoint","position","zPosition"):"apple:3D-cube"===r.animationInfo.name&&s.push("anchorPoint","position","zPosition","transform.rotation.x","transform.rotation.y")),r.transformOriginZValue&&-1===s.indexOf(a)&&(isFirefox?setElementProperty(n,kTransformOriginPropertyName,100*r.anchorPoint.pointX+"% "+100*r.anchorPoint.pointY+"% "+r.transformOriginZValue+"px"):(setElementProperty(n,kTransformOriginZPropertyName,r.transformOriginZValue+"px"),navigator.userAgent.lastIndexOf("Chrome/")<=0&&setElementProperty(n,kTransformPropertyName,"translateZ("+r.transformOriginZValue+"px)"))),e.appendChild(n),this.addAnimationNode(n,t,i,r)}},{key:"createNodes",value:function(e,t,i){var r=gShowController.movieCache;return r&&"renderMovie"!==i.animationInfo.name&&this.setVideoLayer(i,r),this.addNode(e,t,i)}},{key:"setVideoLayer",value:function(e,t){var i=e.objectID,r=t[i+"-video"];if(r)if(1===e.layers.length)e.layers[0].textureId?(e.layers[0].isVideoLayer=!0,e.layers[0].movieObjectID=i):e.layers[0].layers[0].textureId&&(e.layers[0].layers[0].isVideoLayer=!0,e.layers[0].layers[0].movieObjectID=i);else{var a,n=!1;for(u=0,d=e.layers.length;u<d;u++){var o,s=(o=e.layers[u].textureId?e.layers[u]:e.layers[u].layers[0]).textureId;s===r.insertAfterTextureId&&(a=o);for(var l=!1,h=0,c=r.parentLayer.layers.length;h<c;h++){if(r.parentLayer.layers[h].textureId===s){l=!0;break}}l||(n=!0,o.isVideoLayer=!0,o.movieObjectID=i)}!n&&a&&(a.isVideoLayer=!0,a.movieObjectID=i)}else for(var u=0,d=e.layers.length;u<d;u++)this.setVideoLayer(e.layers[u],t)}},{key:"addNode",value:function(e,t,i){if(!i.canvasId){var r="layer"+i.layerId,a=document.createElement("div");a.setAttribute("id",r),setElementProperty(a,"pointer-events","none");var n=i.contentsRect.x,o=i.contentsRect.y,s=i.contentsRect.width,l=i.contentsRect.height,h=i.affineTransform[0],c=i.affineTransform[1],u=i.affineTransform[2],d=i.affineTransform[3],f=i.affineTransform[4],m=i.affineTransform[5],p=i.animationInfo,A=!1;-1===h&&"com.apple.iWork.Keynote.KLNComet"===p.name&&(h=1,A=!0);var v="matrix("+h+","+c+","+u+","+d+","+(f+i.bounds.offset.pointX)+","+(m+i.bounds.offset.pointY)+")",g=i.bounds,y=g.width,b=g.height;this.setStyle(a,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,i.opacity,i.visibility),setElementProperty(a,kTransformPropertyName,v),.5===i.anchorPoint.pointX&&.5===i.anchorPoint.pointY||setElementProperty(a,kTransformOriginPropertyName,100*i.anchorPoint.pointX+"% "+100*i.anchorPoint.pointY+"%"),i.initialState.masksToBounds&&setElementProperty(a,"overflow","hidden"),e.appendChild(a);var S=this.addAnimationNode(a,i.divNames,r,i);i.isTransition&&this.enablePreserve3DFromParent?(0!==t.sublayerTransform[11]&&setElementProperty(a,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue),0!==i.sublayerTransform[11]&&(setElementProperty(a,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(a,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue))):0!==t.sublayerTransform[11]?(setElementProperty(e,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(a,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)):setElementProperty(a,kTransformStylePropertyName,kTransformStyleFlatPropertyValue),isChrome&&(this.enableCompositingUsingBackface?setElementProperty(a,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(a,kTransformPropertyName,"translateZ(0px)"));var x=i.textureId;if(x){var C=gShowController.textureManager,w=C.getTextureObject(this.sceneIndex,x);if(!w)return a;var P=document.createElement("canvas"),T=P.getContext("2d"),k=w.width,D=w.height;if(0===n&&0===o&&1===s&&1===l)P.width=k,P.height=D,k>0&&D>0&&T.drawImage(w,0,0),this.setStyle(P,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null);else{var E=o*D,B=(n+s)*k,M=(o+l)*D,I=n*k,F=P.width=B-I,L=P.height=M-E;T.drawImage(w,I*pdfScaleFactor,E*pdfScaleFactor,F*pdfScaleFactor,L*pdfScaleFactor,0,0,F,L),this.setStyle(P,"0px","0px",F+"px",L+"px",kPositionAbsolutePropertyValue,null,null)}var N=P;N.setAttribute("id",x),"webkit"!==browserPrefix||null!==i.isTransition&&void 0!==i.isTransition||setElementProperty(N,kTransformPropertyName,A?"rotateY(180deg) translateZ(0px)":"translateZ(0px)"),i.isTransition&&(isChrome?this.enableCompositingUsingBackface?this.isGridTransition||this.isMosaicTransition||setElementProperty(N,kBackfaceVisibilityPropertyName,"hidden"):this.isSwooshTransition&&setElementProperty(N,kTransformPropertyName,"translateZ(0px)"):this.enableCompositingUsingBackface?setElementProperty(N,kBackfaceVisibilityPropertyName,"hidden"):setElementProperty(N,kTransformPropertyName,"translateZ(0px)"));var G,R,O=p.objectID,W=p&&"buildOut"===p.type;if(i.isVideoLayer||i.isWebVideoPosterLayer)if("renderMovie"===p.name||"renderWebVideo"===p.name){var U;if(p.movie){var K=C.getMovieUrl(this.sceneIndex,p.movie.asset);U=/(?:\.([^.]+))?$/.exec(K)[1]}if("gif"===U)R=new Image,this.setStyle(R,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null),R.addEventListener("load",this.hideElement.bind(this,N)),R.src=K;else{null!==gShowController.movieCache&&void 0!==gShowController.movieCache||(gShowController.movieCache={});var V=O+"-video";if(i.hasMovie=!0,i.movieId=V,null==(G=gShowController.movieCache[V])){var Q={objectID:O,movieId:V,width:y,height:b,sceneIndex:this.sceneIndex,textureId:x,src:K,showControls:!1===gShowController.isRecording,movieDiv:a,parentLayer:t,webVideo:p.webVideo};G=new KPFMovie(Q),gShowController.movieCache[V]=G,G.observeEvents(N)}}}else{var z=gShowController.movieCache;if(z)G=z[V=i.movieObjectID+"-video"]}if(i.hasContentsAnimation){for(var Y,X,H=i.cssAnimation.animations,j=0,_=H.length;j<_;j++)if("contents"===H[j].property){Y=H[j].to.texture,X=H[j].from.texture;break}var q=C.getTextureObject(this.sceneIndex,Y),J=document.createElement("canvas"),Z=J.getContext("2d"),$=(k=J.width=q.width)/y,ee=(D=J.height=q.height)/b;Z.drawImage(q,0,0),J.setAttribute("id",Y),$>1&&ee>1&&0!==$&&0!==ee?(this.setStyle(J,"0px","0px",k+"px",D+"px",kPositionAbsolutePropertyValue,null,null),setElementProperty(J,kTransformOriginPropertyName,"0% 0%"),setElementProperty(J,kTransformPropertyName,"scale("+1/$+","+1/ee+")")):this.setStyle(J,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null);var te=document.createElement("div");te.id=r+"-contents-to",this.setStyle(te,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null),te.appendChild(J),S.appendChild(te),setElementProperty(te,"opacity",0);var ie=C.getTextureObject(this.sceneIndex,X),re=document.createElement("canvas"),ae=re.getContext("2d");re.width=ie.width,re.height=ie.height,ae.drawImage(ie,0,0),re.setAttribute("id",X),this.setStyle(re,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null);var ne=document.createElement("div");ne.id=r+"-contents-from",this.setStyle(ne,"0px","0px",y+"px",b+"px",kPositionAbsolutePropertyValue,null,null),ne.appendChild(re),S.appendChild(ne)}else S.appendChild(N),R&&S.appendChild(R);G&&(G.isFirstRendered?(G.videoElement?S.insertBefore(G.videoElement,N):G.iframe&&S.insertBefore(G.iframe,N),G.isFirstRendered=!1):i.animationInfo&&"renderMovie"!==i.animationInfo.name&&"renderWebVideo"!==i.animationInfo.name&&(G.objectID===O&&W?(G.stopMovie(),G.removeControls(),G.isBuiltOut=!0):G.isBuiltOut||(S.parentNode.appendChild(G.movieDiv),S.style.visibility="hidden")))}else if(i.initialState.backgroundColor){var oe=i.initialState.backgroundColor;setElementProperty(S,"background-color","rgba("+parseInt(255*oe[0])+","+parseInt(255*oe[1])+","+parseInt(255*oe[2])+","+oe[3]+")")}for(var se=0,le=i.layers.length;se<le;se++)this.addNode(S,i,i.layers[se]);return a}}},{key:"hideElement",value:function(e){e.style.visibility="hidden"}},{key:"serializeSvg",value:function(e){for(var t=e.getElementsByTagName("image"),i=0,r=t.length;i<r;i++){var a=t[i],n=document.createElement("a");n.href=a.getAttributeNS("http://www.w3.org/1999/xlink","href");var o=window.location.protocol+"//"+n.host+n.pathname;a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o)}return(new XMLSerializer).serializeToString(e)}},{key:"draw",value:function(e){this.setStyle(this.domNode,"0px","0px",this.nativeWidth+"px",this.nativeHeight+"px",kPositionAbsolutePropertyValue,this.opacity,this.visibility),"webkit"===browserPrefix&&(this.enableCompositingUsingBackface&&isChrome?setElementProperty(this.domNode,kBackfaceVisibilityPropertyName,"hidden"):setElementProperty(this.domNode,kTransformPropertyName,"translateZ(0px)")),0!==this.layer.sublayerTransform[11]?(setElementProperty(this.domNode,kPerspectivePropertyName,gShowController.stageManager.perspective+"px"),setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)):setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStyleFlatPropertyValue);for(var t=0,i=this.layer.layers.length;t<i;t++)this.createNodes(this.domNode,this.layer,this.layer.layers[t]);e.appendChild(this.domNode)}},{key:"setStyle",value:function(e,t,i,r,a,n,o,s){e.style.top=t,e.style.left=i,e.style.width=r,e.style.height=a,e.style.position=n,null!=o&&(e.style.opacity=o),null!=s&&(e.style.visibility=s)}},{key:"overallEndTime",value:function(e){var t={duration:0};return this.overallEndTimeForLayer(this.layer,t),t.duration}},{key:"overallEndTimeForLayer",value:function(e,t){e.cssAnimation&&e.cssAnimation.overallEndTime>t.duration&&(t.duration=e.cssAnimation.overallEndTime);for(var i=0,r=e.layers.length;i<r;i++)this.overallEndTimeForLayer(e.layers[i],t)}},{key:"animate",value:function(e){e.kpfLayer&&(e.movie?this.animateEffect(e,e.kpfLayer,e.currentKPFLayer?e.currentKPFLayer:null,e.movie):e.webVideo?this.animateEffect(e,e.kpfLayer,e.currentKPFLayer?e.currentKPFLayer:null,e.webVideo):this.animateEffect(e,e.kpfLayer,e.currentKPFLayer?e.currentKPFLayer:null))}},{key:"animateEffect",value:function(e,t,i,r){var a=e.objectID+"-video";if(t.cssAnimationRules.length>0){var n=i?"layer"+i.layerId:"layer"+t.layerId,o=document.getElementById(n);o?this.applyCssAnimation(o,t,i,e):e.currentKPFLayer&&(n="layer"+e.currentKPFLayer.layerId,e.currentKPFLayer.layers[0]&&(n="layer"+e.currentKPFLayer.layers[0].layerId),(o=document.getElementById(n))&&this.applyCssAnimation(o,t,e.currentKPFLayer,e))}else{if(t.isRenderMovie&&"renderMovie"===t.animationInfo.name){var s=gShowController.movieCache;if(s){var l=s[a];l&&(r.loopMode&&"looping"===r.loopMode&&l.setLoop(!0),r.volume&&l.setVolume(r.volume),l.startMovie())}}if(i){var h=document.getElementById("layer"+i.layerId),c=parseTransformMatrix(window.getComputedStyle(h,null).getPropertyValue(kTransformPropertyName)),u="matrix("+c[0]+","+c[1]+","+c[2]+","+c[3]+","+t.bounds.offset.pointX+","+t.bounds.offset.pointY+")";"apple:action-motion-path"===e.name&&setElementProperty(h,kTransformPropertyName,u)}}for(var d=0,f=t.layers.length;d<f;d++)gShowController.movieCache&&gShowController.movieCache[a]?this.animateEffect(e,t.layers[d],i,r):this.animateEffect(e,t.layers[d],i?i.layers[d]:null,r)}},{key:"applyCssAnimation",value:function(e,t,i,r){var a=t.cssAnimation,n=(t.cssAnimationRules,t.cssAnimation.overallEndTime);t.hasMovie&&"buildOut"===t.animationInfo.type&&this.stopMovie(document.getElementById(t.movieId)),isChrome&&"apple:doorway"===t.animationInfo.name&&0===t.layers.length&&0===t.contentsRect.x&&0===t.contentsRect.y&&1===t.contentsRect.width&&1===t.contentsRect.height&&(e.style.visibility="hidden");var o=a.keyAnimations.bounds;if(o){var s=document.styleSheets[1].cssRules,l=s.length,h=e.id+"-bounds";i&&(h="layer"+t.layerId+"-bounds");for(var c=0;c<l;c++){var u=s[c];if(u.name===h){for(;u.cssRules.length>0;)u.deleteRule(u.cssRules[0].keyText);for(var d=0,f=o.keyframes.length;d<f;d++){var m,p,A=o.keyframes[d];0===A.keyframe?(I=A.value.width,F=A.value.height,u.appendRule("0% {"+kTransformPropertyName+": scaleX(1) scaleY(1); "+kAnimationTimingFunctionPropertyName+": "+A.timingFunction+";}")):(m=A.value.width,p=A.value.height,u.appendRule(A.keyframe+"% {"+kTransformPropertyName+": scaleX("+m/I+") scaleY("+p/F+"); "+kAnimationTimingFunctionPropertyName+": "+A.timingFunction+";}"))}}}}if(0!==t.initialState.rotation||1!==t.initialState.scale){var v=document.getElementById(e.id),g=parseTransformMatrix(window.getComputedStyle(v,null).getPropertyValue(kTransformPropertyName)),y="matrix(1,0,0,1,"+g[4]+","+g[5]+")";setElementProperty(v,kTransformPropertyName,y);var b=document.getElementById(e.id+"-"+escapeTextureId("transform.rotation.z"));b&&setElementProperty(b,kTransformPropertyName,"rotateZ("+t.initialState.rotation+"rad)");var S=document.getElementById(e.id+"-"+escapeTextureId("transform.scale.x"));S&&setElementProperty(S,kTransformPropertyName,"scaleX("+t.initialState.scale+")");var x=document.getElementById(e.id+"-"+escapeTextureId("transform.scale.y"));x&&setElementProperty(x,kTransformPropertyName,"scaleY("+t.initialState.scale+")")}for(var C in a.keyAnimations){var w=a.keyAnimations[C],P=w.keyActions,T=P[P.length-1],k=w.keyframes[w.keyframes.length-1],D=this.cssPropertyNameForAction(C),E=this.cssPropertyValueForActionValue(C,k.value),B=(w.repeatCount,n+"s"),M=(h="","");if("isPlaying"!==C&&("renderWebVideo"!==t.animationInfo.name&&(!i||"actionBuild"!==t.animationInfo.type||-1!==kActionBuildKeyAnimations[t.animationInfo.name].indexOf(C))))if("doubleSided"!==C){if("apple:ca-revolve"!==t.animationInfo.name&&"apple:3D-cube"!==t.animationInfo.name||!t.transformOriginValue||!t.transformOriginZValue||"anchorPointZ"!==C&&"zPosition"!==C){switch(C){case"opacity":M=h=e.id+"-opacity",i?(null!==document.getElementById(h)&&void 0!==document.getElementById(h)||(h=e.id),M="layer"+t.layerId+"-opacity"):setElementProperty(e,"opacity",1);break;case"hidden":D="opacity","hidden"===E?E=0:(e.style.visibility="visible",E=1),M=(h=e.id)+"-hidden",i&&(M="layer"+t.layerId+"-hidden");break;case"bounds":var I,F;M=h=e.id+"-bounds",i&&(M="layer"+t.layerId+"-bounds");var L=w.keyframes[0],N=w.keyframes[w.keyframes.length-1];E="scaleX("+N.value.width/L.value.width+") scaleY("+N.value.height/L.value.height+")";break;default:M=h=e.id+"-"+escapeTextureId(C),i&&(M="layer"+t.layerId+"-"+escapeTextureId(C))}if("contents"!==C){var G=document.getElementById(h);if(G){if("anchorPoint"===C){var R={x:k.value.pointX,y:k.value.pointY};t.magicMoveOffsetValue&&(R.x=t.magicMoveOffsetValue.pointX,R.y=t.magicMoveOffsetValue.pointY),D=kTransformPropertyName,E="translateX("+R.x+"px) translateY("+R.y+"px)"}else"anchorPointZ"===C&&(isFirefox||isChrome?(D=kTransformPropertyName,E="translateZ("+-t.transformOriginZValue+"px)"):(D=kTransformPropertyName,E="translateZ("+t.transformOriginZValue+"px)"));"hidden"!==C&&setElementProperty(G,D,E),setElementProperty(G,kAnimationFillModePropertyName,"removed"===T.fillMode?"none":T.fillMode),setElementProperty(G,kAnimationNamePropertyName,M),setElementProperty(G,kAnimationDurationPropertyName,B)}}else if("smartBuild"===r.type){var O=e.id+"-contents-canvas",W=document.createElement("canvas");W.width=t.initialState.width,W.height=t.initialState.height,W.setAttribute("id",O);var U=gShowController.scriptManager.slideIndexFromSceneIndex(this.sceneIndex),K={canvasId:O,canvas:W,textureAssets:gShowController.textureManager.slideCache[U].textureAssets,effect:r,overallEndTime:n,element:e},V=this.glContentsRenderer[O];V||(V=new KNWebGLRenderer(K),this.glContentsRenderer[O]=V),document.getElementById(e.id).appendChild(W);var Q=1e3*r.beginTime;setTimeout(this.animateContentsWillBegin.bind(this,K),Q)}else{var z=e.id+"-contents-from",Y=e.id+"-contents-to",X=z,H=Y;i&&(X="layer"+t.layerId+"-contents-from",H="layer"+t.layerId+"-contents-to");var j=document.getElementById(z),_=document.getElementById(Y);setElementProperty(j,"opacity",0),setElementProperty(j,kAnimationNamePropertyName,X),setElementProperty(j,kAnimationDurationPropertyName,B),setElementProperty(_,"opacity",1),setElementProperty(_,kAnimationNamePropertyName,H),setElementProperty(_,kAnimationDurationPropertyName,B)}}}else{var q=document.getElementById(e.id+"-"+escapeTextureId(C));q&&setElementProperty(q,D,E)}}}},{key:"animateContentsWillBegin",value:function(e){var t=e.canvasId,i=e.effect,r=e.element,a=this.glContentsRenderer[t];a.draw(i),a.animationStarted||(a.animate(),a.animationStarted=!0);var n=r.id+"-contents-from",o=r.id+"-contents-to",s=document.getElementById(n),l=document.getElementById(o);setElementProperty(s,"opacity",0),setElementProperty(l,"opacity",0)}},{key:"cssPropertyValueForActionValue",value:function(e,t){switch(e){case"hidden":return!0===t.scalar?"hidden":"visible";case"anchorPoint":return t.pointX+"% "+t.pointY+"%";case"anchorPointZ":return t.scalar;case"position":return"translate("+t.pointX+"px,"+t.pointY+"px)";case"zPosition":case"transform.translation.z":return"translateZ("+t.scalar+"px)";case"translationEmphasis":return"translateX("+t.translationEmphasis[0]+"px) translateY("+t.translationEmphasis[1]+"px) translateZ("+t.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+t.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(t.scaleEmphasis[3])+","+ensureScaleFactorNotZero(t.scaleEmphasis[4])+","+ensureScaleFactorNotZero(t.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(t.scalar)+")";case"transform.rotation.x":return"rotateX("+t.scalar+"rad)";case"transform.rotation.y":return"rotateY("+t.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+t.scalar+"rad)";case"transform.translation":return"translateX("+t.pointX+"px) translateY("+t.pointY+"px)";case"transform.translation.x":return"translateX("+t.scalar+"px)";case"transform.translation.y":return"translateY("+t.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return t.scalar+"";case"transform":return"matrix3d("+t.transform+")";case"doubleSided":return!1===t.scalar?"hidden":"visible";default:return"some value"}}},{key:"cssPropertyNameForAction",value:function(e){switch(e){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return e}}},{key:"hideMoviePoster",value:function(e){e.style.visibility="hidden"}},{key:"handleMovieDidStart",value:function(e,t){t.style.visibility="visible",setTimeout(this.hideMoviePoster.bind(this,e),120)}},{key:"handleMovieDidEnd",value:function(e,t){t.loop||(t.isEnded=!0)}},{key:"startMovie",value:function(e){e&&(e.play(),e.isPlaying=!0)}},{key:"stopMovie",value:function(e){e&&e.pause()}}]),e}(),KPFEvent=function(){function e(t){_classCallCheck(this,e),this.slideId=t.slideId,this.slideIndex=t.slideIndex,this.sceneIndex=t.sceneIndex,this.event=t.event,this.baseLayer={},this.effects=[],this.cssRenderer={},this.glRenderer={},this.canvasIdFromObjectIdLookup={},this.eventOverallEndTime=0,this.overallEndTimeInternal()}return _createClass(e,[{key:"destroy",value:function(){this.baseLayer.destroy(),this.cssRenderer.destroy();for(var e=0,t=this.effects.length;e<t;e++)this.effects[e].destroy();delete this.baseLayer,delete this.cssRenderer,delete this.effects,delete this.event,this.slideId=null,this.slideIndex=null,this.sceneIndex=null,this.eventOverallEndTime=null}},{key:"addAnimationsToIdenticalLayer",value:function(e,t){if(e.animations&&e.animations.length>0)for(var i=0,r=e.animations.length;i<r;i++)t.animations.push(e.animations[i]);if(e.layers&&e.layers.length>0)for(var a=0,n=e.layers.length;a<n;a++)this.addAnimationsToIdenticalLayer(e.layers[a],t.layers[a])}},{key:"processEffects",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];if("actionBuild"===r.type){for(var a,n=!1,o=0,s=t.length;o<s;o++)if("actionBuild"===t[o].type&&t[o].objectID===r.objectID){a=o,n=!0;break}if(n){this.addAnimationsToIdenticalLayer(r.baseLayer,t[a].baseLayer),r.beginTime<t[a].beginTime&&(t[a].beginTime=r.beginTime),r.beginTime+r.duration>t[a].beginTime+t[a].duration&&(t[a].duration=r.beginTime+r.duration);for(var l=0,h=r.effects.length;l<h;l++)t[a].effects.push(r.effects[l]);null!==t[a].names&&void 0!==t[a].names||(t[a].names=[]),t[a].names.push(r.name)}else t.push(r)}else t.push(r)}for(i=0,s=t.length;i<s;i++)t[i].effects=this.processEffects(t[i].effects);return t}},{key:"renderEffects",value:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var a=new KPFEffect(e[i]),n=!1,o=a.objectID;this.cssRenderer.initRendererFlags(a);var s=o+"-audio";if("apple:audio-start"===a.name){var l=new KPFAudio({objectID:o,audioId:s,isSoundTrack:!1});null!==gShowController.audioCache&&void 0!==gShowController.audioCache||(gShowController.audioCache={}),gShowController.audioCache[s]=l}else if("renderMovie"===a.name||"renderWebVideo"===a.name)gShowController.audioCache&&gShowController.audioCache[s]?this.renderAudioOnlyEffect(a):this.renderMovie(this.baseLayer,a);else{if("actionBuild"===a.type&&!a.isEmphasisBuild)for(var h=0,c=this.effects.length;h<c;h++)this.effects[h].objectID===o&&(n="actionBuild"===this.effects[h].type||"renderMovie"===this.effects[h].name||"renderWebVideo"===this.effects[h].name);if(this.baseLayer.objectID===o){var u=new KPFLayer(a.baseLayer,{name:a.name,type:a.type,objectID:o}),d="layer"+this.baseLayer.layerId,f=document.getElementById(d),m=f.parentNode,p=document.createElement("div");if(p.setAttribute("id","layer"+u.layerId),this.baseLayer=u,a.kpfLayer=u,useWebGL&&-1!==kSupportedWebGLEffects.indexOf(a.name)){var A,v=this.canvasId;v?A=document.getElementById(v):(v=this.canvasId=o+"-canvas",A=this.createCanvasElement(v),m.appendChild(A)),a.nodeToSwapId=d,a.canvasId=v}else this.cssRenderer.layer=u,this.cssRenderer.domNode=p,this.cssRenderer.draw(m),m.removeChild(f)}else this.renderEffect(this.baseLayer,a,n)}this.effects.push(a),t.push(a)}return t}},{key:"renderMovie",value:function(e,t){for(var i,r=0,a=e.layers.length;r<a;r++){var n=t.objectID,o=t.name,s=t.type,l=t.movie,h=t.webVideo;if(e.layers[r].objectID===n){var c=new KPFLayer(t.baseLayer,{name:o,type:s,objectID:n,movie:l,webVideo:h},e.bounds.offset),u=(e.layers[r].layerId,"layer"+e.layers[r].layerId),d=document.getElementById(u);if(!d)continue;var f=d.parentNode;t.kpfLayer=c;var m=this.canvasIdFromObjectIdLookup[n];if(m){var p=this.glRenderer[m];p&&p.removeProgram(n)}e.layers[r]=c;var A=this.cssRenderer.createNodes(f,e,c);f.replaceChild(A,d),i=!0}else i=this.renderMovie(e.layers[r],t);if(i)break}return i}},{key:"renderEffect",value:function(e,t,i){for(var r,a=0,n=e.layers.length;a<n;a++){var o=t.objectID,s=t.name,l=t.type,h=t.movie,c=t.webVideo;if(e.layers[a].objectID===o){var u=new KPFLayer(t.baseLayer,{name:s,type:l,objectID:o,movie:h,webVideo:c},e.bounds.offset),d=(e.layers[a].layerId,"layer"+e.layers[a].layerId),f=document.getElementById(d);if(!f)continue;var m=f.parentNode;if(t.kpfLayer=u,useWebGL&&-1!==kSupportedWebGLEffects.indexOf(s)){var p;(A=this.canvasId)?(p=document.getElementById(A)).style.opacity=1:(A=this.canvasId=o+"-canvas",p=this.createCanvasElement(A),m.appendChild(p)),this.canvasIdFromObjectIdLookup[o]=A,t.nodeToSwapId=d,t.canvasId=A}else{var A;if(A=this.canvasIdFromObjectIdLookup[o]){var v=this.glRenderer[A];v&&v.removeProgram(o)}if(i){var g=t.objectID+"-video",y=gShowController.movieCache&&gShowController.movieCache[g];if("apple:action-scale"===t.name&&!y){var b=document.getElementById(f.childNodes[0].id+"-contents"),S=this.cssRenderer.createNodes(m,e,u),x=S.childNodes[0].id,C=document.getElementById(x+"-contents-from"),w=document.getElementById(x+"-contents-to");if(C&&w){var P=e.bounds,T=P.width,k=P.height,D=f.childNodes[0].id,E=document.createElement("div");E.id=D+"-contents-to",this.setStyle(E,"0px","0px",T+"px",k+"px",kPositionAbsolutePropertyValue,null,null),E.appendChild(w.childNodes[0]),b.appendChild(E),setElementProperty(E,"opacity",0);var B=document.createElement("div");B.id=D+"-contents-from",this.setStyle(B,"0px","0px",T+"px",k+"px",kPositionAbsolutePropertyValue,null,null),B.appendChild(C.childNodes[0]),b.appendChild(B)}else S.parentNode.removeChild(S)}t.currentKPFLayer=e.layers[a]}else{e.layers[a]=u;var M=this.cssRenderer.createNodes(m,e,u);m.replaceChild(M,f)}}r=!0}else r=this.renderEffect(e.layers[a],t,i);if(r)break}return r}},{key:"renderEvent",value:function(e){var t={};this.event.effects&&1===this.event.effects.length&&(t.name=this.event.effects[0].name,t.type=this.event.effects[0].type,t.objectID=this.event.effects[0].objectID),this.baseLayer=new KPFLayer(this.event.baseLayer,t),this.cssRenderer=new KPFCssRenderer(this.baseLayer,this.sceneIndex,this.effects),this.cssRenderer.draw(e)}},{key:"renderAudioOnlyEffect",value:function(e){if("renderMovie"===e.name){var t=e.movie;if(t.isAudioOnly){null!==gShowController.audioCache&&void 0!==gShowController.audioCache||(gShowController.audioCache={});var i=e.objectID+"-audio",r=gShowController.audioCache[i],a=gShowController.textureManager.urlForAsset(t.asset,this.slideId);r.setSrc(a);var n=r.audioElement;t&&(t.loopMode&&"looping"===t.loopMode&&(n.loop=!0),t.volume&&(n.volume=t.volume)),r.startAudio()}}}},{key:"animateEffects",value:function(e){for(var t=0,i=e.length;t<i;t++){var r=e[t];this.animateEffect(r)}for(var a in this.glRenderer){var n=this.glRenderer[a];n.animate(),n.animationStarted=!0}}},{key:"animateEffect",value:function(e){var t=e.canvasId,i=e.nodeToSwapId;if(t){var r={canvasId:t,canvas:document.getElementById(t),nodeToSwapId:i,textureAssets:gShowController.textureManager.slideCache[this.slideIndex].textureAssets,effect:e,overallEndTime:this.eventOverallEndTime},a=this.glRenderer[t];a||(a=new KNWebGLRenderer(r),this.glRenderer[t]=a);var n=1e3*e.beginTime;"transition"===e.type&&(n=0),setTimeout(this.animateEffectWillBegin.bind(this,r),n)}else this.cssRenderer.animate(e);e.effects.length>0&&setTimeout(this.handleEffectDidComplete.bind(this,e),1e3*(e.beginTime+e.duration))}},{key:"animateEffectWillBegin",value:function(e){var t=e.canvasId,i=e.effect,r=this.glRenderer[t];r.draw(i),r.animationStarted||(r.animate(),r.animationStarted=!0);var a=document.getElementById(e.nodeToSwapId);a&&setTimeout(this.handleAnimateEffectDidBegin.bind(this,a),0)}},{key:"handleAnimateEffectDidBegin",value:function(e){e.style.opacity=0}},{key:"handleEffectDidComplete",value:function(e){for(var t=this.renderEffects(e.effects),i=0,r=t.length;i<r;i++){var a=t[i];this.animateEffect(a)}}},{key:"overallEndTime",value:function(){return this.eventOverallEndTime}},{key:"overallEndTimeInternal",value:function(){for(var e=0,t=this.event.effects.length;e<t;e++){var i=this.event.effects[e];this.calculateOverallEndTime(0,i)}}},{key:"calculateOverallEndTime",value:function(e,t){var i=e+t.beginTime+t.duration;i>this.eventOverallEndTime&&(this.eventOverallEndTime=i);for(var r=0,a=t.effects.length;r<a;r++)this.calculateOverallEndTime(i,t.effects[r])}},{key:"createCanvasElement",value:function(e){var t=document.createElement("canvas");return t.width=gShowController.script.slideWidth,t.height=gShowController.script.slideHeight,t.setAttribute("id",e),t}},{key:"setStyle",value:function(e,t,i,r,a,n,o,s){e.style.top=t,e.style.left=i,e.style.width=r,e.style.height=a,e.style.position=n,null!=o&&(e.style.opacity=o),null!=s&&(e.style.visibility=s)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var SlideManager=function(){function e(t){_classCallCheck(this,e),this.header=t.header,this.slides={};for(var i=0,r=this.header.slideList.length;i<r;i++)this.slides[this.header.slideList[i]]={downloaded:!1,script:{},retry:0}}return _createClass(e,[{key:"getSlides",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var a=e[i];this.slides[a].downloaded=!0,this.slides[a].script=JSON.parse(t.getKPFJsonStringForSlideIndex(i)),this.slides[a].originalScript=JSON.parse(t.getKPFJsonStringForSlideIndex(i)),document.dispatchEvent(new CustomEvent(kSlideDidDownloadEvent,{detail:{id:a}}))}}},{key:"downloadSlides",value:function(e){for(var t=0,i=e.length;t<i;t++)this.downloadSlide(e[t])}},{key:"downloadSlide",value:function(e){var t="./assets/"+e+"/"+e+".json";if("file:"===window.location.protocol){t+="p",null!==window.local_slide&&void 0!==window.local_slide||(window.local_slide=function(e){this.slideDidDownload(null,e,!0)}.bind(this));var i=document.createElement("script");i.setAttribute("src",t),document.head.appendChild(i)}else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.send(),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?this.slideDidDownload(e,r):this.slideDidNotDownload(e))}.bind(this)}}},{key:"slideDidDownload",value:function(e,t,i){i?(e=t.name,this.slides[e].script=t.json,this.slides[e].originalScript=JSON.parse(JSON.stringify(t.json))):(this.slides[e].script=JSON.parse(t.responseText),this.slides[e].originalScript=JSON.parse(t.responseText)),this.slides[e].downloaded=!0,document.dispatchEvent(new CustomEvent(kSlideDidDownloadEvent,{detail:{id:e}}))}},{key:"slideDidNotDownload",value:function(){var e=arguments[0];200!=arguments[1].status&&(this.slides[e].retry<1?(this.downloadSlide(e),this.slides[e].retry++):document.dispatchEvent(new CustomEvent(kSlideDidNotDownloadEvent,{detail:{id:e}})))}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var NavigatorController=function(){function e(t){_classCallCheck(this,e),this.domNode=t,this.thumbnailSidebar=new NavigatorThumbnailSidebar,this.thumbnailScroller=new NavigatorThumbnailScroller,this.thumbnailSelection=new NavigatorThumbnailSelection,this.thumbnailContainer=new NavigatorThumbnailContainer,this.thumbnailSidebar.domNode.appendChild(this.thumbnailScroller.domNode),this.thumbnailScroller.domNode.appendChild(this.thumbnailSelection.domNode),this.thumbnailScroller.domNode.appendChild(this.thumbnailContainer.domNode),this.domNode.appendChild(this.thumbnailSidebar.domNode),this.leftSidebar=new NavigatorLeftSidebar,this.domNode.appendChild(this.leftSidebar.domNode),this.domNode.addEventListener("click",this.handleClickEvent.bind(this)),this.leftSidebar.domNode.addEventListener("mouseover",this.handleMouseOverEvent.bind(this)),this.domNode.addEventListener("mouseleave",this.handleMouseOutEvent.bind(this)),document.addEventListener(kSlideIndexDidChangeEvent,this.handleSlideIndexDidChangeEvent.bind(this)),document.addEventListener(kScriptDidDownloadEvent,this.handleScriptDidDownloadEvent.bind(this)),this.slideThumbnail=null}return _createClass(e,[{key:"initScrollbar",value:function(){this.thumbnailScroller.domNode.scrollHeight>this.thumbnailScroller.domNode.offsetHeight?this.thumbnailScroller.domNode.style.width="126px":this.thumbnailScroller.domNode.style.width="129px"}},{key:"handleClickEvent",value:function(e){if(!gShowController.isRecording){var t=(e=e||window.event).target||e.srcElement;for("ms"===browserPrefix?e.cancelBubble=!0:e.stopPropagation();(null===t.slideNumber||void 0===t.slideNumber)&&"body"!==t.nodeName.toLowerCase();)t=t.parentNode;t.slideNumber&&(this.selectedSlideIndex=t.slideNumber,this.select(this.selectedSlideIndex))}}},{key:"select",value:function(e){gShowController.jumpToSlide(e)}},{key:"handleMouseOverEvent",value:function(e){var t=0,i=0;if((e=e||window.event).pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,i=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop),0!==t||0!==i){var r=76*this.selectedSlideIndex,a=this.thumbnailScroller.domNode.scrollTop,n=this.thumbnailScroller.domNode.clientHeight;if(a>r)this.thumbnailScroller.domNode.scrollTop=r;else if(a+n<r+76){var o=r-a-n+76;this.thumbnailScroller.domNode.scrollTop=this.thumbnailScroller.domNode.scrollTop+o}clearTimeout(this.navigatorTimeout),this.navigatorTimeout=setTimeout(this.thumbnailSidebar.show.bind(this.thumbnailSidebar,this.leftSidebar),400)}}},{key:"handleMouseOutEvent",value:function(e){clearTimeout(this.navigatorTimeout),this.navigatorTimeout=setTimeout(this.thumbnailSidebar.hide.bind(this.thumbnailSidebar,this.leftSidebar),400)}},{key:"handleSlideIndexDidChangeEvent",value:function(e){this.selectedSlideIndex=e.detail.slideIndex,this.thumbnailSelection.select(this.selectedSlideIndex)}},{key:"handleScriptDidDownloadEvent",value:function(e){for(var t=e.detail.script,i=0,r=t.slideList.length;i<r;i++){var a=t.slideList[i],n=new NavigatorThumbnailItem;if(n.domNode.slideNumber=i+1,n.numberNode.innerHTML=i+1,setElementProperty(n.domNode,"top",76*i+"px"),this.thumbnailContainer.addItem(n),null==gShowController.delegate.getKPFJsonStringForShow){var o="./assets/"+a+"/thumbnail.jpeg",s=document.createElement("img");s.addEventListener("load",this.updateThumbnail.bind(this,i,s)),s.src=o}else gShowController.delegate.loadTextureBySlideIndex(i,{type:"slideThumbnail",state:"outgoing"},function(e,t){this.updateThumbnail(e,t)}.bind(this,i))}this.initScrollbar()}},{key:"updateThumbnail",value:function(e,t){var i=this.thumbnailContainer.thumbnailItems[e].canvasContainer;if(null===this.slideThumbnail||void 0===this.slideThumbnail){var r,a,n=gShowController.script.originalSlideWidth,o=gShowController.script.originalSlideHeight,s=n/o;s>=4/3?(r=88,a=Math.ceil(1/s*88)):(r=Math.ceil(66*s),a=66),this.slideThumbnail={width:r,height:a,top:Math.ceil((66-a)/2),left:Math.ceil((88-r)/2),scaleX:r/n,scaleY:a/o}}"svg"===t.nodeName.toLowerCase()&&t.firstElementChild.setAttribute("transform","matrix("+this.slideThumbnail.scaleX+",0,0,"+this.slideThumbnail.scaleY+",0,0)"),t.setAttribute("style",kTransitionPropertyName+":opacity; "+kTransitionDurationName+":500; width:"+this.slideThumbnail.width+"px; height:"+this.slideThumbnail.height+"px; left:"+this.slideThumbnail.left+"px; top:"+this.slideThumbnail.top+"px; opacity: 0; position: absolute;"),t.setAttribute("draggable",!1),"moz"===browserPrefix&&t.addEventListener("dragstart",(function(e){e.preventDefault()})),i.appendChild(t),t.style.opacity=1}}]),e}(),NavigatorLeftSidebar=function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorLeftSidebar")},NavigatorThumbnailSidebar=function(){function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailSidebar")}return _createClass(e,[{key:"show",value:function(e){e.domNode.style.visibility="hidden",this.domNode.style.left="0px",gShowController.displayManager.navigatorIsShowing=!0,gShowController.displayManager.clearTimeoutForCursor()}},{key:"hide",value:function(e){e.domNode.style.visibility="visible",this.domNode.style.left="-140px",gShowController.displayManager.navigatorIsShowing=!1,gShowController.displayManager.setTimeoutForCursor()}}]),e}(),NavigatorThumbnailScroller=function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailScroller")},NavigatorThumbnailSelection=function(){function e(t){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailSelection")}return _createClass(e,[{key:"select",value:function(e){this.domNode.style.top=76*e+"px",this.domNode.style.display="block"}}]),e}(),NavigatorThumbnailContainer=function(){function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailContainer"),this.thumbnailItems=[]}return _createClass(e,[{key:"addItem",value:function(e){this.thumbnailItems.push(e),this.domNode.appendChild(e.domNode)}}]),e}(),NavigatorThumbnailItem=function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","navigatorThumbnailItem"),this.thumbnailContentNode=document.createElement("div"),this.thumbnailContentNode.setAttribute("style","position: absolute; height: 76px; width: 119px;"),this.numberNode=document.createElement("div"),this.numberNode.setAttribute("style","position: absolute; bottom: 1px; width: 20px; height: 20px; text-align: right; font-weight: bold; color: white;"),this.imageNode=document.createElement("div"),this.imageNode.setAttribute("style","position: absolute; left: 24px; width: 95px; height: 76px;"),this.thumb=document.createElement("div"),this.thumb.setAttribute("style","position: absolute; top: 4px; width: 90px; height: 68px;"),this.canvasContainer=document.createElement("div"),this.canvasContainer.setAttribute("class","navigatorThumbnailItemCanvasContainer"),this.thumb.appendChild(this.canvasContainer),this.imageNode.appendChild(this.thumb),this.thumbnailContentNode.appendChild(this.numberNode),this.thumbnailContentNode.appendChild(this.imageNode),this.domNode.appendChild(this.thumbnailContentNode)};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var SlideNumberController=function(){function e(t,i){_classCallCheck(this,e),this.domNode=t,this.width=120,this.height=110,this.slideNumberLabel=document.createElement("div"),this.slideNumberLabel.setAttribute("class","slideNumberLabel"),this.slideNumberLabel.innerHTML=i||"Press Return to go to slide:",this.slideNumberDigit=document.createElement("div"),this.slideNumberDigit.setAttribute("class","slideNumberDigit"),this.domNode.appendChild(this.slideNumberLabel),this.domNode.appendChild(this.slideNumberDigit),this.isShowing=!1}return _createClass(e,[{key:"setPosition",value:function(e,t){this.domNode.style.left=e+"px",this.domNode.style.top=t+"px"}},{key:"setSlideNumber",value:function(e){this.slideNumberDigit.innerHTML=e}},{key:"show",value:function(){this.isShowing=!0,this.domNode.style.display="block",this.domNode.style.opacity=1}},{key:"hide",value:function(){this.isShowing=!1,this.domNode.style.display="none",this.domNode.style.opacity=0}}]),e}(),SlideNumberDisplay=function(){function e(t){_classCallCheck(this,e),this.domNode=t,this.width=100,this.height=100,this.slideNumberDigit=document.createElement("div"),this.slideNumberDigit.setAttribute("class","slideNumberDisplayDigit"),this.domNode.appendChild(this.slideNumberDigit),this.isShowing=!1}return _createClass(e,[{key:"setPosition",value:function(e,t){this.domNode.style.left=e+"px",this.domNode.style.top=t+"px"}},{key:"setSlideNumber",value:function(e){this.slideNumberDigit.innerHTML=e}},{key:"show",value:function(e){this.isShowing=!0,this.domNode.style.display="block",this.domNode.style.opacity=1}},{key:"hide",value:function(){this.isShowing=!1,this.domNode.style.display="none",this.domNode.style.opacity=0}}]),e}();function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var HelpPlacardTitleBar=function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","helpPlacardTitleBar"),this.closeButton=document.createElement("div"),this.closeButton.setAttribute("class","helpPlacardCloseButton"),this.title=document.createElement("div"),this.title.setAttribute("class","helpPlacardTitle"),this.title.innerHTML=kHelpPlacardMainTitle,this.domNode.appendChild(this.closeButton),this.domNode.appendChild(this.title)},HelpPlacardContentPanel=function e(t){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","helpPlacardContentPanel");for(var i=0,r=t.length;i<r;i++){var a,n,o=t[i],s=document.createElement("div");o.header?(s.setAttribute("class","helpPlacardHeader"),(a=document.createElement("div")).setAttribute("class","helpPlacardLeftHeaderItem"),a.innerHTML=o.text,s.appendChild(a)):(s.setAttribute("class","helpPlacardItem"),(a=document.createElement("div")).setAttribute("class","helpPlacardRightItem"),a.innerHTML=o.key,(n=document.createElement("div")).setAttribute("class","helpPlacardLeftItem"),n.innerHTML=o.text,s.appendChild(a),s.appendChild(n)),this.domNode.appendChild(s)}},HelpPlacardFooter=function(){function e(){_classCallCheck(this,e),this.domNode=document.createElement("div"),this.domNode.setAttribute("class","helpPlacardFooter");var t=document.createElement("div");t.innerHTML="Acknowledgements",t.setAttribute("class","helpPlacardAcknowledgementsButton"),t.addEventListener("click",this.handleClickEvent.bind(this)),this.domNode.appendChild(t)}return _createClass(e,[{key:"handleClickEvent",value:function(e){e=e||window.event,"ms"===browserPrefix?e.cancelBubble=!0:e.stopPropagation(),window.open("Acknowledgements.pdf","_Acknowledgements")}}]),e}(),HelpPlacardController=function(){function e(t){_classCallCheck(this,e),this.domNode=t,this.width=822,this.height=603;var i=[{key:"&nbsp;",text:kHelpPlacardNavigationTitle,header:!0},{key:"return/enter &nbsp; space &nbsp; &#8594 &nbsp; &#8595 &nbsp; page down",text:kHelpPlacardAdvanceToNextBuild},{key:"[ &nbsp; shift - page up &nbsp; shift - &#8592",text:kHelpPlacardGoBackToPreviousBuild},{key:"] &nbsp; shift - &#8594",text:kHelpPlacardAdvanceAndSkipBuild},{key:"shift - page down &nbsp; shift - &#8595 &nbsp; + &nbsp; =",text:kHelpPlacardAdvanceToNextSlide},{key:"&#8592 &nbsp; &#8593 &nbsp; - &nbsp; shift - &#8593",text:kHelpPlacardGoBackToPreviousSlide},{key:"home",text:kHelpPlacardGoToFirstSlide},{key:"end",text:kHelpPlacardGoToLastSlide},{key:"slide number + return/enter",text:kHelpPlacardGoToSpecificSlide},{key:"&nbsp;",text:kHelpPlacardOtherTitle,header:!0},{key:"? &nbsp; /",text:kHelpPlacardShowOrHideKeyboardShortcuts},{key:"s",text:kHelpPlacardShowOrHideTheCurrentSlideNumber},{key:"esc &nbsp; q",text:kHelpPlacardQuitPresentationMode}];this.helpPlacardTitleBar=new HelpPlacardTitleBar,this.helpPlacardContentPanel=new HelpPlacardContentPanel(i),this.helpPlacardFooter=new HelpPlacardFooter,this.domNode.appendChild(this.helpPlacardTitleBar.domNode),this.domNode.appendChild(this.helpPlacardContentPanel.domNode),this.domNode.appendChild(this.helpPlacardFooter.domNode),this.isShowing=!1}return _createClass(e,[{key:"handleClickEvent",value:function(e){(e=e||window.event).target||e.srcElement;this.isShowing&&("ms"===browserPrefix?e.cancelBubble=!0:e.stopPropagation()),this.hide()}},{key:"setPosition",value:function(e,t){this.domNode.style.left=e+"px",this.domNode.style.top=t+"px"}},{key:"show",value:function(){this.isShowing=!0,this.domNode.style.display="block",this.domNode.style.opacity=1}},{key:"hide",value:function(){this.isShowing=!1,this.domNode.style.display="none",this.domNode.style.opacity=0}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var NarrationManager=function(){function e(t){_classCallCheck(this,e),this.movieSegments=t.movieSegments,this.duration=t.duration,this.eventTracks=t.eventTracks,this.currentNavigationEventIndex=0,this.lastSceneIndex=0;for(var i=0,r=this.eventTracks.length;i<r;i++){var a=this.eventTracks[i];"navigation"===a.type?this.navigationEvents=a.events:"movie"===a.type?this.movieEvents=a.events:"pause"===a.type&&(this.pauseEvents=a.events)}}return _createClass(e,[{key:"start",value:function(){var e=new Audio;e.src="./assets/"+this.movieSegments[0].url,e.addEventListener("playing",this.handleAudioDidStart.bind(this)),e.addEventListener("ended",this.handleAudioDidEnd.bind(this,0)),e.play()}},{key:"handleAudioDidStart",value:function(){setTimeout(this.navigate(this.navigationEvents[0],!0),100)}},{key:"handleAudioDidEnd",value:function(e){var t=e+1;if(this.movieSegments[t]){var i=new Audio;i.src="./assetes/"+this.movieSegments[t].url,i.play(),i.removeEventListener("ended",this.handleAudioDidEnd),i.addEventListener("ended",this.handleAudioDidEnd.bind(this,t))}}},{key:"navigate",value:function(e,t){var i=this.sceneIndexFromNavigationEvent(e);if("start"===e.animationPhase){var r=!1;if(gShowController.script.loopSlideshow?this.lastSceneIndex===gShowController.script.numScenes-1&&0===i&&(r=!0):this.lastSceneIndex+1===i&&(r=!0),r)gShowController.state===kShowControllerState_IdleAtInitialState?gShowController.playCurrentScene():gShowController.state===kShowControllerState_IdleAtFinalState&&gShowController.jumpToScene(this.lastSceneIndex,!0);else{for(var a,n=gShowController.scriptManager.slideIndexFromSceneIndex(i),o=this.lastSceneIndex,s=gShowController.script.events[o].hyperlinks,l=0,h=s.length;l<h&&!(a=s[l]).events[e.slide];l++);a?gShowController.jumpToHyperlinkSlide(n,a):gShowController.jumpToScene(i,!1)}}else"none"===e.animationPhase&&null==t&&gShowController.jumpToScene(i,!1);var c=this.navigationEvents[this.currentNavigationEventIndex+1];if(null!=c){var u=c.startTime-e.startTime;setTimeout(this.navigate.bind(this,c),1e3*u),this.lastSceneIndex=i,this.currentNavigationEventIndex=this.currentNavigationEventIndex+1}}},{key:"handleCurrentSceneDidComplete",value:function(e){gShowController.jumpToScene(e,!1)}},{key:"sceneIndexFromNavigationEvent",value:function(e){for(var t=e.slide,i=gShowController.script.slideList,r=-1,a=0,n=i.length;a<n;a++)if(i[a]===t){r=a;break}var o=gShowController.scriptManager.sceneIndexFromSlideIndex(r);return e.eventIndex+o}},{key:"slideIndexFromSlideId",value:function(e){for(var t=gShowController.slideList,i=-1,r=0,a=t.length;r<a;r++)if(t[r]===e){i=r;break}return i}}]),e}(),KNAnimationActionAcceleration={KNAnimationActionAccelerationNone:0,KNAnimationActionAccelerationEaseIn:1,KNAnimationActionAccelerationEaseOut:2,KNAnimationActionAccelerationEaseBoth:3,KNAnimationActionAccelerationCustom:4},KNActionOpacityName="apple:action-opacity",KNActionMotionPathName="apple:action-motion-path",KNActionRotationName="apple:action-rotation",KNActionScaleName="apple:action-scale",KNActionPopName="apple:action-pop",KNActionPulseName="apple:action-pulse",KNActionBlinkName="apple:action-blink",KNActionFlipName="apple:action-flip",KNActionBounceName="apple:action-bounce",KNActionJiggleName="apple:action-jiggle",KNDirection={KNDirectionNone:0,KNDirectionLeftToRight:11,KNDirectionRightToLeft:12,KNDirectionTopToBottom:13,KNDirectionBottomToTop:14,KNDirectionUpperLeftToBottomRight:21,KNDirectionUpperRightToBottomLeft:22,KNDirectionLowerLeftToUpperRight:23,KNDirectionLowerRightToUpperLeft:24,KNDirectionClockwise:31,KNDirectionCounterclockwise:32,KNDirectionIn:41,KNDirectionOut:42,KNDirectionUp:43,KNDirectionDown:44,KNDirectionStartToEnd:51,KNDirectionEndToStart:52,KNDirectionMiddleToEnds:53,KNDirectionEndsToMiddle:54,KNDirectionRandom:91,KNDirectionAlternating:92,KNDirectionSimultaneous:93,KNDirectionBCForward:111,KNDirectionBCBackward:112,KNDirectionBCRandom:113,KNDirectionBCCenter:114,KNDirectionBCEdges:115,KNDirectionGravity:121,KNDirectionNoGravity:122},KNAnimationStringTypeNone="None",KNAnimationStringTypeBuildIn="In",KNAnimationStringTypeBuildOut="Out",KNAnimationStringTypeTransition="Transition",KNAnimationStringTypeActionBuild="Action";function KNEffectIsActionEffect(e){return[KNActionOpacityName,KNActionMotionPathName,KNActionRotationName,KNActionScaleName].indexOf(e)>-1}function KNEffectIsEmphasisEffect(e){return[KNActionPopName,KNActionPulseName,KNActionBlinkName,KNActionFlipName,KNActionBounceName,KNActionJiggleName].indexOf(e)>-1}var TSDTextureType={Unknown:0,Background:1,Shadow:2,ContactShadow:3,GroupedShadow:4,Object:5,Text:6,StrokeParameterized:7,Stroke:8,StrokeLineEndForHead:9,StrokeLineEndForTail:10,Reflection:11,FrameMask:12,ReflectionMask:13},KNWebGLShader={defaultTexture:{attribNames:["Position","TexCoord"],uniformNames:["MVPMatrix","Texture"],vertex:"        #ifdef GL_ES\n        precision highp float;\n        #endif\n        uniform mat4    MVPMatrix;\n        attribute vec4  Position;\n        attribute vec2  TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = (MVPMatrix * Position);\n        }        ",fragment:"        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            gl_FragColor = texture2D(Texture, v_TexCoord);\n        }        "},defaultTextureAndOpacity:{attribNames:["Position","TexCoord"],uniformNames:["MVPMatrix","Texture","Opacity"],vertex:"        #ifdef GL_ES\n        precision highp float;\n        #endif\n        uniform mat4    MVPMatrix;\n        attribute vec4  Position;\n        attribute vec2  TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = (MVPMatrix * Position);\n        }        ",fragment:"        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        uniform float Opacity;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            gl_FragColor = vec4(Opacity) * texColor;\n        }        "},contentsAndOpacity:{attribNames:["Position","TexCoord"],uniformNames:["MVPMatrix","Texture","Texture2","mixFactor","Opacity"],vertex:"        #ifdef GL_ES\n        precision highp float;\n        #endif\n        uniform mat4 MVPMatrix;\n        attribute vec4 Position;\n        attribute vec2 TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = (MVPMatrix * Position);\n        }        ",fragment:"        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        uniform sampler2D Texture2;\n        uniform float mixFactor;\n        uniform float Opacity;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            vec4 outgoingColor = texture2D(Texture2, v_TexCoord);\n            vec4 incomingColor = texture2D(Texture, v_TexCoord);\n            vec4 result = mix(outgoingColor, incomingColor, mixFactor);\n\t        gl_FragColor = vec4(Opacity) * result;\n        }        "},contents:{attribNames:["Position","TexCoord"],uniformNames:["MVPMatrix","Texture","Texture2","mixFactor"],vertex:"        #ifdef GL_ES\n        precision highp float;\n        #endif\n        uniform mat4 MVPMatrix;\n        attribute vec4 Position;\n        attribute vec2 TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = (MVPMatrix * Position);\n        }        ",fragment:"        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        uniform sampler2D Texture2;\n        uniform float mixFactor;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            vec4 outgoingColor = texture2D(Texture2, v_TexCoord);\n            vec4 incomingColor = texture2D(Texture, v_TexCoord);\n            vec4 result = mix(outgoingColor, incomingColor, mixFactor);\n            gl_FragColor = result;\n        }        "},iris:{attribNames:["Position","TexCoord"],uniformNames:["PercentForAlpha","Scale","Mix","Texture","MVPMatrix","Opacity"],vertex:"        #ifdef GL_ES\n        precision highp float;\n        #endif\n        uniform mat4    MVPMatrix;\n        attribute vec4  Position;\n        attribute vec2  TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = MVPMatrix * Position;\n        }        ",fragment:"        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        uniform float Opacity;\n        uniform float PercentForAlpha;\n        uniform float Scale;\n        uniform float Mix;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            vec4 incomingTexColor = texture2D(Texture, v_TexCoord);\n            vec4 clear = vec4(0.0, 0.0, 0.0, 0.0);\n            float tolerance = PercentForAlpha/5.0;\n            vec2 powers = vec2((v_TexCoord.x - 0.5) * Scale,v_TexCoord.y - 0.5);\n            powers *= powers;\n            float radiusSqrd = PercentForAlpha * PercentForAlpha;\n            float dist =  (powers.x+powers.y)/((0.5*Scale)*(0.5*Scale)+0.25);\n            float gradient = smoothstep(radiusSqrd, radiusSqrd+tolerance, dist);\n            gl_FragColor = vec4(Opacity) * mix(clear, incomingTexColor, abs(Mix - gradient));\n        }        "},twist:{attribNames:["Position","TexCoord","Normal"],uniformNames:["TextureMatrix","SpecularColor","FlipNormals","MVPMatrix","Texture"],vertex:"        #ifdef GL_ES\n            precision highp float;\n        #endif\n        uniform mat4 MVPMatrix;\n        uniform mat3 TextureMatrix;\n        uniform float SpecularColor;\n        uniform mediump float FlipNormals;\n        attribute vec3 Position;\n        attribute vec3 Normal;\n        attribute vec2 TexCoord;\n        varying vec2 v_TexCoord;\n        varying vec3 v_DiffuseColor;\n        varying vec3 v_SpecularColor;\n        const vec3 c_AmbientColor = vec3(0.2);\n        const vec3 c_DiffuseColor = vec3(1);\n        const float c_LightExponent = 32.0;\n        const vec3 c_LightDirection = vec3(0.1580, +0.5925, 0.7900);\n        const vec3 c_LightHalfPlane = vec3(0.0835, +0.3131, 0.9460);\n        void main()\n        {\n            vec3 thisNormal = Normal * FlipNormals;\n            // Lighting\n            float ndotl = max(0.0, dot(thisNormal, c_LightDirection));\n            float ndoth = max(0.0, dot(thisNormal, c_LightHalfPlane));\n            v_DiffuseColor = (c_AmbientColor + ndotl * c_DiffuseColor);\n            v_SpecularColor = (ndoth <= 0.0) ? vec3(0) : (pow(ndoth, c_LightExponent) * vec3(SpecularColor));\n            gl_Position = MVPMatrix * vec4(Position, 1.0);\n            v_TexCoord = (TextureMatrix * vec3(TexCoord,1.0)).xy;\n        }        ",fragment:"        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        varying vec2 v_TexCoord;\n        varying vec3 v_DiffuseColor;\n        varying vec3 v_SpecularColor;\n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            // Lighting\n            texColor.xyz = texColor.xyz * v_DiffuseColor + v_SpecularColor;\n            gl_FragColor = texColor;\n        }        "},colorPlanes:{attribNames:["Position","TexCoord"],uniformNames:["MVPMatrix","FlipTexCoords","Texture","ColorMask"],vertex:"        #ifdef GL_ES\n            precision highp float;\n        #endif\n        uniform mat4 MVPMatrix;\n        uniform vec2 FlipTexCoords;\n        attribute vec2 Position;\n        attribute vec2 TexCoord;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            v_TexCoord = vec2(FlipTexCoords.x == 0.0 ? TexCoord.x : 1.0-TexCoord.x, FlipTexCoords.y == 0.0 ? TexCoord.y : 1.0-TexCoord.y);\n            gl_Position = MVPMatrix * vec4(Position, 0,1);\n        }        ",fragment:"        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D Texture;\n        uniform vec4 ColorMask;\n        varying vec2 v_TexCoord;\n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            texColor *= ColorMask;\n            gl_FragColor = texColor;\n        }        "},flop:{attribNames:["Position","TexCoord","Normal"],uniformNames:["TextureMatrix","FlipNormals","MVPMatrix","Texture"],vertex:"        \n        #ifdef GL_ES\n        precision highp float;\n        #endif\n        \n        uniform mat4 MVPMatrix;\n        uniform mat3 TextureMatrix;\n        uniform float FlipNormals;\n        \n        attribute vec3 Position;\n        attribute vec3 Normal;\n        attribute vec2 TexCoord;\n        \n        varying vec2 v_TexCoord;\n        varying vec3 v_DiffuseColor;\n        \n        const vec3 c_AmbientColor = vec3(0.1);\n        const vec3 c_DiffuseColor = vec3(1);\n        const float c_LightExponent = 32.0;\n        \n        const vec3 c_LightDirection = vec3(0.000, +0.000, 0.900);\n        \n        void main()\n        {\n            vec3 thisNormal = Normal * FlipNormals;\n            \n            // Lighting\n            vec3 lightDirection = vec3(c_LightDirection.x,c_LightDirection.y,c_LightDirection.z);\n            \n            float ndotl = max(0.0, dot(thisNormal, lightDirection));\n            \n            v_DiffuseColor = (c_AmbientColor + ndotl * c_DiffuseColor);\n            \n            gl_Position = MVPMatrix * vec4(Position, 1);\n            v_TexCoord = (TextureMatrix * vec3(TexCoord,1)).xy;\n        }        ",fragment:"        \n        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        \n        uniform sampler2D Texture;\n        \n        varying vec2 v_TexCoord;\n        varying vec3 v_DiffuseColor;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            \n            // Lighting\n            texColor.xyz = texColor.xyz * v_DiffuseColor;\n            gl_FragColor = texColor;\n        }        "},anvilsmoke:{attribNames:["Rotation","Speed","Scale","LifeSpan","ParticleTexCoord","Center","Position"],uniformNames:["Percent","Opacity","ParticleTexture","MVPMatrix"],vertex:"        \n        uniform mat4    MVPMatrix;\n        uniform float   Percent;\n        uniform float   Opacity;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  ParticleTexCoord;\n        attribute vec3  Rotation;\n        attribute vec3  Speed;\n        attribute float Scale;\n        attribute vec2  LifeSpan;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        const float Pi = 3.1415926;\n        const float Pi_2 = 1.5707963;\n        const float TwoPi = 6.2831852;\n        \n        const float sineConstB = 1.2732396; /* = 4./Pi; */\n        const float sineConstC = -0.40528476; /* = -4./(Pi*Pi); */\n        \n        vec3 fastSine(vec3 angle)\n        {\n            vec3 theAngle = mod(angle + Pi, TwoPi) - Pi;\n            return sineConstB * theAngle + sineConstC * theAngle * abs(theAngle);\n        }\n        \n        mat3 fastRotationMatrix(vec3 theRotation)\n        {\n            vec3 sinXYZ = fastSine(theRotation);\n            vec3 cosXYZ = fastSine(Pi_2 - theRotation);\n            mat3 rotMatrix = mat3( cosXYZ.y*cosXYZ.z,  sinXYZ.x*sinXYZ.y*cosXYZ.z+cosXYZ.x*sinXYZ.z, -cosXYZ.x*sinXYZ.y*cosXYZ.z+sinXYZ.x*sinXYZ.z,\n                -cosXYZ.y*sinXYZ.z, -sinXYZ.x*sinXYZ.y*sinXYZ.z+cosXYZ.x*cosXYZ.z,  cosXYZ.x*sinXYZ.y*sinXYZ.z+sinXYZ.x*cosXYZ.z,\n                sinXYZ.y, -sinXYZ.x*cosXYZ.y, cosXYZ.x*cosXYZ.y);\n            return rotMatrix;\n        }\n        \n        void main()\n        {\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n                 realPercent = clamp(realPercent, 0.0, 1.0);\n            realPercent = sqrt(realPercent);\n            \n            /* SCALE */\n            vec4 originalPosition = vec4(Position,0,1);\n            vec4 center = vec4(Center, 0,1);\n            vec3 scaleDirectionVec = vec3(originalPosition.xy-center.xy,0) * Scale * mix(0.1, 1.0, realPercent);\n            \n            /* ROTATE */\n            mat3 rotMatrix = fastRotationMatrix(Rotation * realPercent);\n            vec3 rotatedVec = rotMatrix * scaleDirectionVec;\n            vec4 position = center + vec4(rotatedVec,0);\n            \n            float speedAdjust = realPercent;\n            vec3 thisSpeed = Speed;\n            thisSpeed.x *= sqrt(realPercent);\n            thisSpeed.y *= realPercent*realPercent;\n            position += vec4(thisSpeed, 0);\n            \n            float thisOpacity = Opacity;\n            thisOpacity *= (1.0 - realPercent); /* fade out gradually */\n            thisOpacity *= min(1.0, realPercent*20.0);  /* fade in quickly */\n            \n            /* output */\n            gl_Position = MVPMatrix * position;\n            //v_Color = vec4(1.0, 1.0, 1.0, thisOpacity); //we applied a fix here, might not work everywhere\n            v_Color = vec4(thisOpacity);\n            v_TexCoord = ParticleTexCoord;\n        }\n        ",fragment:"        \n        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D ParticleTexture;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color;\n            \n            gl_FragColor = texColor;\n        }\n        "},anvilspeck:{attribNames:["Speed","Scale","LifeSpan","ParticleTexCoord","Center","Position"],uniformNames:["Percent","Opacity","ParticleTexture","MVPMatrix"],vertex:"        \n        uniform mat4    MVPMatrix;\n        uniform float   Percent;\n        uniform float   Opacity;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  ParticleTexCoord;\n        attribute vec3  Speed;\n        attribute float Scale;\n        attribute vec2  LifeSpan;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        const float Pi = 3.1415926;\n        const float Pi_2 = 1.5707963;\n        const float TwoPi = 6.2831852;\n        \n        const float sineConstB = 1.2732396; /* = 4./Pi; */\n        const float sineConstC = -0.40528476; /* = -4./(Pi*Pi); */\n        \n        vec3 fastSine(vec3 angle)\n        {\n            vec3 theAngle = mod(angle + Pi, TwoPi) - Pi;\n            return sineConstB * theAngle + sineConstC * theAngle * abs(theAngle);\n        }\n        \n        void main()\n        {\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            realPercent = clamp(realPercent, 0.0, 1.0);\n            \n            /* SCALE */\n            vec4 originalPosition = vec4(Position,0,1);\n            vec4 center = vec4(Center, 0,1);\n            vec3 thisScale = Scale * vec3(1, Speed.z, 1) * mix(0.1, 1.0, realPercent);\n            vec3 scaleDirectionVec = vec3(originalPosition.xy-center.xy,0) * thisScale;\n            \n            vec4 position = center + vec4(scaleDirectionVec,0);\n            \n            float speedAdjust = realPercent;\n            vec3 thisPos = vec3(Speed.x * realPercent,\n                Speed.y * fastSine(Pi*0.85*vec3(realPercent,0,0)).x, /* arc with gravity */\n                0);\n            position += vec4(thisPos, 0);\n            \n            float thisOpacity = Opacity;\n            thisOpacity *= (1.0 - realPercent); /* fade out gradually */\n            thisOpacity *= min(1.0, realPercent*20.0);  /* fade in quickly */\n            \n            /* output */\n            gl_Position = MVPMatrix * position;\n            v_Color = vec4(thisOpacity);\n            v_TexCoord = ParticleTexCoord;\n        }        ",fragment:"        \n        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D ParticleTexture;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color;\n            \n            gl_FragColor = texColor;\n        }        "},flame:{attribNames:["Rotation","Speed","LifeSpan","ParticleTexCoord","Center","Position"],uniformNames:["Percent","Duration","Opacity","RotationMax","SpeedMax","ParticleTexture","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        uniform float Percent;\n        uniform float Duration;\n        \n        attribute vec3 Rotation;\n        attribute vec3 Speed;\n        uniform float   Opacity;\n        attribute vec2 LifeSpan;\n        attribute vec2 ParticleTexCoord;\n        attribute vec2  Position;\n        attribute vec2  Center;\n        \n        uniform mediump float RotationMax;\n        uniform mediump float SpeedMax;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        const float Pi = 3.1415926;\n        const float Pi_2 = 1.5707963;\n        const float TwoPi = 6.2831852;\n        \n        const float sineConstB = 1.2732396; /* = 4./Pi; */\n        const float sineConstC = -0.40528476; /* = -4./(Pi*Pi); */\n        \n        float fastSine(float angle)\n        {\n            float theAngle = mod(angle + Pi, TwoPi) - Pi;\n            return sineConstB * theAngle + sineConstC * theAngle * abs(theAngle);\n        }\n        \n        const vec4 kStartColor = vec4( 1.0,  1.0, 1.0,  0.0 ); /* white */\n        const vec4 kMidColor   = vec4( 0.97, 1.0, 0.32, 0.0 ); /* yellow */\n        const vec4 kEndColor   = vec4( 0.9,  0.0, 0.0,  0.0 ); /* red */\n        const float kColorMidPoint   = 0.1;\n        \n        vec4 flameColor(float aPercent)\n        {\n            float thePercent = aPercent;\n            /* CONSTANTS */\n            float beginCutoff = 0.4/Duration;    /* start slow (not bright white) */\n            float smokeCutoff = 1.0 - (0.95/Duration);      /* end with black, basically */\n            float alphaCutoff = 1.0 - 0.5/Duration;    /* fade out towards the end */\n            \n            float alpha = (thePercent < alphaCutoff) ? 1.0 : (1.0-(thePercent-alphaCutoff)/(1.0-alphaCutoff));\n            vec4 theColor = vec4(0,0,0, alpha * 0.75);\n            \n            if (Percent < beginCutoff) {\n                float colorCutoff = beginCutoff*3.0;\n                thePercent += mix(colorCutoff, 0.0, Percent/beginCutoff);\n            }\n            \n            if (thePercent < kColorMidPoint) {\n                float newPercent = thePercent/kColorMidPoint;\n                theColor += mix(kStartColor, kMidColor, newPercent);\n            } else {\n                float newPercent = (thePercent-kColorMidPoint)/(1.0-kColorMidPoint);\n                theColor += mix(kMidColor, kEndColor, newPercent);\n            }\n            \n            if (Percent > smokeCutoff) {\n                /* smoke */\n                float smokeAmount = (Percent - smokeCutoff)/(1.0 - smokeCutoff);\n                smokeAmount = sqrt(smokeAmount);\n                smokeAmount *= (0.25+thePercent*thePercent);\n                theColor = vec4(theColor.rgb * max(0.0, 1.0-smokeAmount), theColor.a);\n            }\n            \n            return theColor;\n        }\n        \n        void main()\n        {\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            bool shouldDiscard = realPercent < 0.0 || realPercent > 1.0;\n            realPercent = clamp(realPercent, 0.0, 1.0);\n            \n            vec4 scaleDirectionVec = vec4(Position-Center,0,0);\n            \n            /* ROTATE */\n            float halfPercent = realPercent/2.0;\n            vec3 thisRotation = Rotation * RotationMax;\n            float theRotation = thisRotation.x + thisRotation.z * (halfPercent * (halfPercent + 1.0));\n            float sinRot = fastSine(theRotation);\n            float cosRot = fastSine(Pi_2 - theRotation);\n            mat3 rotMatrix = mat3(cosRot,-sinRot,0,  sinRot,cosRot,0,  0,0,1);\n            vec3 rotatedVec = rotMatrix * scaleDirectionVec.xyz;\n            \n            /* SCALE */\n            float scaleAdjust = (0.1 + 1.0-(1.0-realPercent)*(1.0-realPercent));\n            vec4 position =  vec4(Center,0,1) + vec4(rotatedVec * scaleAdjust * (shouldDiscard ? 0.001 : 1.0), 0);\n            \n            /* POSITION */\n            vec3 thisSpeed = Speed * SpeedMax;\n            vec4 upVector = vec4(0.0, realPercent*realPercent * -thisSpeed.y, 0.0, 0.0);\n            position += upVector;\n            \n            v_Color = flameColor(realPercent)*Opacity;\n            gl_Position = MVPMatrix * position;\n            v_TexCoord = ParticleTexCoord;\n        }        ",fragment:"        \n        #ifdef GL_ES\n            precision mediump float;\n        #endif\n        uniform sampler2D ParticleTexture;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color;\n            \n            gl_FragColor = texColor;\n        }\n        "},confetti:{attribNames:["Rotation","Speed","TexCoord","Center","Position"],uniformNames:["Percent","Opacity","ParticleTexture","MVPMatrix"],vertex:"        \n        precision highp float;\n        uniform mat4 MVPMatrix;\n        \n        uniform float   Percent;\n        uniform mediump float Opacity;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  TexCoord;\n        attribute vec3  Rotation;\n        attribute vec3  Speed;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        const float Pi = 3.1415926;\n        const float Pi_2 = 1.5707963;\n        const float TwoPi = 6.2831852;\n        \n        const float sineConstB = 1.2732396;\n        const float sineConstC = -0.40528476;\n        \n        vec3 fastSine(vec3 angle)\n        {\n            vec3 theAngle = mod(angle + Pi, TwoPi) - Pi;\n                return sineConstB * theAngle + sineConstC * theAngle * abs(theAngle);\n        }\n        \n        mat3 fastRotationMatrix(vec3 theRotation)\n        {\n            vec3 sinXYZ = fastSine(theRotation);\n            vec3 cosXYZ = fastSine(Pi_2 - theRotation);\n            mat3 rotMatrix = mat3( cosXYZ.y*cosXYZ.z,  sinXYZ.x*sinXYZ.y*cosXYZ.z+cosXYZ.x*sinXYZ.z, -cosXYZ.x*sinXYZ.y*cosXYZ.z+sinXYZ.x*sinXYZ.z,\n                -cosXYZ.y*sinXYZ.z, -sinXYZ.x*sinXYZ.y*sinXYZ.z+cosXYZ.x*cosXYZ.z,  cosXYZ.x*sinXYZ.y*sinXYZ.z+sinXYZ.x*cosXYZ.z,\n                sinXYZ.y, -sinXYZ.x*cosXYZ.y, cosXYZ.x*cosXYZ.y);\n            return rotMatrix;\n        }\n        \n        void main()\n        {\n            /* SCALE */\n            vec4 originalPosition = vec4(Position, 0, 1);\n            vec3 scaleDirectionVec = vec3(Position-Center,0);\n            \n            /* ROTATE */\n            mat3 rotMatrix = fastRotationMatrix(Rotation * Percent);\n            vec3 rotatedVec = scaleDirectionVec * rotMatrix;\n            vec4 position = vec4(Center,0,1) + vec4(rotatedVec,0);\n            \n            float colorAdjust = abs((rotMatrix * vec3(0,0,1)).z);\n            \n            float speedAdjust = Percent;\n            position += vec4(Speed, 0) * speedAdjust;\n            \n            /* output */\n            gl_Position = MVPMatrix * position;\n            v_Color = vec4(vec3(colorAdjust), Opacity);\n            v_TexCoord = TexCoord;\n        }        ",fragment:"        \n        precision mediump float;\n        \n        uniform sampler2D ParticleTexture;\n        //uniform float Opacity;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color;\n            //texColor.a = Opacity;\n            \n            gl_FragColor = texColor;\n        }        "},diffuse:{attribNames:["Rotation","Speed","TexCoord","Center","Position","LifeSpan"],uniformNames:["Percent","Opacity","ParticleTexture","MVPMatrix","RotationMax","SpeedMax"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        uniform float   Percent;\n        uniform mediump float   Opacity;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  TexCoord;\n        \n        attribute mediump vec3  Rotation;\n        uniform mediump float RotationMax;\n        attribute mediump vec3  Speed;\n        uniform mediump float SpeedMax;\n        attribute mediump vec2  LifeSpan;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        const float Pi = 3.1415926;\n        const float Pi_2 = 1.5707963;\n        const float TwoPi = 6.2831852;\n        \n        const float sineConstB = 1.2732396;\n        const float sineConstC = -0.40528476;\n        \n        vec3 fastSine(vec3 angle)\n        {\n            vec3 theAngle = mod(angle + Pi, TwoPi) - Pi;\n            return sineConstB * theAngle + sineConstC * theAngle * abs(theAngle);\n        }\n        \n        mat3 fastRotationMatrix(vec3 theRotation)\n        {\n            vec3 sinXYZ = fastSine(theRotation);\n            vec3 cosXYZ = fastSine(Pi_2 - theRotation);\n            mat3 rotMatrix = mat3( cosXYZ.y*cosXYZ.z,  sinXYZ.x*sinXYZ.y*cosXYZ.z+cosXYZ.x*sinXYZ.z, -cosXYZ.x*sinXYZ.y*cosXYZ.z+sinXYZ.x*sinXYZ.z,\n                                  -cosXYZ.y*sinXYZ.z, -sinXYZ.x*sinXYZ.y*sinXYZ.z+cosXYZ.x*cosXYZ.z,  cosXYZ.x*sinXYZ.y*sinXYZ.z+sinXYZ.x*cosXYZ.z,\n                                  sinXYZ.y, -sinXYZ.x*cosXYZ.y, cosXYZ.x*cosXYZ.y);\n            return rotMatrix;\n        }\n        \n        void main()\n        {\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            float doDiscard = (realPercent > 1.0) ? 0.0 : 1.0;\n            realPercent = clamp(realPercent, 0.0,1.0);\n            float revPercent = 1.0-realPercent;\n            \n            //SCALE\n            vec4 originalPosition = vec4(Position, 0, 1);\n            vec3 scaleDirectionVec = vec3(Position-Center,0);\n            \n            //ROTATE\n            vec3 thisRotation = Rotation * RotationMax;\n            mat3 rotMatrix = fastRotationMatrix(thisRotation * realPercent);\n            vec3 rotatedVec = scaleDirectionVec * rotMatrix;\n            vec4 position = vec4(Center,0,1) + vec4(rotatedVec,0) * doDiscard;\n            \n            vec3 thisSpeed = Speed * SpeedMax;\n            float l2r = -thisSpeed.x/abs(thisSpeed.x);\n            float reverseVector = l2r*(thisSpeed.x+abs(thisSpeed.y)) * realPercent/8.0;\n            \n            float speedMultiplier = 1.-pow(revPercent, 2.0);\n            vec3 dist = thisSpeed * speedMultiplier;\n            dist.x += reverseVector;\n            position.xyz += dist;\n            \n            float colorAdjust = abs((rotMatrix * vec3(0,0,1)).z);\n            \n            //output\n            gl_Position = MVPMatrix * position;\n            v_Color = vec4(vec3(colorAdjust), 1) * (revPercent*Opacity);\n            v_TexCoord = TexCoord;\n        }        ",fragment:"        \n        precision mediump float;\n        \n        uniform sampler2D Texture;\n        uniform float Opacity;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            \n            texColor *= v_Color;\n            \n            gl_FragColor = texColor;\n        }       "},fireworks:{attribNames:["Color","Speed","LifeSpan","Scale","ParticleTexCoord","Center","Position"],uniformNames:["Percent","PreviousPercent","Gravity","StartScale","ShouldSparkle","SparklePeriod","ParticleBurstTiming","PreviousParticleBurstTiming","SpeedMax","ParticleTexture","Opacity","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        uniform float   Percent;\n        uniform float   PreviousPercent;\n        uniform float   Gravity;\n        uniform float   StartScale;\n        uniform float   ShouldSparkle;\n        uniform float   SparklePeriod;\n        uniform float   ParticleBurstTiming;\n        uniform float   PreviousParticleBurstTiming;\n        uniform float   SpeedMax;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  ParticleTexCoord;\n        \n        attribute vec4  Color;\n        attribute vec3  Speed;\n        attribute vec2  LifeSpan;\n        attribute float Scale;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            realPercent = clamp(realPercent, 0.0, 1.0);\n            \n            float prevRealPercent = (PreviousPercent-LifeSpan.x)/LifeSpan.y;\n            prevRealPercent = clamp(prevRealPercent, 0.0,1.0);\n            \n            vec4 center = vec4(Center,0,1);\n            vec4 scaleDirectionVec = vec4(Position-Center,0,0);\n            \n            // TRANSLATE\n            vec3 translation = Speed * (SpeedMax * ParticleBurstTiming); // (1.0-pow(1.0-realPercent, ExplosionPower));\n            translation.y -= Gravity * (Percent - LifeSpan.x); // Gravity is in terms of global percent, not particle system percent\n            \n            vec3 prevTranslation = Speed * (SpeedMax * PreviousParticleBurstTiming);\n            prevTranslation.y -= Gravity * (PreviousPercent - LifeSpan.x); // Gravity is in terms of global percent, not particle system percent\n            \n            vec3 blurOffset = translation - prevTranslation; // Blur in direction of velocity\n            \n            // project centerVec onto translationOffset to get direction\n            blurOffset *= (dot(blurOffset, scaleDirectionVec.xyz) >= 0.0 ? 1.0 : -1.0);\n            \n            center.xyz += translation;\n            \n            // SCALE\n            float scalePercent = (1.0-(1.0-realPercent)*(1.0-realPercent));\n            float scaleAdjust = mix(StartScale, Scale, scalePercent);\n            // scale down to zero, unless we're sparkling\n            scaleAdjust *= (ShouldSparkle>0.5 ? 0.25 : 1.0-scalePercent);\n            vec4 position = center + scaleDirectionVec * scaleAdjust;\n            position += vec4(blurOffset,0);\n            \n            // SPARKLE\n            float sparkleOpacity = fract(realPercent*realPercent * SparklePeriod);\n            sparkleOpacity = smoothstep(0.0, 1.0, sparkleOpacity);\n            \n            // COLOR\n            vec4 color = mix(vec4(1), Color, scalePercent * (ShouldSparkle<0.5 ? 1.0 : 0.5)); // white to color\n            color *= (ShouldSparkle<0.5 ? 1.0 : sparkleOpacity); // apply sparkle opacity\n            color *= (realPercent>=1.0 ? 0.0 : 1.0);\n            v_Color = color;\n            \n            gl_Position = MVPMatrix * position;\n            v_TexCoord = ParticleTexCoord;\n        }        ",fragment:"        \n        precision mediump float;\n        \n        uniform sampler2D ParticleTexture;\n        uniform float Opacity;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        //varying float particleTexPercent;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color * Opacity;\n            //texColor.a *= Opacity;\n            \n            //texColor = vec4(v_TexCoord, 0, 1);\n            \n            gl_FragColor = texColor;\n        }        "},fireworkstrails:{attribNames:["Position","TexCoord"],uniformNames:["Texture","Opacity","NoiseAmount","NoiseSeed","NoiseMax","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        attribute vec2  Position;\n        attribute vec2  TexCoord;\n        \n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            gl_Position = MVPMatrix * vec4(Position, 0,1);\n            v_TexCoord = TexCoord;\n        }        ",fragment:"        precision mediump float;\n        \n        uniform sampler2D Texture;\n        uniform float Opacity;\n        uniform float NoiseAmount;\n        uniform vec2 NoiseSeed;\n        uniform float NoiseMax;\n        \n        //varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        //varying float particleTexPercent;\n        \n        float rand(vec2 co){\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n        }\n        \n        float inverseSquare(float a) {\n            return 1.0-(1.0-a)*(1.0-a);\n        }\n        \n        void main()\n        {\n            vec4 texColor = texture2D(Texture, v_TexCoord);\n            \n            //texColor = bloom(texColor);\n            \n            // Dither transparency to add noise\n            float randomNoise = NoiseMax*rand(v_TexCoord*NoiseSeed);\n            float randomAmount = NoiseAmount * 1.5*max(0.0, texColor.a-0.3333);\n            \n            float thisOpacity = Opacity * mix(1.0, randomNoise, randomAmount);\n            texColor *= thisOpacity;\n            \n            //texColor = vec4(v_TexCoord, 0, 1);\n            \n            gl_FragColor = texColor;\n        }        "},horizontalGaussianBlur:{attribNames:["Position"],uniformNames:["Texture","TextureSize","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        attribute vec2  Position;\n        \n        void main()\n        {\n            gl_Position = MVPMatrix * vec4(Position, 0, 1);\n        }        ",fragment:"        precision highp float;\n        \n        uniform sampler2D Texture;\n        uniform vec2 TextureSize;\n        \n        const vec2 offset1 = vec2(1.3846153846, 0);\n        const vec2 offset2 = vec2(3.2307692308, 0);\n        const float weight0 = 0.2270270270;\n        const float weight1 = 0.3162162162;\n        const float weight2 = 0.0702702703;\n        \n        void main()\n        {\n            vec4 color = texture2D(Texture, gl_FragCoord.xy*TextureSize) * weight0;\n            \n            color += texture2D(Texture, (gl_FragCoord.xy + offset1)*TextureSize) * weight1;\n            color += texture2D(Texture, (gl_FragCoord.xy - offset1)*TextureSize) * weight1;\n            \n            color += texture2D(Texture, (gl_FragCoord.xy + offset2)*TextureSize) * weight2;\n            color += texture2D(Texture, (gl_FragCoord.xy - offset2)*TextureSize) * weight2;\n            \n            gl_FragColor = color;\n        }        "},verticalGaussianBlur:{attribNames:["Position"],uniformNames:["Texture","TextureSize","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        attribute vec2  Position;\n        \n        void main()\n        {\n            gl_Position = MVPMatrix * vec4(Position, 0, 1);\n        }        ",fragment:"        precision highp float;\n        \n        uniform sampler2D Texture;\n        uniform vec2 TextureSize;\n        \n        const vec2 offset1 = vec2(0, 1.3846153846);\n        const vec2 offset2 = vec2(0, 3.2307692308);\n        const float weight0 = 0.2270270270;\n        const float weight1 = 0.3162162162;\n        const float weight2 = 0.0702702703;\n        \n        void main()\n        {\n            vec4 color = texture2D(Texture, gl_FragCoord.xy*TextureSize) * weight0;\n            \n            color += texture2D(Texture, (gl_FragCoord.xy + offset1)*TextureSize) * weight1;\n            color += texture2D(Texture, (gl_FragCoord.xy - offset1)*TextureSize) * weight1;\n            \n            color += texture2D(Texture, (gl_FragCoord.xy + offset2)*TextureSize) * weight2;\n            color += texture2D(Texture, (gl_FragCoord.xy - offset2)*TextureSize) * weight2;\n            \n            gl_FragColor = color;\n        }        "},bloom:{attribNames:["Position","TexCoord"],uniformNames:["Texture","BlurTexture","BloomAmount","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        \n        attribute vec2  Position;\n        attribute vec2  TexCoord;\n        \n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            v_TexCoord = TexCoord;\n            gl_Position = MVPMatrix * vec4(Position, 0, 1);\n        }        ",fragment:"        precision mediump float;\n        \n        uniform sampler2D Texture;\n        uniform sampler2D BlurTexture;\n        uniform float BloomAmount;\n        \n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 color = texture2D(Texture, v_TexCoord);\n            vec4 blurColor = texture2D(BlurTexture, v_TexCoord);\n            \n            color += (blurColor + color) * BloomAmount;\n            gl_FragColor = color;\n        }        "},shimmerObject:{attribNames:["Position","Center","TexCoord","Color","Speed"],uniformNames:["Percent","Opacity","RotationMatrix","SpeedMax","Texture","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4 MVPMatrix;\n        uniform float   Percent;\n        uniform float   Opacity;\n        \n        uniform mat3  RotationMatrix;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  TexCoord;\n        attribute vec4  Color;\n        \n        attribute vec3    Speed;\n        uniform float    SpeedMax;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        void main()\n        {\n            float thisPercent = Percent;\n            float invPercent = 1.0-thisPercent;\n            float thisPercent2 = thisPercent*thisPercent;\n            \n            /* CENTER */\n            vec3 scaleDirectionVec = vec3((Position.x-Center.x),(Position.y-Center.y),0);\n            \n            /* ROTATE */\n            vec3 rotatedVec = RotationMatrix * scaleDirectionVec.xyz;\n            \n            /* SCALE */\n            float scale = invPercent;\n            vec4 position = vec4(Center.xy,0,1) + vec4(rotatedVec,0) * scale;\n            \n            vec3 thisSpeed = Speed * SpeedMax;\n            position.xyz += thisSpeed * thisPercent*(3.0 + mix(thisPercent2*thisPercent, 1.0-invPercent*invPercent, thisPercent2));\n            \n            vec4 outColor = Color;\n            outColor = vec4(Opacity);\n            \n            /* output */\n            gl_Position = MVPMatrix * position;\n            v_Color = outColor;\n            v_TexCoord = TexCoord;\n        }\n        ",fragment:"        precision mediump float;\n        \n        uniform sampler2D Texture;\n        \n        varying vec4 v_Color;\n\t\tvarying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 color = texture2D(Texture, v_TexCoord);\n            \n            color *= v_Color;\n            \n            gl_FragColor = color;\n        }        "},shimmerParticle:{attribNames:["Position","Center","ParticleTexCoord","Color","LifeSpan","Speed","Scale"],uniformNames:["Percent","Opacity","ParticleScalePercent","RotationMatrix","SpeedMax","ParticleTexture","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4    MVPMatrix;\n        uniform float   Percent;\n        uniform float   Opacity;\n        \n        uniform float   ParticleScalePercent;\n        uniform mat3    RotationMatrix;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        attribute vec2  ParticleTexCoord;\n        attribute vec4  Color;\n        attribute vec2  LifeSpan;\n        \n        attribute vec3  Speed;\n        uniform float   SpeedMax;\n        attribute float Scale;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        float scaleUpDown(float x) {\n            float result = 1.0 - abs(2.0*(x-0.5));\n            result *= result;\n            return result;\n        }\n        \n        void main()\n        {\n            /* LIFESPAN */\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            float doDiscard = (realPercent > 1.0 || realPercent < 0.0) ? 0.0 : 1.0;\n            realPercent = clamp(realPercent, 0.0,1.0);\n            float realPercent2 = realPercent*realPercent;\n            float invPercent2 = 1.0-realPercent;\n            invPercent2 *= invPercent2;\n            \n            vec3 scaleDirectionVec = vec3((Position.x-Center.x),(Position.y-Center.y),0);\n            \n            /* ROTATE */\n            vec3 rotatedVec = RotationMatrix * scaleDirectionVec.xyz;\n            \n            /* SCALE */\n            float scalePercent = (LifeSpan.x <= 0.001 ? ParticleScalePercent : scaleUpDown(realPercent));\n            float scale = scalePercent * Scale * doDiscard;\n            vec4 position = vec4(Center,0,1) + vec4(rotatedVec,0) * scale;\n            \n            vec3 thisSpeed = Speed * SpeedMax;\n            position.xyz += thisSpeed * realPercent*(3.0 + mix(realPercent*realPercent2, 1.0-invPercent2, realPercent2));\n            \n            // Only adjust opacity on particles that last the duration of the animation\n            float thisOpacity = (LifeSpan.x <= 0.001 ? Opacity : 1.0);\n            vec4 color = vec4(Color.rgb, 1) * thisOpacity;\n            \n\t        v_Color = color;\n            v_TexCoord = ParticleTexCoord;\n\t        gl_Position = MVPMatrix * position;\n        }\n        ",fragment:"        precision mediump float;\n        \n        uniform sampler2D ParticleTexture;\n        \n        varying vec4 v_Color;\n\t\tvarying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 color = texture2D(ParticleTexture, v_TexCoord);\n            \n            color *= v_Color;\n            \n            gl_FragColor = color;\n        }        "},sparkle:{attribNames:["Scale","LifeSpan","Speed","ParticleTexCoord","Center","Position"],uniformNames:["Percent","Opacity","Color","SpeedMax","ParticleTexture","MVPMatrix"],vertex:"        \n        precision highp float;\n        \n        uniform mat4    MVPMatrix;\n        uniform float   Percent;\n        \n        attribute vec2  Position;\n        attribute vec2  Center;\n        uniform float   Opacity;\n        attribute vec2  ParticleTexCoord;\n        uniform vec4    Color;\n        \n        attribute mediump vec3    Speed;\n        uniform mediump float    SpeedMax;\n        attribute mediump float   Scale;\n        attribute mediump vec2    LifeSpan;\n        \n        varying vec4    v_Color;\n        varying vec2    v_TexCoord;\n        \n        float ReverseSquareOfFloat(float f) {\n            return 1.0 - (1.0-f)*(1.0-f);\n        }\n        \n        void main()\n        {\n            float doDiscard = 0.0;\n            float realPercent = (Percent-LifeSpan.x)/LifeSpan.y;\n            if (realPercent < 0.0 || realPercent > 1.0) {\n                doDiscard = 1.0;\n                realPercent = 1.0;\n            }\n            \n            vec4 position;\n            vec4 scaleDirectionVec = vec4((Position.x-Center.x),(Position.y-Center.y),0,0);\n            \n            // SCALE\n            float scaleAdjust = realPercent;\n            if (scaleAdjust < 0.1) {\n                scaleAdjust /= 0.1;\n                scaleAdjust = sqrt(scaleAdjust);\n            } else {\n                scaleAdjust = 1.0-(scaleAdjust-0.1)/0.9;\n                scaleAdjust = scaleAdjust*scaleAdjust*scaleAdjust;\n            }\n            scaleAdjust *= (doDiscard==0.0 ? 1.0 : 0.0);\n            position = vec4(Center,0,1) + scaleDirectionVec * scaleAdjust * Scale;\n            \n            // POSITION\n            vec3 thisSpeed = Speed * SpeedMax;\n            position += vec4(thisSpeed, 0) * realPercent;\n            \n            float invPercent = 1.0 - realPercent;\n            vec3 rgbColor = mix(Color.rgb, vec3(1,1,1), invPercent*invPercent*invPercent);\n            \n            /* output */\n            gl_Position = MVPMatrix * position;\n            v_Color = vec4(rgbColor, (1.0-realPercent*realPercent)*Opacity);\n            v_TexCoord = ParticleTexCoord;\n        }        ",fragment:"        \n        precision mediump float;\n        \n        uniform sampler2D ParticleTexture;\n        \n        varying vec4 v_Color;\n        varying vec2 v_TexCoord;\n        \n        void main()\n        {\n            vec4 texColor = texture2D(ParticleTexture, v_TexCoord);\n            \n            texColor *= v_Color;\n            \n            gl_FragColor = texColor;\n        }        "}},KNWebGLUtil={setupProgram:function(e,t){for(var i=KNWebGLShader[t],r=this.loadShader(e,e.VERTEX_SHADER,i.vertex),a=this.loadShader(e,e.FRAGMENT_SHADER,i.fragment),n=this.createShaderProgram(e,r,a),o={},s={},l=0,h=i.uniformNames.length;l<h;l++){var c=i.uniformNames[l];s[c]=e.getUniformLocation(n,c)}for(l=0,h=i.attribNames.length;l<h;l++){var u=i.attribNames[l];o[u]=e.getAttribLocation(n,u)}var d={shaderProgram:n,uniforms:s,attribs:o};return e.useProgram(n),d},loadShader:function(e,t,i){var r=e.createShader(t);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(r);return console.log("*** Error compiling shader '"+r+"':"+a),e.deleteShader(r),null}return r},createShaderProgram:function(e,t,i){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)){var a=e.getProgramInfoLog(r);console.log("Error in program linking:"+a),e.deleteProgram(r)}return r},createTexture:function(e,t){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},bindTextureWithImage:function(e,t){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},bindDynamicBufferWithData:function(e,t,i,r,a){e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.DYNAMIC_DRAW),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,a,e.FLOAT,!1,0,0)},bindBufferWithData:function(e,t,i,r,a,n){e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),n),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,a,e.FLOAT,!1,0,0)},setPoint2DAtIndexForAttribute:function(e,t,i){i[2*t]=e.x,i[2*t+1]=e.y,i.size=2},setPoint3DAtIndexForAttribute:function(e,t,i){i[3*t]=e.x,i[3*t+1]=e.y,i[3*t+2]=e.z,i.size=3},setPoint4DAtIndexForAttribute:function(e,t,i){i[4*t]=e.x,i[4*t+1]=e.y,i[4*t+2]=e.z,i[4*t+3]=e.w,i.size=4},setFloatAtIndexForAttribute:function(e,t,i){i[t]=e},getPoint2DForArrayAtIndex:function(e,t){var i={};return i.x=e[2*t],i.y=e[2*t+1],i},getPoint3DForArrayAtIndex:function(e,t){var i={};return i.x=e[3*t],i.y=e[3*t+1],i.z=e[3*t+2],i},getPoint4DForArrayAtIndex:function(e,t){var i={};return i.x=e[4*t],i.y=e[4*t+1],i.z=e[4*t+2],i.w=e[4*t+3],i},bindAllAvailableAttributesToBuffers:function(e,t,i,r,a,n){for(var o in t){var s=t[o];void 0===a[o]&&(a[o]=e.createBuffer()),KNWebGLUtil.bindBufferWithData(e,s,a[o],i[o],r[o],n)}},enableAttribs:function(e,t){var i=t.attribs;for(var r in e.useProgram(t.shaderProgram),i)e.enableVertexAttribArray(i[r])}},WebGraphics={makePoint:function(e,t){var i={};return i.x=e,i.y=t,i},makePoint3D:function(e,t,i){var r={};return r.x=e,r.y=t,r.z=i,r},makePoint4D:function(e,t,i,r){var a={};return a.x=e,a.y=t,a.z=i,a.w=r,a},makeRect:function(e,t,i,r){var a={};return a.x=e,a.y=t,a.width=i,a.height=r,a},makeSize:function(e,t){var i={};return i.width=e,i.height=t,i},setOrigin:function(e,t){return e.x=t.x,e.y=t.y,e},multiplyPoint3DByScalar:function(e,t){var i={};return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i},multiplyPoint4DByScalar:function(e,t){var i={};return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i},addPoint3DToPoint3D:function(e,t){var i={};return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i},point3DNormalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i={};return i.z=e.z/t,i.y=e.y/t,i.x=e.x/t,i},randomBetween:function(e,t){var i=Math.random();return i*=t-e,i+=e},doubleBetween:function(e,t){var i,r,a=0;e<t?(i=e,r=t):(i=t,r=e);var n=Math.random(),o=r*n,s=i*n;return i>=0==r>=0?(a=o-s,a+=i):(a=o+i,a-=s),a},mix:function(e,t,i){return e*(1-i)+t*i},clamp:function(e,t,i){return Math.min(Math.max(e,t),i)},sineMap:function(e){return.5*(Math.sin(e*Math.PI-Math.PI/2)+1)},createMatrix4:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},makeIdentityMatrix4:function(){return WebGraphics.createMatrix4()},makeOrthoMatrix4:function(e,t,i,r,a,n){var o=new Float32Array(16),s=t-e,l=r-i,h=n-a;return o[0]=2/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/h,o[11]=0,o[12]=-(t+e)/s,o[13]=-(r-i)/l,o[14]=-(n+a)/h,o[15]=1,o},makeFrustumMatrix4:function(e,t,i,r,a,n){var o=t-e,s=r-i,l=n-a,h=new Float32Array(16);return h[0]=2*a/o,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*a/s,h[6]=0,h[7]=0,h[8]=(t+e)/o,h[9]=(r+i)/s,h[10]=-(n+a)/l,h[11]=-1,h[12]=0,h[13]=0,h[14]=-2*n*a/l,h[15]=0,h},makePerspectiveMatrix4:function(e,t,i,r){var a=i*Math.tan(e*Math.PI/360),n=a*t;return WebGraphics.makeFrustumMatrix4(-n,n,-a,a,i,r)},multiplyMatrix4:function(e,t){var i=new Float32Array(16),r=e[0],a=e[4],n=e[8],o=e[12],s=e[1],l=e[5],h=e[9],c=e[13],u=e[2],d=e[6],f=e[10],m=e[14],p=e[3],A=e[7],v=e[11],g=e[15],y=t[0],b=t[4],S=t[8],x=t[12],C=t[1],w=t[5],P=t[9],T=t[13],k=t[2],D=t[6],E=t[10],B=t[14],M=t[3],I=t[7],F=t[11],L=t[15];return i[0]=r*y+a*C+n*k+o*M,i[4]=r*b+a*w+n*D+o*I,i[8]=r*S+a*P+n*E+o*F,i[12]=r*x+a*T+n*B+o*L,i[1]=s*y+l*C+h*k+c*M,i[5]=s*b+l*w+h*D+c*I,i[9]=s*S+l*P+h*E+c*F,i[13]=s*x+l*T+h*B+c*L,i[2]=u*y+d*C+f*k+m*M,i[6]=u*b+d*w+f*D+m*I,i[10]=u*S+d*P+f*E+m*F,i[14]=u*x+d*T+f*B+m*L,i[3]=p*y+A*C+v*k+g*M,i[7]=p*b+A*w+v*D+g*I,i[11]=p*S+A*P+v*E+g*F,i[15]=p*x+A*T+v*B+g*L,i},scaleMatrix4:function(e,t,i,r){var a=WebGraphics.createMatrix4();return a[0]=t,a[5]=i,a[10]=r,WebGraphics.multiplyMatrix4(e,a)},translateMatrix4:function(e,t,i,r){var a=WebGraphics.createMatrix4();return a[12]=t,a[13]=i,a[14]=r,WebGraphics.multiplyMatrix4(e,a)},rotateMatrix4AboutXYZ:function(e,t,i,r,a){var n=WebGraphics.makePoint3D(i,r,a),o=(n=WebGraphics.point3DNormalize(n)).x,s=n.y,l=n.z,h=Math.cos(t),c=1-h,u=Math.sin(t),d=WebGraphics.createMatrix4();return d[0]=h+o*o*c,d[1]=o*s*c+l*u,d[2]=l*o*c-s*u,d[4]=o*s*c-l*u,d[5]=h+s*s*c,d[6]=l*s*c+o*u,d[8]=o*s*c+s*u,d[9]=s*l*c-o*u,d[10]=h+l*l*c,WebGraphics.multiplyMatrix4(e,d)},colorWithHSBA:function(e,t,i,r){var a,n,o,s,l,h,c,u,d={hue:e,saturation:t,brightness:i,alpha:r};switch(1===e&&(e=0),o=i*(1-t),s=i*(1-t*(n=(a=6*e)-Math.floor(a))),l=i*(1-t*(1-n)),parseInt(a)){case 0:h=i,u=l,c=o;break;case 1:h=s,u=i,c=o;break;case 2:h=o,u=i,c=l;break;case 3:h=o,u=s,c=i;break;case 4:h=l,u=o,c=i;break;case 5:h=i,u=o,c=s}return d.red=h,d.blue=c,d.green=u,d},makeMat3WithAffineTransform:function(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}},Vector3=function(e){this.create(e)};Vector3.prototype={create:function(e){var t=this.$matrix={};e?(t.m11=e[0],t.m12=e[1],t.m13=e[2]):(t.m11=0,t.m12=0,t.m13=0)},subtract:function(e){var t=this.$matrix,i=e.$matrix;t.m11-=i.m11,t.m12-=i.m12,t.m13-=i.m13},add:function(e){var t=this.$matrix,i=e.$matrix;t.m11+=i.m11,t.m12+=i.m12,t.m13+=i.m13},normalize:function(){var e=this.$matrix,t=Math.sqrt(e.m11*e.m11+e.m12*e.m12+e.m13*e.m13);t>0&&(e.m11/=t,e.m12/=t,e.m13/=t)},scale:function(e){var t=this.$matrix;t.m11*=e,t.m12*=e,t.m13*=e},cross:function(e){var t=this.$matrix,i=e.$matrix,r=i.m11,a=i.m12,n=i.m13,o=t.m11,s=t.m12,l=t.m13;t.m11=s*n-l*a,t.m12=l*r-o*n,t.m13=o*a-s*r},getArray:function(){var e=this.$matrix;return[e.m11,e.m12,e.m13]}};var Matrix3=function(){this.identity()};Matrix3.prototype={identity:function(){this.$matrix={m11:1,m12:0,m13:0,m21:0,m22:1,m23:0,m31:0,m32:0,m33:1}},affineScale:function(e,t){var i=this.$matrix;i.m11=e,i.m22=t},affineTranslate:function(e,t){var i=this.$matrix;i.m13=e,i.m23=t},transformTranslate:function(e,t){var i=new Matrix3;i.affineTranslate(e,t),this.multiply(i.getArray())},multiply:function(e){var t=this.$matrix,i=t.m11,r=t.m12,a=t.m13,n=t.m21,o=t.m22,s=t.m23,l=t.m31,h=t.m32,c=t.m33;t.m11=i*e[0]+r*e[3]+a*e[6],t.m12=i*e[1]+r*e[4]+a*e[7],t.m13=i*e[2]+r*e[5]+a*e[8],t.m21=n*e[0]+o*e[3]+s*e[6],t.m22=n*e[1]+o*e[4]+s*e[7],t.m23=n*e[2]+o*e[5]+s*e[8],t.m31=l*e[0]+h*e[3]+c*e[6],t.m32=l*e[1]+h*e[4]+c*e[7],t.m33=l*e[2]+h*e[5]+c*e[8]},getArray:function(){var e=this.$matrix;return[e.m11,e.m12,e.m13,e.m21,e.m22,e.m23,e.m31,e.m32,e.m33]},getFloat32Array:function(){return new Float32Array(this.getArray())},getColumnMajorArray:function(){var e=this.$matrix;return[e.m11,e.m21,e.m31,e.m12,e.m22,e.m32,e.m13,e.m23,e.m33]},getColumnMajorFloat32Array:function(){return new Float32Array(this.getColumnMajorArray())}};var Matrix4=function(){this.identity()};function TSUMix(e,t,i){return e+(t-e)*i}function TSUSineMap(e){return.5*(Math.sin(e*Math.PI-Math.PI/2)+1)}function TwistFX(e,t){var i=4/10.25,r=(1+i)*t-i*e;return r<0?0:r>1?1:TSUSineMap(r)}function CGAffineTransformMakeRotation(e){var t,i;return t=Math.sin(e),[i=Math.cos(e),t,-t,i,0,0]}function CGAffineTransformEqualToTransform(e,t){return e.a===t.a&&e.b===t.b&&e.c===t.c&&e.d===t.d&&e.tx===t.tx&&e.ty===t.ty}function CATransform3DEqualToTransform(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function CGPointMake(e,t){return{x:e,y:t}}function CGRectIntersection(e,t){var i,r,a,n,o={origin:{x:0,y:0},size:{width:0,height:0}};return(i=Math.max(e.origin.x,t.origin.x))>(r=Math.min(e.origin.x+e.size.width,t.origin.x+t.size.width))||(a=Math.max(e.origin.y,t.origin.y))>(n=Math.min(e.origin.y+e.size.height,t.origin.y+t.size.height))||(o.origin.x=i,o.size.width=r-i,o.origin.y=a,o.size.height=n-a),o}function CGRectIntegral(e){var t={origin:{x:0,y:0},size:{width:0,height:0}};return t.origin.x=Math.floor(e.origin.x),t.origin.y=Math.floor(e.origin.y),t.size.width=Math.ceil(e.origin.x+e.size.width)-t.origin.x,t.size.height=Math.ceil(e.origin.y+e.size.height)-t.origin.y,t}function CGRectGetMinX(e){return e.origin.x}function CGRectGetMinY(e){return e.origin.y}function CGRectGetMidX(e){return e.origin.x+e.size.width/2}function CGRectGetMidY(e){return e.origin.y+e.size.height/2}function CGRectGetMaxX(e){return e.origin.x+e.size.width}function CGRectGetMaxY(e){return e.origin.y+e.size.height}function CGRectEqualToRect(e,t){return e.origin.x===t.origin.x&&e.origin.y===t.origin.y&&e.size.width===t.size.width&&e.size.height===t.size.height}function CGRectMake(e,t,i,r){return{origin:{x:e,y:t},size:{width:i,height:r}}}function CGSizeMake(e,t){var i={};return i.width=e,i.height=t,i}function CGSizeEqualToSize(e,t){return e.width===t.width&&e.height===t.height}Matrix4.prototype={identity:function(){this.$matrix={m11:1,m12:0,m13:0,m14:0,m21:0,m22:1,m23:0,m24:0,m31:0,m32:0,m33:1,m34:0,m41:0,m42:0,m43:0,m44:1}},translate:function(e,t,i){var r=new Matrix4,a=r.$matrix;a.m14=e,a.m24=t,a.m34=i,this.multiply(r)},scale:function(e,t,i){var r=new Matrix4,a=r.$matrix;a.m11=e,a.m22=t,a.m33=i,this.multiply(r)},multiply:function(e){var t=this.$matrix,i=e.$matrix,r=i.m11*t.m11+i.m21*t.m12+i.m31*t.m13+i.m41*t.m14,a=i.m12*t.m11+i.m22*t.m12+i.m32*t.m13+i.m42*t.m14,n=i.m13*t.m11+i.m23*t.m12+i.m33*t.m13+i.m43*t.m14,o=i.m14*t.m11+i.m24*t.m12+i.m34*t.m13+i.m44*t.m14,s=i.m11*t.m21+i.m21*t.m22+i.m31*t.m23+i.m41*t.m24,l=i.m12*t.m21+i.m22*t.m22+i.m32*t.m23+i.m42*t.m24,h=i.m13*t.m21+i.m23*t.m22+i.m33*t.m23+i.m43*t.m24,c=i.m14*t.m21+i.m24*t.m22+i.m34*t.m23+i.m44*t.m24,u=i.m11*t.m31+i.m21*t.m32+i.m31*t.m33+i.m41*t.m34,d=i.m12*t.m31+i.m22*t.m32+i.m32*t.m33+i.m42*t.m34,f=i.m13*t.m31+i.m23*t.m32+i.m33*t.m33+i.m43*t.m34,m=i.m14*t.m31+i.m24*t.m32+i.m34*t.m33+i.m44*t.m34,p=i.m11*t.m41+i.m21*t.m42+i.m31*t.m43+i.m41*t.m44,A=i.m12*t.m41+i.m22*t.m42+i.m32*t.m43+i.m42*t.m44,v=i.m13*t.m41+i.m23*t.m42+i.m33*t.m43+i.m43*t.m44,g=i.m14*t.m41+i.m24*t.m42+i.m34*t.m43+i.m44*t.m44;t.m11=r,t.m12=a,t.m13=n,t.m14=o,t.m21=s,t.m22=l,t.m23=h,t.m24=c,t.m31=u,t.m32=d,t.m33=f,t.m34=m,t.m41=p,t.m42=A,t.m43=v,t.m44=g},perspective:function(e,t,i,r){var a=i*Math.tan(e*Math.PI/360),n=a*t;return this.frustum(-n,n,-a,a,i,r)},ortho:function(e,t,i,r,a,n){var o=t-e,s=r-i,l=n-a,h=this.$matrix;h.m11=2/o,h.m12=0,h.m13=0,h.m14=-(t+e)/o,h.m21=0,h.m22=2/s,h.m23=0,h.m24=-(r+i)/s,h.m31=0,h.m32=0,h.m33=-2/l,h.m34=-(n+a)/l,h.m41=0,h.m42=0,h.m43=0,h.m44=1},frustum:function(e,t,i,r,a,n){var o=t-e,s=r-i,l=n-a,h=this.$matrix;h.m11=2*a/o,h.m12=0,h.m13=(t+e)/o,h.m14=0,h.m21=0,h.m22=2*a/s,h.m23=(r+i)/s,h.m24=0,h.m31=0,h.m32=0,h.m33=-(n+a)/l,h.m34=-2*n*a/l,h.m41=0,h.m42=0,h.m43=-1,h.m44=0},getArray:function(){var e=this.$matrix;return[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44]},getFloat32Array:function(){return new Float32Array(this.getArray())},getColumnMajorArray:function(){var e=this.$matrix;return[e.m11,e.m21,e.m31,e.m41,e.m12,e.m22,e.m32,e.m42,e.m13,e.m23,e.m33,e.m43,e.m14,e.m24,e.m34,e.m44]},getColumnMajorFloat32Array:function(){return new Float32Array(this.getColumnMajorArray())}};var CGSizeZero={width:0,height:0},CGRectZero={origin:{x:0,y:0},size:{width:0,height:0}},TSDRectUnit={origin:{x:0,y:0},size:{width:1,height:1}};function TSDMixFloats(e,t,i){return e*(1-i)+t*i}function TSDCenterOfRect(e){return WebGraphics.makePoint(CGRectGetMidX(e),CGRectGetMidY(e))}function TSDPointFromNormalizedRect(e,t){return WebGraphics.makePoint(t.origin.x+e.x*t.size.width,t.origin.y+e.y*t.size.height)}function TSDRectWithPoints(e,t){var i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),a=Math.min(e.y,t.y);return CGRectMake(i,a,r-i,Math.max(e.y,t.y)-a)}function TSDGLColor(e,t,i,r){return{r:e,g:t,b:i,a:r}}var TSD8bitColorDenominator=.003906402593851;function TSDGLColor4fMakeWithUInt(e){return WebGraphics.makePoint4D(((16711680&e)>>16)*TSD8bitColorDenominator,((65280&e)>>8)*TSD8bitColorDenominator,(255&e)*TSD8bitColorDenominator,((4278190080&e)>>24)*TSD8bitColorDenominator)}function TSUReverseSquare(e){var t=1-e;return 1-t*t}function mvpMatrixWithInitialStateAffineTransform(e,t){var i=e.width,r=e.height,a={x:i/2,y:r/2},n=e.anchorPoint;.5===n.pointX&&.5===n.pointY||(a.x=n.pointX*i,a.y=(1-n.pointY)*r),t=WebGraphics.translateMatrix4(t,a.x,a.y,0);var o=e.rotation;0!==o&&(t=WebGraphics.rotateMatrix4AboutXYZ(t,-o,0,0,1));var s=e.scale;return 1!==s&&(t=WebGraphics.scaleMatrix4(t,s,s,1)),t=WebGraphics.translateMatrix4(t,-a.x,-a.y,0)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)};var kShaderUniformGravity="Gravity",kShaderUniformMaskTexture="MaskTexture",kShaderUniformNoiseAmount="NoiseAmount",kShaderUniformNoiseMax="NoiseMax",kShaderUniformNoiseSeed="NoiseSeed",kShaderUniformParticleBurstTiming="ParticleBurstTiming",kShaderUniformPreviousParticleBurstTiming="PreviousParticleBurstTiming",kShaderUniformPreviousPercent="PreviousPercent",kShaderUniformShouldSparkle="ShouldSparkle",kShaderUniformSparklePeriod="SparklePeriod",kShaderUniformSparkleStartTime="SparkleStartTime",kShaderUniformStartScale="StartScale",kShimmerUniformParticleScalePercent="ParticleScalePercent",kShimmerUniformRotationMatrix="RotationMatrix",KNSparkleMaxParticleLife=.667,KNWebGLRenderer=function(){function e(t){_classCallCheck(this,e);var i=this.canvas=t.canvas;this.canvasId=t.canvasId,this.textureAssets=t.textureAssets,this.durationMax=1e3*t.overallEndTime,this.glPrograms=[],this.elapsed=0;var r=this.gl=i.getContext("webgl")||i.getContext("experimental-webgl");r?(this.animationStarted=!1,r.viewportWidth=i.width,r.viewportHeight=i.height,this.initMVPMatrix(),this.coreAnimationWrapper=new KNWebGLCoreAnimationWrapper(r)):this.noGL=!0}return _createClass(e,[{key:"initMVPMatrix",value:function(){var e=this.gl,t=e.viewportWidth,i=e.viewportHeight,r=Math.PI/180*20,a=i/(2*Math.tan(r/2)),n=a-1.5*t,o=a+15*t;this.slideProjectionMatrix=WebGraphics.makePerspectiveMatrix4(20,t/i,Math.max(1,n),o);var s=WebGraphics.translateMatrix4(WebGraphics.createMatrix4(),-t/2,-i/2,-a);this.slideProjectionMatrix=WebGraphics.multiplyMatrix4(this.slideProjectionMatrix,s),this.slideOrthoMatrix=WebGraphics.makeOrthoMatrix4(0,t,0,i,-1,1)}},{key:"setupTexture",value:function(e){var t=[];this.textureInfoFromEffect(e.kpfLayer,e.name,{pointX:0,pointY:0},e.baseLayer.initialState.opacity,t);for(var i=0,r=t.length;i<r;i++){var a=t[i].textureId,n=this.textureAssets[a];t[i].texture=KNWebGLUtil.createTexture(this.gl,n);var o=t[i].toTextureId;if(o){var s=this.textureAssets[o];t[i].toTexture=KNWebGLUtil.createTexture(this.gl,s)}}return t}},{key:"textureInfoFromEffect",value:function(e,t,i,r,a){var n={};if(n.offset={pointX:i.pointX+e.bounds.offset.pointX,pointY:i.pointY+e.bounds.offset.pointY},n.parentOpacity=r,e.textureId){n.textureId=e.textureId,n.width=e.bounds.width,n.height=e.bounds.height,n.initialState=e.initialState,n.hasHighlightedBulletAnimation=e.hasHighlightedBulletAnimation,n.texturedRectangle=e.texturedRectangle;var o=e.animations;if(o&&o.length>0){var s=o[0];if("contents"===s.property)n.toTextureId=s.to.texture;else if(!s.property){var l=s.animations;if(l)for(var h=0,c=l.length;h<c;h++){var u=l[h];if("contents"===u.property){n.toTextureId=u.to.texture;break}}}}n.animations=o,n.textureRect={origin:{x:n.offset.pointX,y:n.offset.pointY},size:{width:n.width,height:n.height}},a.push(n)}else for(h=0,c=e.layers.length;h<c;h++)this.textureInfoFromEffect(e.layers[h],t,n.offset,n.parentOpacity,a)}},{key:"draw",value:function(e){var t,i={effect:e,textures:this.setupTexture(e)},r=e.type;if("transition"===r)switch(e.name){case"apple:wipe-iris":t=new KNWebGLTransitionIris(this,i);break;case"com.apple.iWork.Keynote.BUKTwist":t=new KNWebGLTransitionTwist(this,i);break;case"com.apple.iWork.Keynote.KLNColorPlanes":t=new KNWebGLTransitionColorPlanes(this,i);break;case"com.apple.iWork.Keynote.BUKFlop":t=new KNWebGLTransitionFlop(this,i);break;case"com.apple.iWork.Keynote.KLNConfetti":t=new KNWebGLTransitionConfetti(this,i);break;case"apple:magic-move-implied-motion-path":t=new KNWebGLTransitionMagicMove(this,i);break;case"apple:ca-text-shimmer":t=new KNWebGLTransitionShimmer(this,i);break;case"apple:ca-text-sparkle":t=new KNWebGLTransitionSparkle(this,i);break;default:t=new KNWebGLDissolve(this,i)}else if("buildIn"===r||"buildOut"===r)switch(e.name){case"apple:wipe-iris":t=new KNWebGLBuildIris(this,i);break;case"com.apple.iWork.Keynote.BUKAnvil":t=new KNWebGLBuildAnvil(this,i);break;case"com.apple.iWork.Keynote.KLNFlame":t=new KNWebGLBuildFlame(this,i);break;case"com.apple.iWork.Keynote.KNFireworks":t=new KNWebGLBuildFireworks(this,i);break;case"com.apple.iWork.Keynote.KLNConfetti":t=new KNWebGLBuildConfetti(this,i);break;case"com.apple.iWork.Keynote.KLNDiffuse":t=new KNWebGLBuildDiffuse(this,i);break;case"com.apple.iWork.Keynote.KLNShimmer":t=new KNWebGLBuildShimmer(this,i);break;case"com.apple.iWork.Keynote.KLNSparkle":t=new KNWebGLBuildSparkle(this,i);break;default:t=new KNWebGLDissolve(this,i)}else if("smartBuild"===r)if("apple:gallery-dissolve"===e.name)t=new KNWebGLContents(this,i);else t=new KNWebGLDissolve(this,i);this.removeProgram(e.objectID),this.glPrograms.push(t)}},{key:"animate",value:function(){var e=new Date,t=0;if(this.time){var i=e.getTime();t=i-this.time,this.time=i}else t=0,this.time=e.getTime();this.elapsed+=t;var r=this.glPrograms,a=r.length;if(this.elapsed<=this.durationMax)this.animationRequest=window.requestAnimFrame(this.animate.bind(this));else for(var n=0;n<a;n++){(s=r[n]).isCompleted=!0}var o=this.gl;o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(n=0;n<a;n++){var s;(s=r[n]).drawFrame(t,this.elapsed,s.duration)}}},{key:"removeProgram",value:function(e){for(var t=this.glPrograms,i=t.length;i--;){t[i].effect.objectID===e&&t.splice(i,1)}}},{key:"resize",value:function(e){var t=this.gl,i=e.width,r=e.height;t.viewportWidth===i&&t.viewportHeight===r||(t.viewport(0,0,i,r),t.viewportWidth=i,t.viewportHeight=r)}}]),e}(),KNWebGLProgram=function(){function e(t,i){_classCallCheck(this,e),this.renderer=t,this.gl=t.gl,this.textures=i.textures;var r=this.effect=i.effect,a=this.type=r.type;this.direction=r.attributes?r.attributes.direction:null,this.duration=1e3*r.duration,this.buildOut="buildOut"===a,this.buildIn="buildIn"===a,this.program={},this.isCompleted=!1,i.programNames&&this.setupProgram(i)}return _createClass(e,[{key:"setupProgram",value:function(e){for(var t=this.gl,i=0,r=e.programNames.length;i<r;i++){var a=e.programNames[i];this.program[a]=KNWebGLUtil.setupProgram(t,a)}t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)}}]),e}(),KNWebGLContents=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"contents",effect:r.effect,textures:r.textures};return(a=t.call(this,e,n)).programData=n,a.percentfinished=0,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.textures[0].textureRect,r=CGRectMake(0,0,i.size.width,i.size.height),a=CGSizeMake(2,2),n=this.contentsShader=new TSDGLShader(t);n.initWithContentsShader(),n.setMat4WithTransform3D(e.slideProjectionMatrix,kTSDGLShaderUniformMVPMatrix),n.setGLint(0,kTSDGLShaderUniformTexture2),n.setGLint(1,kTSDGLShaderUniformTexture),(this.contentsDataBuffer=new TSDGLDataBuffer(t)).initWithVertexRect(r,TSDRectUnit,a,!1,!1)}},{key:"drawFrame",value:function(e,t,i){this.renderer,this.gl;var r=this.percentfinished;(r+=e/i)>=1&&(r=1,this.isCompleted=!0),this.percentfinished=r,this.p_drawContents(r)}},{key:"p_drawContents",value:function(e){var t=this.gl,i=this.textures,r=i[0].texture,a=i[1].texture,n=TSUSineMap(e);e>=1&&(n=1),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),this.contentsShader.setGLFloat(n,"mixFactor"),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.contentsDataBuffer.drawWithShader(this.contentsShader,!0)}}]),i}(),KNWebGLDrawable=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"WebDrawable",programNames:["defaultTextureAndOpacity"],effect:r.effect,textures:r.textures};return(a=t.call(this,e,n)).programData=n,a.Opacity=1,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.defaultTextureAndOpacity,r=(i.uniforms,i.attribs,this.textures[0]);t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var a=this.textureCoordinateBuffer=t.createBuffer(),n=this.textureCoordinates=[0,0,0,1,1,0,1,1];t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);var o=this.positionBuffer=t.createBuffer(),s=this.boxPosition=[0,0,0,0,r.height,0,r.width,0,0,r.width,r.height,0];t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.MVPMatrix=WebGraphics.translateMatrix4(e.slideProjectionMatrix,r.offset.pointX,t.viewportHeight-r.offset.pointY-r.height,0)}},{key:"drawFrame",value:function(){this.renderer;var e=this.gl,t=this.program.defaultTextureAndOpacity,i=t.uniforms,r=t.attribs,a=this.textures[0].texture;e.useProgram(t.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordinateBuffer),e.vertexAttribPointer(r.TexCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.TexCoord),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.vertexAttribPointer(r.Position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.Position),e.uniformMatrix4fv(i.MVPMatrix,!1,this.MVPMatrix),e.uniform1f(i.Opacity,this.Opacity),e.activeTexture(e.TEXTURE0),e.uniform1i(i.Texture,0),e.bindTexture(e.TEXTURE_2D,a),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}]),i}(),KNWebGLFramebufferDrawable=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=e.gl,o=r.frameRect,s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,o.size.width,o.size.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null);var l={width:o.size.width,height:o.size.height,offset:{pointX:0,pointY:0},texture:s},h={name:"FramebufferDrawable",programNames:["defaultTexture"],effect:r.effect,textures:[l]};return(a=t.call(this,e,h)).frameRect=o,a.texture=s,a.programData=h,a.buffer=a.createFramebuffer(n,s),a.drawableFrame=r.drawableFrame,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"createFramebuffer",value:function(e,t){var i=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),i}},{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.defaultTexture,r=(i.uniforms,i.attribs,this.textures[0]);t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var a=this.textureCoordinateBuffer=t.createBuffer(),n=this.textureCoordinates=[0,1,0,0,1,1,1,0];t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);var o=this.positionBuffer=t.createBuffer(),s=this.boxPosition=[0,0,0,0,r.height,0,r.width,0,0,r.width,r.height,0];t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.MVPMatrix=WebGraphics.translateMatrix4(e.slideProjectionMatrix,r.offset.pointX,t.viewportHeight-r.offset.pointY-r.height,0)}},{key:"drawFrame",value:function(){this.renderer;var e=this.gl,t=this.program.defaultTexture,i=t.uniforms,r=t.attribs,a=this.textures[0].texture;e.useProgram(t.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordinateBuffer),e.vertexAttribPointer(r.TexCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.TexCoord),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.vertexAttribPointer(r.Position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.Position),e.uniformMatrix4fv(i.MVPMatrix,!1,this.MVPMatrix),e.activeTexture(e.TEXTURE0),e.uniform1i(i.Texture,0),e.bindTexture(e.TEXTURE_2D,a),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}]),i}(),KNWebGLDissolve=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"dissolve",programNames:["defaultTextureAndOpacity"],effect:r.effect,textures:r.textures};return(a=t.call(this,e,n)).programData=n,a.percentfinished=0,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.defaultTextureAndOpacity,r=(i.uniforms,i.attribs,this.textures[0]);t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var a=this.textureCoordinateBuffer=t.createBuffer(),n=this.textureCoordinates=[0,0,0,1,1,0,1,1];t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);var o=this.positionBuffer=t.createBuffer(),s=this.boxPosition=[0,0,0,0,r.height,0,r.width,0,0,r.width,r.height,0];t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.MVPMatrix=WebGraphics.translateMatrix4(e.slideProjectionMatrix,r.offset.pointX,t.viewportHeight-(r.offset.pointY+r.height),0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){var r=this.percentfinished;(r+=e/i)>1&&(r=1);var a=TSUSineMap(r);1===r&&(a=1),this.buildOut&&(a=1-a),this.percentfinished=r,this.percentAlpha=a,this.draw()}},{key:"draw",value:function(){this.renderer;var e,t=this.gl,i=this.program.defaultTextureAndOpacity,r=i.uniforms,a=i.attribs,n=this.textures,o=n[0].texture;n.length>1&&(e=n[1].texture),t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordinateBuffer),t.vertexAttribPointer(a.TexCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.TexCoord),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(a.Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.Position),t.uniformMatrix4fv(r.MVPMatrix,!1,this.MVPMatrix),t.activeTexture(t.TEXTURE0),t.uniform1i(r.Texture,0),e&&(t.bindTexture(t.TEXTURE_2D,e),t.uniform1f(r.Opacity,1),t.drawArrays(t.TRIANGLE_STRIP,0,4)),t.bindTexture(t.TEXTURE_2D,o),t.uniform1f(r.Opacity,this.percentAlpha),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}]),i}(),KNWebGLTransitionIris=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"apple:wipe-iris",programNames:["iris"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.direction===KNDirection.KNDirectionOut,s=a.buildOut;return s&&o||!s&&!o?(a.mix=0,a.percentfinished=1):(a.mix=1,a.percentfinished=0),a.percentAlpha=0,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.iris,r=(i.attribs,i.uniforms,this.textures[0]);t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.scale=r.width/r.height;var a=this.textureCoordinatesBuffer=t.createBuffer(),n=this.textureCoordinates=[0,0,0,1,1,0,1,1];t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);var o=this.positionBuffer=t.createBuffer(),s=this.boxPosition=[0,0,0,0,r.height,0,r.width,0,0,r.width,r.height,0];t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.MVPMatrix=WebGraphics.translateMatrix4(e.slideProjectionMatrix,r.offset.pointX,t.viewportHeight-(r.offset.pointY+r.height),0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){var r=this.buildOut,a=this.direction===KNDirection.KNDirectionOut,n=this.percentfinished;r&&a||!r&&!a?(n-=e/i)<0&&(n=0):(n+=e/i)>1&&(n=1);var o=TSUSineMap(n);1===n&&(o=1),r&&(o=1-o),this.percentAlpha=o,this.percentfinished=n,this.draw()}},{key:"draw",value:function(){this.renderer;var e,t=this.gl,i=this.program.iris,r=i.attribs,a=i.uniforms,n=this.textures,o=n[0].texture,s=(n[0],this.scale);n.length>1&&(e=n[1].texture),t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordinatesBuffer),t.vertexAttribPointer(r.TexCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(r.TexCoord),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(r.Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(r.Position),t.uniformMatrix4fv(a.MVPMatrix,!1,this.MVPMatrix),t.activeTexture(t.TEXTURE0),t.uniform1i(a.Texture,0),t.uniform1f(a.Opacity,1),e&&(t.bindTexture(t.TEXTURE_2D,e),t.uniform1f(a.PercentForAlpha,0),t.uniform1f(a.Scale,s),t.uniform1f(a.Mix,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)),t.bindTexture(t.TEXTURE_2D,o),t.uniform1f(a.PercentForAlpha,this.percentAlpha),t.uniform1f(a.Scale,s),t.uniform1f(a.Mix,this.mix),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}]),i}(),KNWebGLBuildIris=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"apple:wipe-iris",programNames:["iris"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o;var s=a.direction===KNDirection.KNDirectionOut,l=a.buildOut;l&&s||!l&&!s?(a.mix=0,a.percentfinished=1):(a.mix=1,a.percentfinished=0),a.percentAlpha=0,a.drawableObjects=[];for(var h=0,c=a.textures.length;h<c;h++){var u=r.textures[h],d=new KNWebGLDrawable(e,{effect:n,textures:[u]});a.drawableObjects.push(d)}return a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.iris;i.attribs,i.uniforms;t.useProgram(i.shaderProgram),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW);t.viewportWidth,t.viewportHeight;this.irisSystems=[];for(var a=0,n=this.textures.length;a<n;a++){var o=this.textures[a],s=(o.width,o.height,o.width/o.height),l=t.createBuffer(),h=[0,0,0,0,o.height,0,o.width,0,0,o.width,o.height,0];t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW);var c=WebGraphics.translateMatrix4(e.slideProjectionMatrix,o.offset.pointX,t.viewportHeight-(o.offset.pointY+o.height),0),u=o.initialState;0===u.rotation&&1===u.scale||(c=mvpMatrixWithInitialStateAffineTransform(u,c)),this.irisSystems[a]={textureCoordinatesBuffer:r,positionBuffer:l,MVPMatrix:c,scale:s}}}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=this.buildOut,n=this.direction===KNDirection.KNDirectionOut,o=this.percentfinished;a&&n||!a&&!n?(o-=e/i)<=0&&(o=0,this.isCompleted=!0):(o+=e/i)>=1&&(o=1,this.isCompleted=!0);var s=TSUSineMap(o);1===o&&(s=1),a&&(s=1-s),this.percentAlpha=s,this.percentfinished=o,r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);for(var l=0,h=this.textures.length;l<h;l++){var c=this.textures[l],u=c.initialState,d=c.animations;if(c.hasHighlightedBulletAnimation){if(!u.hidden){var f;if(d.length>0&&"opacity"===d[0].property){var m=d[0].from.scalar,p=d[0].to.scalar-m;f=a?m+p*(1-this.percentfinished):m+p*this.percentfinished}else f=c.initialState.opacity;this.drawableObjects[l].Opacity=this.parentOpacity*f,this.drawableObjects[l].drawFrame()}}else if(c.animations.length>0){if(this.isCompleted){a||(this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame());continue}var A=this.program.iris,v=A.attribs,g=A.uniforms,y=this.irisSystems[l],b=y.scale;r.useProgram(A.shaderProgram);var S=y.textureCoordinatesBuffer;r.bindBuffer(r.ARRAY_BUFFER,S),r.vertexAttribPointer(v.TexCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(v.TexCoord);var x=y.positionBuffer;r.bindBuffer(r.ARRAY_BUFFER,x),r.vertexAttribPointer(v.Position,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(v.Position);var C=y.MVPMatrix;r.uniformMatrix4fv(g.MVPMatrix,!1,C),r.activeTexture(r.TEXTURE0),r.uniform1i(g.Texture,0),r.uniform1f(g.Opacity,this.parentOpacity*c.initialState.opacity),r.bindTexture(r.TEXTURE_2D,c.texture),r.uniform1f(g.PercentForAlpha,this.percentAlpha),r.uniform1f(g.Scale,b),r.uniform1f(g.Mix,this.mix),r.drawArrays(r.TRIANGLE_STRIP,0,4)}else c.initialState.hidden||(this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame())}}}]),i}(),KNWebGLTransitionTwist=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.BUKTwist",programNames:["twist"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.gl;a.direction=a.effect.attributes.direction,a.percentfinished=0;var s,l,h=a.mNumPoints=24,c=o.viewportWidth/(h-1),u=o.viewportHeight/(h-1),d=1/(h-1),f=a.TexCoords=[],m=a.PositionCoords=[],p=a.NormalCoords=[];for(l=0;l<h;l++)for(s=0;s<h;s++){m[3*(A=l*h+s)]=s*c,m[3*A+1]=l*u,m[3*A+2]=0,f.push(s*d),f.push(l*d),p.push(0),p.push(0),p.push(-1)}var A=0,v=a.elementArray=[];for(l=0;l<h-1;l++)for(s=0;s<h;s++)v[A++]=l*h+s,v[A++]=(l+1)*h+s;return a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.twist,r=i.uniforms,a=i.attribs;t.enable(t.CULL_FACE),this.buffers={},this.buffers.TexCoord=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.TexCoord),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.TexCoords),t.STATIC_DRAW),t.vertexAttribPointer(a.TexCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.TexCoord),this.buffers.Position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.Position),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.PositionCoords),t.DYNAMIC_DRAW),t.vertexAttribPointer(a.Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.Position),this.buffers.Normal=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.Normal),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.NormalCoords),t.DYNAMIC_DRAW),t.vertexAttribPointer(a.Normal,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.Normal),this.MVPMatrix=e.slideProjectionMatrix,t.uniformMatrix4fv(r.MVPMatrix,!1,this.MVPMatrix),this.AffineTransform=new Matrix3,this.AffineTransform.affineScale(1,-1),this.AffineTransform.affineTranslate(0,1),this.AffineIdentity=new Matrix3,this.elementIndicesBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.elementIndicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.elementArray),t.STATIC_DRAW),t.activeTexture(t.TEXTURE0),t.uniform1i(r.Texture,0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){var r,a,n=this.gl,o=this.program.twist.attribs,s=this.percentfinished;(s+=e/i)>1&&(s=1),this.specularcolor=.5*TSUSineMap(2*s);var l=n.viewportHeight/2,h=this.mNumPoints,c=this.TexCoords,u=this.PositionCoords,d=this.NormalCoords;for(r=0;r<h;r++)for(a=0;a<h;a++){var f=r*h+a,m={};m.x=c[2*f],m.y=c[2*f+1];var p=-Math.PI*TwistFX(this.direction===KNDirection.KNDirectionLeftToRight?m.x:1-m.x,s),A={};A.y=l-l*(1-2*m.y)*Math.cos(p),A.z=l*(1-2*m.y)*Math.sin(p),u[3*f+1]=A.y,u[3*f+2]=A.z}for(r=0;r<h;r++)for(a=0;a<h;a++){for(var v=new Vector3,g=(f=r*h+a,0);g<4;g++){var y=0,b=0,S=0,x=0;switch(g){case 0:y=1,x=1;break;case 1:b=1,S=-1;break;case 2:y=-1,x=-1;break;case 3:b=-1,S=1}if(!(a+y<0||a+S<0||r+b<0||r+x<0||a+y>=h||a+S>=h||r+b>=h||r+x>=h)){var C=new Vector3([u[3*f],u[3*f+1],u[3*f+2]]),w=new Vector3([u[3*((r+b)*h+(a+y))],u[3*((r+b)*h+(a+y))+1],u[3*((r+b)*h+(a+y))+2]]),P=new Vector3([u[3*((r+x)*h+(a+S))],u[3*((r+x)*h+(a+S))+1],u[3*((r+x)*h+(a+S))+2]]);w.subtract(C),P.subtract(C),w.cross(P),v.add(w)}}v.normalize(),v.scale(-1),v=v.getArray(),d[3*f]=v[0],d[3*f+1]=v[1],d[3*f+2]=v[2]}n.bindBuffer(n.ARRAY_BUFFER,this.buffers.Position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(u),n.DYNAMIC_DRAW),n.vertexAttribPointer(o.Position,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.buffers.Normal),n.bufferData(n.ARRAY_BUFFER,new Float32Array(d),n.DYNAMIC_DRAW),n.vertexAttribPointer(o.Normal,3,n.FLOAT,!1,0,0),this.percentfinished=s,this.draw()}},{key:"draw",value:function(){this.renderer;var e,t=this.gl,i=this.program.twist.uniforms,r=this.textures,a=r[0].texture,n=r[1].texture,o=this.mNumPoints,s=this.specularcolor,l=this.AffineTransform.getColumnMajorFloat32Array(),h=this.AffineIdentity.getColumnMajorFloat32Array(),c=this.elementIndicesBuffer;if(s||(s=0),t.uniform1f(i.SpecularColor,s),this.percentfinished<.5){for(t.cullFace(t.BACK),t.bindTexture(t.TEXTURE_2D,a),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),t.uniformMatrix3fv(i.TextureMatrix,!1,l),t.uniform1f(i.FlipNormals,1),e=0;e<o-1;e++)t.drawElements(t.TRIANGLE_STRIP,2*o,t.UNSIGNED_SHORT,e*o*2*2);for(t.cullFace(t.FRONT),t.bindTexture(t.TEXTURE_2D,n),t.uniformMatrix3fv(i.TextureMatrix,!1,h),t.uniform1f(i.FlipNormals,-1),e=0;e<o-1;e++)t.drawElements(t.TRIANGLE_STRIP,2*o,t.UNSIGNED_SHORT,e*o*2*2)}else{for(t.cullFace(t.FRONT),t.bindTexture(t.TEXTURE_2D,n),t.uniformMatrix3fv(i.TextureMatrix,!1,h),t.uniform1f(i.FlipNormals,-1),e=0;e<o-1;e++)t.drawElements(t.TRIANGLE_STRIP,2*o,t.UNSIGNED_SHORT,e*o*2*2);for(t.cullFace(t.BACK),t.bindTexture(t.TEXTURE_2D,a),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),t.uniformMatrix3fv(i.TextureMatrix,!1,l),t.uniform1f(i.SpecularColor,s),t.uniform1f(i.FlipNormals,1),e=0;e<o-1;e++)t.drawElements(t.TRIANGLE_STRIP,2*o,t.UNSIGNED_SHORT,e*o*2*2)}}}]),i}(),KNWebGLTransitionColorPlanes=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.KLNColorPlanes",programNames:["colorPlanes"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.effect.attributes.direction;return o!==KNDirection.KNDirectionLeftToRight&&o!==KNDirection.KNDirectionRightToLeft&&o!==KNDirection.KNDirectionTopToBottom&&o!==KNDirection.KNDirectionBottomToTop&&(o=KNDirection.KNDirectionLeftToRight),a.direction=o,a.mNumColors=3,a.percentfinished=0,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.colorPlanes,r=i.uniforms,a=i.attribs,n=this.textures[0];t.disable(t.CULL_FACE),t.blendFunc(t.ONE,t.ONE);var o=this.buffers={};o.TexCoord=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.TexCoord);var s=this.TexCoords=[0,0,0,1,1,0,1,1];t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),t.vertexAttribPointer(a.TexCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.TexCoord),o.Position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.Position);var l=this.PositionCoords=[0,0,0,0,n.height,0,n.width,0,0,n.width,n.height,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.vertexAttribPointer(a.Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.Position),this.MVPMatrix=e.slideProjectionMatrix,t.uniformMatrix4fv(r.MVPMatrix,!1,this.MVPMatrix),t.activeTexture(t.TEXTURE0),t.uniform1i(r.Texture,0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=this.program.colorPlanes,n=a.uniforms,o=(a.attribs,this.textures),s=o[0],l=o[1];this.percentfinished+=e/i,this.percentfinished>1&&(this.percentfinished=1);var h=this.percentfinished,c=this.direction,u=c===KNDirection.KNDirectionRightToLeft||c===KNDirection.KNDirectionBottomToTop,d=c===KNDirection.KNDirectionLeftToRight||c===KNDirection.KNDirectionRightToLeft,f=1-(1-h)*(1-h),m=d?s.width:s.height,p=TSUSineMap(2*h)*m*.25,A=Math.sin(2*-f*Math.PI);A*=f*m*1,h<.5?(r.bindTexture(r.TEXTURE_2D,l.texture),r.uniform2fv(n.FlipTexCoords,new Float32Array([0,0]))):(r.bindTexture(r.TEXTURE_2D,s.texture),c===KNDirection.KNDirectionTopToBottom||c===KNDirection.KNDirectionBottomToTop?r.uniform2fv(n.FlipTexCoords,new Float32Array([0,1])):r.uniform2fv(n.FlipTexCoords,new Float32Array([1,0])));for(var v=0,g=this.mNumColors;v<g;v++){var y=v/g,b=WebGraphics.colorWithHSBA(y,1,1,1/g);r.uniform4fv(n.ColorMask,new Float32Array([b.red,b.green,b.blue,b.alpha]));var S=Math.PI/180*(180*TSUSineMap(h)),x=WebGraphics.translateMatrix4(this.MVPMatrix,s.width/2,s.height/2,A);x=WebGraphics.rotateMatrix4AboutXYZ(x,S,(u?-1:1)*(d?0:1),(u?-1:1)*(d?1:0),0),x=WebGraphics.translateMatrix4(x,-s.width/2,-s.height/2,p*(v-1)),r.uniformMatrix4fv(n.MVPMatrix,!1,x),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}}]),i}(),KNWebGLTransitionFlop=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.BUKFlop",programNames:["flop","defaultTexture"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.effect.attributes.direction;o!==KNDirection.KNDirectionLeftToRight&&o!==KNDirection.KNDirectionRightToLeft&&o!==KNDirection.KNDirectionTopToBottom&&o!==KNDirection.KNDirectionBottomToTop&&(o=KNDirection.KNDirectionLeftToRight),a.direction=o,a.percentfinished=0;var s=a.elementArray=[],l=a.gl,h=l.viewportWidth,c=l.viewportHeight,u=h,d=c;o===KNDirection.KNDirectionTopToBottom||o===KNDirection.KNDirectionBottomToTop?d*=.5:u*=.5;var f=a.mNumPoints=8,m=0;for(b=0;b<f-1;b++)for(S=0;S<f;S++)s[m++]=(b+0)*f+S,s[m++]=(b+1)*f+S;for(var p=u/(f-1),A=d/(f-1),v=o===KNDirection.KNDirectionTopToBottom?d:0,g=o===KNDirection.KNDirectionRightToLeft?u:0,y=a.attributeBufferData={Position:[],TexCoords:[],Normal:[],ShadowPosition:[],ShadowTexCoord:[],PreviousPosition:[],PreviousTexCoords:[],PreviousNormal:[]},b=0;b<f;b++)for(var S=0;S<f;S++)m=b*f+S,KNWebGLUtil.setPoint3DAtIndexForAttribute(WebGraphics.makePoint3D(S*p+g,b*A,0),m,y.Position),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint((S*p+g)/h,(b*A+v)/c),m,y.TexCoords),KNWebGLUtil.setPoint3DAtIndexForAttribute(WebGraphics.makePoint3D(0,0,1),m,y.Normal);return a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.program.flop,r=i.attribs,a=i.uniforms,n=this.program.defaultTexture,o=this.MVPMatrix=e.slideProjectionMatrix,s=t.viewportWidth,l=t.viewportHeight,h=this.direction;h===KNDirection.KNDirectionTopToBottom||h===KNDirection.KNDirectionBottomToTop?l*=.5:s*=.5;var c=[0,0,0,.5,1,0,1,.5],u=[0,0,0,0,l,0,s,0,0,s,l,0],d=[0,.5,0,1,1,.5,1,1],f=[0,l,0,0,2*l,0,s,l,0,s,2*l,0];KNWebGLUtil.enableAttribs(t,i);var m=this.attributeBufferData,p=this.buffers={},A=this.Coordinates={};p.TexCoord=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.TexCoord),t.bufferData(t.ARRAY_BUFFER,new Float32Array(m.TexCoords),t.DYNAMIC_DRAW),t.vertexAttribPointer(r.TexCoord,2,t.FLOAT,!1,0,0),p.Position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.Position),t.bufferData(t.ARRAY_BUFFER,new Float32Array(m.Position),t.DYNAMIC_DRAW),t.vertexAttribPointer(r.Position,3,t.FLOAT,!1,0,0),p.Normal=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.Normal),t.bufferData(t.ARRAY_BUFFER,new Float32Array(m.Normal),t.DYNAMIC_DRAW),t.vertexAttribPointer(r.Normal,3,t.FLOAT,!1,0,0),t.uniformMatrix4fv(a.MVPMatrix,!1,o);var v=this.AffineTransform=new Matrix3;h===KNDirection.KNDirectionTopToBottom?(v.affineScale(1,-1),v.affineTranslate(0,1)):h===KNDirection.KNDirectionBottomToTop?(v.affineScale(1,-1),v.affineTranslate(0,1),c=[0,.5,0,1,1,.5,1,1],d=[0,0,0,.5,1,0,1,.5],u=[0,l,0,0,2*l,0,s,l,0,s,2*l,0],f=[0,0,0,0,l,0,s,0,0,s,l,0]):h===KNDirection.KNDirectionRightToLeft?(v.affineScale(-1,1),v.affineTranslate(1,0),c=[0,0,0,1,.5,0,.5,1],d=[.5,0,.5,1,1,0,1,1],f=[s,0,0,s,l,0,2*s,0,0,2*s,l,0]):h===KNDirection.KNDirectionLeftToRight&&(v.affineScale(-1,1),v.affineTranslate(1,0),u=[s,0,0,s,l,0,2*s,0,0,2*s,l,0],c=[.5,0,.5,1,1,0,1,1],d=[0,0,0,1,.5,0,.5,1],f=[0,0,0,0,l,0,s,0,0,s,l,0]),this.AffineIdentity=new Matrix3,this.elementIndicesBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.elementIndicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.elementArray),t.STATIC_DRAW),A.DefaultTexture=c,A.DefaultTexture2=d,A.DefaultPosition=u,A.DefaultPosition2=f,KNWebGLUtil.enableAttribs(t,n),p.TextureCoordinates=t.createBuffer(),p.PositionCoordinates=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p.TextureCoordinates),t.bindBuffer(t.ARRAY_BUFFER,p.PositionCoordinates),t.bufferData(t.ARRAY_BUFFER,new Float32Array(c),t.DYNAMIC_DRAW),t.vertexAttribPointer(n.attribs.TexCoord,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.DYNAMIC_DRAW),t.vertexAttribPointer(n.attribs.Position,3,t.FLOAT,!1,0,0),t.uniform1i(n.uniforms.Texture,0),t.uniformMatrix4fv(n.uniforms.MVPMatrix,!1,o),t.useProgram(i.shaderProgram),t.activeTexture(t.TEXTURE0),t.uniform1i(i.uniforms.Texture,0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){this.percentfinished+=e/i,this.percentfinished>1&&(this.percentfinished=1),this.updateFlopWithPercent(),this.draw()}},{key:"updateFlopWithPercent",value:function(){for(var e=this.gl,t=this.direction,i=e.viewportWidth,r=e.viewportHeight,a=this.percentfinished*Math.PI,n=this.percentfinished*this.percentfinished*this.percentfinished*Math.PI,o=r/2,s=i/2,l=0,h=this.mNumPoints,c=this.attributeBufferData,u=0;u<h;u++)for(var d=0;d<h;d++){var f=u*h+d,m=KNWebGLUtil.getPoint2DForArrayAtIndex(c.TexCoords,f);m.x*=i,m.y*=r;var p=(l=t===KNDirection.KNDirectionBottomToTop?m.y/o:t===KNDirection.KNDirectionTopToBottom?(2*o-m.y)/o:t===KNDirection.KNDirectionLeftToRight?m.x/s:(2*s-m.x)/s)*a+(1-l)*n;t!==KNDirection.KNDirectionLeftToRight&&t!==KNDirection.KNDirectionTopToBottom||(p*=-1);var A=Math.sin(p),v=Math.cos(p),g=KNWebGLUtil.getPoint3DForArrayAtIndex(c.Position,f),y=KNWebGLUtil.getPoint3DForArrayAtIndex(c.Normal,f);if(t===KNDirection.KNDirectionTopToBottom||t===KNDirection.KNDirectionBottomToTop){var b=WebGraphics.makePoint3D(g.x,o-(o-m.y)*v,(o-m.y)*A);KNWebGLUtil.setPoint3DAtIndexForAttribute(b,f,c.Position);var S=WebGraphics.makePoint3D(y.x,-A,v);KNWebGLUtil.setPoint3DAtIndexForAttribute(S,f,c.Normal)}else{b=WebGraphics.makePoint3D(s-(s-m.x)*v,g.y,-(s-m.x)*A);KNWebGLUtil.setPoint3DAtIndexForAttribute(b,f,c.Position);S=WebGraphics.makePoint3D(-A,y.y,v);KNWebGLUtil.setPoint3DAtIndexForAttribute(S,f,c.Normal)}}}},{key:"draw",value:function(){this.renderer;var e=this.gl,t=this.program.flop,i=this.program.defaultTexture,r=this.textures,a=r[1].texture,n=r[0].texture;e.useProgram(i.shaderProgram),e.disable(e.CULL_FACE),e.bindTexture(e.TEXTURE_2D,a);var o=this.mNumPoints,s=this.buffers,l=this.Coordinates,h=this.attributeBufferData;KNWebGLUtil.bindDynamicBufferWithData(e,i.attribs.Position,s.PositionCoordinates,l.DefaultPosition,3),KNWebGLUtil.bindDynamicBufferWithData(e,i.attribs.TexCoord,s.TextureCoordinates,l.DefaultTexture,2),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.useProgram(i.shaderProgram),e.disable(e.CULL_FACE),e.bindTexture(e.TEXTURE_2D,n),KNWebGLUtil.bindDynamicBufferWithData(e,i.attribs.Position,s.PositionCoordinates,l.DefaultPosition2,3),KNWebGLUtil.bindDynamicBufferWithData(e,i.attribs.TexCoord,s.TextureCoordinates,l.DefaultTexture2,2),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.enable(e.CULL_FACE),e.useProgram(t.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,s.Position),e.bufferData(e.ARRAY_BUFFER,new Float32Array(h.Position),e.DYNAMIC_DRAW),e.vertexAttribPointer(t.attribs.Position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,s.Normal),e.bufferData(e.ARRAY_BUFFER,new Float32Array(h.Normal),e.DYNAMIC_DRAW),e.vertexAttribPointer(t.attribs.Normal,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,s.TexCoord),e.bufferData(e.ARRAY_BUFFER,new Float32Array(h.TexCoords),e.DYNAMIC_DRAW),e.vertexAttribPointer(t.attribs.TexCoord,2,e.FLOAT,!1,0,0),e.cullFace(e.BACK),e.bindTexture(e.TEXTURE_2D,n),e.uniformMatrix3fv(t.uniforms.TextureMatrix,!1,this.AffineTransform.getColumnMajorFloat32Array()),e.uniform1f(t.uniforms.FlipNormals,-1);for(var c=0;c<o-1;c++)e.drawElements(e.TRIANGLE_STRIP,2*o,e.UNSIGNED_SHORT,c*o*2*2);e.bindTexture(e.TEXTURE_2D,a),e.cullFace(e.FRONT),e.uniformMatrix3fv(t.uniforms.TextureMatrix,!1,this.AffineIdentity.getColumnMajorFloat32Array()),e.uniform1f(t.uniforms.FlipNormals,1);for(c=0;c<o-1;c++)e.drawElements(e.TRIANGLE_STRIP,2*o,e.UNSIGNED_SHORT,c*o*2*2)}}]),i}(),KNWebGLBuildAnvil=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"com.apple.iWork.Keynote.BUKAnvil",programNames:["anvilsmoke","anvilspeck"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o;var s=a.gl;a.smokeTexture=KNWebGLUtil.bindTextureWithImage(s,smokeImage),a.speckTexture=KNWebGLUtil.bindTextureWithImage(s,speckImage),a.percentfinished=0,a.drawableObjects=[];for(var l=0,h=a.textures.length;l<h;l++){var c=r.textures[l],u=new KNWebGLDrawable(e,{effect:n,textures:[c]});a.drawableObjects.push(u)}return a.objectY=1,a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl;this.smokeSystems=[],this.speckSystems=[];for(var i=0,r=this.textures.length;i<r;i++){var a=this.textures[i],n=a.width,o=a.height,s=t.viewportWidth,l=t.viewportHeight,h=300,c=new KNWebGLBuildAnvilSmokeSystem(e,this.program.anvilsmoke,{width:n,height:o},{width:s,height:l},this.duration,{width:h,height:1},{width:kParticleSize,height:kParticleSize},this.smokeTexture);h=40;var u=new KNWebGLBuildAnvilSpeckSystem(e,this.program.anvilspeck,{width:n,height:o},{width:s,height:l},this.duration,{width:h,height:1},{width:kParticleSize,height:kParticleSize},this.speckTexture);this.smokeSystems.push(c),this.speckSystems.push(u)}}},{key:"drawFrame",value:function(e,t,i){var r=this.renderer,a=this.gl;this.percentfinished+=e/i,this.percentfinished>=1&&(this.percentfinished=1,this.isCompleted=!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var n=0,o=this.textures.length;n<o;n++){var s=this.textures[n],l=s.initialState,h=s.animations;if(s.hasHighlightedBulletAnimation){if(!l.hidden){var c;if(h.length>0&&"opacity"===h[0].property){var u=h[0].from.scalar;c=u+(h[0].to.scalar-u)*this.percentfinished}else c=s.initialState.opacity;this.drawableObjects[n].Opacity=this.parentOpacity*c,this.drawableObjects[n].drawFrame()}}else if(s.animations.length>0){if(this.isCompleted){this.drawableObjects[n].Opacity=this.parentOpacity*s.initialState.opacity,this.drawableObjects[n].drawFrame();continue}s.width;var d=s.height,f=s.offset.pointX,m=s.offset.pointY,p=a.viewportWidth,A=a.viewportHeight;i/=1e3;var v=Math.min(.2,.4*i),g=Math.min(.25,.5*i),y=this.cameraShakePointsWithRandomGenerator(),b=(this.percentfinished*i-v)/g,S=WebGraphics.makePoint(0,0);if(0<b&&b<1){var x=Math.floor(b*kNumCameraShakePoints),C=Math.ceil(WebGraphics.clamp(b*kNumCameraShakePoints,0,y.length-1)),w=y[x],P=y[C],T=b*kNumCameraShakePoints-x;S=WebGraphics.makePoint(WebGraphics.mix(w.x,P.x,T),WebGraphics.mix(w.y,P.y,T))}var k=WebGraphics.clamp(this.percentfinished*i/v,0,1),D=WebGraphics.clamp((this.percentfinished*i-v)/(i-v),0,1);this.percentfinished;this.objectY=m+d,this.objectY*=1-k*k,this.drawableObjects[n].MVPMatrix=WebGraphics.translateMatrix4(r.slideOrthoMatrix,f+S.x*p,A-m-d+this.objectY+S.y*A,0),this.drawableObjects[n].Opacity=this.parentOpacity*s.initialState.opacity,this.drawableObjects[n].drawFrame();var E=WebGraphics.translateMatrix4(r.slideProjectionMatrix,f,A-(m+(d+16))*(1-D*D*.02),0),B=this.smokeSystems[n];if(B.setMVPMatrix(E),B.drawFrame(D,1-D*D),D<.5){E=WebGraphics.translateMatrix4(r.slideOrthoMatrix,f,A-(m+d+16),0);var M=this.speckSystems[n];M.setMVPMatrix(E),M.drawFrame(D,WebGraphics.clamp(1-2*WebGraphics.sineMap(D),0,1))}}else s.initialState.hidden||(this.drawableObjects[n].Opacity=this.parentOpacity*s.initialState.opacity,this.drawableObjects[n].drawFrame())}}},{key:"cameraShakePointsWithRandomGenerator",value:function(){for(var e=[],t=0;t<kNumCameraShakePoints;t++){var i=1-t/kNumCameraShakePoints;i*=i;var r=WebGraphics.makePoint(.025*WebGraphics.randomBetween(-1,1)*i*.4,.025*Math.pow(-1,t)*i);e[t]=r}return e}}]),i}(),KNWebGLBuildFlame=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.KLNFlame",programNames:["flame"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.gl;a.flameTexture=KNWebGLUtil.bindTextureWithImage(o,flameImage),a.percentfinished=0,a.drawableObjects=[],a.framebufferDrawableObjects=[],a.slideSize={width:o.viewportWidth,height:o.viewportHeight};for(var s=a.effect,l=0,h=a.textures.length;l<h;l++){var c=r.textures[l],u=new KNWebGLDrawable(e,{effect:s,textures:[c]});a.drawableObjects.push(u);var d={size:{width:c.width,height:c.height},origin:{x:c.offset.pointX,y:c.offset.pointY}},f=a.frameOfEffectWithFrame(d),m=new KNWebGLFramebufferDrawable(e,{effect:s,textures:[],drawableFrame:d,frameRect:f});a.framebufferDrawableObjects.push(m)}return a.parentOpacity=s.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"frameOfEffectWithFrame",value:function(e){var t=e.size,i=this.slideSize,r=1.2-Math.min(1,Math.sqrt(t.width/i.width))+1,a=1.25-Math.min(1,Math.sqrt(t.height/i.height))+1,n={width:Math.round(t.width*r),height:Math.round(t.height*a)};t.width/t.height<1&&(n.width=Math.max(n.width,t.width+t.height));var o={size:n,origin:{x:e.origin.x+(t.width-n.width)/2,y:e.origin.y+(t.height-n.height)/2}};o.origin.y-=.25*(o.size.height-e.size.height);var s=this.gl,l=CGRectIntersection(o,{origin:{x:0,y:0},size:{width:s.viewportWidth,height:s.viewportHeight}});return l=CGRectIntegral(l)}},{key:"p_orthoTransformWithScale",value:function(e,t,i){var r={width:i.size.width*e,height:i.size.height*e},a=WebGraphics.makeOrthoMatrix4(0,r.width,0,r.height,-1,1);return WebGraphics.translateMatrix4(a,t.x,-t.y,0)}},{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.duration/1e3;this.flameSystems=[];for(var r=0,a=this.textures.length;r<a;r++){var n=this.textures[r],o=n.width,s=n.height,l=t.viewportWidth,h=t.viewportHeight,c=this.framebufferDrawableObjects[r],u=c.frameRect,d=c.drawableFrame,f={x:n.offset.pointX-u.origin.x,y:n.offset.pointY+s-(u.origin.y+u.size.height)},m=d.origin.y-u.origin.y,p=u.origin.y+u.size.height-(d.origin.y+d.size.height);f.y+=p-m,c.MVPMatrix=this.p_orthoTransformWithScale(1,f,u);var A=o/s,v=Math.round(150*A);v*=i+Math.max(0,1-i/2);var g=new KNWebGLBuildFlameSystem(e,this.program.flame,{width:o,height:s},{width:l,height:h},Math.max(2,this.duration),v,this.flameTexture);g.p_setupParticleDataWithTexture(n),this.flameSystems.push(g)}}},{key:"drawFrame",value:function(e,t,i){var r=this.renderer,a=this.gl,n=this.program.flame.uniforms,o=this.buildOut,s=this.percentfinished;(s+=e/i)>=1&&(s=1,this.isCompleted=!0),this.percentfinished=s,a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var l=0,h=this.textures.length;l<h;l++){var c=this.textures[l],u=c.initialState,d=c.animations;if(c.hasHighlightedBulletAnimation){if(!u.hidden){var f;if(d.length>0&&"opacity"===d[0].property){var m=d[0].from.scalar;f=m+(d[0].to.scalar-m)*this.percentfinished}else f=c.initialState.opacity;this.drawableObjects[l].Opacity=this.parentOpacity*f,this.drawableObjects[l].drawFrame()}}else if(c.animations.length>0){if(this.isCompleted){o||(this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame());continue}c.width;var p=c.height;c.offset.pointX,c.offset.pointY,a.viewportWidth,a.viewportHeight;i/=1e3;var A=s;o&&(A=1-A);var v=o?.25:.5,g=Math.min(v,1/i);if(A>g){var y=(A-g)/(1-g),b=TSUSineMap(Math.min(1,2*y));b*=this.parentOpacity*c.initialState.opacity;var S=this.drawableObjects[l];S.Opacity=b,S.drawFrame()}var x=this.framebufferDrawableObjects[l],C=x.drawableFrame,w=x.frameRect,P={x:c.offset.pointX-w.origin.x,y:c.offset.pointY+p-(w.origin.y+w.size.height)},T=C.origin.y-w.origin.y,k=w.origin.y+w.size.height-(C.origin.y+C.size.height);P.y+=k-T;var D=this.p_orthoTransformWithScale(1,P,w);a.viewport(0,0,w.size.width,w.size.height),a.bindFramebuffer(a.FRAMEBUFFER,x.buffer),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE);var E=0===s||1===s?0:1;a.bindTexture(a.TEXTURE_2D,x.texture);var B=this.flameSystems[l];B.setMVPMatrix(D),a.uniform1f(n.SpeedMax,B._speedMax),B.drawFrame(s,E),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindTexture(a.TEXTURE_2D,null),a.viewport(0,0,a.viewportWidth,a.viewportHeight),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),x.MVPMatrix=WebGraphics.translateMatrix4(r.slideProjectionMatrix,w.origin.x,a.viewportHeight-(w.origin.y+w.size.height),0),x.drawFrame()}else c.initialState.hidden||(this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame())}}}]),i}(),KNWebGLTransitionConfetti=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.KLNConfetti",programNames:["confetti","defaultTexture"],effect:r.effect,textures:r.textures};return(a=t.call(this,e,n)).programData=n,a.useGravity=a.direction===KNDirection.KNDirectionGravity,a.percentfinished=0,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.textures,r=i[0],a=r.width,n=r.height,o=t.viewportWidth,s=t.viewportHeight;t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.confettiSystem=new KNWebGLBuildConfettiSystem(e,this.program.confetti,{width:a,height:n},{width:o,height:s},this.duration,1e4,i[1].texture),this.confettiSystem.setMVPMatrix(e.slideProjectionMatrix);var l=this.program.defaultTexture;KNWebGLUtil.enableAttribs(t,l);var h=[0,0,-1,0,s,-1,o,0,-1,o,s,-1];this.textureCoordinatesBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordinatesBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),t.vertexAttribPointer(l.attribs.TexCoord,2,t.FLOAT,!1,0,0),this.positionBuffer=t.createBuffer(),KNWebGLUtil.bindDynamicBufferWithData(t,l.attribs.Position,this.positionBuffer,h,3),t.uniformMatrix4fv(l.uniforms.MVPMatrix,!1,e.slideOrthoMatrix),t.activeTexture(t.TEXTURE0),t.uniform1i(l.uniforms.Texture,0),this.drawFrame(0,0,4)}},{key:"drawFrame",value:function(e,t,i){var r=this.gl,a=r.viewportWidth,n=r.viewportHeight,o=this.percentfinished;if((o+=e/i)>1&&(o=1,this.isCompleted=!0),this.isCompleted){var s=this.program.defaultTexture;return r.useProgram(s.shaderProgram),r.uniformMatrix4fv(s.uniforms.MVPMatrix,!1,this.renderer.slideProjectionMatrix),void this.draw()}var l=this.percentfinished=o,h=1-l,c=1-h*h*h;c=c*(1-l*l)+l*l*(1-h*h)+l,c*=.5,c*=c;var u=.75+.25*(1-Math.pow(h,4)),d=WebGraphics.translateMatrix4(this.renderer.slideProjectionMatrix,a/2,n/2,0);d=WebGraphics.scaleMatrix4(d,u,u,1),d=WebGraphics.translateMatrix4(d,-a/2,-n/2,0);s=this.program.defaultTexture;r.useProgram(s.shaderProgram),r.uniformMatrix4fv(s.uniforms.MVPMatrix,!1,d),this.draw();var f=1-l;if(f=WebGraphics.clamp(f,0,1),c=WebGraphics.clamp(c,0,1),this.useGravity){var m=this.renderer.slideProjectionMatrix;m=WebGraphics.translateMatrix4(m,0,2*-n*l*l*.5,0),this.confettiSystem.setMVPMatrix(m)}this.confettiSystem.drawFrame(c,f)}},{key:"draw",value:function(){var e=this.gl,t=this.program.defaultTexture,i=t.attribs,r=e.viewportWidth,a=e.viewportHeight;e.useProgram(t.shaderProgram);var n=[0,0,-1,0,a,-1,r,0,-1,r,a,-1];e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordinatesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(i.TexCoord,2,e.FLOAT,!1,0,0),KNWebGLUtil.bindDynamicBufferWithData(e,i.Position,this.positionBuffer,n,3),e.bindTexture(e.TEXTURE_2D,this.textures[0].texture),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}]),i}(),KNWebGLBuildConfetti=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"com.apple.iWork.Keynote.KLNConfetti",programNames:["confetti"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o,a.useGravity=a.direction===KNDirection.KNDirectionGravity,a.percentfinished=0,a.drawableObjects=[];for(var s=0,l=a.textures.length;s<l;s++){var h=r.textures[s],c=new KNWebGLDrawable(e,{effect:n,textures:[h]});a.drawableObjects.push(c)}return a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=t.viewportWidth,r=t.viewportHeight;this.confettiSystems=[];for(var a=0,n=this.textures.length;a<n;a++){var o=this.textures[a],s=o.width,l=o.height,h=l/r*s/i;h=Math.sqrt(Math.sqrt(h));var c=Math.round(1e4*h),u=new KNWebGLBuildConfettiSystem(e,this.program.confetti,{width:s,height:l},{width:i,height:r},this.duration,c,o.texture);u.ratio=h,this.confettiSystems.push(u)}}},{key:"drawFrame",value:function(e,t,i){var r=this.renderer,a=this.gl,n=(a.viewportWidth,a.viewportHeight),o=this.buildIn,s=(this.buildOut,this.percentfinished);(s+=e/i)>1&&(s=1,this.isCompleted=!0),this.percentfinished=s;for(var l=0,h=this.textures.length;l<h;l++){var c=this.textures[l],u=c.initialState,d=c.animations;if(c.hasHighlightedBulletAnimation){if(!u.hidden){var f;if(d.length>0&&"opacity"===d[0].property){var m=d[0].from.scalar;f=m+(d[0].to.scalar-m)*s}else f=c.initialState.opacity;a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),this.drawableObjects[l].Opacity=this.parentOpacity*f,this.drawableObjects[l].drawFrame()}}else if(c.animations.length>0){if(this.isCompleted){o&&(this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame());continue}c.width;var p=c.height,A=o?1-s:s,v=1-A,g=1-v*v*v;g=g*(1-A*A)+A*A*(1-v*v)+A,g*=.5,o&&(g*=g);var y=this.confettiSystems[l],b=WebGraphics.translateMatrix4(r.slideProjectionMatrix,c.offset.pointX,n-(c.offset.pointY+p),0);0===(u=c.initialState).rotation&&1===u.scale||(b=mvpMatrixWithInitialStateAffineTransform(u,b));var S=1-A;if(S=WebGraphics.clamp(S,0,1),g=WebGraphics.clamp(g,0,1),this.useGravity){var x=y.ratio;b=WebGraphics.translateMatrix4(b,0,2*-n*A*A*(1-.5*x),0)}a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),y.setMVPMatrix(b),y.drawFrame(g,S)}else c.initialState.hidden||(a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),this.drawableObjects[l].Opacity=this.parentOpacity*c.initialState.opacity,this.drawableObjects[l].drawFrame())}}}]),i}(),KNWebGLBuildDiffuse=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"com.apple.iWork.Keynote.KLNDiffuse",programNames:["diffuse"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o,a.percentfinished=0,a.drawableObjects=[];for(var s=0,l=a.textures.length;s<l;s++){var h=r.textures[s],c=new KNWebGLDrawable(e,{effect:n,textures:[h]});a.drawableObjects.push(c)}return a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=t.viewportWidth,r=t.viewportHeight;this.diffuseSystems=[];for(var a=0,n=this.textures.length;a<n;a++){var o=this.textures[a],s=o.width,l=o.height,h=l/r*s/i;h=Math.sqrt(Math.sqrt(h));var c=Math.round(4e3*h),u=new KNWebGLBuildDiffuseSystem(e,this.program.diffuse,{width:s,height:l},{width:i,height:r},this.duration,c,o.texture,this.direction===KNDirection.KNDirectionRightToLeft);this.diffuseSystems.push(u)}}},{key:"drawFrame",value:function(e,t,i){var r=this.renderer,a=this.gl,n=(a.viewportWidth,a.viewportHeight),o=this.percentfinished;(o+=e/i)>1&&(o=1,this.isCompleted=!0),this.percentfinished=o,a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var s=0,l=this.textures.length;s<l;s++){var h=this.textures[s],c=h.initialState,u=h.animations;if(h.hasHighlightedBulletAnimation){if(!c.hidden){var d;if(u.length>0&&"opacity"===u[0].property){var f=u[0].from.scalar;d=f+(u[0].to.scalar-f)*o}else d=h.initialState.opacity;this.drawableObjects[s].Opacity=this.parentOpacity*d,this.drawableObjects[s].drawFrame()}}else if(h.animations.length>0){h.width;var m=h.height,p=h.offset.pointX,A=h.offset.pointY,v=this.diffuseSystems[s],g=WebGraphics.translateMatrix4(r.slideProjectionMatrix,p,n-(A+m),0);0===(c=h.initialState).rotation&&1===c.scale||(g=mvpMatrixWithInitialStateAffineTransform(c,g)),v.setMVPMatrix(g),v.drawFrame(this.percentfinished,this.parentOpacity*c.opacity)}else h.initialState.hidden||(this.drawableObjects[s].Opacity=this.parentOpacity*h.initialState.opacity,this.drawableObjects[s].drawFrame())}}}]),i}(),KNWebGLBuildFireworks=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n={name:"com.apple.iWork.Keynote.KNFireworks",programNames:["fireworks"],effect:r.effect,textures:r.textures};(a=t.call(this,e,n)).programData=n;var o=a.gl;a.animParameterGroup=new KNAnimParameterGroup("Fireworks"),a.fireworksTexture=KNWebGLUtil.bindTextureWithImage(o,fireworksImage),a.fireworksCenterBurstTexture=KNWebGLUtil.bindTextureWithImage(o,fireworksCenterBurstImage),a.percentfinished=0,a.prevpercentfinished=0,a.drawableObjects=[],a.frameRect=a.frameOfEffectWithFrame(),a.slideSize={width:o.viewportWidth,height:o.viewportHeight};for(var s=a.effect,l=0,h=a.textures.length;l<h;l++){var c=r.textures[l],u=new KNWebGLDrawable(e,{effect:s,textures:[c]});a.drawableObjects.push(u)}return a.parentOpacity=s.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"frameOfEffectWithFrame",value:function(){var e=this.gl;return{origin:{x:0,y:0},size:{width:e.viewportWidth,height:e.viewportHeight}}}},{key:"p_orthoTransformWithScale",value:function(e,t,i){var r={width:i.size.width*e,height:i.size.height*e},a=WebGraphics.makeOrthoMatrix4(0,r.width,0,r.height,-1,1);return WebGraphics.translateMatrix4(a,t.x,-t.y,0)}},{key:"p_setupFBOWithSize",value:function(e){this.framebuffer=new TSDGLFrameBuffer(this.gl,e,2)}},{key:"p_fireworksSystemsForTR",value:function(e){var t=this.renderer,i=this.gl,r=i.viewportWidth,a=i.viewportHeight,n=this.duration/1e3,o=this.animParameterGroup,s=n*o.doubleForKey("FireworksCount");s=Math.max(2,s);for(var l=[],h=parseInt(WebGraphics.randomBetween(0,s-1)),c=0;c<s;c++){var u=o.doubleForKey("ParticleCount"),d=Math.min(r,a),f=d*WebGraphics.doubleBetween(o.doubleForKey("FireworkSizeMin"),o.doubleForKey("FireworkSizeMax")),m=new KNWebGLBuildFireworksSystem(t,this.program.fireworks,{width:e.width,height:e.height},{width:r,height:a},this.duration,{width:u,height:1},{width:1,height:1},this.fireworksTexture),p=WebGraphics.makeSize(o.doubleForKey("ParticleSizeMin"),o.doubleForKey("ParticleSizeMax"));p.width=p.width*d/100,p.height=p.height*d/100,m.randomParticleSizeMinMax=p,m.maxDistance=f,m.colorRandomness=o.doubleForKey("ParticleColorRandomness"),m.lifeSpanMinDuration=o.doubleForKey("ParticleLifeSpanMinDuration"),m.randomParticleSpeedMinMax=WebGraphics.makePoint(o.doubleForKey("FireworkSpeedMin"),o.doubleForKey("FireworkSpeedMax")),c%2==0?m.fireworkStartingPositionX=WebGraphics.randomBetween(0,.5):c%2==1&&(m.fireworkStartingPositionX=WebGraphics.randomBetween(.5,1)),0===c&&(m.fireworkStartingPositionX=0),1===c&&(m.fireworkStartingPositionX=1);var A=WebGraphics.randomBetween(o.doubleForKey("FireworkDurationMin"),o.doubleForKey("FireworkDurationMax"));A/=n;var v=WebGraphics.randomBetween(0,1-A);c===h&&(v=0),v=Math.max(v,.001),m.lifeSpan={start:v,duration:A},m.setupWithTexture(e),l.push(m)}return l}},{key:"animationWillBeginWithContext",value:function(){var e=this.renderer,t=this.gl,i=this.animParameterGroup,r=CGRectMake(0,0,512,512),a=(CGRectMake(0,0,this.slideSize.width,this.slideSize.height),CGRectMake(0,0,1,1),CGSizeMake(2,2)),n=this.frameRect;this.fireworksSystems=[];for(var o=0,s=this.textures.length;o<s;o++){var l=this.textures[o],h={x:l.offset.pointX-n.origin.x,y:l.offset.pointY+l.height-(n.origin.y+n.size.height)},c=WebGraphics.makeOrthoMatrix4(0,n.size.width,0,n.size.height,-1,1),u=WebGraphics.translateMatrix4(c,h.x,-h.y,0),d=new TSDGLShader(t);d.initWithDefaultTextureAndOpacityShader(),d.setMat4WithTransform3D(u,kTSDGLShaderUniformMVPMatrix),d.setGLint(0,kTSDGLShaderUniformTexture);var f=l.textureRect,m=CGRectMake(0,0,f.size.width,f.size.height),p=new TSDGLDataBuffer(t);p.initWithVertexRect(m,TSDRectUnit,a,!1,!1);var A=e.slideProjectionMatrix;A=WebGraphics.translateMatrix4(A,h.x,-h.y,0);var v=this.p_fireworksSystemsForTR(l);this.p_setupFBOWithSize(n.size);var g=this.fboShader=new TSDGLShader(t);g.initWithShaderFileNames("fireworkstrails","fireworkstrails"),g.setMat4WithTransform3D(c,kTSDGLShaderUniformMVPMatrix),g.setGLint(0,kTSDGLShaderUniformTexture),(this.fboDataBuffer=new TSDGLDataBuffer(t)).initWithVertexRect(CGRectMake(0,0,n.size.width,n.size.height),TSDRectUnit,a,!1,!1);var y=this.centerBurstShader=new TSDGLShader(t);y.initWithDefaultTextureAndOpacityShader(),y.setGLFloat(1,kTSDGLShaderUniformOpacity),(this.centerBurstDataBuffer=new TSDGLDataBuffer(t)).initWithVertexRect(r,TSDRectUnit,a,!1,!1),(this._bloomEffect=new TSDGLBloomEffect(t)).initWithEffectSize(n.size,i.doubleForKey("BloomBlurScale"));var b={baseOrthoTransform:c,baseTransform:u,objectShader:d,objectDataBuffer:p,fireworksMVP:A,systems:v};this.fireworksSystems.push(b),t.clearColor(0,0,0,0),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.DEPTH_TEST)}}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=this.program.fireworks,n=a.uniforms,o=this.buildOut,s=this.percentfinished,l=this.animParameterGroup,h=l.doubleForKey("ParticleTrailsDitherAmount"),c=l.doubleForKey("ParticleTrailsDitherMax"),u=l.doubleForKey("BloomPower");(s+=e/i)>=1&&(s=1,this.isCompleted=!0),this.percentfinished=s,r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);for(var d=0,f=this.textures.length;d<f;d++){var m=this.textures[d],p=m.initialState,A=m.animations;if(m.hasHighlightedBulletAnimation){if(!p.hidden){var v;if(A.length>0&&"opacity"===A[0].property){var g=A[0].from.scalar;v=g+(A[0].to.scalar-g)*this.percentfinished}else v=m.initialState.opacity;this.drawableObjects[d].Opacity=this.parentOpacity*v,this.drawableObjects[d].drawFrame()}}else if(m.animations.length>0){if(this.isCompleted){o||(this.drawableObjects[d].Opacity=this.parentOpacity*m.initialState.opacity,this.drawableObjects[d].drawFrame());continue}m.width,m.height,m.offset.pointX,m.offset.pointY;var y=r.viewportWidth,b=r.viewportHeight;i/=1e3;var S=s,x=TSDGLFrameBuffer.currentGLFramebuffer(r),C=this.fireworksSystems[d],w=C.objectShader,P=C.objectDataBuffer;this.p_drawObject(S,m,w,P);var T=this.framebuffer,k=this.fboShader,D=this.fboDataBuffer,E=T.currentGLTexture();T.setCurrentTextureToNext(),T.bindFramebuffer(),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,T.size.width,T.size.height),r.bindTexture(r.TEXTURE_2D,E);var B=l.doubleForKey("FireworkDurationMin")/i;B=Math.min(B/2,1);var M=WebGraphics.clamp((s-B)/(1-B),0,1),I=1-WebGraphics.mix(l.doubleForKey("TrailsFadeOutMin"),l.doubleForKey("TrailsFadeOutMax"),Math.pow(M,2));k.setGLFloat(I,kTSDGLShaderUniformOpacity),k.setGLFloat(h,kShaderUniformNoiseAmount),k.setGLFloat(c,kShaderUniformNoiseMax);var F=WebGraphics.makePoint(WebGraphics.randomBetween(0,1),WebGraphics.randomBetween(0,1));k.setPoint2D(F,kShaderUniformNoiseSeed),D.drawWithShader(this.fboShader,!0),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.useProgram(a.shaderProgram);var L=l.doubleForKey("Gravity");L*=.001*Math.min(y,b),L*=i,r.uniform1f(n.Gravity,L);var N=Math.min(y,b)*l.doubleForKey("ParticleSizeStart")/100;r.uniform1f(n.StartScale,N),r.uniform1f(n.SparklePeriod,l.doubleForKey("SparklePeriod")),this.drawParticleSystemsWithPercent(s,!1,1,C),r.viewport(0,0,r.viewportWidth,r.viewportHeight),T.unbindFramebufferAndBindGLFramebuffer(x);var G=l.doubleForKey("FireworkDurationMax");G=Math.min(G,.999);var R=WebGraphics.clamp((s-G)/(1-G),0,1),O=1-l.doubleForAnimationCurve("ParticleTransparency",R);this._bloomEffect.bindFramebuffer(),r.clear(r.COLOR_BUFFER_BIT),k.setGLFloat(O,kTSDGLShaderUniformOpacity),k.setGLFloat(0,kShaderUniformNoiseAmount),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.bindTexture(r.TEXTURE_2D,T.currentGLTexture()),D.drawWithShader(k,!0),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.useProgram(a.shaderProgram),this.drawParticleSystemsWithPercent(s,!0,O,C),this._bloomEffect.unbindFramebufferAndBindGLFramebuffer(x),r.blendFunc(r.ONE,r.ONE),this._bloomEffect.drawBloomEffectWithMVPMatrix(C.baseOrthoTransform,u,x),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)}else m.initialState.hidden||(this.drawableObjects[d].Opacity=this.parentOpacity*m.initialState.opacity,this.drawableObjects[d].drawFrame())}this.prevpercentfinished=this.percentfinished}},{key:"p_drawObject",value:function(e,t,i,r){var a=this.gl,n=this.animParameterGroup,o=n.doubleForKey("TextOpacityBeginTime"),s=n.doubleForKey("TextOpacityEndTime");e=WebGraphics.clamp((e-o)/(s-o),0,1);var l=this.parentOpacity*t.initialState.opacity;l*=n.doubleForAnimationCurve("TextOpacityTiming",e),i.setGLFloat(l,kTSDGLShaderUniformOpacity),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindTexture(a.TEXTURE_2D,t.texture),r.drawWithShader(i,!0)}},{key:"drawParticleSystemsWithPercent",value:function(e,t,i,r){this.renderer;var a=this.gl,n=this.program.fireworks,o=n.uniforms,s=this.animParameterGroup,l=r.systems,h=r.baseTransform,c=r.fireworksMVP;a.useProgram(n.shaderProgram),a.uniform1f(o.ShouldSparkle,t?1:0);for(var u=0,d=l.length;u<d;u++){var f=l[u],m=f.lifeSpan;if(!((p=(e-m.start)/m.duration)<=0||p>=1)){var p=WebGraphics.clamp(p,0,1),A=(this.prevpercentfinished-m.start)/m.duration;A=WebGraphics.clamp(A,p/2,1);var v=i;t&&(v=1-s.doubleForAnimationCurve("ParticleTransparency",p));var g=s.doubleForAnimationCurve("ParticleBurstTiming",A),y=s.doubleForAnimationCurve("ParticleBurstTiming",p);if(a.uniform1f(o.ParticleBurstTiming,y),a.uniform1f(o.PreviousParticleBurstTiming,g),a.uniform1f(o.PreviousPercent,A),!t&&!f.didDrawCenterBurst){a.bindTexture(a.TEXTURE_2D,this.fireworksCenterBurstTexture);var b=a.viewportHeight/512;b*=WebGraphics.randomBetween(s.doubleForKey("CenterBurstScaleMin"),s.doubleForKey("CenterBurstScaleMax"));var S=f._startingPoint,x=WebGraphics.translateMatrix4(h,S.x,S.y,0),C=WebGraphics.makePoint(-256*b,-256*b);x=WebGraphics.translateMatrix4(x,C.x,C.y,0),x=WebGraphics.scaleMatrix4(x,b,b,1),this.centerBurstShader.setGLFloat(s.doubleForKey("CenterBurstOpacity"),kTSDGLShaderUniformOpacity),this.centerBurstShader.setMat4WithTransform3D(x,kTSDGLShaderUniformMVPMatrix),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),this.centerBurstDataBuffer.drawWithShader(this.centerBurstShader,!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),f.didDrawCenterBurst=!0}a.useProgram(n.shaderProgram),f.setMVPMatrix(c),f.drawFrame(p,v)}}}}]),i}(),KNWebGLBuildShimmerEffect=function(){function e(t,i,r,a,n,o,s,l,h,c){_classCallCheck(this,e),this.renderer=t,this.gl=t.gl,this.program=i,this._slideRect=r,this._texture=a,this._destinationRect=n,this._translate=o,this._duration=s,this._direction=l,this._buildType=h,this._baseTransform=new Float32Array(16),this._isSetup=!1,this.parentOpacity=c,this.shimmerTexture=KNWebGLUtil.bindTextureWithImage(this.gl,shimmerImage),this.setupEffectIfNecessary()}return _createClass(e,[{key:"setupEffectIfNecessary",value:function(){if(!this._isSetup){var e=this.gl,t=this._texture,i=(CGSizeMake(2,2),{origin:{x:0,y:0},size:{width:e.viewportWidth,height:e.viewportHeight}}),r={x:t.offset.pointX-i.origin.x,y:t.offset.pointY+t.height-(i.origin.y+i.size.height)},a=WebGraphics.makeOrthoMatrix4(0,i.size.width,0,i.size.height,-1,1),n=WebGraphics.translateMatrix4(a,r.x,-r.y,0),o=t.initialState;0===o.rotation&&1===o.scale||(n=mvpMatrixWithInitialStateAffineTransform(o,n)),this._objectSystem=this.objectSystemForTR(this._texture,this._slideRect,this._duration),this._objectSystem.setMVPMatrix(n),this._objectSystem.shouldDraw&&(this._particleSystem=this.particleSystemForTR(this._texture,this._slideRect,this._duration),this._particleSystem.setMVPMatrix(n)),this.baseTransform=n,this._isSetup=!0}}},{key:"p_numberOfParticlesForTR",value:function(e,t,i){var r=this._destinationRect,a=t.size,n=r.size.width/a.width*r.size.height/a.height,o=e.size.width/r.size.width*e.size.height/r.size.height;return parseInt(Math.min(n*o*2e3,3276))}},{key:"objectSystemForTR",value:function(e,t,i){var r=e.textureRect,a=this.p_numberOfParticlesForTR(r,t,i);return new KNWebGLBuildShimmerObjectSystem(this.renderer,this.program.shimmerObject,{width:r.size.width,height:r.size.height},{width:t.size.width,height:t.size.height},i,a,e.texture,this._direction)}},{key:"particleSystemForTR",value:function(e,t,i){var r=e.textureRect,a=this.p_numberOfParticlesForTR(r,t,i);a=Math.max(2,a/40);var n=this._objectSystem.particleCount;return n+=a,n=Math.min(n,3276),new KNWebGLBuildShimmerParticleSystem(this.renderer,this.program.shimmerParticle,{width:r.size.width,height:r.size.height},{width:t.size.width,height:t.size.height},i,CGSizeMake(n,1),this._objectSystem.particleSize,this._objectSystem,this.shimmerTexture,this._direction)}},{key:"p_drawObject",value:function(e,t,i,r){var a=this.gl,n=this.parentOpacity*t.initialState.opacity;n*=TSUSineMap(e),i.setGLFloat(n,kTSDGLShaderUniformOpacity),a.bindTexture(a.TEXTURE_2D,t.texture),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),r.drawWithShader(i,!0)}},{key:"renderEffectAtPercent",value:function(e){var t=this.gl,i=this._texture;"buildOut"===this._buildType&&(e=1-e);var r=(1-e)*(1-e),a="buildIn"===this._buildType,n=(TSUReverseSquare(e)*this._duration/1e3+e)*Math.PI/2;a||(n*=-1);var o=WebGraphics.makePoint(.2,.4),s=(e-o.x)/o.y;s=TSUSineMap(s=WebGraphics.clamp(s,0,1));var l=this.parentOpacity*i.initialState.opacity;s*=l,t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.useProgram(this.program.shimmerObject.shaderProgram),this._objectSystem.setMVPMatrix(this.baseTransform),this._objectSystem.drawGLSLWithPercent(r,s,n,a,i.texture),t.useProgram(this.program.shimmerParticle.shaderProgram),this._particleSystem.setMVPMatrix(this.baseTransform),this._particleSystem.drawGLSLWithPercent(r,.5*l,n,a,this.shimmerTexture)}}]),e}(),KNWebGLBuildShimmer=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"com.apple.iWork.Keynote.KLNShimmer",programNames:["shimmerObject","shimmerParticle"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o;var s=a.gl;a.percentfinished=0,a.drawableObjects=[],a.slideOrigin={x:0,y:0},a.slideSize={width:s.viewportWidth,height:s.viewportHeight},a.slideRect={origin:a.slideOrigin,size:a.slideSize};for(var l=0,h=a.textures.length;l<h;l++){var c=r.textures[l],u=c.textureRect,d={effect:n,textures:[c]},f=a.frameOfEffectWithFrame(u),m=new KNWebGLDrawable(e,d);m.frameRect=f,a.drawableObjects.push(m)}return a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"frameOfEffectWithFrame",value:function(e){this.gl;var t={x:CGRectGetMinX(e),y:CGRectGetMinY(e)},i={x:CGRectGetMaxX(e),y:CGRectGetMaxY(e)},r=Math.max(e.size.width,e.size.height);r=Math.max(r,this.slideSize.height/3),t.y-=r,i.y+=r,t.x-=r,i.x+=r;var a=TSDRectWithPoints(t,i);return a=CGRectIntegral(a=CGRectIntersection(a,this.slideRect))}},{key:"animationWillBeginWithContext",value:function(){var e=this.renderer;this.shimmerEffects=[];for(var t=this.program,i=this.slideRect,r=this.duration,a=this.direction,n=this.type,o=this.parentOpacity,s=0,l=this.textures.length;s<l;s++){var h=this.textures[s],c=(this.textures[s].textureRect,this.drawableObjects[s].frameRect),u={x:h.offset.pointX-c.origin.x,y:h.offset.pointY+h.height-(c.origin.y+c.size.height)},d=WebGraphics.makeOrthoMatrix4(0,c.size.width,0,c.size.height,-1,1),f=WebGraphics.translateMatrix4(d,u.x,-u.y,0),m=new KNWebGLBuildShimmerEffect(e,t,i,h,c,f,r,a,n,o);this.shimmerEffects.push(m)}}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=(r.viewportWidth,r.viewportHeight,this.percentfinished);(a+=e/i)>1&&(a=1,this.isCompleted=!0),this.percentfinished=a,r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);for(var n=0,o=this.textures.length;n<o;n++){var s=this.textures[n],l=s.initialState,h=s.animations;if(s.hasHighlightedBulletAnimation){if(!l.hidden){var c;if(h.length>0&&"opacity"===h[0].property){var u=h[0].from.scalar;c=u+(h[0].to.scalar-u)*a}else c=s.initialState.opacity;this.drawableObjects[n].Opacity=this.parentOpacity*c,this.drawableObjects[n].drawFrame()}}else if(s.animations.length>0){if(this.isCompleted){this.buildIn&&(this.drawableObjects[n].Opacity=this.parentOpacity*s.initialState.opacity,this.drawableObjects[n].MVPMatrix=mvpMatrixWithInitialStateAffineTransform(l,this.drawableObjects[n].MVPMatrix),this.drawableObjects[n].drawFrame());continue}s.width,s.height,s.offset.pointX,s.offset.pointY;this.shimmerEffects[n].renderEffectAtPercent(this.percentfinished)}else s.initialState.hidden||(this.drawableObjects[n].Opacity=this.parentOpacity*s.initialState.opacity,this.drawableObjects[n].drawFrame())}}}]),i}(),KNWebGLBuildSparkleEffect=function(){function e(t,i,r,a,n,o,s,l,h,c){_classCallCheck(this,e),this.renderer=t,this.gl=t.gl,this.program=i,this._slideRect=r,this._texture=a,this._destinationRect=n,this._translate=o,this._duration=s,this._direction=l,this._buildType=h,this._baseTransform=new Float32Array(16),this._isSetup=!1,this.parentOpacity=c,this.sparkleTexture=KNWebGLUtil.bindTextureWithImage(this.gl,sparkleImage),this.setupEffectIfNecessary()}return _createClass(e,[{key:"setupEffectIfNecessary",value:function(){if(!this._isSetup){var e=this.gl,t=this._texture,i=CGSizeMake(2,2),r={origin:{x:0,y:0},size:{width:e.viewportWidth,height:e.viewportHeight}},a={x:t.offset.pointX-r.origin.x,y:t.offset.pointY+t.height-(r.origin.y+r.size.height)},n=WebGraphics.makeOrthoMatrix4(0,r.size.width,0,r.size.height,-1,1),o=WebGraphics.translateMatrix4(n,a.x,-a.y,0),s=t.initialState;0===s.rotation&&1===s.scale||(o=mvpMatrixWithInitialStateAffineTransform(s,o));var l=this._objectShader=new TSDGLShader(e);l.initWithDefaultTextureAndOpacityShader(),l.setMat4WithTransform3D(o,kTSDGLShaderUniformMVPMatrix),l.setGLint(0,kTSDGLShaderUniformTexture);var h=new TSDGLDataBufferAttribute(kTSDGLShaderAttributePosition,GL_STREAM_DRAW,GL_FLOAT,!1,2),c=new TSDGLDataBufferAttribute(kTSDGLShaderAttributeTexCoord,GL_STREAM_DRAW,GL_FLOAT,!1,2);(this._objectDataBuffer=new TSDGLDataBuffer(e)).newDataBufferWithVertexAttributes([h,c],i,!0),this.sparkleSystem=this.sparkleSystemForTR(this._texture,this._slideRect,this._duration),this.sparkleSystem.setMVPMatrix(o),this.sparkleSystem.setColor(new Float32Array([1,1,1,1])),this.baseTransform=o,this._isSetup=!0}}},{key:"p_numberOfParticlesForTR",value:function(e,t,i){var r=this._destinationRect,a=t.size,n=r.size.width/a.width*r.size.height/a.height,o=e.size.width/r.size.width*e.size.height/r.size.height;return parseInt(Math.min(n*o*2e3,3276))}},{key:"sparkleSystemForTR",value:function(e,t,i){var r=e.textureRect,a=this._slideRect.size,n=this._destinationRect,o=Math.min(n.size.width,a.width)/a.width*Math.min(n.size.height,a.height)/a.height,s=parseInt((2-Math.sqrt(o))/2*1500*this._duration/1e3);return new KNWebGLBuildSparkleSystem(this.renderer,this.program.sparkle,{width:r.size.width,height:r.size.height},{width:t.size.width,height:t.size.height},i,CGSizeMake(s,1),{width:128,height:128},this.sparkleTexture,this._direction)}},{key:"p_drawObject",value:function(e,t,i,r){var a=this.gl,n=this.parentOpacity*t.initialState.opacity;n*=TSUSineMap(e),i.setGLFloat(n,kTSDGLShaderUniformOpacity),a.bindTexture(a.TEXTURE_2D,t.texture),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),r.drawWithShader(i,!0)}},{key:"renderEffectAtPercent",value:function(e){var t=this.gl,i=this._texture,r=this._direction,a=i.textureRect,n=r===KNDirection.KNDirectionRightToLeft||r===KNDirection.KNDirectionTopToBottom,o=r===KNDirection.KNDirectionRightToLeft||r===KNDirection.KNDirectionLeftToRight,s=(this._translate,this.parentOpacity*i.initialState.opacity),l=this._duration/1e3,h=.2/l,c=a.size.width,u=a.size.height,d=e/(1-KNSparkleMaxParticleLife/Math.max(.75,l)),f=0,m=0,p=0,A=0,v=0,g=0,y=0,b=0;"buildOut"===this._buildType?(d-=h,f=o?n?0:c:0,m=o||n?0:u,p=o?n?c-c*WebGraphics.clamp(d,0,1):c*WebGraphics.clamp(d,0,1):c,A=o?u:n?u-u*WebGraphics.clamp(d,0,1):u*WebGraphics.clamp(d,0,1),v=o?n?0:1:0,g=o||n?0:1,y=o?n?1-1*WebGraphics.clamp(d,0,1):1*WebGraphics.clamp(d,0,1):1,b=o?1:n?1-1*WebGraphics.clamp(d,0,1):1*WebGraphics.clamp(d,0,1)):(d-=h,f=o&&n?c:0,m=o?0:n?u:0,p=o?n?c-c*WebGraphics.clamp(d,0,1):c*WebGraphics.clamp(d,0,1):c,A=o?u:n?u-u*WebGraphics.clamp(d,0,1):u*WebGraphics.clamp(d,0,1),v=o&&n?1:0,g=o?0:n?1:0,y=o?n?1-1*WebGraphics.clamp(d,0,1):1*WebGraphics.clamp(d,0,1):1,b=o?1:n?1-1*WebGraphics.clamp(d,0,1):1*WebGraphics.clamp(d,0,1)),t.bindTexture(t.TEXTURE_2D,i.texture),this._objectShader.setGLFloat(s,kTSDGLShaderUniformOpacity);var S=this._objectDataBuffer,x=S.vertexAttributeNamed(kTSDGLShaderAttributePosition),C=S.vertexAttributeNamed(kTSDGLShaderAttributeTexCoord);S.setGLPoint2D(WebGraphics.makePoint(f,m),x,0),S.setGLPoint2D(WebGraphics.makePoint(p,m),x,1),S.setGLPoint2D(WebGraphics.makePoint(f,A),x,2),S.setGLPoint2D(WebGraphics.makePoint(p,A),x,3),S.setGLPoint2D(WebGraphics.makePoint(v,g),C,0),S.setGLPoint2D(WebGraphics.makePoint(y,g),C,1),S.setGLPoint2D(WebGraphics.makePoint(v,b),C,2),S.setGLPoint2D(WebGraphics.makePoint(y,b),C,3),S.drawWithShader(this._objectShader,!0),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.useProgram(this.program.sparkle.shaderProgram),this.sparkleSystem.setMVPMatrix(this.baseTransform),this.sparkleSystem.drawFrame(e,1)}}]),e}(),KNWebGLBuildSparkle=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=r.effect,o={name:"com.apple.iWork.Keynote.KLNSparkle",programNames:["sparkle"],effect:n,textures:r.textures};(a=t.call(this,e,o)).programData=o;var s=a.gl;a.percentfinished=0,a.drawableObjects=[],a.slideOrigin={x:0,y:0},a.slideSize={width:s.viewportWidth,height:s.viewportHeight},a.slideRect={origin:a.slideOrigin,size:a.slideSize};for(var l=0,h=a.textures.length;l<h;l++){var c=r.textures[l],u=c.textureRect,d={effect:n,textures:[c]},f=a.frameOfEffectWithFrame(u),m=new KNWebGLDrawable(e,d);m.frameRect=f,a.drawableObjects.push(m)}return a.parentOpacity=n.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"frameOfEffectWithFrame",value:function(e){var t=WebGraphics.makePoint(CGRectGetMinX(e),CGRectGetMinY(e)),i=WebGraphics.makePoint(CGRectGetMaxX(e),CGRectGetMaxY(e)),r=Math.max(e.size.width,e.size.height);r=Math.max(r,128),t.y=Math.max(CGRectGetMinY(this.slideRect),t.y-r),i.y=Math.min(CGRectGetMaxY(this.slideRect),i.y+r),t.x=Math.max(CGRectGetMinX(this.slideRect),t.x-r),i.x=Math.min(CGRectGetMaxX(this.slideRect),i.x+r);var a=TSDRectWithPoints(t,i);return a=CGRectIntegral(a)}},{key:"animationWillBeginWithContext",value:function(){var e=this.renderer;this.sparkleEffects=[];for(var t=this.program,i=this.slideRect,r=this.duration,a=this.direction,n=this.type,o=this.parentOpacity,s=0,l=this.textures.length;s<l;s++){var h=this.textures[s],c=(a=this.direction,this.textures[s].textureRect,this.drawableObjects[s].frameRect),u={x:h.offset.pointX-c.origin.x,y:h.offset.pointY+h.height-(c.origin.y+c.size.height)},d=WebGraphics.makeOrthoMatrix4(0,c.size.width,0,c.size.height,-1,1),f=WebGraphics.translateMatrix4(d,u.x,-u.y,0),m=new KNWebGLBuildSparkleEffect(e,t,i,h,c,f,r,a,n,o);this.sparkleEffects.push(m)}}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=(r.viewportWidth,r.viewportHeight,this.buildIn),n=(this.buildOut,this.percentfinished);(n+=e/i)>1&&(n=1,this.isCompleted=!0),this.percentfinished=n,r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);for(var o=0,s=this.textures.length;o<s;o++){var l=this.textures[o],h=l.initialState,c=l.animations;if(l.hasHighlightedBulletAnimation){if(!h.hidden){var u;if(c.length>0&&"opacity"===c[0].property){var d=c[0].from.scalar;u=d+(c[0].to.scalar-d)*n}else u=l.initialState.opacity;this.drawableObjects[o].Opacity=this.parentOpacity*u,this.drawableObjects[o].drawFrame()}}else if(l.animations.length>0){if(this.isCompleted){a&&(this.drawableObjects[o].Opacity=this.parentOpacity*l.initialState.opacity,this.drawableObjects[o].MVPMatrix=mvpMatrixWithInitialStateAffineTransform(h,this.drawableObjects[o].MVPMatrix),this.drawableObjects[o].drawFrame());continue}this.sparkleEffects[o].renderEffectAtPercent(this.percentfinished)}else l.initialState.hidden||(this.drawableObjects[o].Opacity=this.parentOpacity*l.initialState.opacity,this.drawableObjects[o].drawFrame())}}}]),i}(),KNWebGLTransitionMagicMove=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=new KNWebGLCoreAnimationWrapperProgram(r);(a=t.call(this,e,n.data)).coreAnimationWrapperProgram=n;var o=a.gl;a.percentfinished=0,a.drawableObjects=[],a.slideOrigin={x:0,y:0},a.slideSize={width:o.viewportWidth,height:o.viewportHeight},a.slideRect={origin:a.slideOrigin,size:a.slideSize},a.frameRect=a.slideRect;var s=r.effect;return a.parentOpacity=s.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer;this.coreAnimationWrapperBasedEffects=[];for(var t=this.program,i=this.slideRect,r=this.duration,a=this.direction,n=this.type,o=this.parentOpacity,s=(this.parameterGroupName,0),l=this.textures.length;s<l;s++){var h=this.textures[s],c=(a=this.direction,this.textures[s].textureRect,this.frameRect),u={x:h.offset.pointX-c.origin.x,y:h.offset.pointY+h.height-(c.origin.y+c.size.height)},d=WebGraphics.makeOrthoMatrix4(0,c.size.width,0,c.size.height,-1,1),f=WebGraphics.translateMatrix4(d,u.x,-u.y,0),m=new KNWebGLCoreAnimationWrapperBasedEffect(e,t,i,h,c,f,r,a,n,o);this.coreAnimationWrapperBasedEffects.push(m)}}},{key:"drawFrame",value:function(e,t,i){for(var r=this.coreAnimationWrapperBasedEffects,a=0,n=r.length;a<n;a++)r[a].drawFrame(e,t,i)}}]),i}(),KNWebGLTransitionContentAware=function(e){_inherits(i,KNWebGLProgram);var t=_createSuper(i);function i(e,r){var a;_classCallCheck(this,i);var n=new KNWebGLCoreAnimationWrapperProgram(r);(a=t.call(this,e,n.data)).coreAnimationWrapperProgram=n,a.params=r;var o=a.gl;a.percentfinished=0,a.slideOrigin={x:0,y:0},a.slideSize={width:o.viewportWidth,height:o.viewportHeight},a.slideRect={origin:a.slideOrigin,size:a.slideSize},a.frameRect=a.slideRect;var s=r.effect;return a.parentOpacity=s.baseLayer.initialState.opacity,a.animationWillBeginWithContext(),a}return _createClass(i,[{key:"animationWillBeginWithContext",value:function(){var e=this.renderer;this.contentAwareEffects=[];for(var t=this.program,i=this.slideRect,r=this.duration,a=this.direction,n=this.type,o=this.parentOpacity,s=(this.parameterGroupName,0),l=this.textures.length;s<l;s++){var h=this.textures[s],c=(a=this.direction,this.textures[s].textureRect,this.frameRect),u={x:h.offset.pointX-c.origin.x,y:h.offset.pointY+h.height-(c.origin.y+c.size.height)},d=WebGraphics.makeOrthoMatrix4(0,c.size.width,0,c.size.height,-1,1),f=WebGraphics.translateMatrix4(d,u.x,-u.y,0),m=h.texturedRectangle,p=m.textureType,A=!(p!==TSDTextureType.Object||!m.shapePath);if(p===TSDTextureType.Text||A){var v=this.params,g=v.effect;v.textures=[h];var y=h.animations;if(y&&y.length>0)for(var b=y[0].animations,S=0,x=b.length;S<x;S++){var C=b[S];if("hidden"===C.property){g.type=C.to.scalar?"buildOut":"buildIn";break}}switch(g.name){case"apple:ca-text-shimmer":t=new KNWebGLBuildShimmer(e,v);break;case"apple:ca-text-sparkle":t=new KNWebGLBuildSparkle(e,v);break;default:t=new KNWebGLDissolve(e,v)}this.contentAwareEffects.push(t)}else{var w=new KNWebGLCoreAnimationWrapperBasedEffect(e,t,i,h,c,f,r,a,n,o);this.contentAwareEffects.push(w)}}}},{key:"drawFrame",value:function(e,t,i){for(var r=this.contentAwareEffects,a=0,n=r.length;a<n;a++){r[a].drawFrame(e,t,i)}}}]),i}(),KNWebGLTransitionShimmer=function(e){_inherits(i,KNWebGLTransitionContentAware);var t=_createSuper(i);function i(e,r){return _classCallCheck(this,i),t.call(this,e,r)}return i}(),KNWebGLTransitionSparkle=function(e){_inherits(i,KNWebGLTransitionContentAware);var t=_createSuper(i);function i(e,r){return _classCallCheck(this,i),t.call(this,e,r)}return i}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kNumCameraShakePoints=10,kParticleSize=16,smokeImage=new Image;smokeImage.src="data:image/png;base64,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";var speckImage=new Image;speckImage.src="data:image/png;base64,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";var flameImage=new Image;flameImage.src="data:image/png;base64,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";var fireworksImage=new Image;fireworksImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RkM3QzYxRTkxNTI4MTFFMEJCNUZCQkY4M0Q5QzA5QUUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkM3QzYxRUExNTI4MTFFMEJCNUZCQkY4M0Q5QzA5QUUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGQzdDNjFFNzE1MjgxMUUwQkI1RkJCRjgzRDlDMDlBRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpGQzdDNjFFODE1MjgxMUUwQkI1RkJCRjgzRDlDMDlBRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuKuqL4AAAJZSURBVHjazFfZcqMwEGRAxEfinP//jbtZXxAORarqYdsTCTsvCa7qEpijWz2aGSHFDT/vvdCpXLt9ulHEX3u33EjMo2Se9TTy8awQuUKeQmmEFIZ4pOMJORFyA3lJqMw5/0bCYM6zImSGnEkdjY6ECM1eiXtgoHESYkXIDHkF1MAdjSyiMOQfAR2NHa4NKREyQ+5AuALWwIrEsAAlbQMaoAU648YkQjK266wj4Qa4D9gCa1yvIGAASSQ9AceAM9CQGxfhYAFK7jDDNcgi8Y7wAEErI6AF2SFgTzhCUAOHehURBbjEimfrtyB9CngGdhC1xr0FXtqAbGPC480a0KyQwD29QMOhC48diIQvAa8Yn/CfhqEg+/fkjICspzXQ49qopM5UuFQI1IFI/oZxh5myA2fjykCLssWxhkD5vEsUHBuCBxA+gzzikaxWB86GXNeELsoa15UnuiA2BJyCK8qCexLymBFQm/VwwD2auqkClgxBSRXvztSADWFLz7OQTaJmODP7qZdYB2xGcPmtDRwRF5nrdtZfGllZ/PLPJdqpzzSXzoBnn7re2/JrWvWFACYd6WFb27W01onYn03p5fTruQKyCOsAz7ol0iNWNed5lxDwD8XoQL2ASzC7MTmQmn0HASdKJ679faYQRfI/Ae8QczDN6IsLqRCo9drZ9kilyuR5rhS/kwhtRrYRZUMwUAltTPXyVOGOM80okv4lAdwJ9f3/QxBbYuxKxoESRBXl7Eix/k47PplNycUecRkbkl/fki1iU7qIbfkiPkwW8Wm2iI/Tn/o8/xRgAC3fu+i/r3G+AAAAAElFTkSuQmCC";var fireworksCenterBurstImage=new Image;fireworksCenterBurstImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3NDBDQ0JGOTYzNTIxMUUyQjA3RUFENTVGMzUzRDEzNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3NDBDQ0JGQTYzNTIxMUUyQjA3RUFENTVGMzUzRDEzNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjc0MENDQkY3NjM1MjExRTJCMDdFQUQ1NUYzNTNEMTM0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjc0MENDQkY4NjM1MjExRTJCMDdFQUQ1NUYzNTNEMTM0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+EpkdvgAAbEdJREFUeNrsXe3O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";var shimmerImage=new Image;shimmerImage.src="data:image/png;base64,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";var sparkleImage=new Image;sparkleImage.src="data:image/png;base64,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";var KNWebGLParticleSystem=function(){function e(t,i,r,a,n,o,s,l){_classCallCheck(this,e),this.renderer=t,this.program=i;var h=this.gl=this.renderer.gl;this.uniforms=i.uniforms,this.attribs=i.attribs;KNWebGLUtil.enableAttribs(h,i),this.texture=l,this.objectSize=r,this.slideSize=a,this.duration=n,this.particleSize=s,this.particleSystemSize=o,this.particleCount=o.width*o.height,this.particlesWide=o.width,this.particlesHigh=o.height,this.particleSystemVisibilities=[],this.shouldDraw=!0,this.percentfinished=0}return _createClass(e,[{key:"animationWillBeginWithContext",value:function(){var e=this.gl,t=this.uniforms,i=this.attribs;void 0!==t.SpeedMax&&(this._speedMax=this.speedMax(),e.uniform1f(t.SpeedMax,this._speedMax)),void 0!==t.RotationMax&&(this._rotationMax=this.rotationMax(),e.uniform1f(t.RotationMax,this._rotationMax)),void 0!==t.Duration&&(this._duration=this.duration/1e3,e.uniform1f(t.Duration,this._duration));var r,a=this.particleSize,n=this.objectSize,o=CGRectMake(0,0,n.width,n.height),s=n.width,l=n.height;if(this.pixels){var h=e.createFramebuffer();r=new Uint8Array(s*l*4),e.bindFramebuffer(e.FRAMEBUFFER,h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&e.readPixels(0,0,s,l,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null)}var c=void 0!==i.TexCoord;e.useProgram(this.program.shaderProgram);var u=this.attributeBuffers={};u.Position=[],u.Center=[],u.TexCoord=[],u.ParticleTexCoord=[],u.Speed=[],u.Rotation=[],u.Scale=[],u.LifeSpan=[],u.Color=[];for(var d=this.numberOfVerticesPerParticle,f=0,m=this.particlesHigh;f<m;f++)for(var p=0,A=this.particlesWide;p<A;p++){var v=WebGraphics.makePoint(p,f),g=(D=this.particlesWide*v.y+v.x)*d,y=CGRectMake(p*a.width,f*a.height,a.width,a.height);!c||p!==A-1&&f!==m-1||(y=CGRectIntersection(y,o));var b=y,S=!0;if(this.pixels){for(var x=WebGraphics.makePoint4D(0,0,0,0),C=0,w=b.origin.x+b.size.width,P=b.origin.y+b.size.height,T=b.origin.y;T<P;++T)for(var k=b.origin.x;k<w;++k)if(k<s&&T<l){var D=T*s*4+4*k;if(void 0!==i.Color){var E=1;if(b.size.width>1){var B=2*(k-b.origin.x)/b.size.width-1,M=2*(T-b.origin.y)/b.size.height-1;E=1-B*B+(1-M*M)}var I=r[D],F=r[D+1],L=r[D+2],N=r[D+3],G=WebGraphics.makePoint4D(I/255,F/255,L/255,N/255);0!==G.w&&(x.x+=E*G.x/G.w,x.y+=E*G.y/G.w,x.z+=E*G.z/G.w,x.w+=E*G.w,C+=E)}else{N=r[D+3]/255;x.w+=N}}if(S=x.w>0,this.particleSystemVisibilities.push(S),void 0!==i.Color){0===C&&(C=1);var R=1/C,O=WebGraphics.multiplyPoint4DByScalar(x,R),W=u.Color;KNWebGLUtil.setPoint4DAtIndexForAttribute(O,g,W),KNWebGLUtil.setPoint4DAtIndexForAttribute(O,g+1,W),KNWebGLUtil.setPoint4DAtIndexForAttribute(O,g+2,W),KNWebGLUtil.setPoint4DAtIndexForAttribute(O,g+3,W)}}this.willOverrideStartingPoints&&(y.origin=WebGraphics.setOrigin(y.origin,this.startingPointAtIndexPoint(v)));var U=[];U[0]=WebGraphics.makePoint(y.origin.x,y.origin.y),d>1&&(U[1]=WebGraphics.makePoint(y.origin.x+y.size.width,y.origin.y),U[2]=WebGraphics.makePoint(y.origin.x+y.size.width,y.origin.y+y.size.height),U[3]=WebGraphics.makePoint(y.origin.x,y.origin.y+y.size.height));for(var K=0;K<d;K++)KNWebGLUtil.setPoint2DAtIndexForAttribute(U[K],g+K,u.Position);if(void 0!==i.Center){var V=y.origin.x+y.size.width/2,Q=y.origin.y+y.size.height/2;KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(V,Q),g,u.Center),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(V,Q),g+1,u.Center),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(V,Q),g+2,u.Center),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(V,Q),g+3,u.Center)}if(void 0!==i.TexCoord)for(K=0;K<d;K++){var z=WebGraphics.makePoint(U[K].x/n.width,U[K].y/n.height);KNWebGLUtil.setPoint2DAtIndexForAttribute(z,g+K,u.TexCoord)}if(void 0!==i.ParticleTexCoord&&(KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(0,0),g,u.ParticleTexCoord),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(1,0),g+1,u.ParticleTexCoord),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(1,1),g+2,u.ParticleTexCoord),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(0,1),g+3,u.ParticleTexCoord)),void 0!==i.Speed){var Y=this.speedAtIndexPoint(v);KNWebGLUtil.setPoint3DAtIndexForAttribute(Y,g,u.Speed),KNWebGLUtil.setPoint3DAtIndexForAttribute(Y,g+1,u.Speed),KNWebGLUtil.setPoint3DAtIndexForAttribute(Y,g+2,u.Speed),KNWebGLUtil.setPoint3DAtIndexForAttribute(Y,g+3,u.Speed)}if(void 0!==i.Rotation){var X=this.rotationAtIndexPoint(v);KNWebGLUtil.setPoint3DAtIndexForAttribute(X,g,u.Rotation),KNWebGLUtil.setPoint3DAtIndexForAttribute(X,g+1,u.Rotation),KNWebGLUtil.setPoint3DAtIndexForAttribute(X,g+2,u.Rotation),KNWebGLUtil.setPoint3DAtIndexForAttribute(X,g+3,u.Rotation)}if(void 0!==i.Scale){var H=this.scaleAtIndexPoint(v);KNWebGLUtil.setFloatAtIndexForAttribute(H,g,u.Scale),KNWebGLUtil.setFloatAtIndexForAttribute(H,g+1,u.Scale),KNWebGLUtil.setFloatAtIndexForAttribute(H,g+2,u.Scale),KNWebGLUtil.setFloatAtIndexForAttribute(H,g+3,u.Scale)}if(void 0!==i.LifeSpan){var j=this.lifeSpanAtIndexPoint(v);KNWebGLUtil.setPoint2DAtIndexForAttribute(j,g,u.LifeSpan),KNWebGLUtil.setPoint2DAtIndexForAttribute(j,g+1,u.LifeSpan),KNWebGLUtil.setPoint2DAtIndexForAttribute(j,g+2,u.LifeSpan),KNWebGLUtil.setPoint2DAtIndexForAttribute(j,g+3,u.LifeSpan)}if(void 0!==i.Color&&this.willOverrideColors){var _=this.colorAtIndexPoint(v);KNWebGLUtil.setPoint4DAtIndexForAttribute(_,g,u.Color),KNWebGLUtil.setPoint4DAtIndexForAttribute(_,g+1,u.Color),KNWebGLUtil.setPoint4DAtIndexForAttribute(_,g+2,u.Color),KNWebGLUtil.setPoint4DAtIndexForAttribute(_,g+3,u.Color)}}var q=0,J=this.elementArray=[];for(K=0;K<this.particleCount;K++)J[q++]=4*K+0,J[q++]=4*K+1,J[q++]=4*K+2,J[q++]=4*K+0,J[q++]=4*K+2,J[q++]=4*K+3;this.buffer={},KNWebGLUtil.bindAllAvailableAttributesToBuffers(e,i,u,{LifeSpan:2,Scale:1,Rotation:3,Speed:3,ParticleTexCoord:2,TexCoord:2,Center:2,Position:2,Color:4},this.buffer,e.DYNAMIC_DRAW),this.elementArrayBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.elementArrayBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(J),e.DYNAMIC_DRAW),this.uniforms.Texture&&e.uniform1i(this.uniforms.Texture,0),this.uniforms.ParticleTexture&&e.uniform1i(this.uniforms.ParticleTexture,0)}},{key:"drawFrame",value:function(e,t){var i=this.gl,r=this.program,a=this.uniforms;this.percentfinished=e,i.useProgram(r.shaderProgram),i.bindTexture(i.TEXTURE_2D,this.texture),i.uniform1f(a.Percent,e),i.uniform1f(a.Opacity,t),KNWebGLUtil.bindAllAvailableAttributesToBuffers(i,this.attribs,this.attributeBuffers,{LifeSpan:2,Scale:1,Rotation:3,Speed:3,ParticleTexCoord:2,TexCoord:2,Center:2,Position:2,Color:4},this.buffer,i.DYNAMIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.elementArrayBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.elementArray),i.DYNAMIC_DRAW),this.draw()}},{key:"draw",value:function(){var e=this.gl;e.drawElements(e.TRIANGLES,this.elementArray.length,e.UNSIGNED_SHORT,0)}},{key:"setColor",value:function(e){var t=this.gl;t.useProgram(this.program.shaderProgram),t.uniform4fv(this.uniforms.Color,e)}},{key:"setMVPMatrix",value:function(e){var t=this.gl;t.useProgram(this.program.shaderProgram),t.uniformMatrix4fv(this.uniforms.MVPMatrix,!1,e)}},{key:"indexFromPoint",value:function(e){return this.particlesWide*e.y+e.x}},{key:"point3DRandomDirection",value:function(){var e=WebGraphics.randomBetween(-1,1),t=WebGraphics.randomBetween(0,2*Math.PI),i=Math.sqrt(1-e*e);return WebGraphics.makePoint3D(i*Math.cos(t),i*Math.sin(t),e)}}],[{key:"particleSystemSizeWithRequestedNumber",value:function(e,t,i){var r=65535/i;if(e=Math.min(e,r),0===t.width&&0===t.height||this.willOverrideStartingPoints||1===e)return WebGraphics.makeSize(e,1);if(e>=t.width*t.height)return t;if(e<1)return e=1,WebGraphics.makeSize(e,1);var a=0,n=0,o=Math.round(Math.sqrt(t.width*t.height));if((a=Math.ceil(t.width/o)*Math.ceil(t.height/o))===e)return WebGraphics.makeSize(o,o);if(a<e){do{n=a,o--,a=Math.ceil(t.width/o)*Math.ceil(t.height/o)}while(a<e&&o>2);return o<=2?WebGraphics.makeSize(Math.ceil(t.width/2),Math.ceil(t.height/2)):Math.abs(a-e)<Math.abs(n-e)?WebGraphics.makeSize(Math.ceil(t.width/o),Math.ceil(t.height/o)):WebGraphics.makeSize(Math.ceil(t.width/(o+1)),Math.ceil(t.height/(o+1)))}do{n=a,o++,a=Math.ceil(t.width/o)*Math.ceil(t.height/o)}while(a>e&&o>2);return o<=2?WebGraphics.makeSize(Math.ceil(t.width/2),Math.ceil(t.height/2)):Math.abs(a-e)<Math.abs(n-e)?WebGraphics.makeSize(Math.ceil(t.width/o),Math.ceil(t.height/o)):WebGraphics.makeSize(Math.ceil(t.width/(o+1)),Math.ceil(t.height/(o+1)))}}]),e}(),KNWebGLBuildAnvilSmokeSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){var c;return _classCallCheck(this,i),(c=t.call(this,e,r,a,n,o,s,l,h)).willOverrideStartingPoints=!0,c.numberOfVerticesPerParticle=4,c.setupWithTexture(),c}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"startingPointAtIndexPoint",value:function(e){var t=this.indexFromPoint(e);return WebGraphics.makePoint(t/this.particleCount*this.objectSize.width-kParticleSize/2,kParticleSize/2)}},{key:"speedAtIndexPoint",value:function(e){var t=2*this.indexFromPoint(e)/this.particleCount-1;t=(t<0?-1:1)*Math.sqrt(Math.abs(t));var i=(Math.abs(t)+.25)*WebGraphics.randomBetween(-1,.1);return t*=WebGraphics.randomBetween(.25,1),WebGraphics.makePoint3D(5.6*this.p_anvilGlobalScale()*t,5*this.p_anvilGlobalScale()*-i,0)}},{key:"rotationAtIndexPoint",value:function(e){var t=(2*this.indexFromPoint(e)/this.particleCount-1)*WebGraphics.randomBetween(.5,1)*Math.PI;return t*=this.duration/1e3,WebGraphics.makePoint3D(0,0,t)}},{key:"scaleAtIndexPoint",value:function(e){var t=Math.abs(2*this.indexFromPoint(e)/this.particleCount-1);t+=1.25;var i=WebGraphics.randomBetween(0,1);return i*=i*i,t*=WebGraphics.mix(1,2.5,i),t*=this.p_anvilGlobalScale()/kParticleSize}},{key:"lifeSpanAtIndexPoint",value:function(e){return WebGraphics.makePoint(0,this.duration/1e3*WebGraphics.randomBetween(.15,1))}},{key:"p_anvilGlobalScale",value:function(){return WebGraphics.mix(1.25,.75,this.objectSize.width/this.slideSize.width)*(this.objectSize.width/7)}}]),i}(),KNWebGLBuildAnvilSpeckSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){var c;return _classCallCheck(this,i),(c=t.call(this,e,r,a,n,o,s,l,h)).willOverrideStartingPoints=!0,c.numberOfVerticesPerParticle=4,c.setupWithTexture(),c}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"startingPointAtIndexPoint",value:function(e){var t=this.indexFromPoint(e);return WebGraphics.makePoint(t/this.particleCount*this.objectSize.width-kParticleSize/2,kParticleSize/2)}},{key:"speedAtIndexPoint",value:function(e){var t=WebGraphics.makePoint3D(0,0,0),i=this.indexFromPoint(e);return t.x=2*i/this.particleCount-1,t.y=WebGraphics.randomBetween(.2,1),i%3!=1?(t.z=.2,t.y*=.025*(WebGraphics.randomBetween(0,1)<.5?-1:1),t.x*=10,t.y*=10):t.z=1,t.x*=5.25*this.p_anvilGlobalScale(),t.y*=4*this.p_anvilGlobalScale(),t}},{key:"rotationAtIndexPoint",value:function(e){var t=(2*this.indexFromPoint(e)/this.particleCount-1)*WebGraphics.randomBetween(.5,1)*Math.PI;return t*=this.duration/1e3,WebGraphics.makePoint3D(0,0,t)}},{key:"scaleAtIndexPoint",value:function(e){var t=this.indexFromPoint(e),i=WebGraphics.randomBetween(3,5);return t%3!=1&&(i*=3),i*=this.p_anvilGlobalScale()/kParticleSize}},{key:"lifeSpanAtIndexPoint",value:function(e){var t=this.indexFromPoint(e),i=WebGraphics.makePoint(0,Math.min(1,this.duration/1e3)*WebGraphics.randomBetween(.2,.5));return t%3!=1&&(i.y*=10),i}},{key:"p_anvilGlobalScale",value:function(){return WebGraphics.mix(1.25,.75,this.objectSize.width/this.slideSize.width)*(this.objectSize.width/7)}}]),i}(),KNWebGLBuildFlameSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l){var h;_classCallCheck(this,i);var c=a.width,u=a.height,d=KNWebGLParticleSystem.particleSystemSizeWithRequestedNumber(s,WebGraphics.makeSize(c,u),4),f=WebGraphics.makeSize(Math.ceil(c/d.width),Math.ceil(u/d.height));return(h=t.call(this,e,r,a,n,o,d,f,l)).willOverrideStartingPoints=!0,h.numberOfVerticesPerParticle=4,h}return _createClass(i,[{key:"p_setupParticleDataWithTexture",value:function(e){var t=this.gl,i=Math.round(e.width),r=Math.round(e.height),a=t.createFramebuffer(),n=new Uint8Array(i*r*4);t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE&&t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,n);for(var o,s={x:i,y:r},l={x:0,y:0},h=[],c=i,u=0;u<4*i;u+=4){for(var d=u/4,f=Number.MAX_VALUE,m=0,p=!1,A={x:d/i,y:-1},v=r-1;v>=0;v--){var g=r-v;n[4*d+v*i*4+3]/255>.1&&(f=Math.min(g,f),m=Math.max(g,m),p=!0)}p&&(A.y=m/r,s.x=Math.min(s.x,d),l.x=Math.max(l.x,d),s.y=Math.min(s.y,f),l.y=Math.max(l.y,m)),h[d]=A}o={width:l.x-s.x,height:l.y-s.y},this._actualSize=o,this._bottomRow=h,this._bottomRowCount=c,t.bindFramebuffer(t.FRAMEBUFFER,null),this.animationWillBeginWithContext();for(var y=this.attributeBuffers.Position,b=this.attributeBuffers.Center,S=this._actualSize.height/2,x=this.numberOfVerticesPerParticle,C=0,w=this.particleCount;C<w;C++){var P=C*x,T={x:y[2*P],y:y[2*P+1]};T.x-=S/2,T.y-=S/2;var k=WebGraphics.makeRect(T.x,T.y,S,S),D=WebGraphics.makePoint(T.x+S/2,T.y+S/2);KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(k.x,k.y),P,y),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(k.x+k.width,k.y),P+1,y),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(k.x+k.width,k.y+k.height),P+2,y),KNWebGLUtil.setPoint2DAtIndexForAttribute(WebGraphics.makePoint(k.x,k.y+k.height),P+3,y);for(u=0;u<4;u++)KNWebGLUtil.setPoint2DAtIndexForAttribute(D,P+u,b)}}},{key:"startingPointAtIndexPoint",value:function(e){for(var t=0,i=0,r=!1,a=0;a<this._bottomRowCount;a++)if(-1!==this._bottomRow[a].y){r=!0;break}if(this._bottomRow&&r)do{var n=WebGraphics.randomBetween(0,this._bottomRowCount-1);n=Math.round(n),t=this._bottomRow[n].x,i=this._bottomRow[n].y}while(-1===i);return{x:t*this.objectSize.width,y:i*this.objectSize.height}}},{key:"speedAtIndexPoint",value:function(e){var t=4*this.indexFromPoint(e),i=this.attributeBuffers.Position[2*t+1];i=Math.min(i,this._actualSize.height);var r=(.2*this._actualSize.height+.9*i)*(1+WebGraphics.randomBetween(0,.1)),a=WebGraphics.makePoint3D(0,r,0);return a=WebGraphics.multiplyPoint3DByScalar(a,1/this.speedMax())}},{key:"speedMax",value:function(){return 1.1*this._actualSize.height*1.1}},{key:"lifeSpanAtIndexPoint",value:function(e){var t=Math.min(1,1/Math.max(2,this._duration))*WebGraphics.randomBetween(.8,1),i=this.indexFromPoint(e)/this.particleCount;return i=i*i*.25+.75*i,i*=1-t,WebGraphics.makePoint(i,t)}},{key:"rotationAtIndexPoint",value:function(e){return WebGraphics.makePoint3D(WebGraphics.randomBetween(-1,1),0,WebGraphics.randomBetween(-1,1))}},{key:"rotationMax",value:function(){return 2*Math.PI}}]),i}(),KNWebGLBuildConfettiSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l){var h;_classCallCheck(this,i);var c=a.width,u=a.height,d=KNWebGLParticleSystem.particleSystemSizeWithRequestedNumber(s,WebGraphics.makeSize(c,u),4),f=WebGraphics.makeSize(Math.ceil(c/d.width),Math.ceil(u/d.height));return(h=t.call(this,e,r,a,n,o,d,f,l)).willOverrideStartingPoints=!1,h.numberOfVerticesPerParticle=4,h.setupWithTexture(),h}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"startingPointAtIndexPoint",value:function(e){var t=this.indexFromPoint(e);return WebGraphics.makePoint(t/this.particleCount*this.objectSize.width-kParticleSize/2,kParticleSize/2)}},{key:"speedAtIndexPoint",value:function(e){var t=.025,i=20*t,r=this.objectSize.width/this.slideSize.width*this.objectSize.height/this.slideSize.height;t*=r=1-.75*(r=Math.sqrt(r)),i*=r;var a=Math.min(this.objectSize.height,this.objectSize.width),n=a*i,o=a*t,s=(this.particleSystemSize.width*this.particleSystemSize.width+this.particleSystemSize.height*this.particleSystemSize.height)/4,l=WebGraphics.makePoint3D(WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1));l.z=-Math.abs(l.z),l=WebGraphics.multiplyPoint3DByScalar(l,n);var h=WebGraphics.makePoint3D(e.x-this.particlesWide/2,e.y-this.particlesHigh/2,0),c=h.x*h.x+h.y*h.y;h.z=Math.sqrt(s-c);var u=WebGraphics.multiplyPoint3DByScalar(h,o);return u=WebGraphics.addPoint3DToPoint3D(u,l)}},{key:"rotationAtIndexPoint",value:function(e){var t=8*Math.PI,i=WebGraphics.makePoint3D(WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1));return WebGraphics.multiplyPoint3DByScalar(i,t)}},{key:"scaleAtIndexPoint",value:function(e){return 1}}]),i}(),KNWebGLBuildDiffuseSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){var c;_classCallCheck(this,i);var u=a.width,d=a.height,f=KNWebGLParticleSystem.particleSystemSizeWithRequestedNumber(s,WebGraphics.makeSize(u,d),4),m=WebGraphics.makeSize(Math.ceil(u/f.width),Math.ceil(d/f.height));return(c=t.call(this,e,r,a,n,o,f,m,l)).willOverrideStartingPoints=!1,c.numberOfVerticesPerParticle=4,c.l2r=h,c.setupWithTexture(),c}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"speedAtIndexPoint",value:function(e){var t=this.l2r,i=WebGraphics.makePoint3D(WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1)),r=2*e.y/this.particleSystemSize.height-1;i=WebGraphics.multiplyPoint3DByScalar(i,8*(1.1-r*r));var a=WebGraphics.makePoint3D((2-Math.abs(r))*(t?-1:1),2*r,0);a=WebGraphics.multiplyPoint3DByScalar(a,5);var n=WebGraphics.addPoint3DToPoint3D(a,i);return n=WebGraphics.point3DNormalize(n)}},{key:"speedMax",value:function(){return 1.5*this.objectSize.height/Math.sqrt(this.duration/1e3)}},{key:"rotationAtIndexPoint",value:function(e){return WebGraphics.makePoint3D(WebGraphics.randomBetween(-1,1),WebGraphics.randomBetween(-1,1),0)}},{key:"rotationMax",value:function(){var e=8*Math.PI;return e}},{key:"lifeSpanAtIndexPoint",value:function(e){var t=this.l2r,i=this.particleSystemSize.width,r=WebGraphics.clamp(.8/(this.duration/1e3),.1,.9),a=(t?i-e.x:e.x)/i;return a*=1-r,WebGraphics.makePoint(a,r)}}]),i}(),KNWebGLBuildFireworksSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){var c;return _classCallCheck(this,i),(c=t.call(this,e,r,a,n,o,s,l,h)).willOverrideStartingPoints=!0,c.willOverrideColors=!0,c.numberOfVerticesPerParticle=4,c}return _createClass(i,[{key:"setupWithTexture",value:function(e){this.gl,e.width,e.height;var t=-Math.min(this.objectSize.height,this.slideSize.height/10),i=WebGraphics.randomBetween(t,this.objectSize.height);this._startingPoint=WebGraphics.makePoint(this.fireworkStartingPositionX*this.objectSize.width,i);var r=WebGraphics.colorWithHSBA(WebGraphics.randomBetween(0,1),1,1,1);this._startingColorRGB=WebGraphics.makePoint3D(r.red,r.green,r.blue),this.animationWillBeginWithContext()}},{key:"startingPointAtIndexPoint",value:function(e){return this._startingPoint}},{key:"colorAtIndexPoint",value:function(e){var t=this.point3DRandomDirection(),i=WebGraphics.multiplyPoint3DByScalar(t,this.colorRandomness),r=WebGraphics.addPoint3DToPoint3D(this._startingColorRGB,i);return r.x=WebGraphics.clamp(r.x,0,1),r.y=WebGraphics.clamp(r.y,0,1),r.z=WebGraphics.clamp(r.z,0,1),{x:r.x,y:r.y,z:r.z,w:1}}},{key:"speedAtIndexPoint",value:function(e){var t=this.point3DRandomDirection(),i=WebGraphics.randomBetween(.8,1);return WebGraphics.multiplyPoint3DByScalar(t,i)}},{key:"speedMax",value:function(){return this.maxDistance}},{key:"scaleAtIndexPoint",value:function(e){return WebGraphics.randomBetween(this.randomParticleSizeMinMax.width,this.randomParticleSizeMinMax.height)}},{key:"lifeSpanAtIndexPoint",value:function(e){return WebGraphics.makePoint(0,WebGraphics.randomBetween(this.lifeSpanMinDuration,1))}}]),i}(),KNWebGLBuildShimmerSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){return _classCallCheck(this,i),t.call(this,e,r,a,n,o,s,l,h)}return _createClass(i,[{key:"speedMax",value:function(){return.075*Math.sqrt(this.objectSize.width*this.objectSize.height)}},{key:"speedAtIndexPoint",value:function(e){var t=this.point3DRandomDirection();return t.z=0,t}}]),i}(),KNWebGLBuildShimmerObjectSystem=function(e){_inherits(i,KNWebGLBuildShimmerSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h){var c;_classCallCheck(this,i);var u=a.width,d=a.height,f=KNWebGLParticleSystem.particleSystemSizeWithRequestedNumber(s,WebGraphics.makeSize(u,d),4),m=WebGraphics.makeSize(Math.ceil(u/f.width),Math.ceil(d/f.height));return(c=t.call(this,e,r,a,n,o,f,m,l,h)).willOverrideStartingPoints=!1,c.willOverrideColors=!1,c.numberOfVerticesPerParticle=4,c.pixels=!0,c.direction=h,c.setupWithTexture(),c}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"drawGLSLWithPercent",value:function(e,t,i,r){var a=Math.max(0,1.1*e-.1),n=1-Math.min(1,TSDMixFloats(5*e,e*e,e)),o=CGAffineTransformMakeRotation(a*(r?1:-1)*2),s=WebGraphics.makeMat3WithAffineTransform(o);this.gl.uniformMatrix3fv(this.uniforms.RotationMatrix,!1,s),this.drawFrame(a,t*n)}}]),i}(),KNWebGLBuildShimmerParticleSystem=function(e){_inherits(i,KNWebGLBuildShimmerSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h,c,u){var d;_classCallCheck(this,i);var f=.48828125,m=.02,p=.3;return(d=t.call(this,e,r,a,n,o,s,l,c,u)).kNumHullPoints=20,d.willOverrideStartingPoints=!0,d.willOverrideColors=!0,d.numberOfVerticesPerParticle=4,d.direction=u,d.objectSystem=h,d.objectSystemVertexCount=4*h.particleCount,d.p_particleHullArray=[{x:p,y:p},{x:.7,y:p},{x:.7,y:.7},{x:p,y:.7},{x:f,y:.7},{x:.51171875,y:.7},{x:.51171875,y:.98},{x:f,y:.98},{x:.7,y:.51171875},{x:.98,y:.51171875},{x:.98,y:f},{x:.7,y:f},{x:f,y:m},{x:.51171875,y:m},{x:.51171875,y:p},{x:f,y:p},{x:m,y:f},{x:p,y:f},{x:p,y:.51171875},{x:m,y:.51171875}],d.setupWithTexture(),d}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext(),this.p_setupVertexData()}},{key:"p_setupVertexData",value:function(){for(var e=CGRectMake(0,0,1,1),t=(this.numberOfVerticesPerParticle,this.particleCount),i=5*this.particleCount,r=(this.attributeBuffers,{Position:[],Center:[],TexCoord:[],ParticleTexCoord:[],Speed:[],Rotation:[],Scale:[],LifeSpan:[],Color:[]}),a=0;a<t;++a){var n=4*a,o=this.attributeBuffers.Scale[n],s=WebGraphics.makePoint3D(this.attributeBuffers.Speed[3*n],this.attributeBuffers.Speed[3*n+1],this.attributeBuffers.Speed[3*n+2]),l=WebGraphics.makePoint4D(this.attributeBuffers.Color[4*n],this.attributeBuffers.Color[4*n+1],this.attributeBuffers.Color[4*n+2],this.attributeBuffers.Color[4*n+3]),h=TSDRectWithPoints(WebGraphics.makePoint(this.attributeBuffers.Position[2*n],this.attributeBuffers.Position[2*n+1]),WebGraphics.makePoint(this.attributeBuffers.Position[2*n+4],this.attributeBuffers.Position[2*n+5]));!1===this.objectSystem.particleSystemVisibilities[a]&&(h=TSDRectWithPoints(WebGraphics.makePoint(0,0),WebGraphics.makePoint(0,0)));for(var c=WebGraphics.makePoint(this.attributeBuffers.Center[2*n],this.attributeBuffers.Center[2*n+1]),u=WebGraphics.makePoint(this.attributeBuffers.LifeSpan[2*n],this.attributeBuffers.LifeSpan[2*n+1]),d=this.p_particleHullArray,f=this.kNumHullPoints,m=0;m<f;++m){var p=a*f+m,A=d[m],v=this.p_hullPoint(A,h);KNWebGLUtil.setPoint2DAtIndexForAttribute(v,p,r.Position);var g=this.p_hullPoint(A,e);KNWebGLUtil.setPoint2DAtIndexForAttribute(g,p,r.ParticleTexCoord),KNWebGLUtil.setPoint2DAtIndexForAttribute(c,p,r.Center),KNWebGLUtil.setPoint4DAtIndexForAttribute(l,p,r.Color),KNWebGLUtil.setPoint3DAtIndexForAttribute(s,p,r.Speed),KNWebGLUtil.setFloatAtIndexForAttribute(o,p,r.Scale),KNWebGLUtil.setPoint2DAtIndexForAttribute(u,p,r.LifeSpan)}}this.attributeBuffers=r;var y=this.elementArray=[],b=0;for(a=0;a<i;a++)y[b++]=4*a+0,y[b++]=4*a+1,y[b++]=4*a+2,y[b++]=4*a+0,y[b++]=4*a+2,y[b++]=4*a+3}},{key:"p_hullPoint",value:function(e,t){return WebGraphics.makePoint(t.origin.x+t.size.width*e.x,t.origin.y+t.size.height*e.y)}},{key:"startingPointAtIndexPoint",value:function(e){var t=4*this.indexFromPoint(e),i=this.objectSystemVertexCount,r=this.objectSystem.attributeBuffers.Position;if(t<i)return WebGraphics.makePoint(r[2*t],r[2*t+1]);var a=this.objectSize.width/2,n=this.objectSize.height/2,o=CGPointMake(a,n),s=WebGraphics.randomBetween(0,1),l=WebGraphics.doubleBetween(0,2*Math.PI);return CGPointMake(o.x+a*s*Math.cos(l),o.y+n*s*Math.sin(l))}},{key:"speedAtIndexPoint",value:function(e){var t=4*this.indexFromPoint(e),i=this.objectSystemVertexCount,r=this.objectSystem.attributeBuffers.Speed;return t<i?WebGraphics.makePoint3D(r[3*t],r[3*t+1],r[3*t+2]):WebGraphics.makePoint3D(0,0,0)}},{key:"scaleAtIndexPoint",value:function(e){var t=WebGraphics.randomBetween(0,1);return TSUMix(1,25,t*t)}},{key:"lifeSpanAtIndexPoint",value:function(e){if(4*this.indexFromPoint(e)<this.objectSystemVertexCount)return WebGraphics.makePoint(0,1);var t=Math.min(2/(this.duration/1e3),.9),i=TSDMixFloats(.01,.99,1-TSUReverseSquare(WebGraphics.randomBetween(0,1)));return t*=TSUReverseSquare(i),i=Math.min(i,.99-t),WebGraphics.makePoint(i,t)}},{key:"colorAtIndexPoint",value:function(e){var t=4*this.indexFromPoint(e),i=this.objectSystemVertexCount,r=this.objectSystem.attributeBuffers.Color;return t<i?WebGraphics.makePoint4D(r[4*t],r[4*t+1],r[4*t+2],r[4*t+3]):WebGraphics.makePoint4D(1,1,1,1)}},{key:"drawGLSLWithPercent",value:function(e,t,i,r){var a=CGAffineTransformMakeRotation(e*(r?1:-1)*2),n=WebGraphics.makeMat3WithAffineTransform(a);this.gl.uniformMatrix3fv(this.uniforms[kShimmerUniformRotationMatrix],!1,n);var o=1-e,s=TSUMix(o*o,25*e,Math.pow(o,15));this.gl.uniform1f(this.uniforms[kShimmerUniformParticleScalePercent],s),this.drawFrame(e,t)}}]),i}(),KNWebGLBuildSparkleSystem=function(e){_inherits(i,KNWebGLParticleSystem);var t=_createSuper(i);function i(e,r,a,n,o,s,l,h,c){var u;return _classCallCheck(this,i),(u=t.call(this,e,r,a,n,o,s,l,h)).willOverrideStartingPoints=!0,u.numberOfVerticesPerParticle=4,u.direction=c,u.cachedGlobalScale=u.p_globalScale(),u.setupWithTexture(),u}return _createClass(i,[{key:"setupWithTexture",value:function(){this.animationWillBeginWithContext()}},{key:"p_globalScale",value:function(){var e=this.objectSize,t=this.slideSize,i=Math.min(e.width,e.height),r=i/Math.min(t.width,t.height);return i=i/Math.sqrt(Math.sqrt(r))*.25}},{key:"startingPointAtIndexPoint",value:function(e){var t=.1/(this.duration/1e3),i=this.direction===KNDirection.KNDirectionTopToBottom||this.direction===KNDirection.KNDirectionBottomToTop,r=this.direction===KNDirection.KNDirectionRightToLeft||this.direction===KNDirection.KNDirectionTopToBottom,a=this.indexFromPoint(e)/this.particleCount,n=(a=r?1-a:a)+t*WebGraphics.doubleBetween(-1,1),o=Math.random();o=2*o-1,o=((o*=Math.abs(o))+1)/2;var s=i?o:n,l=i?n:o;return WebGraphics.makePoint(s*this.objectSize.width-this.particleSize.width/2,l*this.objectSize.height-this.particleSize.height/2)}},{key:"speedAtIndexPoint",value:function(e){var t=this.point3DRandomDirection();t.z*=.01;var i=Math.random();return WebGraphics.multiplyPoint3DByScalar(t,i)}},{key:"speedMax",value:function(){var e=Math.min(this.objectSize.width,this.objectSize.height),t=e/Math.min(this.slideSize.width,this.slideSize.height);return e=e/Math.pow(t,.667)*.25*1.5}},{key:"scaleAtIndexPoint",value:function(e){return this.cachedGlobalScale/this.particleSize.width}},{key:"lifeSpanAtIndexPoint",value:function(e){var t=this.indexFromPoint(e)/this.particleCount,i=KNSparkleMaxParticleLife/Math.max(.75,this.duration/1e3);return t*=1-i,WebGraphics.makePoint(t,i)}}]),i}();function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var KNWebGLCoreAnimationWrapperProjectionTransformType={Invalid:0,Orthographic:1,Perspective:2,Custom:3},KNWebGLCoreAnimationWrapperTextureDrawOptions=function e(t,i,r){_classCallCheck(this,e),this.hidden=!1,this.wantsBackFaceCulling=!1,this.isBackground=!1,this.isForeground=!0,this.isMoving=!0,this.isBlending=!1,this.opacity=1,this.textureInfo=t,this.effectDuration=i,this.baseTransform=r},KNWebGLCoreAnimationWrapperProgram=function e(t){_classCallCheck(this,e),this.name="CoreAnimationWrapperBasedEffect",this.effect=t.effect,this.textures=t.textures,this.data={name:this.name,programNames:[],effect:this.effect,textures:this.textures}},KNWebGLCoreAnimationWrapper=function(){function e(t){_classCallCheck(this,e),this.gl=t,this.setupWithContext()}return _createClass(e,[{key:"setupWithContext",value:function(){this.animParameterGroup=new KNAnimParameterGroup("timingFunction")}},{key:"renderFrameWithContext",value:function(e,t,i){for(var r,a=this.gl,n=this.animParameterGroup,o=i.textureInfo,s=o.textureRect,l=o.initialState,h=i.effectDuration,c=i.baseTransform,u=i.percent,d=i.isBlending,f={x:s.size.width/2,y:s.size.height/2},m=0,p=0,A=0,v=0,g=1,y=1,b=1,S=1,x=!1,C=0,w=0,P=1,T=1,k=0,D=o.texture,E=o.animations[0].animations,B=0,M=E.length;B<M;B++){var I=E[B],F=I.property,L=I.from,N=I.to,G=u,R=1e3*I.beginTime,O=1e3*I.duration;switch(I.timingFunction&&"Linear"!==I.timingFunction&&(G=n.doubleForAnimationCurve(I.timingFunction,u)),F){case"transform.translation":m=L.pointX,p=L.pointY,N.pointX,N.pointY,A=(N.pointX-L.pointX)*G,v=(N.pointY-L.pointY)*G;break;case"transform.rotation.z":x=!0,C=L.scalar,w=N.scalar;break;case"transform.scale.x":g=L.scalar,b=N.scalar;break;case"transform.scale.y":y=L.scalar,S=N.scalar;break;case"opacity":if(P=L.scalar,T=N.scalar,h!==O){var W=u*h;k=W<R?0:W>R+O?1:(W-R)/O,I.timingFunction&&"Linear"!==I.timingFunction&&(k=n.doubleForAnimationCurve(I.timingFunction,k))}else k=G;break;case"contents":r=o.toTexture}}var U=l.hidden?0:o.parentOpacity*l.opacity;P!==T&&(U=P+(T-P)*k),e.setGLFloat(U,kTSDGLShaderUniformOpacity);var K=WebGraphics.translateMatrix4(c,m,-p,0);K=WebGraphics.translateMatrix4(K,A,-v,0);var V=l.anchorPoint;.5===V.pointX&&.5===V.pointY||(f.x=V.pointX*s.size.width,f.y=(1-V.pointY)*s.size.height),K=WebGraphics.translateMatrix4(K,f.x,f.y,0);var Q=l.rotation;x&&(C!==Q&&(Q=C),Q+=(w-C)*G),0!==Q&&(K=WebGraphics.rotateMatrix4AboutXYZ(K,-Q,0,0,1));var z=l.scale;1!==z&&(K=WebGraphics.scaleMatrix4(K,z,z,1)),g===b&&y===S||(K=WebGraphics.scaleMatrix4(K,(b-g)*G+g,(S-y)*G+y,1)),K=WebGraphics.translateMatrix4(K,-f.x,-f.y,0),e.setMat4WithTransform3D(K,kTSDGLShaderUniformMVPMatrix),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),d?(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,D),e.setGLFloat(G,"mixFactor")):a.bindTexture(a.TEXTURE_2D,D),t.drawWithShader(e,!0)}}]),e}(),KNWebGLCoreAnimationWrapperBasedEffect=function(){function e(t,i,r,a,n,o,s,l,h,c){_classCallCheck(this,e),this.renderer=t,this.gl=t.gl,this.program=i,this.slideRect=r,this.texture=a,this.frameRect=n,this.baseTransform=o,this.duration=s,this.direction=l,this.buildType=h,this.parentOpacity=c,this.animParameterGroup=new KNAnimParameterGroup("timingFunction"),this.percentfinished=0,this.prepareAnimationWithContext(),this.animationWillBeginWithContext()}return _createClass(e,[{key:"isOrthographicProjection",value:function(){return!0}},{key:"prepareAnimationWithContext",value:function(){this.coreAnimationWrapper=this.renderer.coreAnimationWrapper,(this.textureDrawOptions=new KNWebGLCoreAnimationWrapperTextureDrawOptions(this.texture,this.duration,this.baseTransform)).isBlending=!!this.texture.toTexture}},{key:"animationWillBeginWithContext",value:function(){this.renderer;var e=this.gl,t=(this.frameRect,CGSizeMake(2,2)),i=(this.texture,this.objectShader=new TSDGLShader(e));i.initWithContentsAndOpacityShader(),i.setMat4WithTransform3D(this.baseTransform,kTSDGLShaderUniformMVPMatrix),i.setGLint(0,kTSDGLShaderUniformTexture2),i.setGLint(1,kTSDGLShaderUniformTexture);var r=this.texture.textureRect,a=CGRectMake(0,0,r.size.width,r.size.height);(this.objectDataBuffer=new TSDGLDataBuffer(e)).initWithVertexRect(a,TSDRectUnit,t,!1,!1)}},{key:"drawFrame",value:function(e,t,i){this.renderer;var r=this.gl,a=(this.buildOut,this.percentfinished);(a+=e/i)>=1&&(a=1,this.isCompleted=!0),this.percentfinished=a,r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);var n=this.texture,o=(n.initialState,n.animations,this.objectShader),s=this.objectDataBuffer;if(n.animations.length>0){var l=a,h=this.textureDrawOptions;h.percent=l,this.coreAnimationWrapper.renderFrameWithContext(o,s,h)}else{var c=n.initialState.hidden?0:this.parentOpacity*n.initialState.opacity;o.setGLFloat(c,kTSDGLShaderUniformOpacity),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.bindTexture(r.TEXTURE_2D,n.texture),s.drawWithShader(o,!0)}}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var ParameterGroup={Fireworks:{FireworkSizeMax:.3,FireworkDurationMax:2,ParticleTrailsDitherMax:2,SparkleStartTime:.5,TextOpacityEndTime:.6,ParticleTransparency:{dblValue:0,controlPoints:[{x:1,y:0},{x:.718446,y:1}]},TextOpacityTiming:{dblValue:0,controlPoints:[{x:1,y:0},{x:.825627,y:1}]},BloomBlurScale:4,Gravity:20,ParticleBurstTiming:{dblValue:0,controlPoints:[{x:0,y:1},{x:.551894,y:.993738}]},ParticleSizeStart:.5,ParticleTrailsDitherAmount:.5,CenterBurstOpacity:1,BloomPower:3,ParticleSizeMax:.5,ParticleSizeMin:3,CenterBurstScaleMin:.15,TrailsFadeOutMax:.1,CenterBurstScaleMax:.3,TrailsFadeOutMin:.03,TextOpacityBeginTime:.1,ParticleCount:200,SparklePeriod:13,ParticleColorRandomness:.09,FireworkSpeedMax:1,FireworkDurationMin:1,FireworkSizeMin:.15,ParticleLifeSpanMinDuration:.5,FireworkSpeedMin:.8,FireworksCount:2},timingFunction:{EaseIn:{controlPoints:[{x:.42,y:0},{x:1,y:1}]},EaseOut:{controlPoints:[{x:0,y:0},{x:.58,y:1}]},EaseInEaseOut:{controlPoints:[{x:.42,y:0},{x:.58,y:1}]}}},CubicBezierPath=function(){function e(t,i){_classCallCheck(this,e);var r=this.cx=3*t.x,a=this.bx=3*(i.x-t.x)-r,n=(this.ax=1-r-a,this.cy=3*t.y),o=this.by=3*(i.y-t.y)-n;this.ay=1-n-o;this.iteration=5,this.epsilon=1e-4}return _createClass(e,[{key:"bezierCurveX",value:function(e){return e*(this.cx+e*(this.bx+e*this.ax))}},{key:"bezierCurveY",value:function(e){return e*(this.cy+e*(this.by+e*this.ay))}},{key:"bezierCurveDerivativeX",value:function(e){return this.cx+e*(2*this.bx+3*this.ax*e)}},{key:"solveXForT",value:function(e){for(var t,i=this.epsilon,r=e,a=0,n=this.iteration;a<n&&(t=this.bezierCurveX(r)-e,!(Math.abs(t)<i));a++)r-=t/this.bezierCurveDerivativeX(r);return r}},{key:"yValueFromXValue",value:function(e){return this.bezierCurveY(this.solveXForT(e))}}]),e}(),KNAnimParameterGroup=function(){function e(t){_classCallCheck(this,e),this.parameterGroup=ParameterGroup[t],this.animationCurves={}}return _createClass(e,[{key:"doubleForKey",value:function(e){var t=this.parameterGroup[e].dblValue;return t||(t=this.parameterGroup[e]),t}},{key:"boolForKey",value:function(e){var t=this.parameterGroup[e].dblValue;return t||(t=this.parameterGroup[e]),t>0}},{key:"doubleForAnimationCurve",value:function(e,t){return this.pathForAnimationCurve(e).yValueFromXValue(t)}},{key:"pathForAnimationCurve",value:function(e){var t=this.animationCurves[e];if(!t){var i=this.parameterGroup[e];t=new CubicBezierPath(i.controlPoints[0],i.controlPoints[1]),this.animationCurves[e]=t}return t}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var CHAR_MAX=127,UCHAR_MAX=255,SHRT_MAX=32767,USHRT_MAX=65535,GL_FALSE=0,GL_TRUE=1,GL_POINTS=0,GL_LINES=1,GL_LINE_LOOP=2,GL_LINE_STRIP=3,GL_TRIANGLES=4,GL_TRIANGLE_STRIP=5,GL_TRIANGLE_FAN=6,GL_BYTE=5120,GL_UNSIGNED_BYTE=5121,GL_SHORT=5122,GL_UNSIGNED_SHORT=5123,GL_INT=5124,GL_UNSIGNED_INT=5125,GL_FLOAT=5126,GL_DOUBLE=5130,GL_STREAM_DRAW=35040,GL_STATIC_DRAW=35044,GL_DYNAMIC_DRAW=35048,GL_FLOAT_VEC2=35664,GL_FLOAT_VEC3=35665,GL_FLOAT_VEC4=35666,GL_INT_VEC2=35667,GL_INT_VEC3=35668,GL_INT_VEC4=35669,GL_BOOL=35670,GL_BOOL_VEC2=35671,GL_BOOL_VEC3=35672,GL_BOOL_VEC4=35673,GL_FLOAT_MAT2=35674,GL_FLOAT_MAT3=35675,GL_FLOAT_MAT4=35676,GL_SAMPLER_1D=35677,GL_SAMPLER_2D=35678,GL_SAMPLER_3D=35679,GL_SAMPLER_CUBE=35680,TSDGLDataBufferDataTypeUnknown=0,TSDGLDataBufferDataTypeByte=GL_BYTE,TSDGLDataBufferDataTypeUnsignedByte=GL_UNSIGNED_BYTE,TSDGLDataBufferDataTypeShort=GL_SHORT,TSDGLDataBufferDataTypeUnsignedShort=GL_UNSIGNED_SHORT,TSDGLDataBufferDataTypeFloat=GL_FLOAT;function TSDGLDataBufferDataTypeAsGLEnum(e){var t=0;switch(e){case TSDGLDataBufferDataTypeByte:t=GL_BYTE;break;case TSDGLDataBufferDataTypeUnsignedByte:t=GL_UNSIGNED_BYTE;break;case TSDGLDataBufferDataTypeUnsignedShort:t=GL_UNSIGNED_SHORT;break;case TSDGLDataBufferDataTypeShort:t=GL_SHORT;break;case TSDGLDataBufferDataTypeFloat:t=GL_FLOAT;break;case TSDGLDataBufferDataTypeUnknown:console.log("Unknown TSDGLdataBufferDataType!")}return t}function TSDGLDataBufferDataTypeSize(e){var t=0;switch(e){case GL_BYTE:case GL_UNSIGNED_BYTE:t=1;break;case GL_SHORT:case GL_UNSIGNED_SHORT:t=2;break;case GL_FLOAT:t=4}return t}function TSDGLbyteFromFloat(e,t){return t&&(e*=CHAR_MAX),e}function TSDGLPoint2DByteFromPoint2D(e,t){var i=TSDGLbyteFromFloat(e.x,t),r=TSDGLbyteFromFloat(e.y,t),a=new Int8Array(2);return a.set([i,r],0),a}function TSDGLubyteFromFloat(e,t){return t&&(e*=UCHAR_MAX),e}function TSDGLPoint2DUnsignedByteFromPoint2D(e,t){var i=TSDGLubyteFromFloat(e.x,t),r=TSDGLubyteFromFloat(e.y,t),a=new Uint8Array(2);return a.set([i,r],0),a}function TSDGLshortFromFloat(e,t){return t&&(e*=SHRT_MAX),e}function TSDGLPoint2DShortFromPoint2D(e,t){var i=TSDGLshortFromFloat(e.x,t),r=TSDGLshortFromFloat(e.y,t),a=new Int16Array(4);return a.set([i,r],0),a}function TSDGLushortFromFloat(e,t){return t&&(e*=USHRT_MAX),e}function TSDGLPoint2DUnsignedShortFromPoint2D(e,t){var i=TSDGLushortFromFloat(e.x,t),r=TSDGLushortFromFloat(e.y,t),a=new Uint16Array(4);return a.set([i,r],0),a}function TSDGLDataBufferSetGLPoint2DWithDataType(e,t,i,r,a){switch(i){case TSDGLDataBufferDataTypeByte:var n=TSDGLPoint2DByteFromPoint2D(a,r);new Int8Array(e).set(n,t);break;case TSDGLDataBufferDataTypeUnsignedByte:n=TSDGLPoint2DUnsignedByteFromPoint2D(a,r);new Uint8Array(e).set(n,t);break;case TSDGLDataBufferDataTypeShort:n=TSDGLPoint2DShortFromPoint2D(a,r);new Int16Array(e).set(n,t/2);break;case TSDGLDataBufferDataTypeUnsignedShort:n=TSDGLPoint2DUnsignedShortFromPoint2D(a,r);new Uint16Array(e).set(n,t/2);break;case TSDGLDataBufferDataTypeFloat:new Float32Array(e).set([a.x,a.y],t/4);break;case TSDGLDataBufferDataTypeUnknown:console.log("Unknown data type!")}}var TSDGLDataBufferAttribute=function(){function e(t,i,r,a,n){_classCallCheck(this,e),this.locationInShader=-1,this.bufferOffset=null,this.dataArrayBuffer=null,this.dataBuffer=null,this.initWithName(t,i,r,a,n)}return _createClass(e,[{key:"initWithName",value:function(e,t,i,r,a){this.name=e,this.bufferUsage=t,this.dataType=i,this.dataType===GL_SHORT&&(this.dataType=GL_FLOAT),this.componentCount=a,this.isNormalized=r,this.locationInShader=-1}}]),e}(),TSDGLDataArrayBuffer=function(){function e(t){_classCallCheck(this,e),this.gl=t,this._vertexAttributes=null,this.mVertexCount=0,this._dataTypeSizeInBytes=0,this._bufferUsage=0,this.mNeedsUpdateFirstIndex=[],this.mNeedsUpdateLastIndex=[],this.mGLData=null,this.mGLDataBufferHasBeenSetup=!1,this.mGLDataBuffers=[],this.mAttributeOffsetsDictionary=null,this.GLDataBufferEntrySize=0,this.bufferCount=1,this.currentBufferIndex=0}return _createClass(e,[{key:"initWithVertexAttributes",value:function(e,t,i){this._vertexAttributes=e.slice(),this.mVertexCount=t,this.mAttributeOffsetsDictionary={};for(var r=0,a=0,n=this._vertexAttributes.length;a<n;a++){var o=this._vertexAttributes[a];o.dataArrayBuffer=this;var s=TSDGLDataBufferDataTypeSize(o.dataType);0===this._bufferUsage&&(this._bufferUsage=o.bufferUsage),o.bufferOffset=r;var l=o.componentCount*s;r+=l=l+3&-4,4*o.componentCount}this.GLDataBufferEntrySize=r,this.GLDataBufferEntrySize>0&&(this.mGLData=new ArrayBuffer(this.mVertexCount*this.GLDataBufferEntrySize)),this.bufferCount=i,this.mNeedsUpdateFirstIndex=[],this.mNeedsUpdateLastIndex=[];for(a=0;a<i;a++)this.mNeedsUpdateFirstIndex[a]=-1,this.mNeedsUpdateLastIndex[a]=-1}},{key:"p_setupGLDataBufferIfNecessary",value:function(){var e=this.gl;if(!this.mGLDataBufferHasBeenSetup){for(var t=0;t<this.bufferCount;t++)this.mGLDataBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.mGLDataBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.mGLData,this._bufferUsage),this.mNeedsUpdateFirstIndex[t]=-1,this.mNeedsUpdateLastIndex[t]=-1;this.mGLDataBufferHasBeenSetup=!0}}},{key:"updateDataBufferIfNecessary",value:function(){if(this.p_setupGLDataBufferIfNecessary(),this.hasUpdatedData())if(this._bufferUsage!==GL_STATIC_DRAW){for(var e=this.gl,t=Number.MAX_SAFE_INTEGER,i=-1,r=0;r<this.bufferCount;r++){var a=this.mNeedsUpdateFirstIndex[r];-1!==a&&(t=Math.min(t,a)),-1!==this.mNeedsUpdateLastIndex[r]&&(i=Math.max(i,this.mNeedsUpdateLastIndex[r]))}var n=t;n*=this.GLDataBufferEntrySize,this.GLDataBufferEntrySize,e.bindBuffer(e.ARRAY_BUFFER,this.mGLDataBuffers[this.currentBufferIndex]),e.bufferSubData(e.ARRAY_BUFFER,n,this.mGLData),this.mNeedsUpdateFirstIndex[this.currentBufferIndex]=-1,this.mNeedsUpdateLastIndex[this.currentBufferIndex]=-1}else console.log("We're GL_STATIC_DRAW but trying (and FAILING) to update the array after initial setup!")}},{key:"p_bufferOffsetOfAttribute",value:function(e,t,i){var r=t*this.GLDataBufferEntrySize;return r+=e.bufferOffset,0!==i&&(r+=TSDGLDataBufferDataTypeSize(e.dataType)*i),r}},{key:"setGLPoint2D",value:function(e,t,i){var r=this.p_bufferOffsetOfAttribute(t,i,0);TSDGLDataBufferSetGLPoint2DWithDataType(this.mGLData,r,t.dataType,t.isNormalized,e),this.addIndexNeedsUpdate(i)}},{key:"enableVertexAttributeArrayBuffersWithShader",value:function(e){var t=this.gl;this.updateDataBufferIfNecessary(),t.bindBuffer(t.ARRAY_BUFFER,this.mGLDataBuffers[this.currentBufferIndex]);for(var i=0,r=this._vertexAttributes.length;i<r;i++){var a=this._vertexAttributes[i],n=a.locationInShader;-1===n&&(-1===(n=e.locationForAttribute(a.name))&&console.log("Could not find attribute "+a.name+"in shader!"),a.locationInShader=n);var o=0;this._vertexAttributes.length>1&&(o=this.GLDataBufferEntrySize);var s=TSDGLDataBufferDataTypeAsGLEnum(a.dataType);t.enableVertexAttribArray(n),t.vertexAttribPointer(n,a.componentCount,s,a.isNormalized?GL_TRUE:GL_FALSE,o,a.bufferOffset)}}},{key:"disableVertexAttributeArrayBuffersWithShader",value:function(e){for(var t=this.gl,i=0,r=this._vertexAttributes.length;i<r;i++){var a=this._vertexAttributes[i];t.disableVertexAttribArray(a.locationInShader)}t.bindBuffer(t.ARRAY_BUFFER,null)}},{key:"hasUpdatedData",value:function(){for(var e=0;e<this.bufferCount;e++)if(-1!==this.mNeedsUpdateFirstIndex[e])return!0;return!1}},{key:"addIndexNeedsUpdate",value:function(e){var t=this.currentBufferIndex,i=this.mNeedsUpdateFirstIndex,r=this.mNeedsUpdateLastIndex;i[t]=-1===i[t]?e:Math.min(i[t],e),r[t]=-1===r[t]?e:Math.max(r[t],e)}}]),e}(),TSDGLDataBuffer=function(){function e(t){_classCallCheck(this,e),this.gl=t,this.mCurrentBufferIndex=0,this.mArrayBuffers=[],this.mAttributeToArrayBuffersDictionary={},this.mElementArrayCount=0,this.mGLElementData=null,this.mGLElementDataBufferWasSetup=!1,this.mGLElementDataBuffer=null,this.mGLElementMeshSize={width:0,height:0},this.mGLElementQuadParticleCount=0}return _createClass(e,[{key:"p_setupGLElementArrayBufferIfNecessary",value:function(){var e=this.gl;if(!this.mGLElementDataBufferWasSetup)if(this.mGLElementData){var t=0;if(CGSizeEqualToSize(this.mGLElementMeshSize,CGSizeZero)){if(0!==this.mGLElementQuadParticleCount){!0,this.drawMode=GL_TRIANGLES;for(var i=0;i<this.mGLElementQuadParticleCount;++i)this.setGLushort(4*i+0,t++),this.setGLushort(4*i+1,t++),this.setGLushort(4*i+2,t++),this.setGLushort(4*i+0,t++),this.setGLushort(4*i+2,t++),this.setGLushort(4*i+3,t++)}}else{!0;for(var r=0;r<this.mGLElementMeshSize.height-1;++r)for(var a=0;a<this.mGLElementMeshSize.width;++a)this.setGLushort((r+0)*this.mGLElementMeshSize.width+a,t++),this.setGLushort((r+1)*this.mGLElementMeshSize.width+a,t++)}this.mGLElementDataBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.mGLElementDataBuffer),this.mGLElementDataBufferWasSetup=!0}else this.mGLElementDataBufferWasSetup=!0}},{key:"newDataBufferWithVertexAttributes",value:function(e,t,i){var r=t.width*t.height,a=2*t.width*(t.height-1);this.initWithVertexAttributesDesignated(e,r,a,i),this.mGLElementMeshSize=t}},{key:"initWithVertexAttributes",value:function(e,t){var i=t.width*t.height,r=2*t.width*(t.height-1);this.initWithVertexAttributesDesignated(e,i,r,!1),this.mGLElementMeshSize=t}},{key:"initWithVertexAttributesDesignated",value:function(e,t,i,r){this._doubleBuffered=r,this.drawMode=GL_TRIANGLE_STRIP,this._vertexAttributes=e,this._vertexCount=t,this.mArrayBuffers=[],this.mAttributeToArrayBuffersDictionary={};for(var a=e.slice();a.length>0;){for(var n=a[0],o=[],s=0,l=a.length;s<l;s++){(u=a[s]).bufferUsage===n.bufferUsage&&o.push(u)}var h=r&&n.bufferUsage!==GL_STATIC_DRAW?2:1,c=new TSDGLDataArrayBuffer(this.gl);c.initWithVertexAttributes(o,t,h);for(s=0,l=o.length;s<l;s++){var u;(u=o[s]).dataBuffer=this,this.mAttributeToArrayBuffersDictionary[u.name]=c}this.mArrayBuffers.push(c);for(s=0,l=o.length;s<l;s++){var d=o[s];a.splice(a.indexOf(d),1)}}i>0&&(this.mElementArrayCount=i,this.mGLElementData=new ArrayBuffer(2*this.mElementArrayCount))}},{key:"initWithVertexRect",value:function(e,t,i,r,a){this.gl;var n,o,s=!CGRectEqualToRect(t,CGRectZero),l=[],h=new TSDGLDataBufferAttribute("Position",GL_STATIC_DRAW,GL_FLOAT,!1,2);if(l.push(h),s){var c=GL_SHORT;CGRectEqualToRect(t,CGRectMake(0,0,1,1))&&CGSizeEqualToSize(i,CGSizeMake(2,2))&&(c=GL_UNSIGNED_BYTE),n=new TSDGLDataBufferAttribute("TexCoord",GL_STATIC_DRAW,c,!0,2),l.push(n)}a&&(o=new TSDGLDataBufferAttribute("Center",GL_STATIC_DRAW,GL_FLOAT,!1,2),l.push(o)),this.initWithVertexAttributes(l,i);for(var u=0,d=TSDCenterOfRect(e),f=parseInt(i.width-1),m=parseInt(i.height-1),p=0;p<=m;++p)for(var A=0;A<=f;++A){var v=WebGraphics.makePoint(A/f,p/m),g=TSDPointFromNormalizedRect(v,e);if(this.setGLPoint2D(g,h,u),s){var y=TSDPointFromNormalizedRect(v,t);r&&(y=WebGraphics.makePoint(y.x,1-y.y)),this.setGLPoint2D(y,n,u)}a&&this.setGLPoint2D(d,o,u),u++}}},{key:"setGLPoint2D",value:function(e,t,i){t.dataArrayBuffer.setGLPoint2D(e,t,i)}},{key:"setGLushort",value:function(e,t){var i=t;new Uint16Array(this.mGLElementData).set([e],i)}},{key:"enableElementArrayBuffer",value:function(){var e=this.gl;this.p_setupGLElementArrayBufferIfNecessary(),this.mGLElementDataBufferWasSetup&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.mGLElementDataBuffer)}},{key:"disableElementArrayBuffer",value:function(){var e=this.gl;this.mGLElementDataBufferWasSetup&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},{key:"enableDataBufferWithShader",value:function(e){e.isActive||e.activate();for(var t=0,i=this.mArrayBuffers.length;t<i;t++){this.mArrayBuffers[t].enableVertexAttributeArrayBuffersWithShader(e)}this.enableElementArrayBuffer(),this._enabledShader=e,this._isEnabled=!0}},{key:"disableDataBufferWithShader",value:function(e){if(this._isEnabled){this.disableElementArrayBuffer();for(var t=0,i=this.mArrayBuffers.length;t<i;t++){this.mArrayBuffers[t].disableVertexAttributeArrayBuffersWithShader(e)}this._enabledShader=null,this._isEnabled=!1}}},{key:"drawWithShader",value:function(e,t){var i=this.gl,r={location:0,length:this.mElementArrayCount>0?this.mElementArrayCount:this._vertexCount};if(this.enableDataBufferWithShader(e),this.mGLElementDataBufferWasSetup&&this.mElementArrayCount>0)if(i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.mGLElementData,i.STATIC_DRAW),CGSizeEqualToSize(this.mGLElementMeshSize,CGSizeZero))i.drawElements(this.drawMode,r.length,i.UNSIGNED_SHORT,2*r.location);else for(var a=this.mGLElementMeshSize.width,n=0;n<this.mGLElementMeshSize.height-1;++n)i.drawElements(this.drawMode,2*a,i.UNSIGNED_SHORT,2*n*a*2);else i.drawArrays(this.drawMode,r.location,r.length);if(this.disableDataBufferWithShader(e),this.isDoubleBuffered){this.mCurrentBufferIndex=(this.mCurrentBufferIndex+1)%2;for(var o=0,s=this.mArrayBuffers.length;o<s;o++){var l=this.mArrayBuffers[o];1!==l.bufferCount&&(l.currentBufferIndex=this.mCurrentBufferIndex)}}t&&e.deactivate()}},{key:"vertexAttributeNamed",value:function(e){for(var t in this._vertexAttributes){var i=this._vertexAttributes[t];if(i.name===e)return i}return null}}]),e}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kTSDGLShaderUniformColor="Color",kTSDGLShaderUniformDuration="Duration",kTSDGLShaderUniformMotionBlurVector="MotionBlurVector",kTSDGLShaderUniformMVPMatrix="MVPMatrix",kTSDGLShaderUniformOpacity="Opacity",kTSDGLShaderUniformParticleTexture="ParticleTexture",kTSDGLShaderUniformPercent="Percent",kTSDGLShaderUniformPreviousMVPMatrix="PreviousMVPMatrix",kTSDGLShaderUniformTexture="Texture",kTSDGLShaderUniformTextureMatrix="TextureMatrix",kTSDGLShaderUniformTextureSize="TextureSize",kTSDGLShaderUniformTexture2="Texture2",kTSDGLShaderUniformTexture2Matrix="Texture2Matrix",kTSDGLShaderUniformTexture2Size="Texture2Size",kTSDGLShaderUniformVelocityScale="VelocityScale",kTSDGLShaderUniformVelocityTexture="VelocityTexture",kTSDGLShaderAttributeCenter="Center",kTSDGLShaderAttributeColor="Color",kTSDGLShaderAttributeLifeSpan="LifeSpan",kTSDGLShaderAttributeNormal="Normal",kTSDGLShaderAttributeParticleTexCoord="ParticleTexCoord",kTSDGLShaderAttributePosition="Position",kTSDGLShaderAttributePreviousPosition="PreviousPosition",kTSDGLShaderAttributeRotation="Rotation",kTSDGLShaderAttributeScale="Scale",kTSDGLShaderAttributeSpeed="Speed",kTSDGLShaderAttributeTexCoord="TexCoord",kTSDGLShaderUniformRotationMax="RotationMax",kTSDGLShaderUniformSpeedMax="SpeedMax",TSDGLShaderQualifierType={Unknown:0,Int:1,Float:2,Vec2:3,Vec3:4,Vec4:5,Mat3:6,Mat4:7};function TSDGLShaderQualifierTypeFromGLenum(e){var t=TSDGLShaderQualifierType.Unknown;switch(e){case GL_FLOAT:t=TSDGLShaderQualifierType.Float;break;case GL_FLOAT_VEC2:t=TSDGLShaderQualifierType.Vec2;break;case GL_FLOAT_VEC3:t=TSDGLShaderQualifierType.Vec3;break;case GL_FLOAT_VEC4:t=TSDGLShaderQualifierType.Vec4;break;case GL_BOOL:case GL_SAMPLER_2D:case GL_INT:t=TSDGLShaderQualifierType.Int;break;case GL_FLOAT_MAT3:t=TSDGLShaderQualifierType.Mat3;break;case GL_FLOAT_MAT4:t=TSDGLShaderQualifierType.Mat4;break;default:console.log("Unimplemented GLenum type "+e)}return t}var TSDGLShaderQualifier=function(){function e(t,i){_classCallCheck(this,e),this.gl=t,this._uniformLocation=-1,this._needsUpdate=!0,this._name=i}return _createClass(e,[{key:"updateUniformLocationWithShaderProgramObject",value:function(e){-1===this._uniformLocation&&(this._uniformLocation=this.gl.getUniformLocation(e,this._name))}}]),e}(),TSDGLShaderQualifierInt=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._GLintValue=0,a._proposedGLintValue=0,a}return _createClass(i,[{key:"setProposedGLintValue",value:function(e){this._proposedGLintValue!==e&&(this._proposedGLintValue=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniform1i(this._uniformLocation,this._proposedGLintValue),this._GLintValue=this._proposedGLintValue,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierFloat=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._GLfloatValue=0,a._proposedGLfloatValue=0,a}return _createClass(i,[{key:"setProposedGLfloatValue",value:function(e){this._proposedGLfloatValue!==e&&(this._proposedGLfloatValue=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniform1f(this._uniformLocation,this._proposedGLfloatValue),this._GLfloatValue=this._proposedGLfloatValue,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierPoint2D=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._GLPoint2DValue={},a._proposedGLPoint2DValue={},a}return _createClass(i,[{key:"setProposedGLPoint2DValue",value:function(e){this._proposedGLPoint2DValue.x===e.x&&this._proposedGLPoint2DValue.y===e.y||(this._proposedGLPoint2DValue=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniform2fv(this._uniformLocation,[this._proposedGLPoint2DValue.x,this._proposedGLPoint2DValue.y]),this._GLPoint2DValue=this._proposedGLPoint2DValue,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierPoint3D=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._GLPoint3DValue={},a._proposedGLPoint3DValue={},a}return _createClass(i,[{key:"setProposedGLPoint3DValue",value:function(e){this._proposedGLPoint3DValue.x===e.x&&this._proposedGLPoint3DValue.y===e.y&&this._proposedGLPoint3DValue.z===e.z||(this._proposedGLPoint3DValue=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniform3fv(this._uniformLocation,[this._proposedGLPoint3DValue.x,this._proposedGLPoint3DValue.y,this._proposedGLPoint3DValue.z]),this._GLPoint3DValue=this._proposedGLPoint3DValue,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierPoint4D=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._GLPoint4DValue={},a._proposedGLPoint4DValue={},a}return _createClass(i,[{key:"setProposedGLPoint4DValue",value:function(e){this._proposedGLPoint4DValue.x===e.x&&this._proposedGLPoint4DValue.y===e.y&&this._proposedGLPoint4DValue.z===e.z&&this._proposedGLPoint4DValue.w===e.w||(this._proposedGLPoint4DValue=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniform4fv(this._uniformLocation,[this._proposedGLPoint4DValue.x,this._proposedGLPoint4DValue.y,this._proposedGLPoint4DValue.z,this._proposedGLPoint4DValue.w]),this._GLPoint4DValue=this._proposedGLPoint4DValue,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierMat3=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._affineTransform=new Float32Array(9),a._proposedAffineTransform=new Float32Array(9),a}return _createClass(i,[{key:"setProposedAffineTransform",value:function(e){CGAffineTransformEqualToTransform(this._proposedAffineTransform,e)||(this._proposedAffineTransform=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){var i=[this._proposedAffineTransform.a,this._proposedAffineTransform.b,0,this._proposedAffineTransform.c,this._proposedAffineTransform.d,0,this._proposedAffineTransform.tx,this._proposedAffineTransform.ty,1];e.uniformMatrix3fv(this._uniformLocation,!1,i),this._affineTransform=this._proposedAffineTransform,this._needsUpdate=!1}}]),i}(),TSDGLShaderQualifierMat4=function(e){_inherits(i,TSDGLShaderQualifier);var t=_createSuper(i);function i(e,r){var a;return _classCallCheck(this,i),(a=t.call(this,e,r))._transform3D=new Float32Array(16),a._proposedTransform3D=new Float32Array(16),a}return _createClass(i,[{key:"setProposedTransform3D",value:function(e){CATransform3DEqualToTransform(this._proposedTransform3D,e)||(this._proposedTransform3D=e,this._needsUpdate=!0)}},{key:"setGLUniformWithShader",value:function(e,t){e.uniformMatrix4fv(this._uniformLocation,!1,this._proposedTransform3D),this._transform3D=this._proposedTransform3D,this._needsUpdate=!1}}]),i}(),TSDGLShader=function(){function e(t){_classCallCheck(this,e),this.gl=t,this._uniforms={},this.name="",this.programObject=null,this.isActive=!1,this._uniformsNeedingUpdate=[]}return _createClass(e,[{key:"initWithDefaultTextureShader",value:function(){this.initWithShaderFileNames("defaultTexture","defaultTexture"),this.setGLint(0,kTSDGLShaderUniformTexture)}},{key:"initWithDefaultTextureAndOpacityShader",value:function(){this.initWithShaderFileNames("defaultTexture","defaultTextureAndOpacity")}},{key:"initWithDefaultHorizontalBlurShader",value:function(){this.initWithShaderFileNames("horizontalGaussianBlur","horizontalGaussianBlur"),this.setGLint(0,kTSDGLShaderUniformTexture)}},{key:"initWithDefaultVerticalBlurShader",value:function(){this.initWithShaderFileNames("verticalGaussianBlur","verticalGaussianBlur"),this.setGLint(0,kTSDGLShaderUniformTexture)}},{key:"initWithContentsShader",value:function(){this.initWithShaderFileNames("contents","contents")}},{key:"initWithContentsAndOpacityShader",value:function(){this.initWithShaderFileNames("contentsAndOpacity","contentsAndOpacity")}},{key:"initWithShaderFileNames",value:function(e,t){var i=KNWebGLShader[e].vertex,r=KNWebGLShader[t].fragment;this.initWithShaders(i,r)}},{key:"initWithShaders",value:function(e,t){var i=this.gl,r=KNWebGLUtil.loadShader(i,i.VERTEX_SHADER,e),a=KNWebGLUtil.loadShader(i,i.FRAGMENT_SHADER,t);this.programObject=KNWebGLUtil.createShaderProgram(i,r,a),this.p_updateUniformsAndAttributesFromShader()}},{key:"p_updateUniformsAndAttributesFromShader",value:function(){var e,t=this.gl,i=this.programObject;e=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(var r=0;r<e;r++){var a=(l=t.getActiveUniform(i,r)).name,n=l.type,o=(l.size,TSDGLShaderQualifierTypeFromGLenum(n));this.shaderQualifierForUniform(a,o)}var s;s=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(r=0;r<s;r++){var l;a=(l=t.getActiveAttrib(i,r)).name,n=l.type,l.size;this.locationForAttribute(a)}}},{key:"shaderQualifierForUniform",value:function(e,t){var i=this.gl,r=this._uniforms[e];if(!r){switch(t){case TSDGLShaderQualifierType.Unknown:console.log("Unknown Shader Qualifier Type!");break;case TSDGLShaderQualifierType.Int:r=new TSDGLShaderQualifierInt(i,e);break;case TSDGLShaderQualifierType.Float:r=new TSDGLShaderQualifierFloat(i,e);break;case TSDGLShaderQualifierType.Vec2:r=new TSDGLShaderQualifierPoint2D(i,e);break;case TSDGLShaderQualifierType.Vec3:r=new TSDGLShaderQualifierPoint3D(i,e);break;case TSDGLShaderQualifierType.Vec4:r=new TSDGLShaderQualifierPoint4D(i,e);break;case TSDGLShaderQualifierType.Mat3:r=new TSDGLShaderQualifierMat3(i,e);break;case TSDGLShaderQualifierType.Mat4:r=new TSDGLShaderQualifierMat4(i,e)}r.updateUniformLocationWithShaderProgramObject(this.programObject),this._uniforms[e]=r}return r}},{key:"setGLint",value:function(e,t){var i=this.shaderQualifierForUniform(t,TSDGLShaderQualifierType.Int);i.setProposedGLintValue(e),i._needsUpdate&&this._uniformsNeedingUpdate.push(i),this.p_setQualifiersIfNecessary()}},{key:"setGLFloat",value:function(e,t){var i=this.shaderQualifierForUniform(t,TSDGLShaderQualifierType.Float);i.setProposedGLfloatValue(e),i._needsUpdate&&this._uniformsNeedingUpdate.push(i),this.p_setQualifiersIfNecessary()}},{key:"setPoint2D",value:function(e,t){var i=this.shaderQualifierForUniform(t,TSDGLShaderQualifierType.Vec2);i.setProposedGLPoint2DValue(e),i._needsUpdate&&this._uniformsNeedingUpdate.push(i),this.p_setQualifiersIfNecessary()}},{key:"setMat4WithTransform3D",value:function(e,t){var i=this.shaderQualifierForUniform(t,TSDGLShaderQualifierType.Mat4);i.setProposedTransform3D(e),i._needsUpdate&&this._uniformsNeedingUpdate.push(i),this.p_setQualifiersIfNecessary()}},{key:"locationForUniform",value:function(e){var t,i=this._uniforms[e];return i&&(t=i._uniformLocation),t||(t=this.gl.getUniformLocation(this.programObject,e)),t}},{key:"locationForAttribute",value:function(e){this._attributeLocations||(this._attributeLocations={});var t=this._attributeLocations[e];return void 0===t&&(t=-1),t<0&&(t=this.gl.getAttribLocation(this.programObject,e),this._attributeLocations[e]=t),t}},{key:"p_setQualifiersIfNecessary",value:function(){if(this.isActive&&0!==this._uniformsNeedingUpdate.length){for(var e=0,t=this._uniformsNeedingUpdate.length;e<t;e++){var i=this._uniformsNeedingUpdate[e];-1===i._uniformLocation&&i.updateUniformLocationWithShaderProgramObject(this.programObject),i.setGLUniformWithShader(this.gl,this)}this._uniformsNeedingUpdate=[]}}},{key:"activate",value:function(){var e=this.gl;this.isActive||(e.useProgram(this.programObject),this.isActive=!0),this.p_setQualifiersIfNecessary()}},{key:"deactivate",value:function(){this.isActive&&(this.isActive=!1)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var TSDGLFrameBuffer=function(){function e(t,i,r){_classCallCheck(this,e),this.gl=t,this.size=i,this.textureCount=r,this.currentTextureIndex=0,this.setupFramebuffer(t,i,r)}return _createClass(e,[{key:"setupFramebuffer",value:function(e,t,i){var r=this.buffer=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r);for(var a=this.textures=[],n=0;n<i;n++){var o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),a.push(o)}e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a[this.currentTextureIndex],0),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"currentGLTexture",value:function(){return this.textures[this.currentTextureIndex]}},{key:"setCurrentTextureToNext",value:function(){var e=this.textureCount;if(this.textureCount>0){var t=(this.currentTextureIndex+1)%e;this.currentTextureIndex=t,this.bindFramebuffer()}}},{key:"bindFramebuffer",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.buffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.textures[this.currentTextureIndex],0)}},{key:"unbindFramebufferAndBindGLFramebuffer",value:function(e){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e)}}],[{key:"currentGLFramebuffer",value:function(e){return e.getParameter(e.FRAMEBUFFER_BINDING)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var kShaderUniformBloomAmount="BloomAmount",kShaderUniformBlurTexture="BlurTexture",TSDGLBloomEffect=function(){function e(t){_classCallCheck(this,e),this.gl=t}return _createClass(e,[{key:"initWithEffectSize",value:function(e,t){this._effectSize=e,this._blurBufferSize=CGSizeMake(Math.max(16,Math.ceil(e.width/t)),Math.max(16,Math.ceil(e.height/t))),this.p_setupShaders(),this.p_setupBuffers()}},{key:"p_setupShaders",value:function(){var e=this.gl,t=this._blurBufferSize,i=WebGraphics.makePoint(1/t.width,1/t.height),r=WebGraphics.makeOrthoMatrix4(0,t.width,0,t.height,-1,1),a=this._blurHorizontalShader=new TSDGLShader(e);a.initWithDefaultHorizontalBlurShader(),a.setMat4WithTransform3D(r,kTSDGLShaderUniformMVPMatrix),a.setPoint2D(i,kTSDGLShaderUniformTextureSize);var n=this._blurVerticalShader=new TSDGLShader(e);n.initWithDefaultVerticalBlurShader(),n.setMat4WithTransform3D(r,kTSDGLShaderUniformMVPMatrix),n.setPoint2D(i,kTSDGLShaderUniformTextureSize);var o=this._fboTransferShader=new TSDGLShader(e);o.initWithDefaultTextureShader(),o.setMat4WithTransform3D(r,kTSDGLShaderUniformMVPMatrix);var s=this._bloomShader=new TSDGLShader(e);s.initWithShaderFileNames("bloom","bloom"),s.setGLint(0,kTSDGLShaderUniformTexture),s.setGLint(1,kShaderUniformBlurTexture)}},{key:"p_setupBuffers",value:function(){var e=this.gl,t=this._effectSize,i=this._blurBufferSize,r=CGSizeMake(2,2),a=CGRectMake(0,0,t.width,t.height),n=CGRectMake(0,0,i.width,i.height);(this._dataBuffer=new TSDGLDataBuffer(e)).initWithVertexRect(a,TSDRectUnit,r,!1,!1),(this._blurDataBuffer=new TSDGLDataBuffer(e)).initWithVertexRect(n,CGRectZero,r,!0,!1),(this._blurTransferDataBuffer=new TSDGLDataBuffer(e)).initWithVertexRect(n,TSDRectUnit,r,!1,!1),this._colorFramebuffer=new TSDGLFrameBuffer(e,t,1),this._blurFramebuffer=new TSDGLFrameBuffer(e,i,2)}},{key:"bindFramebuffer",value:function(){this._colorFramebuffer.bindFramebuffer()}},{key:"unbindFramebufferAndBindGLFramebuffer",value:function(e){this._colorFramebuffer.unbindFramebufferAndBindGLFramebuffer(e)}},{key:"p_blurColorBufferWithPreviousFramebuffer",value:function(e){var t=this.gl,i=this._blurFramebuffer,r=this._blurBufferSize;i.bindFramebuffer(),t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,r.width,r.height),t.bindTexture(t.TEXTURE_2D,this._colorFramebuffer.currentGLTexture()),this._blurTransferDataBuffer.drawWithShader(this._fboTransferShader,!0);var a=i.currentGLTexture();i.setCurrentTextureToNext(),t.clear(t.COLOR_BUFFER_BIT),t.bindTexture(t.TEXTURE_2D,a),this._blurDataBuffer.drawWithShader(this._blurHorizontalShader,!0),t.bindTexture(t.TEXTURE_2D,null),a=i.currentGLTexture(),i.setCurrentTextureToNext(),t.clear(t.COLOR_BUFFER_BIT),t.bindTexture(t.TEXTURE_2D,a),this._blurDataBuffer.drawWithShader(this._blurVerticalShader,!0),i.unbindFramebufferAndBindGLFramebuffer(e),t.bindTexture(t.TEXTURE_2D,null)}},{key:"drawBloomEffectWithMVPMatrix",value:function(e,t,i){var r=this.gl,a=this._effectSize,n=r.getParameter(r.VIEWPORT);this.p_blurColorBufferWithPreviousFramebuffer(i),r.viewport(0,0,a.width,a.height),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._blurFramebuffer.currentGLTexture()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._colorFramebuffer.currentGLTexture());var o=this._bloomShader;o.setMat4WithTransform3D(e,kTSDGLShaderUniformMVPMatrix),o.setGLFloat(t,kShaderUniformBloomAmount),this._dataBuffer.drawWithShader(o,!0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.viewport(n[0],n[1],n[2],n[3])}}]),e}();